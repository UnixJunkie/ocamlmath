<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Math" rel="Chapter" href="Math.html"><title>Math.Matrix</title>
</head>
<body>
<code class="code"><span class="keyword">struct</span><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Introduction"><h1>Introduction</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(**
The mathematician will find in this module:
<p>
<ul>
<li>constructions to practice matrix calculus with integer and real coefficients,</li>
</ul>
<ul>
<li>common convergence acceleration methods,</li>
</ul>
<ul>
<li>methods of block matrix calculus through variant types <code class="code">float_or_array</code> and <code class="code">int_or_array</code>.</li>
</ul>

<span id="2_Conventions"><h2>Conventions</h2></span>
<p>

Vectors are rows of scalars (<code class="code">float</code> or <code class="code">int</code>), of type <code class="code">float array</code> or <code class="code">int array</code>.
<p>

A (bidimensional) matrix is a row vector,
each element of which being a row of the matrix.
Matrices are of type <code class="code">float array array</code> or <code class="code">int array array</code>.
<p>

<span id="2_Comments"><h2>Comments</h2></span>
<p>

The delivered functions are rough from workshop and require the usual care of use.
<p>

The iterative refinement of the inverse of a matrix may be stopped by testing the difference
between the product and the identity or by detecting a too weak variation of the candidate, as suggested by William Kahan in :
<p>

<code class="code">http://www.cs.berkeley.edu/~wkahan/<span class="constructor">Cantilever</span>.pdf</code>
<p>

This author confesses to be the author of the HP15C calulator's high level mathematical functions manual 
in the page 5 of :
<p>

<code class="code">http://www.cs.berkeley.edu/~wkahan/<span class="constructor">MktgMath</span>.pdf</code>
<p>

This manual is a good introduction to error analysis.
<p>

The block calculus allows to replace blocks of matrices by scalars (<code class="code">float</code> or <code class="code">int</code>).
Such a simplification implies necessary ambiguities: in a multiplication,
the block reduced to a scalar behaves like a scalar matrix; in an addition,
it behaves like a saturated matrix. Only the scalar <code class="code">0</code> behaves without ambiguity.
<p>

The matrices may be cut in blocks in a recursive way;
the obtained thickness is not limited: a square matrix of order 2 ^ n cut in a recursive way
in two parts (vertically and horizontally) would climb up to the thickness n - 1.
<p>

Increment the thickness slows down the elementary calculi on matrices.
<p>

A matrix can be invertible by block only if it is generic enough (random enough).
In this case, the calculus of the inverse with a block cutting up to the first level
may be quicker than usual inverse, for an order greater than about 1250;
the rows and columns are cut in 20 to 22 pieces between 1250 and 10000.
The increase in speed is due to the replacement of many blocks by the real <code class="code">0</code>,
which compensates the slow of block matrix operations.
<p>

On the laptop described below, the inversion of a big random matrix is about five times slower
than under <code class="code">scilab</code> compilated with <code class="code">atlas</code>, about twenty percent slower than under <code class="code">scilab</code> 
compilated without <code class="code">atlas</code>.
<p>

This module is distributed under the same licence as Ocaml.
<p>

<center>§ </center>
<p>

La mathématicienne ou le mathématicien trouvera dans ce module :
<p>
<ul>
<li>des constructions permettant de pratiquer le calcul matriciel à coefficients entiers et réels,</li>
</ul>
<ul>
<li>des méthodes usuelles d'accélération de convergence,</li>
</ul>
<ul>
<li>des méthodes de calcul matriciel par blocs, à l'aide de types variants <code class="code">float_or_array</code> et <code class="code">int_or_array</code>.</li>
</ul>

<span id="2_Conventions"><h2>Conventions</h2></span>
<p>

Les vecteurs sont des lignes de scalaires (<code class="code">float</code> ou <code class="code">int</code>), de type <code class="code">float array</code> ou <code class="code">int array</code>.
<p>

Une matrice (bidimensionnelle) est un vecteur ligne 
dont chaque élément est une ligne de la matrice. 
Les matrices sont de type <code class="code">float array array</code> ou <code class="code">int array array</code>.
<p>

<span id="2_Commentaires"><h2>Commentaires</h2></span>
<p>

Les fonctions délivrées sont brutes de fonderie et réclament les précautions habituelles d'utilisation.
<p>

Le raffinement itératif de l'inverse d'une matrice peut être arrêté par test de l'écart entre 
le produit et l'identité ou par variation du candidat trop faible, comme proposé par William Kahan dans :
<p>

<code class="code">http://www.cs.berkeley.edu/~wkahan/<span class="constructor">Cantilever</span>.pdf</code>
<p>

Cet auteur avoue être l'auteur du manuel des fonctions mathématiques de haut niveau 
de la calculette HP15C à la page 5 de :
<p>

<code class="code">http://www.cs.berkeley.edu/~wkahan/<span class="constructor">MktgMath</span>.pdf</code>
<p>

Ce manuel est une bonne introduction à l'analyse d'erreur.
<p>

Le calcul par blocs autorise de remplacer des blocs de matrices par des scalaires (<code class="code">float</code> ou <code class="code">int</code>).
Une telle simplification entraîne d'obligatoires ambiguïtés : dans une multiplication, 
le bloc réduit à un scalaire se comporte comme une matrice scalaire ; dans une addition, 
il se comporte comme une matrice saturée. Seul le scalaire <code class="code">0</code> se comporte sans ambiguïté.
<p>

Les matrices peuvent être découpées en blocs de manière récursive ;
l'épaisseur obtenue n'est pas limitée : une matrice carrée d'ordre 2 ^ n découpée récursivement 
en deux (verticalement et horizontalement) monterait jusqu'à l'épaisseur n - 1.
<p>

Incrémenter l'épaisseur ralentit les calculs élémentaires sur les matrices.
<p>

Une matrice ne peut être bloc-inversible que si elle est suffisamment générique (assez aléatoire).
Dans ce cas, le calcul de l'inverse avec un découpage par blocs au premier niveau peut
être plus rapide que l'inverse ordinaire, pour un ordre supérieur à 1250 environ ; 
les lignes et colonnes sont découpées en 20 à 22 morceaux entre 1250 et 10000.
L'augmentation de vitesse est due au remplacement de beaucoup de blocs par le réel <code class="code">0</code>,
ce qui compense la lenteur des opérations sur les matrices par blocs.
<p>

Sur la machine portable :
<p>

<pre></pre><code class="code"><span class="constructor">CPU</span>:&nbsp;<span class="constructor">AMD</span>&nbsp;<span class="constructor">Athlon</span>(tm)&nbsp;<span class="constructor">II</span>&nbsp;<span class="constructor">Dual</span>-<span class="constructor">Core</span>&nbsp;<span class="constructor">M300</span>&nbsp;(1994.94-<span class="constructor">MHz</span>&nbsp;<span class="constructor">K8</span>-<span class="keyword">class</span>&nbsp;<span class="constructor">CPU</span>)<br>
&nbsp;&nbsp;<span class="constructor">Origin</span>&nbsp;=&nbsp;<span class="string">"AuthenticAMD"</span>&nbsp;&nbsp;<span class="constructor">Id</span>&nbsp;=&nbsp;0x100f62&nbsp;&nbsp;<span class="constructor">Stepping</span>&nbsp;=&nbsp;2<br>
&nbsp;&nbsp;<span class="constructor">Features</span>=0x178bfbff&lt;<span class="constructor">FPU</span>,<span class="constructor">VME</span>,<span class="constructor">DE</span>,<span class="constructor">PSE</span>,<span class="constructor">TSC</span>,<span class="constructor">MSR</span>,<span class="constructor">PAE</span>,<span class="constructor">MCE</span>,<span class="constructor">CX8</span>,<span class="constructor">APIC</span>,<span class="constructor">SEP</span>,<span class="constructor">MTRR</span>,<span class="constructor">PGE</span>,<span class="constructor">MCA</span>,<span class="constructor">CMOV</span>,<span class="constructor">PAT</span>,<span class="constructor">PSE36</span>,<span class="constructor">CLFLUSH</span>,<span class="constructor">MMX</span>,<span class="constructor">FXSR</span>,<span class="constructor">SSE</span>,<span class="constructor">SSE2</span>,<span class="constructor">HTT</span>&gt;<br>
&nbsp;&nbsp;<span class="constructor">Features2</span>=0x802009&lt;<span class="constructor">SSE3</span>,<span class="constructor">MON</span>,<span class="constructor">CX16</span>,<span class="constructor">POPCNT</span>&gt;<br>
&nbsp;&nbsp;<span class="constructor">AMD</span>&nbsp;<span class="constructor">Features</span>=0xee500800&lt;<span class="constructor">SYSCALL</span>,<span class="constructor">NX</span>,<span class="constructor">MMX</span>+,<span class="constructor">FFXSR</span>,<span class="constructor">Page1GB</span>,<span class="constructor">RDTSCP</span>,<span class="constructor">LM</span>,3<span class="constructor">DNow</span>!+,3<span class="constructor">DNow</span>!&gt;<br>
&nbsp;&nbsp;<span class="constructor">AMD</span>&nbsp;<span class="constructor">Features2</span>=0x377f&lt;<span class="constructor">LAHF</span>,<span class="constructor">CMP</span>,<span class="constructor">SVM</span>,<span class="constructor">ExtAPIC</span>,<span class="constructor">CR8</span>,<span class="constructor">ABM</span>,<span class="constructor">SSE4A</span>,<span class="constructor">Prefetch</span>,<span class="constructor">OSVW</span>,<span class="constructor">IBS</span>,<span class="constructor">SKINIT</span>,<span class="constructor">WDT</span>&gt;<br>
&nbsp;&nbsp;<span class="constructor">TSC</span>:&nbsp;<span class="constructor">P</span>-state&nbsp;invariant<br>
real&nbsp;memory&nbsp;&nbsp;=&nbsp;4294967296&nbsp;(4096&nbsp;<span class="constructor">MB</span>)<br>
avail&nbsp;memory&nbsp;=&nbsp;4111618048&nbsp;(3921&nbsp;<span class="constructor">MB</span>)<br>
<span class="constructor">ACPI</span>&nbsp;<span class="constructor">APIC</span>&nbsp;<span class="constructor">Table</span>:&nbsp;&lt;<span class="constructor">HP</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3652&nbsp;&nbsp;&nbsp;&nbsp;&gt;<br>
<span class="constructor">FreeBSD</span>/<span class="constructor">SMP</span>:&nbsp;<span class="constructor">Multiprocessor</span>&nbsp;<span class="constructor">System</span>&nbsp;<span class="constructor">Detected</span>:&nbsp;2&nbsp;<span class="constructor">CPUs</span><br>
<span class="constructor">FreeBSD</span>/<span class="constructor">SMP</span>:&nbsp;1&nbsp;package(s)&nbsp;x&nbsp;2&nbsp;core(s)<br>
&nbsp;cpu0&nbsp;(<span class="constructor">BSP</span>):&nbsp;<span class="constructor">APIC</span>&nbsp;<span class="constructor">ID</span>:&nbsp;&nbsp;0<br>
&nbsp;cpu1&nbsp;(<span class="constructor">AP</span>):&nbsp;<span class="constructor">APIC</span>&nbsp;<span class="constructor">ID</span>:&nbsp;&nbsp;1<br>
</code><pre></pre>
<p>

l'inversion d'une grande matrice aléatoire est environ cinq fois plus lente que sous <code class="code">scilab</code> compilé 
avec <code class="code">atlas</code>, environ vingt pour cent plus lente que sous <code class="code">scilab</code> compilé sans <code class="code">atlas</code>.
<p>

Ce module est distribué selon la même licence qu'Ocaml.
<p>

<center>Copyright Stéphane Grognet </center>
<center>Laboratoire de mathématiques Jean Leray UMR 6629 CNRS </center>
<center>Fédération de recherche mathématique des Pays de la Loire </center>
<center>IREM des Pays de la Loire - Université de Nantes </center>
<center>version 0.5</center>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
@version 0.5
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
@author Stéphane Grognet
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
@since 2011, 2012, 2013
*)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Constructionsminimales"><h1>Constructions minimales</h1></span>
<span id="1_Minimalconstructions"><h1>Minimal constructions</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Util</span>&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Constructionspolymorphes"><h1>Constructions polymorphes</h1></span>
<span id="1_Polymorphicconstructions"><h1>Polymorphic constructions</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** Polymorphic functions are reputed to be slow.
<p>

Les fonctions polymorphes sont réputés lentes.*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_eq equality matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_eq&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;eq&nbsp;m&nbsp;n&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;p&nbsp;=&nbsp;<span class="constructor">Array</span>.mapi&nbsp;(&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Util</span>.array_eq&nbsp;eq&nbsp;m.(i)&nbsp;x&nbsp;)&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.fold_left&nbsp;(&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;)&nbsp;<span class="keyword">true</span>&nbsp;p&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>insert matrix row column element</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;insert&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;m&nbsp;i&nbsp;j&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;(m.(i).(j)&nbsp;&lt;-&nbsp;x)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>numrows matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;numrows&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>numcolumns matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;numcolumns&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;=&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;0&nbsp;<span class="keyword">else</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>slow_numcolumns matrix</pre> slow_numcolumns gives the number of columns even for lacunar matrices:
<p>

slow_numcolumns donne le nombre des colonnes même pour les matrices lacunaires. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;slow_numcolumns&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;long&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;long&nbsp;=&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;0&nbsp;<span class="keyword">else</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;long&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;!accu&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(i)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_max_by_row matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_max_by_row&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;<span class="constructor">Util</span>.vector_max&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_max_by_column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_max_by_column&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_max_by_row&nbsp;(&nbsp;<span class="constructor">Util</span>.transpose&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_max matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_max&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Util</span>.vector_max&nbsp;(<span class="constructor">Array</span>.map&nbsp;<span class="constructor">Util</span>.vector_max&nbsp;m)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_min_by_row matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_min_by_row&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;<span class="constructor">Util</span>.vector_min&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_min_by_column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_min_by_column&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_min_by_row&nbsp;(&nbsp;<span class="constructor">Util</span>.transpose&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_min matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_min&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Util</span>.vector_min&nbsp;(<span class="constructor">Array</span>.map&nbsp;<span class="constructor">Util</span>.vector_min&nbsp;m)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_copy copy_function vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_copy&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;copy&nbsp;v&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;=&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;[|&nbsp;|]<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;v.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;copy&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_copy copy_function matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_copy&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;copy&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;r&nbsp;&lt;=&nbsp;0&nbsp;)&nbsp;<span class="keyword">or</span>&nbsp;(&nbsp;c&nbsp;&lt;=&nbsp;0&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;[|&nbsp;[|&nbsp;|]&nbsp;|]<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;m.(0).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i)&nbsp;&lt;-&nbsp;vector_copy&nbsp;copy&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_find_last equality matrix</pre> matrix_find_last returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_find_last retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_find_last&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;eq&nbsp;x&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;(r&nbsp;-&nbsp;1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;indice&nbsp;:=&nbsp;<span class="constructor">Util</span>.vector_find_last&nbsp;eq&nbsp;x&nbsp;m.(!i)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;-1)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_find_last_first equality matrix</pre> matrix_find_last returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_find_last_first retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_find_last_first&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;eq&nbsp;x&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;(r&nbsp;-&nbsp;1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;indice&nbsp;:=&nbsp;<span class="constructor">Util</span>.vector_find_first&nbsp;eq&nbsp;x&nbsp;m.(!i)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;-1)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_find_first equality matrix</pre> matrix_find_first returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_find_first retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_find_first&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;eq&nbsp;x&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;indice&nbsp;:=&nbsp;<span class="constructor">Util</span>.vector_find_first&nbsp;eq&nbsp;x&nbsp;m.(!i)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;r)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_find_first_last equality matrix</pre> matrix_find_first returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_find_first_last retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_find_first_last&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;eq&nbsp;x&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;indice&nbsp;:=&nbsp;<span class="constructor">Util</span>.vector_find_last&nbsp;eq&nbsp;x&nbsp;m.(!i)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;r)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_find_twin equality matrix</pre> matrix_find_first returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_find_twin retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_find_twin&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;eq&nbsp;x&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;=&nbsp;min&nbsp;(r&nbsp;-&nbsp;1)&nbsp;(&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;(float&nbsp;r)&nbsp;/.&nbsp;2.&nbsp;)&nbsp;)&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;indice&nbsp;:=&nbsp;<span class="constructor">Util</span>.vector_find_twin&nbsp;eq&nbsp;x&nbsp;m.(!i)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;1&nbsp;+&nbsp;r)&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;r&nbsp;-&nbsp;1&nbsp;-&nbsp;!i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indice&nbsp;:=&nbsp;<span class="constructor">Util</span>.vector_find_twin&nbsp;eq&nbsp;x&nbsp;m.(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;j&nbsp;;&nbsp;i&nbsp;:=&nbsp;1&nbsp;+&nbsp;r)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_find_all equality matrix</pre> matrix_find_all returns <code class="code">[||]</code> if it does not find:
<p>

matrix_find_all retourne <code class="code">[||]</code> s'il ne trouve pas.*)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_find_all&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;eq&nbsp;x&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;result&nbsp;=&nbsp;ref&nbsp;[||]&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;[||]&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;[||]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;indice&nbsp;:=&nbsp;<span class="constructor">Util</span>.vector_find_all&nbsp;eq&nbsp;x&nbsp;m.(i)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;[||]&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;<span class="constructor">Array</span>.map&nbsp;(<span class="keyword">function</span>&nbsp;a&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;i&nbsp;;&nbsp;a|])&nbsp;!indice&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!result&nbsp;!index&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!result&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>extract_column column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;extract_column&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;ref[||]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;mm&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm&nbsp;(<span class="constructor">Array</span>.map&nbsp;(<span class="keyword">function</span>&nbsp;a&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">List</span>.nth&nbsp;(<span class="constructor">Array</span>.to_list&nbsp;a)&nbsp;i)&nbsp;m)&nbsp;;<br>
&nbsp;!mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_extract_column column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_extract_column&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(j:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;m.(i).(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>affect_column column_index vector matrix</pre> The size of the vector may be bigger than the number of rows of the matrix. The modification takes place on the input matrix.
<p>

La taille du vecteur peut dépassr le nombre de lignes de la matrice.
La modification a lieu sur la matrice entrée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;affect_column&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(j:int)&nbsp;v&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(j)&nbsp;&lt;-&nbsp;<span class="constructor">List</span>.nth&nbsp;(<span class="constructor">Array</span>.to_list&nbsp;v)&nbsp;i<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_affect_column column_index vector matrix</pre> The size of the vector may be bigger than the number of rows of the matrix. The modification takes place on the input matrix.
<p>

La taille du vecteur peut dépassr le nombre de lignes de la matrice. La modification a lieu sur la matrice entrée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_affect_column&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(j:int)&nbsp;(v:float&nbsp;array)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(j)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>extract_diag matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;extract_diag&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;ref[||]&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(numrows&nbsp;m)&nbsp;(numcolumns&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm&nbsp;[|m.(i).(i)|]<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;!mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>exchange_row index1 index2 matrix</pre> This function is not sealed.
<p>

Cette fonction n'est pas étanche. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;exchange_row&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;aux&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;m.(i)&nbsp;&lt;-&nbsp;m.(j)&nbsp;;<br>
&nbsp;&nbsp;m.(j)&nbsp;&lt;-&nbsp;aux&nbsp;;<br>
&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>exchange_column index1 index2 matrix</pre> This function is not sealed.
<p>

Cette fonction n'est pas étanche. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;exchange_column&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;aux&nbsp;=&nbsp;extract_column&nbsp;i&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;auxil&nbsp;=&nbsp;extract_column&nbsp;j&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;affect_column&nbsp;j&nbsp;aux&nbsp;m&nbsp;;<br>
&nbsp;&nbsp;affect_column&nbsp;i&nbsp;auxil&nbsp;m&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sub_matrix matrix beg-row end-row beg-col end-col</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sub_matrix&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;m&nbsp;i&nbsp;ii&nbsp;j&nbsp;jj&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** i et j : beginning: début ; ii et jj : end: fin *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(ii&nbsp;-&nbsp;i&nbsp;+&nbsp;1)&nbsp;(jj&nbsp;-&nbsp;j&nbsp;+&nbsp;1)&nbsp;m.(0).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;row&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;ii&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;mm.(row-i)&nbsp;&lt;-&nbsp;<span class="constructor">Array</span>.sub&nbsp;m.(row)&nbsp;j&nbsp;(jj&nbsp;-&nbsp;j&nbsp;+&nbsp;1)&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** The functions <code class="code">inline</code> and <code class="code">slice</code> are reciprocal of one another.
<p>

Les fonctions <code class="code">inline</code> et <code class="code">slice</code> sont réciproques l'une de l'autre. *)</span></td></tr></table><code class="code"><br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>inline matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;inline&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;x&nbsp;=&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;r&nbsp;*&nbsp;c&nbsp;)&nbsp;x.(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ir&nbsp;=&nbsp;i&nbsp;*&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.(&nbsp;ir&nbsp;+&nbsp;j&nbsp;)&nbsp;&lt;-&nbsp;row.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>slice vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;slice&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;v&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;l&nbsp;<span class="keyword">mod</span>&nbsp;n&nbsp;!=&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"The&nbsp;number&nbsp;of&nbsp;lines&nbsp;must&nbsp;divide&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;vector&nbsp;in&nbsp;Matrix.slice."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;l&nbsp;/&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;c&nbsp;v.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=pred&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;n&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ni&nbsp;=&nbsp;n&nbsp;*&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;v.(&nbsp;ni&nbsp;+&nbsp;j&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="1_Constructions"><h1>Constructions</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** The variants bis and ter introduce different behaviours for non square matrices.
<p>

Les variantes bis et ter introduisent des comportements différents pour les matrices non carrées. *)</span></td></tr></table><code class="code"><br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>zeros_float matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;zeros_float&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>null_float numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;null_float&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ones_float matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ones_float&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;1.&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>units_float matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;units_float&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;1.&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>fill_float matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;fill_float&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;x&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>saturate_float numrows numcolumns real</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;saturate_float&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;x&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>identity_float numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;identity_float&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>identity_float_bis numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;identity_float_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(c&nbsp;-&nbsp;r)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(&nbsp;i&nbsp;+&nbsp;delta&nbsp;)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>identity_float_ter numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;identity_float_ter&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(r&nbsp;-&nbsp;c)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(&nbsp;i&nbsp;+&nbsp;delta&nbsp;).(i)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>rank_float_matrix numrows numcolumns rank</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;rank_float_matrix&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(rank:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rank&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>eye_float matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;eye_float&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;identity_float&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>eye_float_bis matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;eye_float_bis&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;identity_float_bis&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>eye_float_ter matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;eye_float_ter&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;identity_float_ter&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>scal_float numrows numcolumns real</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;scal_float&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>scal_float_bis numrows numcolumns real</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;scal_float_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(c&nbsp;-&nbsp;r)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(&nbsp;i&nbsp;+&nbsp;delta&nbsp;)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>scal_float_ter numrows numcolumns real</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;scal_float_ter&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(r&nbsp;-&nbsp;c)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(&nbsp;i&nbsp;+&nbsp;delta&nbsp;).(i)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>diag_float vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;diag_float&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>diag_inv_float vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;diag_inv_float&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;in&nbsp;Matrix.diag_inv_float."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;1.&nbsp;/.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_permu size index1 index2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_permu&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;i&nbsp;j&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;identity_float&nbsp;n&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;0.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m.(j).(j)&nbsp;&lt;-&nbsp;0.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m.(i).(j)&nbsp;&lt;-&nbsp;1.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m.(j).(i)&nbsp;&lt;-&nbsp;1.&nbsp;;<br>
&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>oblique_float numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;oblique_float&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(s&nbsp;-&nbsp;i)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>oblique_float_bis numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;oblique_float_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(c&nbsp;-&nbsp;r)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(&nbsp;s&nbsp;-&nbsp;i&nbsp;+&nbsp;delta&nbsp;)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>oblique_float_ter numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;oblique_float_ter&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(r&nbsp;-&nbsp;c)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(&nbsp;i&nbsp;+&nbsp;delta&nbsp;).(s&nbsp;-&nbsp;i)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antiscal_float numrows numcolumns real</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antiscal_float&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(s-i)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antiscal_float_bis numrows numcolumns real</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antiscal_float_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(c&nbsp;-&nbsp;r)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(&nbsp;s&nbsp;-&nbsp;i&nbsp;+&nbsp;delta&nbsp;)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antiscal_float_ter numrows numcolumns real</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antiscal_float_ter&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(r&nbsp;-&nbsp;c)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(&nbsp;i&nbsp;+&nbsp;delta&nbsp;).(s-i)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antidiag_float numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antidiag_float&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(i).(r&nbsp;-&nbsp;1&nbsp;-&nbsp;i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antidiag_inv_float numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antidiag_inv_float&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;in&nbsp;Matrix.antidiag_inv_float."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.(i).(r&nbsp;-&nbsp;1&nbsp;-&nbsp;i)&nbsp;&lt;-&nbsp;1.&nbsp;/.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_serret_frenet vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_serret_frenet&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;r_r&nbsp;=&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;rr&nbsp;rr&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(0).(1)&nbsp;&lt;-&nbsp;v.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;r_r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(&nbsp;i&nbsp;-&nbsp;1&nbsp;)&nbsp;&lt;-&nbsp;-.&nbsp;v.(&nbsp;i&nbsp;-&nbsp;1&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;&lt;-&nbsp;v.(i)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(r).(r_r)&nbsp;&lt;-&nbsp;-.&nbsp;v.(r_r)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_random size range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.float&nbsp;x<br>
&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_sign_random size</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_sign_random&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;n&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Random</span>.bool()&nbsp;<span class="keyword">then</span>&nbsp;1.&nbsp;<span class="keyword">else</span>&nbsp;-1.<br>
&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_random_progression size range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_random_progression&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_float_random&nbsp;n&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;-&nbsp;1)&nbsp;+.&nbsp;v.(i)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_bal_random size range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*.&nbsp;2.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.float&nbsp;y)&nbsp;-.&nbsp;x<br>
&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;v&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_open_equal_subdivision beginning number_of_steps end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_open_equal_subdivision&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(n:int)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;(1.&nbsp;+.&nbsp;float&nbsp;n)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;(a&nbsp;+.&nbsp;x)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;-&nbsp;1)&nbsp;+.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_closed_equal_subdivision beginning number_of_steps end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_closed_equal_subdivision&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(n:int)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;(&nbsp;(float&nbsp;n)&nbsp;-.&nbsp;1.&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;nn&nbsp;=&nbsp;n&nbsp;/&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;nn&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;-&nbsp;1)&nbsp;+.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;n&nbsp;-&nbsp;2&nbsp;<span class="keyword">downto</span>&nbsp;nn&nbsp;+&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;+&nbsp;1)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_closed_open_equal_subdivision beginning number_of_steps end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_closed_open_equal_subdivision&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(n:int)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;(float&nbsp;n)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;-&nbsp;1)&nbsp;+.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_open_closed_equal_subdivision beginning number_of_steps end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_open_closed_equal_subdivision&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(n:int)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;(float&nbsp;n)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;n&nbsp;-&nbsp;2&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;+&nbsp;1)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_open_equal_range beginning step end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_open_equal_range&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(x:float)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;<span class="constructor">Util</span>.round&nbsp;(&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;x&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;(a&nbsp;+.&nbsp;x)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;-&nbsp;1)&nbsp;+.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_closed_equal_range beginning step end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_closed_equal_range&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(x:float)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;<span class="constructor">Util</span>.round&nbsp;(&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;x&nbsp;)&nbsp;+&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;nn&nbsp;=&nbsp;n&nbsp;/&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;nn&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;-&nbsp;1)&nbsp;+.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;n&nbsp;-&nbsp;2&nbsp;<span class="keyword">downto</span>&nbsp;nn&nbsp;+&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;+&nbsp;1)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_closed_open_equal_range beginning step end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_closed_open_equal_range&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(x:float)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;<span class="constructor">Util</span>.round&nbsp;(&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;x&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;-&nbsp;1)&nbsp;+.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_open_closed_equal_range beginning step end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_open_closed_equal_range&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(x:float)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;<span class="constructor">Util</span>.round&nbsp;(&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;x&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;n&nbsp;-&nbsp;2&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;+&nbsp;1)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_open_random_subdivision beginning number_of_steps end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_open_random_subdivision&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(n:int)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_float_random_progression&nbsp;(n&nbsp;+&nbsp;1)&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;v.(n)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;a&nbsp;+.&nbsp;x&nbsp;*.&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.sub&nbsp;v&nbsp;0&nbsp;n&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_closed_random_subdivision beginning number_of_steps end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_closed_random_subdivision&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(n:int)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_float_random_progression&nbsp;(n&nbsp;-&nbsp;1)&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;v.(n&nbsp;-&nbsp;2)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;n&nbsp;-&nbsp;2&nbsp;<span class="keyword">downto</span>&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;a&nbsp;+.&nbsp;x&nbsp;*.&nbsp;v.(i&nbsp;-&nbsp;1)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v.(0)&nbsp;&lt;-&nbsp;a&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.append&nbsp;v&nbsp;[|b|]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_closed_open_random_subdivision beginning number_of_steps end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_closed_open_random_subdivision&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(n:int)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_float_random_progression&nbsp;n&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;v.(n&nbsp;-&nbsp;1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">downto</span>&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;a&nbsp;+.&nbsp;x&nbsp;*.&nbsp;v.(i&nbsp;-&nbsp;1)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v.(0)&nbsp;&lt;-&nbsp;a&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_open_closed_random_subdivision beginning number_of_steps end</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_open_closed_random_subdivision&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(n:int)&nbsp;(b:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_float_random_progression&nbsp;n&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;(b&nbsp;-.&nbsp;a)&nbsp;/.&nbsp;v.(n&nbsp;-&nbsp;1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;a&nbsp;+.&nbsp;x&nbsp;*.&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.float&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*.&nbsp;2.<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.float&nbsp;y)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_trig_float_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_trig_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.float&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_trig_float_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_trig_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*.&nbsp;2.<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.float&nbsp;y)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_trig_float_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_trig_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.float&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_trig_float_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_trig_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*.&nbsp;2.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.float&nbsp;y)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_nil_float_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_nil_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.float&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_nil_float_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_nil_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*.&nbsp;2.<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.float&nbsp;y)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_nil_float_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_nil_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.float&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_nil_float_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_nil_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*.&nbsp;2.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.float&nbsp;y)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_unip_float_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_unip_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;1.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.float&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;m.(rr).(rr)&nbsp;&lt;-&nbsp;1.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_unip_float_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_unip_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*.&nbsp;2.<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;1.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.float&nbsp;y)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;m.(rr).(rr)&nbsp;&lt;-&nbsp;1.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_unip_float_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_unip_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;m.(0).(0)&nbsp;&lt;-&nbsp;1.&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.float&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_unip_float_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_unip_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*.&nbsp;2.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;m.(0).(0)&nbsp;&lt;-&nbsp;1.&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.float&nbsp;y)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_binome rank</pre> The Pascal triangle in floating point output.
<p>

Le triangle de Pascal en sortie réelle. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_float_binome&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;n&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;n&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|[|1.|]|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;[|1.|]&nbsp;;&nbsp;[|&nbsp;1.&nbsp;;&nbsp;1.&nbsp;|]&nbsp;|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;matrix_float_binome&nbsp;(n&nbsp;-&nbsp;1)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(&nbsp;n&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;row.(i&nbsp;-&nbsp;1)&nbsp;+.&nbsp;row.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.append&nbsp;m&nbsp;[|&nbsp;v&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_Vandermonde vector</pre> The real Vandermonde matrix.
<p>

La matrice de Vandermonde réelle. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_Vandermonde&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;v&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;xi&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;row.(j&nbsp;-&nbsp;1)&nbsp;*.&nbsp;xi<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_nil order</pre> The model nilpotent real matrix of order n and rank n - 1.
<p>

La matrice nilpotente modèle réelle d'ordre n et de rang n - 1. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_nil&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;n&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(i&nbsp;+&nbsp;1)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_Jordan order coefficient</pre> The real Jordan block of order n.
<p>

Le bloc de Jordan réel d'ordre n. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_Jordan&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i&nbsp;+&nbsp;1)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m.(n&nbsp;-&nbsp;1).(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>zeros_int matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;zeros_int&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>null_int numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;null_int&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ones_int matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ones_int&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;1&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>units_int numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;units_int&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;1&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>fill_int matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;fill_int&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;x&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>saturate_int numrows numcolumns integer</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;saturate_int&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;x&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>identity_int numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;identity_int&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>identity_int_bis numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;identity_int_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(c&nbsp;-&nbsp;r)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(&nbsp;i&nbsp;+&nbsp;delta&nbsp;)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>identity_int_ter numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;identity_int_ter&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(r&nbsp;-&nbsp;c)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(&nbsp;i&nbsp;+&nbsp;delta&nbsp;).(i)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>rank_int_matrix numrows numcolumns rank</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;rank_int_matrix&nbsp;=&nbsp;&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(rank:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rank&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>eye_int matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;eye_int&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;identity_int&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>eye_int_bis matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;eye_int_bis&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;identity_int_bis&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>eye_int_ter matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;eye_int_ter&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;identity_int_ter&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>scal_int numrows numcolumns integer</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;scal_int&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>scal_int_bis numrows numcolumns integer</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;scal_int_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(c&nbsp;-&nbsp;r)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(&nbsp;i&nbsp;+&nbsp;delta&nbsp;)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>scal_int_ter numrows numcolumns integer</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;scal_int_ter&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(r&nbsp;-&nbsp;c)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(&nbsp;i&nbsp;+&nbsp;delta&nbsp;).(i)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>diag_int vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;diag_int&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_permu size index1 index2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_permu&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;i&nbsp;j&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;identity_int&nbsp;n&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;0&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m.(j).(j)&nbsp;&lt;-&nbsp;0&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m.(i).(j)&nbsp;&lt;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m.(j).(i)&nbsp;&lt;-&nbsp;1&nbsp;;<br>
&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>oblique_int numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;oblique_int&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(s-i)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>oblique_int_bis numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;oblique_int_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(c&nbsp;-&nbsp;r)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(&nbsp;s&nbsp;-&nbsp;i&nbsp;+&nbsp;delta&nbsp;)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>oblique_int_ter numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;oblique_int_ter&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(r&nbsp;-&nbsp;c)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(&nbsp;i&nbsp;+&nbsp;delta&nbsp;).(s-i)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antiscal_int numrows numcolumns integer</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antiscal_int&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(s-i)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antiscal_int_bis numrows numcolumns integer</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antiscal_int_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(c&nbsp;-&nbsp;r)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(&nbsp;s&nbsp;-&nbsp;i&nbsp;+&nbsp;delta&nbsp;)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antiscal_int_ter numrows numcolumns integer</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antiscal_int_ter&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;0&nbsp;(r&nbsp;-&nbsp;c)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(&nbsp;i&nbsp;+&nbsp;delta&nbsp;).(s-i)&nbsp;&lt;-&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antidiag_int numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antidiag_int&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(i).(r&nbsp;-&nbsp;1&nbsp;-&nbsp;i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_random size range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.int&nbsp;x<br>
&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_sign_random size</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_sign_random&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;n&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Random</span>.bool()&nbsp;<span class="keyword">then</span>&nbsp;1&nbsp;<span class="keyword">else</span>&nbsp;-1<br>
&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_random_progression size range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_random_progression&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_int_random&nbsp;n&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i&nbsp;-&nbsp;1)&nbsp;+&nbsp;v.(i)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_bal_random size range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.int&nbsp;y)&nbsp;-&nbsp;x<br>
&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;v&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_equal_range beginning step number_of_samples</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_equal_range&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:int)&nbsp;(s:int)&nbsp;(n:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;n&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;+&nbsp;i&nbsp;*&nbsp;s&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;v&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.int&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.int&nbsp;y)&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_trig_int_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_trig_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.int&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_trig_int_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_trig_int_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*&nbsp;2<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.int&nbsp;y)&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_trig_int_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_trig_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.int&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_trig_int_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_trig_int_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.int&nbsp;y)&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_nil_int_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_nil_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.int&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_nil_int_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_nil_int_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*&nbsp;2<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.int&nbsp;y)&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_nil_int_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_nil_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.int&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_nil_int_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_nil_int_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.int&nbsp;y)&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_unip_int_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_unip_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.int&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;m.(rr).(rr)&nbsp;&lt;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>upper_unip_int_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;upper_unip_int_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*&nbsp;2<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.int&nbsp;y)&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;m.(rr).(rr)&nbsp;&lt;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_unip_int_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_unip_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;m.(0).(0)&nbsp;&lt;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Random</span>.int&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>lower_unip_int_bal_random rows columns range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;lower_unip_int_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;*&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;m.(0).(0)&nbsp;&lt;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(<span class="constructor">Random</span>.int&nbsp;y)&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_binome rank</pre> The Pascal triangle in integer output.
<p>

Le triangle de Pascal en sortie entière. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_int_binome&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;n&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;n&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|[|1|]|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;[|1|]&nbsp;;&nbsp;[|&nbsp;1&nbsp;;&nbsp;1&nbsp;|]&nbsp;|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;matrix_int_binome&nbsp;(n&nbsp;-&nbsp;1)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(&nbsp;n&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;row.(i&nbsp;-&nbsp;1)&nbsp;+&nbsp;row.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.append&nbsp;m&nbsp;[|&nbsp;v&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_Vandermonde vector</pre> The integer Vandermonde matrix.
<p>

La matrice de Vandermonde entière. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_Vandermonde&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;v&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;xi&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;row.(j&nbsp;-&nbsp;1)&nbsp;*&nbsp;xi<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_nil order</pre> The model nilpotent integer matrix of order n and rank n - 1.
<p>

La matrice nilpotente modèle entière d'ordre n et de rang n - 1. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_nil&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;n&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(i&nbsp;+&nbsp;1)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_Jordan order coefficient</pre> The integer Jordan block of order n.
<p>

Le bloc de Jordan entier d'ordre n. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_Jordan&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;row.(i&nbsp;+&nbsp;1)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;m.(n&nbsp;-&nbsp;1).(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Calcullmentairesurlesmatricesrelles"><h1>Calcul élémentaire sur les matrices réelles</h1></span>
<span id="1_Elementarycalculusforrealmatrices"><h1>Elementary calculus for real matrices</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_copy vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_copy&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_clip vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_clip&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;min&nbsp;x&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_crest real vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_crest&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;y&nbsp;&gt;&nbsp;x&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;y&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_gully real vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_gully&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;y&nbsp;&lt;&nbsp;x&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;x&nbsp;-.&nbsp;y<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>other_vector_float_copy vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;other_vector_float_copy&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_copy vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_copy&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_clip vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_clip&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;min&nbsp;x&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_crest real vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_crest&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;row_input.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;y&nbsp;&gt;&nbsp;x&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;y&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_gully real vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_gully&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;row_input.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;y&nbsp;&lt;&nbsp;x&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;-.&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_sub_matrix matrix beg-row end-row beg-col end-col</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_sub_matrix&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;i&nbsp;ii&nbsp;j&nbsp;jj&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** i et j : beginning: début ; ii et jj : end: fin *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(ii&nbsp;-&nbsp;i&nbsp;+&nbsp;1)&nbsp;(jj&nbsp;-&nbsp;j&nbsp;+&nbsp;1)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;index&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;ii&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(index)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(index&nbsp;-&nbsp;i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;indice&nbsp;=&nbsp;j&nbsp;<span class="keyword">to</span>&nbsp;jj&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(indice&nbsp;-&nbsp;j)&nbsp;&lt;-&nbsp;row_input.(indice)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_of_vector vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_of_vector&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;int_of_float&nbsp;v.(i)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_of_matrix matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_of_matrix&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;int_of_float&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_round vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_round&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Util</span>.round&nbsp;v.(i)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_round matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_round&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Util</span>.round&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_apply function matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_apply&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:float&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;f&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_transpose matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_transpose&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;c&nbsp;r&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(j).(i)&nbsp;&lt;-&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;&nbsp;&nbsp;<br>
&nbsp;&nbsp;mm;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_max vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_max&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;v.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;max&nbsp;v.(i)&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_max_by_row matrix</pre> matrix_float_max_by_row even for lacunar matrices:
<p>

matrix_float_max_by_row fonctionne même pour les matrices lacunaires. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_max_by_row&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(-.&nbsp;max_float)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;max&nbsp;row.(j)&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;accu.(i)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_max_by_column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_max_by_column&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(-.&nbsp;max_float)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;max&nbsp;m.(i).(j)&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu.(j)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_max matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_max&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-.&nbsp;max_float)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;max&nbsp;row.(j)&nbsp;!accu<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_min vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_min&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;v.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;min&nbsp;v.(i)&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_min_by_row matrix</pre> matrix_float_min_by_row even for lacunar matrices:
<p>

matrix_float_min_by_row fonctionne même pour les matrices lacunaires. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_min_by_row&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(-.&nbsp;min_float)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;min&nbsp;row.(j)&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;accu.(i)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_min_by_column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_min_by_column&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(-.&nbsp;min_float)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;min&nbsp;m.(i).(j)&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu.(j)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_min matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_min&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-.&nbsp;min_float)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;min&nbsp;row.(j)&nbsp;!accu<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_find_last element vector</pre> vector_float_find_last returns <code class="code">-1</code> if it does not find:
<p>

vector_float_find_last retourne <code class="code">-1</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_find_last&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;v.(!i)&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;-1)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;-&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!index&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_find_first element vector</pre> vector_float_find_first returns <code class="code">-1</code> if it does not find:
<p>

vector_float_find_first retourne <code class="code">-1</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_find_first&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;v.(!i)&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;!index&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_find_twin element vector</pre> vector_float_find_first returns <code class="code">-1</code> if it does not find:
<p>

vector_float_find_twin retourne <code class="code">-1</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_find_twin&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;=&nbsp;min&nbsp;((<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1)&nbsp;(&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;(float&nbsp;(<span class="constructor">Array</span>.length&nbsp;v))&nbsp;/.&nbsp;2.&nbsp;)&nbsp;)&nbsp;)&nbsp;&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;v.(!i)&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;-&nbsp;!i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;v.(j)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;j&nbsp;;&nbsp;i&nbsp;:=&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;!index&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_find_all element vector</pre> vector_float_find_all returns <code class="code">[||]</code>  if it does not find:
<p>

vector_float_find_all retourne <code class="code">[||]</code> s'il ne trouve pas.*)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_find_all&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;[||]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(x&nbsp;=&nbsp;v.(i))&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!index&nbsp;[|i|]&nbsp;;&nbsp;())<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;!index&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_find_last element vector</pre> matrix_float_find_last returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_float_find_last retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_find_last&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!j&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(!j)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;indice&nbsp;:=&nbsp;!j&nbsp;;&nbsp;j&nbsp;:=&nbsp;-1&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;-&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;-1&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_find_last_first element vector</pre> matrix_find_last returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_float_find_last_first retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_find_last_first&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;(&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!j&nbsp;&lt;&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;row&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(!j)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;indice&nbsp;:=&nbsp;!j&nbsp;;&nbsp;j&nbsp;:=&nbsp;max_int&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;-1&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_find_first element vector</pre> matrix_find_first returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_float_find_first retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_find_first&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!j&nbsp;&lt;&nbsp;<span class="constructor">Array</span>.length&nbsp;row&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(!j)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;indice&nbsp;:=&nbsp;!j&nbsp;;&nbsp;j&nbsp;:=&nbsp;<span class="constructor">Array</span>.length&nbsp;row&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_find_first_last element vector</pre> matrix_find_first returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_float_find_first_last retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_find_first_last&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!j&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(!j)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;indice&nbsp;:=&nbsp;!j&nbsp;;&nbsp;j&nbsp;:=&nbsp;-1&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;-&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_find_twin element vector</pre> matrix_find_twin returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_float_find_twin retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_find_twin&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m&nbsp;-&nbsp;1)&nbsp;(&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;(float&nbsp;(<span class="constructor">Array</span>.length&nbsp;m))&nbsp;/.&nbsp;2.&nbsp;)&nbsp;)&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!j&nbsp;&lt;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;row&nbsp;-&nbsp;1)&nbsp;(&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;(float&nbsp;(<span class="constructor">Array</span>.length&nbsp;row))&nbsp;/.&nbsp;2.&nbsp;)&nbsp;)&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(!j)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;indice&nbsp;:=&nbsp;!j&nbsp;;&nbsp;j&nbsp;:=&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;row&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k&nbsp;=&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;-&nbsp;!j&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(k)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;indice&nbsp;:=&nbsp;k&nbsp;;&nbsp;j&nbsp;:=&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;row&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_find_all element vector</pre> matrix_find_all returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_float_find_all retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_find_all&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;ref&nbsp;[||]&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;[||]&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;[||]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;-1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;row&nbsp;-1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(j)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;indice&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!indice&nbsp;[|j|]&nbsp;;&nbsp;()&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;[||]&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;<span class="constructor">Array</span>.map&nbsp;(<span class="keyword">function</span>&nbsp;a&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;i&nbsp;;&nbsp;a|])&nbsp;!indice&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!result&nbsp;!index&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!result&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_sum vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_sum&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;v.(i)&nbsp;+.&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_contraction vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_contraction&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;v.(i)&nbsp;*.&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_sum_by_row matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_sum_by_row&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;row.(j)&nbsp;+.&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;accu.(i)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_sum_by_column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_sum_by_column&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;m.(i).(j)&nbsp;+.&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu.(j)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_sum matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_sum&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;row.(j)&nbsp;+.&nbsp;!accu<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_mean_by_row matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_mean_by_row&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;row.(j)&nbsp;+.&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu.(i)&nbsp;&lt;-&nbsp;!accumul&nbsp;/.&nbsp;(float&nbsp;c)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_mean_by_column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_mean_by_column&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;m)&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;m.(i).(j)&nbsp;+.&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu.(j)&nbsp;&lt;-&nbsp;!accumul&nbsp;/.&nbsp;(float&nbsp;r)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_abs vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_abs&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;abs_float&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_abs matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_abs&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;abs_float&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_opp matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_opp&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;-.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_of_vector_float vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_of_vector_float&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;ref&nbsp;<span class="string">"[|&nbsp;"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;rr&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;(&nbsp;string_of_float&nbsp;v.(i)&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;;&nbsp;"</span>&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;(&nbsp;string_of_float&nbsp;v.(rr)&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;|]"</span>&nbsp;;<br>
&nbsp;&nbsp;!s&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_print vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_print&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;string_of_vector_float&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;print_string&nbsp;s&nbsp;;<br>
&nbsp;&nbsp;print_newline&nbsp;()&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>bare_vector_float_to_string vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;bare_vector_float_to_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;ref&nbsp;<span class="string">"[|&nbsp;"</span>&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;(&nbsp;string_of_float&nbsp;v.(i)&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;"</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;(&nbsp;string_of_float&nbsp;v.(rr)&nbsp;)&nbsp;^&nbsp;<span class="string">"|]"</span>&nbsp;;<br>
&nbsp;&nbsp;!s&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>bare_vector_float_print vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;bare_vector_float_print&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;bare_vector_float_to_string&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;print_string&nbsp;s&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_of_string string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_of_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ls&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;st&nbsp;=&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;3&nbsp;(&nbsp;ls&nbsp;-&nbsp;6&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;listing&nbsp;=&nbsp;<span class="constructor">Str</span>.split&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"&nbsp;;&nbsp;"</span>&nbsp;)&nbsp;st&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;<span class="constructor">Array</span>.of_list&nbsp;listing&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;float_of_string&nbsp;a&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>bare_vector_float_of_string string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;bare_vector_float_of_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ls&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;st&nbsp;=&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;2&nbsp;(&nbsp;ls&nbsp;-&nbsp;4&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;listing&nbsp;=&nbsp;<span class="constructor">Str</span>.split&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"&nbsp;"</span>&nbsp;)&nbsp;st&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;<span class="constructor">Array</span>.of_list&nbsp;listing&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;float_of_string&nbsp;a&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_to_string matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_to_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;ref&nbsp;<span class="string">"[|&nbsp;with&nbsp;"</span><br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;slow_numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;string_of_int&nbsp;r&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&gt;&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"&nbsp;rows"</span><br>
&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"&nbsp;row"</span>&nbsp;;<br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"\n"</span>&nbsp;;<br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;bare_vector_float_to_string&nbsp;m.(0)&nbsp;^&nbsp;<span class="string">"&nbsp;;"</span>&nbsp;;&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"\n"</span>&nbsp;^&nbsp;(&nbsp;bare_vector_float_to_string&nbsp;m.(i)&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;;"</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"\n|]&nbsp;and&nbsp;"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;c&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;c&nbsp;&gt;&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"&nbsp;columns\n"</span><br>
&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"&nbsp;column\n"</span>&nbsp;;<br>
&nbsp;&nbsp;!s&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_print matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_print&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;matrix_float_to_string&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;print_string&nbsp;s&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_of_string string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_of_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ls&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;st&nbsp;=&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;8&nbsp;(&nbsp;ls&nbsp;-&nbsp;8&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;number_of_rows&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;position&nbsp;=&nbsp;<span class="constructor">Str</span>.search_forward&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"&nbsp;row"</span>&nbsp;)&nbsp;st&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int_of_string&nbsp;(&nbsp;<span class="constructor">String</span>.sub&nbsp;st&nbsp;0&nbsp;position&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;number_of_rows&nbsp;0&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;listing&nbsp;=&nbsp;<span class="constructor">Str</span>.split&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"&nbsp;;\n"</span>&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;(&nbsp;<span class="constructor">Array</span>.of_list&nbsp;listing&nbsp;)&nbsp;0&nbsp;number_of_rows&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;number_of_rows&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.(i)&nbsp;&lt;-&nbsp;bare_vector_float_of_string&nbsp;a.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;str&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;(&nbsp;<span class="constructor">List</span>.tl&nbsp;(&nbsp;<span class="constructor">Str</span>.split&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"\n"</span>&nbsp;)&nbsp;a.(0)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.(0)&nbsp;&lt;-&nbsp;bare_vector_float_of_string&nbsp;str&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_trace matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_trace&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))<br>
&nbsp;<span class="keyword">and</span>&nbsp;accumulateur&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;accumulateur&nbsp;:=&nbsp;!accumulateur&nbsp;+.&nbsp;m.(i).(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accumulateur&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_scal_add coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;x&nbsp;+.&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_scal_mult coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;x&nbsp;*.&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_scal_left_sub coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_scal_right_sub coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;x&nbsp;-.&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_scal_left_div coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;/.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_scal_right_div coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;x&nbsp;/.&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_opp vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_opp&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;-.&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_inv vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;in&nbsp;Matrix.vector_float_inv."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;1.&nbsp;/.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_plus vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;+.&nbsp;vv.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vvv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_minus vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;-.&nbsp;vv.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vvv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_coeff_prod vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;*.&nbsp;vv.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vvv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_coeff_div vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;/.&nbsp;vv.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vvv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_scal_prod vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_scal_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;x&nbsp;:=&nbsp;!x&nbsp;+.&nbsp;v.(i)&nbsp;*.&nbsp;vv.(i)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;&nbsp;<br>
&nbsp;&nbsp;!x&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_float_scal_add beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_float_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;+.&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_float_scal_add beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_float_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;+.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_float_scal_mult beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_float_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;*.&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_float_scal_mult beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_float_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;*.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_float_scal_left_sub beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_float_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_float_scal_left_sub beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_float_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_float_scal_right_sub beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_float_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;x&nbsp;-.&nbsp;v.(k)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_float_scal_right_sub beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_float_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;x&nbsp;-.&nbsp;v.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_float_scal_left_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_float_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;/.&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_float_scal_left_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_float_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;/.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_float_scal_right_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_float_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;x&nbsp;/.&nbsp;v.(k)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_float_scal_right_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_float_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;x&nbsp;/.&nbsp;v.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_float_plus beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_float_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;(<span class="constructor">Array</span>.length&nbsp;vv)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;+.&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_float_plus beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_float_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;+.&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_float_minus beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_float_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;s&nbsp;t&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;(<span class="constructor">Array</span>.length&nbsp;t)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;s.(k)&nbsp;-.&nbsp;t.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_float_minus beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_float_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;-.&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_float_coeff_prod beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_float_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;(<span class="constructor">Array</span>.length&nbsp;vv)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;*.&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_float_coeff_prod beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_float_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;*.&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_float_coeff_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_float_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;(<span class="constructor">Array</span>.length&nbsp;vv)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;/.&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_float_coeff_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_float_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;/.&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_scal_add coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;+.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_scal_mult coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;*.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_scal_left_sub coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input.(j)&nbsp;-.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_scal_right_sub coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;-.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_scal_right_div coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;/.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_scal_left_div coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input.(j)&nbsp;/.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_plus matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(mm:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input_left)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input_left.(j)&nbsp;+.&nbsp;row_input_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_minus matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(mm:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input_left)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input_left.(j)&nbsp;-.&nbsp;row_input_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_coeff_prod matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(mm:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input_left)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input_left.(j)&nbsp;*.&nbsp;row_input_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_coeff_div matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(mm:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input_left)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input_left.(j)&nbsp;/.&nbsp;row_input_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_twisted_prod matrix1 matrix2</pre> This calculates matrix1 times transpose ( matrix2 ).
<p>

Ceci calcule matrix1 fois transposée de matrix2. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_twisted_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(mm:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;mm<br>
&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;min&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;mm.(0)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;tt&nbsp;=&nbsp;t&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_right&nbsp;=&nbsp;mm.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;coeff&nbsp;=&nbsp;ref&nbsp;row_output.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;tt&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeff&nbsp;:=&nbsp;!coeff&nbsp;+.&nbsp;row_input_left.(k)&nbsp;*.&nbsp;row_input_right.(k)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;!coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_prod matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(mm:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_twisted_prod&nbsp;m&nbsp;(&nbsp;float_transpose&nbsp;mm&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_triple_prod matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_triple_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float&nbsp;array&nbsp;array)&nbsp;(b:float&nbsp;array&nbsp;array)&nbsp;(c:float&nbsp;array&nbsp;array)<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_twisted_prod&nbsp;a&nbsp;(&nbsp;matrix_float_twisted_prod&nbsp;(&nbsp;float_transpose&nbsp;c&nbsp;)&nbsp;b&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_naive_prod matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_naive_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(mm:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;mm.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_output)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;mm)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input_left.(k)&nbsp;*.&nbsp;mm.(k).(j)&nbsp;+.&nbsp;row_output.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_twisted_commut matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_twisted_commut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(mm:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_minus&nbsp;(&nbsp;matrix_float_twisted_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_float_twisted_prod&nbsp;mm&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_twisted_commut_bis matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_twisted_commut_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(mm:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;float_transpose&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;m_mm&nbsp;=&nbsp;float_transpose&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_float_minus&nbsp;(&nbsp;matrix_float_twisted_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_float_twisted_prod&nbsp;m_mm&nbsp;m_m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_commut matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_commut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(mm:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_minus&nbsp;(&nbsp;matrix_float_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_float_prod&nbsp;mm&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_matrix_float_prod vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_matrix_float_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;output&nbsp;=&nbsp;ref&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;row_input.(j)&nbsp;*.&nbsp;v.(j)&nbsp;+.&nbsp;!output<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;!output&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_vector_float_prod matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_vector_float_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;output&nbsp;=&nbsp;ref&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;row_input.(j)&nbsp;*.&nbsp;v.(j)&nbsp;+.&nbsp;!output<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;!output&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_matrix_float_apply function vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_matrix_float_apply&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:float&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(v:float&nbsp;array)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;f&nbsp;v.(j)&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_apply2 function vector vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_apply2&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:float&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(u:float&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;u&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;l&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;f&nbsp;u.(i)&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_apply2 function matrix matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_apply2&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:float&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(w:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;f&nbsp;row_input_left.(j)&nbsp;row_input_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_vector_float_row_apply function vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_vector_float_row_apply&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:float&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;f&nbsp;row_input.(j)&nbsp;v.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_row_apply_scal function matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_row_apply_scal&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:float&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;l&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;f&nbsp;row_input<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_column_apply_scal function matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_column_apply_scal&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:float&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_row_apply_scal&nbsp;f&nbsp;(&nbsp;float_transpose&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_row_apply_vect function matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_row_apply_vect&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:float&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;l&nbsp;(&nbsp;f&nbsp;m.(0)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;f&nbsp;row_input<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_column_apply_vect function matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_column_apply_vect&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:float&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;float_transpose&nbsp;(&nbsp;matrix_float_row_apply_vect&nbsp;f&nbsp;(&nbsp;float_transpose&nbsp;m&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_sym matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_sym&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_scal_mult&nbsp;0.5&nbsp;(&nbsp;matrix_float_plus&nbsp;(float_transpose&nbsp;m)&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_antisym matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_antisym&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_scal_mult&nbsp;0.5&nbsp;(&nbsp;matrix_float_minus&nbsp;m&nbsp;(float_transpose&nbsp;m)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_mean vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_mean&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;(&nbsp;vector_float_sum&nbsp;v&nbsp;)&nbsp;/.&nbsp;(&nbsp;float&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_median vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_median&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">List</span>.fast_sort&nbsp;compare&nbsp;(<span class="constructor">Array</span>.to_list&nbsp;v)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">List</span>.length&nbsp;vv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ll&nbsp;=&nbsp;l&nbsp;/&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;l&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;=&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;<span class="constructor">List</span>.nth&nbsp;vv&nbsp;ll<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;<span class="constructor">List</span>.nth&nbsp;vv&nbsp;ll&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">List</span>.nth&nbsp;vv&nbsp;(ll&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span>&nbsp;(&nbsp;a&nbsp;+.&nbsp;b&nbsp;)&nbsp;/.&nbsp;2.&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_median matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_median&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;vector_float_median&nbsp;(&nbsp;inline&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_median_by_row matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_median_by_row&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;vector_float_median&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_median_by_column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_median_by_column&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_median_by_row&nbsp;(&nbsp;float_transpose&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_composed_median matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_composed_median&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;vector_float_median&nbsp;(&nbsp;matrix_float_median_by_row&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_mean_median matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_mean_median&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;vector_float_mean&nbsp;(&nbsp;matrix_float_median_by_row&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_eliminate vector_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_eliminate&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;float_transpose&nbsp;v<br>
&nbsp;<span class="keyword">and</span>&nbsp;condition&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;b&nbsp;z&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;b&nbsp;<span class="keywordsign">||</span>&nbsp;(&nbsp;classify_float&nbsp;z&nbsp;)&nbsp;=&nbsp;<span class="constructor">FP_infinite</span>&nbsp;<span class="keywordsign">||</span>&nbsp;(&nbsp;classify_float&nbsp;z&nbsp;)&nbsp;=&nbsp;<span class="constructor">FP_nan</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;ref&nbsp;[|&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;not&nbsp;(&nbsp;<span class="constructor">Array</span>.fold_left&nbsp;condition&nbsp;<span class="keyword">false</span>&nbsp;w.(i)&nbsp;)&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!x&nbsp;[|&nbsp;w.(i)&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;float_transpose&nbsp;!x&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_var vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_var&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;v.(i)&nbsp;+.&nbsp;!accu&nbsp;;<br>
&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;v.(i)&nbsp;*.&nbsp;v.(i)&nbsp;+.&nbsp;!accumul<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;q&nbsp;=&nbsp;(&nbsp;float&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;(&nbsp;!accumul&nbsp;-.&nbsp;!accu&nbsp;*.&nbsp;!accu&nbsp;/.&nbsp;q&nbsp;)&nbsp;/.&nbsp;q&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_stdev vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_stdev&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sqrt&nbsp;(&nbsp;vector_float_var&nbsp;v&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_covar vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_covar&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array)&nbsp;(vv:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;accum&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;v.(i)&nbsp;+.&nbsp;!accu&nbsp;;<br>
&nbsp;&nbsp;&nbsp;accum&nbsp;:=&nbsp;vv.(i)&nbsp;+.&nbsp;!accum&nbsp;;<br>
&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;v.(i)&nbsp;*.&nbsp;vv.(i)&nbsp;+.&nbsp;!accumul<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;q&nbsp;=&nbsp;(&nbsp;float&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;(&nbsp;!accumul&nbsp;-.&nbsp;!accu&nbsp;*.&nbsp;!accum&nbsp;/.&nbsp;q&nbsp;)&nbsp;/.&nbsp;q&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_linear_regression vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_linear_regression&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array)&nbsp;(w:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accuV&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;accuW&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;accuV2&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;accuW2&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;accuVW&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accuV&nbsp;:=&nbsp;v.(i)&nbsp;+.&nbsp;!accuV&nbsp;;<br>
&nbsp;&nbsp;&nbsp;accuV2&nbsp;:=&nbsp;v.(i)&nbsp;*.&nbsp;v.(i)&nbsp;+.&nbsp;!accuV2&nbsp;;<br>
&nbsp;&nbsp;&nbsp;accuVW&nbsp;:=&nbsp;v.(i)&nbsp;*.&nbsp;w.(i)&nbsp;+.&nbsp;!accuVW&nbsp;;<br>
&nbsp;&nbsp;&nbsp;accuW&nbsp;:=&nbsp;w.(i)&nbsp;+.&nbsp;!accuW&nbsp;;<br>
&nbsp;&nbsp;&nbsp;accuW2&nbsp;:=&nbsp;w.(i)&nbsp;*.&nbsp;w.(i)&nbsp;+.&nbsp;!accuW2&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;q&nbsp;=&nbsp;(&nbsp;float&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vbar&nbsp;=&nbsp;!accuV&nbsp;/.&nbsp;q<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;varv&nbsp;=&nbsp;(&nbsp;!accuV2&nbsp;-.&nbsp;!accuV&nbsp;*.&nbsp;!accuV&nbsp;/.&nbsp;q&nbsp;)&nbsp;/.&nbsp;q<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;wbar&nbsp;=&nbsp;!accuW&nbsp;/.&nbsp;q<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;varw&nbsp;=&nbsp;(&nbsp;!accuW2&nbsp;-.&nbsp;!accuW&nbsp;*.&nbsp;!accuW&nbsp;/.&nbsp;q&nbsp;)&nbsp;/.&nbsp;q<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;covar&nbsp;=&nbsp;(&nbsp;!accuVW&nbsp;-.&nbsp;!accuV&nbsp;*.&nbsp;!accuW&nbsp;/.&nbsp;q&nbsp;)&nbsp;/.&nbsp;q&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;covar&nbsp;/.&nbsp;varv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;wbar&nbsp;-.&nbsp;a&nbsp;*.&nbsp;vbar<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rho&nbsp;=&nbsp;covar&nbsp;/.&nbsp;sqrt&nbsp;(&nbsp;varv&nbsp;*.&nbsp;varw&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;a&nbsp;;&nbsp;b&nbsp;;&nbsp;rho&nbsp;|]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_norm_inf vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_norm_inf&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-.&nbsp;max_float)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;max&nbsp;(&nbsp;abs_float&nbsp;v.(i)&nbsp;)&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_norm_1 vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_norm_1&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;(&nbsp;abs_float&nbsp;v.(i)&nbsp;)&nbsp;+.&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_norm_2 vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_norm_2&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;v.(i)&nbsp;*.&nbsp;v.(i)&nbsp;+.&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;sqrt&nbsp;(&nbsp;!accu&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_square_norm_2 vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_square_norm_2&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;v.(i)&nbsp;*.&nbsp;v.(i)&nbsp;+.&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_norm exponent vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_norm&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;a&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;&nbsp;exp&nbsp;(&nbsp;a&nbsp;*.&nbsp;log&nbsp;(&nbsp;abs_float&nbsp;v.(i)&nbsp;)&nbsp;)&nbsp;+.&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;exp&nbsp;(&nbsp;log&nbsp;(&nbsp;!accu&nbsp;)&nbsp;/.&nbsp;a&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_norm_inf matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_norm_inf&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-.&nbsp;max_float)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;(&nbsp;abs_float&nbsp;row_input.(j)&nbsp;)&nbsp;+.&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;max&nbsp;!accumul&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_norm_1 matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_norm_1&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;float_transpose&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_norm_frobenius matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_norm_frobenius&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;(&nbsp;row_input.(j)&nbsp;*.&nbsp;row_input.(j)&nbsp;)&nbsp;+.&nbsp;!accu<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;sqrt&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_square_frobenius matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_square_frobenius&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;(&nbsp;row_input.(j)&nbsp;*.&nbsp;row_input.(j)&nbsp;)&nbsp;+.&nbsp;!accu<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_frobenius_prod matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_frobenius_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;p.(i)&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input_left)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;(&nbsp;row_input_left.(j)&nbsp;*.&nbsp;row_input_right.(j)&nbsp;)&nbsp;+.&nbsp;!accu<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_norm_1_approx matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_norm_1_approx&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-.&nbsp;max_float)<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_bal_random&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;(&nbsp;<span class="constructor">Util</span>.int_max&nbsp;100&nbsp;(&nbsp;<span class="constructor">Util</span>.int_max&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;)&nbsp;)&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_float_prod&nbsp;m&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;mmm.(0))&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;col_input&nbsp;=&nbsp;extract_column&nbsp;i&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;col_output&nbsp;=&nbsp;extract_column&nbsp;i&nbsp;mmm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;vector_float_norm_1&nbsp;col_input<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;vector_float_norm_1&nbsp;col_output&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;max&nbsp;(&nbsp;b&nbsp;/.&nbsp;a&nbsp;)&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_norm_2_approx matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_norm_2_approx&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-.&nbsp;max_float)<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_bal_random&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;(&nbsp;<span class="constructor">Util</span>.int_max&nbsp;100&nbsp;(&nbsp;<span class="constructor">Util</span>.int_max&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;)&nbsp;)&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_float_prod&nbsp;m&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;mmm.(0))&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;col_input&nbsp;=&nbsp;extract_column&nbsp;i&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;col_output&nbsp;=&nbsp;extract_column&nbsp;i&nbsp;mmm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;vector_float_norm_2&nbsp;col_input<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;vector_float_norm_2&nbsp;col_output&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;max&nbsp;(&nbsp;b&nbsp;/.&nbsp;a&nbsp;)&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_norm_approx exponent matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_norm_approx&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;alpha&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-.&nbsp;max_float)<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_bal_random&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;(&nbsp;<span class="constructor">Util</span>.int_max&nbsp;100&nbsp;(&nbsp;<span class="constructor">Util</span>.int_max&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;)&nbsp;)&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_float_prod&nbsp;m&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;mmm.(0))&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;col_input&nbsp;=&nbsp;extract_column&nbsp;i&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;col_output&nbsp;=&nbsp;extract_column&nbsp;i&nbsp;mmm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;vector_float_norm&nbsp;alpha&nbsp;col_input<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;vector_float_norm&nbsp;alpha&nbsp;col_output&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;max&nbsp;(&nbsp;b&nbsp;/.&nbsp;a&nbsp;)&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_non_diag_part norm matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_non_diag_part&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_float_copy&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;w.(i).(i)&nbsp;&lt;-&nbsp;0.&nbsp;;<br>
&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_non_diagonality norm matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_non_diagonality&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_non_diag_part&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;distance&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_non_scal_part norm matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_non_scal_part&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;float&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_float_scal_left_sub&nbsp;(&nbsp;(float_trace&nbsp;m)&nbsp;/.&nbsp;rr&nbsp;)&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_non_scalarity norm matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_non_scalarity&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_non_scal_part&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;distance&nbsp;mm&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Calcullmentairesurlesmatricesentires"><h1>Calcul élémentaire sur les matrices entières</h1></span>
<span id="1_Elementarycalculusforintegermatrices"><h1>Elementary calculus for integer matrices</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_copy vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_copy&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_clip vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_clip&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;min&nbsp;x&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_crest integer vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_crest&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;y&nbsp;&gt;&nbsp;x&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;y&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_gully integer vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_gully&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;y&nbsp;&lt;&nbsp;x&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;x&nbsp;-&nbsp;y<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>other_vector_int_copy vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;other_vector_int_copy&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_copy vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_copy&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_clip vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_clip&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;min&nbsp;x&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_crest integer vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_crest&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;row_input.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;y&nbsp;&gt;&nbsp;x&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;y&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_gully integer vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_gully&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;row_input.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;y&nbsp;&lt;&nbsp;x&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;-&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_sub_matrix matrix beg-row end-row beg-col end-col</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_sub_matrix&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;i&nbsp;ii&nbsp;j&nbsp;jj&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** i et j : beginning: début ; ii et jj : end: fin *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(ii&nbsp;-&nbsp;i&nbsp;+&nbsp;1)&nbsp;(jj&nbsp;-&nbsp;j&nbsp;+&nbsp;1)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;index&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;ii&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(index)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(index&nbsp;-&nbsp;i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;indice&nbsp;=&nbsp;j&nbsp;<span class="keyword">to</span>&nbsp;jj&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(indice&nbsp;-&nbsp;j)&nbsp;&lt;-&nbsp;row_input.(indice)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_of_vector vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_of_vector&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;float_of_int&nbsp;v.(i)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_of_matrix matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_of_matrix&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;float_of_int&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_transpose matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_transpose&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m&nbsp;-&nbsp;1)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input&nbsp;-&nbsp;1)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(j).(i)&nbsp;&lt;-&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;&nbsp;&nbsp;<br>
&nbsp;&nbsp;mm;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_max vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_max&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;v.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;v.(i)&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_max_by_row matrix</pre> matrix_int_max_by_row even for lacunar matrices:
<p>

matrix_int_max_by_row fonctionne même pour les matrices lacunaires. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_max_by_row&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(-&nbsp;max_int)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;row.(j)&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;accu.(i)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_max_by_column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_max_by_column&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(-&nbsp;max_int)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;m.(i).(j)&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu.(j)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_max matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_max&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-&nbsp;max_int)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;row.(j)&nbsp;!accu<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_min vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_min&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;v.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;min&nbsp;v.(i)&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_min_by_row matrix</pre> matrix_int_min_by_row even for lacunar matrices:
<p>

matrix_int_min_by_row fonctionne même pour les matrices lacunaires. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_min_by_row&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(-&nbsp;min_int)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;min&nbsp;row.(j)&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;accu.(i)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_min_by_column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_min_by_column&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(-&nbsp;min_int)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;min&nbsp;m.(i).(j)&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu.(j)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_min matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_min&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-&nbsp;min_int)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;min&nbsp;row.(j)&nbsp;!accu<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_find_last element vector</pre> vector_int_find_last returns <code class="code">-1</code> if it does not find:
<p>

vector_int_find_last retourne <code class="code">-1</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_find_last&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;v.(!i)&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;-1)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;-&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!index&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_find_first element vector</pre> vector_int_find_first returns <code class="code">-1</code> if it does not find:
<p>

vector_int_find_first retourne <code class="code">-1</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_find_first&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;v.(!i)&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;!index&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_find_twin element vector</pre> vector_int_find_first returns <code class="code">-1</code> if it does not find:
<p>

vector_int_find_twin retourne <code class="code">-1</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_find_twin&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;=&nbsp;min&nbsp;((<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1)&nbsp;(&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;(float&nbsp;(<span class="constructor">Array</span>.length&nbsp;v))&nbsp;/.&nbsp;2.&nbsp;)&nbsp;)&nbsp;)&nbsp;&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;v.(!i)&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;-&nbsp;!i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;v.(j)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;j&nbsp;;&nbsp;i&nbsp;:=&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;!index&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_find_all element vector</pre> vector_int_find_all returns <code class="code">[||]</code>  if it does not find:
<p>

vector_int_find_all retourne <code class="code">[||]</code> s'il ne trouve pas.*)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_find_all&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;[||]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(x&nbsp;=&nbsp;v.(i))&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!index&nbsp;[|i|]&nbsp;;&nbsp;())<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;!index&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_find_last element vector</pre> matrix_int_find_last returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_int_find_last retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_find_last&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!j&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(!j)&nbsp;<span class="keyword">then</span>&nbsp;(indice&nbsp;:=&nbsp;!j&nbsp;;&nbsp;j&nbsp;:=&nbsp;-1)&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;-&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;-1)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_find_first element vector</pre> matrix_find_first returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_int_find_first retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_find_first&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!j&nbsp;&lt;&nbsp;<span class="constructor">Array</span>.length&nbsp;row&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(!j)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;indice&nbsp;:=&nbsp;!j&nbsp;;&nbsp;j&nbsp;:=&nbsp;<span class="constructor">Array</span>.length&nbsp;row&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_find_twin element vector</pre> matrix_find_twin returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_int_find_twin retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_find_twin&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m&nbsp;-&nbsp;1)&nbsp;(&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;(float&nbsp;(<span class="constructor">Array</span>.length&nbsp;m))&nbsp;/.&nbsp;2.&nbsp;)&nbsp;)&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!j&nbsp;&lt;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;row&nbsp;-&nbsp;1)&nbsp;(&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;(float&nbsp;(<span class="constructor">Array</span>.length&nbsp;row))&nbsp;/.&nbsp;2.&nbsp;)&nbsp;)&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(!j)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;indice&nbsp;:=&nbsp;!j&nbsp;;&nbsp;j&nbsp;:=&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;row&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k&nbsp;=&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;-&nbsp;!j&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(k)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;indice&nbsp;:=&nbsp;k&nbsp;;&nbsp;j&nbsp;:=&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;row&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;+&nbsp;1&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!i&nbsp;;&nbsp;i&nbsp;:=&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!index&nbsp;;&nbsp;!indice&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_find_all element vector</pre> matrix_find_all returns <code class="code">[|-1;-1|]</code> if it does not find:
<p>

matrix_int_find_all retourne <code class="code">[|-1;-1|]</code> s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_find_all&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;ref&nbsp;[||]&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;[||]&nbsp;<span class="keyword">and</span>&nbsp;indice&nbsp;=&nbsp;ref&nbsp;[||]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;row&nbsp;-1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;row.(j)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;indice&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!indice&nbsp;[|j|]&nbsp;;&nbsp;()&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!indice&nbsp;&lt;&gt;&nbsp;[||]&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;<span class="constructor">Array</span>.map&nbsp;(<span class="keyword">function</span>&nbsp;a&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;i&nbsp;;&nbsp;a|])&nbsp;!indice&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!result&nbsp;!index&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!result&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_sum vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_sum&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;v.(i)&nbsp;+&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_contraction vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_contraction&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;v.(i)&nbsp;*&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_sum_by_row matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_sum_by_row&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;row.(j)&nbsp;+&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;accu.(i)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_sum_by_column matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_sum_by_column&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;accu.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;m.(i).(j)&nbsp;+&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu.(j)&nbsp;&lt;-&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_sum matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_sum&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;row.(j)&nbsp;+&nbsp;!accu<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_abs vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_abs&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;abs&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_abs matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_abs&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;abs&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_opp matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_opp&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;-&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_of_vector_int vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_of_vector_int&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;ref&nbsp;<span class="string">"[|&nbsp;"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;rr&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;v.(i)&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;;&nbsp;"</span>&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;v.(rr)&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;|]"</span>&nbsp;;<br>
&nbsp;&nbsp;!s&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_print vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_print&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;string_of_vector_int&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;print_string&nbsp;s&nbsp;;<br>
&nbsp;print_newline&nbsp;()&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>bare_vector_int_to_string vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;bare_vector_int_to_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;ref&nbsp;<span class="string">"[|"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;r&nbsp;-&nbsp;2&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;v.(i)&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;"</span>&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;v.(r&nbsp;-&nbsp;1)&nbsp;)&nbsp;^&nbsp;<span class="string">"|]"</span>&nbsp;;<br>
&nbsp;&nbsp;!s&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>bare_vector_int_print vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;bare_vector_int_print&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;bare_vector_int_to_string&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;print_string&nbsp;s&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_of_string string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_of_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ls&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;st&nbsp;=&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;3&nbsp;(&nbsp;ls&nbsp;-&nbsp;6&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;listing&nbsp;=&nbsp;<span class="constructor">Str</span>.split&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"&nbsp;;&nbsp;"</span>&nbsp;)&nbsp;st&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;<span class="constructor">Array</span>.of_list&nbsp;listing&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;int_of_string&nbsp;a&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>bare_vector_int_of_string string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;bare_vector_int_of_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ls&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;st&nbsp;=&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;2&nbsp;(&nbsp;ls&nbsp;-&nbsp;4&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;listing&nbsp;=&nbsp;<span class="constructor">Str</span>.split&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"&nbsp;"</span>&nbsp;)&nbsp;st&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;<span class="constructor">Array</span>.of_list&nbsp;listing&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;int_of_string&nbsp;a&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_to_string matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_to_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;ref&nbsp;<span class="string">"[|&nbsp;with&nbsp;"</span><br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;slow_numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;string_of_int&nbsp;r&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&gt;&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"&nbsp;rows"</span><br>
&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"&nbsp;row"</span>&nbsp;;<br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"\n"</span>&nbsp;;<br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;bare_vector_int_to_string&nbsp;m.(0)&nbsp;^&nbsp;<span class="string">"&nbsp;;"</span>&nbsp;;&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"\n"</span>&nbsp;^&nbsp;(&nbsp;bare_vector_int_to_string&nbsp;m.(i)&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;;"</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"\n|]&nbsp;and&nbsp;"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;c&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;c&nbsp;&gt;&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"&nbsp;columns\n"</span><br>
&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;<span class="string">"&nbsp;column\n"</span>&nbsp;;<br>
&nbsp;&nbsp;!s&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_print matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_print&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;matrix_int_to_string&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;print_string&nbsp;s&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_of_string string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_of_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ls&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;st&nbsp;=&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;8&nbsp;(&nbsp;ls&nbsp;-&nbsp;8&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;number_of_rows&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;position&nbsp;=&nbsp;<span class="constructor">Str</span>.search_forward&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"&nbsp;row"</span>&nbsp;)&nbsp;st&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int_of_string&nbsp;(&nbsp;<span class="constructor">String</span>.sub&nbsp;st&nbsp;0&nbsp;position&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;number_of_rows&nbsp;0&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;listing&nbsp;=&nbsp;<span class="constructor">Str</span>.split&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"&nbsp;;\n"</span>&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;(&nbsp;<span class="constructor">Array</span>.of_list&nbsp;listing&nbsp;)&nbsp;0&nbsp;number_of_rows&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;number_of_rows&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.(i)&nbsp;&lt;-&nbsp;bare_vector_int_of_string&nbsp;a.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;str&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;(&nbsp;<span class="constructor">List</span>.tl&nbsp;(&nbsp;<span class="constructor">Str</span>.split&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"\n"</span>&nbsp;)&nbsp;a.(0)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.(0)&nbsp;&lt;-&nbsp;bare_vector_int_of_string&nbsp;str&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_trace matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_trace&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))<br>
&nbsp;<span class="keyword">and</span>&nbsp;accumulateur&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;accumulateur&nbsp;:=&nbsp;!accumulateur&nbsp;+&nbsp;m.(i).(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accumulateur&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_scal_add coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;x&nbsp;+&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_scal_mult coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;x&nbsp;*&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_scal_left_sub coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_scal_right_sub coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;x&nbsp;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_scal_left_div coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;/&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_scal_right_div coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;x&nbsp;/&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_scal_left_mod coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_scal_left_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;x&nbsp;<span class="keyword">mod</span>&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_scal_right_mod coefficient vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_scal_right_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;<span class="keyword">mod</span>&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_opp vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_opp&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_inv vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;in&nbsp;Matrix.vector_int_inv."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;1&nbsp;/&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vv&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_plus vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;+&nbsp;vv.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vvv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_minus vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;-&nbsp;vv.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vvv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_coeff_prod vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;*&nbsp;vv.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vvv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_coeff_div vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;/&nbsp;vv.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vvv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_coeff_mod vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_coeff_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;v.(i)&nbsp;<span class="keyword">mod</span>&nbsp;vv.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vvv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_scal_prod vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_scal_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;x&nbsp;:=&nbsp;!x&nbsp;+&nbsp;v.(i)&nbsp;*&nbsp;vv.(i)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;&nbsp;<br>
&nbsp;&nbsp;!x&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_scal_add beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;+&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_scal_add beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;+&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_scal_mult beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;*&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_scal_mult beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;*&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_scal_left_sub beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_scal_left_sub beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_scal_right_sub beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;x&nbsp;-&nbsp;v.(k)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_scal_right_sub beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;x&nbsp;-&nbsp;v.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_scal_left_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;/&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_scal_left_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;/&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_scal_right_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;x&nbsp;/&nbsp;v.(k)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_scal_right_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;x&nbsp;/&nbsp;v.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_scal_left_mod beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_scal_left_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;x&nbsp;<span class="keyword">mod</span>&nbsp;v.(k)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_scal_left_mod beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_scal_left_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;x&nbsp;<span class="keyword">mod</span>&nbsp;v.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_scal_right_mod beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_scal_right_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;<span class="keyword">mod</span>&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_scal_right_mod beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_scal_right_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;x&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;<span class="keyword">mod</span>&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_plus beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;(<span class="constructor">Array</span>.length&nbsp;vv)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;+&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_plus beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;+&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_minus beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;s&nbsp;t&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;(<span class="constructor">Array</span>.length&nbsp;t)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;s.(k)&nbsp;-&nbsp;t.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_minus beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;-&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_coeff_prod beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;(<span class="constructor">Array</span>.length&nbsp;vv)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;*&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_coeff_prod beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;*&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_coeff_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;(<span class="constructor">Array</span>.length&nbsp;vv)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;/&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_coeff_div beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;/&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_int_coeff_mod beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_int_coeff_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;(<span class="constructor">Array</span>.length&nbsp;vv)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k)&nbsp;&lt;-&nbsp;v.(k)&nbsp;<span class="keyword">mod</span>&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>part_int_coeff_mod beginning end vector1 vector2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;part_int_coeff_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;j&nbsp;(v:int&nbsp;array)&nbsp;(vv:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(k-i)&nbsp;&lt;-&nbsp;v.(k)&nbsp;<span class="keyword">mod</span>&nbsp;vv.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_scal_add coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;ref&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;+&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;!row_output<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_scal_mult coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;ref&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;*&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;!row_output<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_scal_left_sub coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input.(j)&nbsp;-&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_scal_right_sub coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;-&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_scal_left_div coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input.(j)&nbsp;/&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_scal_right_div coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;/&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_scal_left_mod coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_scal_left_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;<span class="keyword">mod</span>&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_scal_right_mod coefficient matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_scal_right_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input.(j)&nbsp;<span class="keyword">mod</span>&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_plus matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(mm:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input_left)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input_left.(j)&nbsp;+&nbsp;row_input_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_minus matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(mm:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input_left)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input_left.(j)&nbsp;-&nbsp;row_input_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_coeff_prod matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(mm:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input_left)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input_left.(j)&nbsp;*&nbsp;row_input_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_coeff_div matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(mm:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input_left)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input_left.(j)&nbsp;/&nbsp;row_input_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_coeff_mod matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_coeff_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(mm:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input_left)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input_left.(j)&nbsp;<span class="keyword">mod</span>&nbsp;row_input_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_twisted_prod matrix1 matrix2</pre> This calculates matrix1 times transpose ( matrix2 )
<p>

Ceci calcule matrix1 fois transposée de matrix2. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_twisted_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(mm:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;mm<br>
&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;min&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;mm.(0)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;tt&nbsp;=&nbsp;t&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_right&nbsp;=&nbsp;mm.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;coeff&nbsp;=&nbsp;ref&nbsp;row_output.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;tt&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeff&nbsp;:=&nbsp;!coeff&nbsp;+&nbsp;row_input_left.(k)&nbsp;*&nbsp;row_input_right.(k)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;!coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_prod matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(mm:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_int_twisted_prod&nbsp;m&nbsp;(&nbsp;int_transpose&nbsp;mm&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_twisted_commut matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_twisted_commut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(mm:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_int_minus&nbsp;(&nbsp;matrix_int_twisted_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_int_twisted_prod&nbsp;mm&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_twisted_commut_bis matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_twisted_commut_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(mm:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;int_transpose&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;m_mm&nbsp;=&nbsp;int_transpose&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_int_minus&nbsp;(&nbsp;matrix_int_twisted_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_int_twisted_prod&nbsp;m_mm&nbsp;m_m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_commut matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_commut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(mm:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_int_minus&nbsp;(&nbsp;matrix_int_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_int_prod&nbsp;mm&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_triple_prod matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_triple_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:int&nbsp;array&nbsp;array)&nbsp;(b:int&nbsp;array&nbsp;array)&nbsp;(c:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_int_twisted_prod&nbsp;a&nbsp;(&nbsp;matrix_int_twisted_prod&nbsp;(&nbsp;int_transpose&nbsp;c&nbsp;)&nbsp;b&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_naive_prod matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_naive_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(mm:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;mm.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_output)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;mm)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input_left.(k)&nbsp;*&nbsp;mm.(k).(j)&nbsp;+&nbsp;row_output.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_matrix_int_prod vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_matrix_int_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int&nbsp;array)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;output&nbsp;=&nbsp;ref&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;row_input.(j)&nbsp;*&nbsp;v.(j)&nbsp;+&nbsp;!output<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;!output&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_vector_int_prod vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_vector_int_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;output&nbsp;=&nbsp;ref&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;row_input.(j)&nbsp;*&nbsp;v.(j)&nbsp;+&nbsp;!output<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;!output&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_matrix_int_apply function vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_matrix_int_apply&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:int&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int)&nbsp;(v:int&nbsp;array)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;f&nbsp;v.(j)&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_apply2 function vector vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_apply2&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:int&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int)&nbsp;(u:int&nbsp;array)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;u&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;l&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;f&nbsp;u.(i)&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_apply2 function matrix matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_apply2&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:int&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(w:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input_left&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input_right&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;f&nbsp;row_input_left.(j)&nbsp;row_input_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_vector_int_row_apply function vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_vector_int_row_apply&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:int&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;f&nbsp;row_input.(j)&nbsp;v.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_row_apply_scal function matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_row_apply_scal&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:int&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;l&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;f&nbsp;row_input<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_column_apply_scal function matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_column_apply_scal&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:int&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_int_row_apply_scal&nbsp;f&nbsp;(&nbsp;int_transpose&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_row_apply_vect function matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_row_apply_vect&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:int&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int&nbsp;array)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;l&nbsp;(&nbsp;f&nbsp;m.(0)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;f&nbsp;row_input<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_column_apply_vect function matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_column_apply_vect&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:int&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int&nbsp;array)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;int_transpose&nbsp;(&nbsp;matrix_int_row_apply_vect&nbsp;f&nbsp;(&nbsp;int_transpose&nbsp;m&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_sym matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_sym&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_int_scal_left_div&nbsp;2&nbsp;(&nbsp;matrix_int_plus&nbsp;(int_transpose&nbsp;m)&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_antisym matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_antisym&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_int_scal_left_div&nbsp;2&nbsp;(&nbsp;matrix_int_minus&nbsp;m&nbsp;(int_transpose&nbsp;m)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_norm_inf vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_norm_inf&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-&nbsp;max_int)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;(&nbsp;abs&nbsp;v.(i)&nbsp;)&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_norm_1 vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_norm_1&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;v)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;(&nbsp;abs&nbsp;v.(i)&nbsp;)&nbsp;+&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_norm_inf matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_norm_inf&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-&nbsp;max_int)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accumul&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row_input)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accumul&nbsp;:=&nbsp;(&nbsp;abs&nbsp;row_input.(j)&nbsp;)&nbsp;+&nbsp;!accumul<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;!accumul&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!accu&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_norm_1 matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_norm_1&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_int_norm_inf&nbsp;(&nbsp;int_transpose&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_non_diagonality norm matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_non_diagonality&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:int&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_int_minus&nbsp;m&nbsp;(&nbsp;diag_int&nbsp;(extract_diag&nbsp;m)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;distance&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_non_scalarity norm matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_non_scalarity&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:int&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_int_scal_left_sub&nbsp;(&nbsp;(int_trace&nbsp;m)&nbsp;/&nbsp;r&nbsp;)&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;distance&nbsp;mm&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="1_Calculsubstantielsurlesmatrices"><h1>Calcul substantiel sur les matrices</h1></span>
<span id="1_Substantialcalculusonmatrices"><h1>Substantial calculus on matrices</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_diag_left_mult vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_diag_left_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:float&nbsp;array)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;d)<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(&nbsp;cc&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;d.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;*.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_diag_left_div vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_diag_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:float&nbsp;array)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;d)<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(&nbsp;cc&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;d.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input.(j)&nbsp;/.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_diag_right_mult vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_diag_right_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:float&nbsp;array)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;d)<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(&nbsp;cc&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;d.(j)&nbsp;*.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_diag_right_div vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_diag_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:float&nbsp;array)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;d)<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(&nbsp;cc&nbsp;+&nbsp;1&nbsp;)&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input.(j)&nbsp;/.&nbsp;d.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_diag_left_mult vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_diag_left_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:int&nbsp;array)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;d)<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(&nbsp;cc&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;d.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;x&nbsp;*&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_diag_left_div vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_diag_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:int&nbsp;array)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;d)<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(&nbsp;cc&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;d.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input.(j)&nbsp;/&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_diag_right_mult vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_diag_right_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:int&nbsp;array)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;d)<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(&nbsp;cc&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;d.(j)&nbsp;*&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_diag_right_div vector matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_diag_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:int&nbsp;array)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;d)<br>
&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(&nbsp;cc&nbsp;+&nbsp;1&nbsp;)&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_input.(j)&nbsp;/&nbsp;d.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_slow_pivot_downward i m p</pre> The matrix m is assumed to be upper triangular from line 0 to i - 1.
The matrix p registers the same changes as m.
Output: pivot acted on the matrix <code class="code">m</code>, pivot acted on the matrix <code class="code">p</code>, 
pair of permutation indexes, value of the inverse of the pivot.
<p>

La matrice m est supposée, de la ligne 0 à i - 1, triangulaire supérieure. 
La matrice p enregistre les mêmes changements que m.
Sortie : pivot effectué sur la matrice <code class="code">m</code>, pivot effecturé sur la matrice <code class="code">p</code>, 
paire d'indices de permutation, valeur de l'inverse du pivot. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_slow_pivot_downward&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;mmmm&nbsp;=&nbsp;ref&nbsp;(matrix_float_copy&nbsp;m)<br>
&nbsp;<span class="keyword">and</span>&nbsp;pppp&nbsp;=&nbsp;ref&nbsp;(matrix_float_copy&nbsp;p)<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;min&nbsp;r&nbsp;c&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;permutation&nbsp;=&nbsp;ref&nbsp;(&nbsp;[|&nbsp;[|&nbsp;0.&nbsp;;&nbsp;0.&nbsp;|]&nbsp;|]&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;float_sub_matrix&nbsp;m&nbsp;i&nbsp;(r&nbsp;-&nbsp;1)&nbsp;i&nbsp;(c&nbsp;-&nbsp;1)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_float_abs&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;plusgrand&nbsp;=&nbsp;matrix_max&nbsp;mmm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;matrix_float_find_first&nbsp;plusgrand&nbsp;mmm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;index.(0)&nbsp;&lt;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mmmm&nbsp;:=&nbsp;exchange_row&nbsp;i&nbsp;(i+index.(0))&nbsp;!mmmm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pppp&nbsp;:=&nbsp;exchange_row&nbsp;i&nbsp;(i+index.(0))&nbsp;!pppp&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;index.(1)&nbsp;&lt;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;permutation&nbsp;:=&nbsp;float_of_matrix&nbsp;[|&nbsp;[|&nbsp;i&nbsp;;&nbsp;i+index.(1)&nbsp;|]&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mmmm&nbsp;:=&nbsp;exchange_column&nbsp;i&nbsp;(i+index.(1))&nbsp;!mmmm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;!mmmm.(i).(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;coefficient&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;in&nbsp;Matrix.float_slow_pivot_downward."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;vector_float_scal_left_div&nbsp;coefficient&nbsp;!mmmm.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne&nbsp;=&nbsp;vector_float_scal_left_div&nbsp;coefficient&nbsp;!pppp.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Pay attention to order: attention à l'ordre *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!mmmm.(j).(i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!pppp.(j)&nbsp;&lt;-&nbsp;vector_float_minus&nbsp;!pppp.(j)&nbsp;(&nbsp;vector_float_scal_mult&nbsp;coeff&nbsp;ligne&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mmmm.(j)&nbsp;&lt;-&nbsp;partial_float_minus&nbsp;(i&nbsp;+&nbsp;1)&nbsp;(c&nbsp;-&nbsp;1)&nbsp;!mmmm.(j)&nbsp;(&nbsp;partial_float_scal_mult&nbsp;(i&nbsp;+&nbsp;1)&nbsp;(c&nbsp;-&nbsp;1)&nbsp;coeff&nbsp;row&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;!mmmm&nbsp;;&nbsp;!pppp&nbsp;;&nbsp;!permutation&nbsp;;&nbsp;[|[|1.&nbsp;/.&nbsp;coefficient|]|]&nbsp;|]&nbsp;&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_restricted_slow_pivot_downward i m</pre> The matrix m is assumed to be upper triangular from line 0 to i - 1.
Output: pivot acted on the matrix <code class="code">m</code>, value of the pivot, 
flag indicating a transposition of indexes.
<p>

La matrice m est supposée, de la ligne 0 à i - 1, triangulaire supérieure.
Sortie : pivot effectué sur la matrice <code class="code">m</code>, valeur du pivot, 
drapeau indiquant une transposition des indices. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_restricted_slow_pivot_downward&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;change_sign&nbsp;=&nbsp;ref&nbsp;<span class="keyword">false</span><br>
&nbsp;<span class="keyword">and</span>&nbsp;flag&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;<span class="keyword">and</span>&nbsp;mmmm&nbsp;=&nbsp;ref&nbsp;(matrix_float_copy&nbsp;m)<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;min&nbsp;r&nbsp;c&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;float_sub_matrix&nbsp;m&nbsp;i&nbsp;(r&nbsp;-&nbsp;1)&nbsp;i&nbsp;(c&nbsp;-&nbsp;1)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_float_abs&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;plusgrand&nbsp;=&nbsp;matrix_max&nbsp;mmm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;matrix_float_find_first&nbsp;plusgrand&nbsp;mmm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;index.(0)&nbsp;&lt;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;change_sign&nbsp;:=&nbsp;not&nbsp;!change_sign&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mmmm&nbsp;:=&nbsp;exchange_row&nbsp;i&nbsp;(&nbsp;i&nbsp;+&nbsp;index.(0)&nbsp;)&nbsp;!mmmm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;index.(1)&nbsp;&lt;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;change_sign&nbsp;:=&nbsp;not&nbsp;!change_sign&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mmmm&nbsp;:=&nbsp;exchange_column&nbsp;i&nbsp;(&nbsp;i&nbsp;+&nbsp;index.(1)&nbsp;)&nbsp;!mmmm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;!mmmm.(i).(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;coefficient&nbsp;&lt;&gt;&nbsp;0.&nbsp;)&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;vector_float_scal_left_div&nbsp;coefficient&nbsp;!mmmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!mmmm.(j).(i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mmmm.(j)&nbsp;&lt;-&nbsp;partial_float_minus&nbsp;(i&nbsp;+&nbsp;1)&nbsp;(c&nbsp;-&nbsp;1)&nbsp;!mmmm.(j)&nbsp;(&nbsp;partial_float_scal_mult&nbsp;(i&nbsp;+&nbsp;1)&nbsp;(c&nbsp;-&nbsp;1)&nbsp;coeff&nbsp;row&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!change_sign&nbsp;<span class="keyword">then</span>&nbsp;flag&nbsp;:=&nbsp;1.&nbsp;<span class="keyword">else</span>&nbsp;flag&nbsp;:=&nbsp;0.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;!mmmm&nbsp;;&nbsp;[|[|&nbsp;coefficient&nbsp;|]|]&nbsp;;&nbsp;[|[|&nbsp;!flag&nbsp;|]|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_slow_pivot_upward i m p</pre> The matrix m is assumed to be diagonal from line i + 1 to r - 1.
The matrix p registers the same changes as m.
Output: pivot acted on the matrix <code class="code">m</code>, pivot acted on the matrix <code class="code">p</code>.
<p>

La matrice m est supposée, de la ligne i + 1 à r - 1, diagonale. 
La matrice p enregistre les memes changements que m.
Sortie : pivot effectué sur la matrice <code class="code">m</code>, pivot effecturé sur la matrice <code class="code">p</code>. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_slow_pivot_upward&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array)&nbsp;(coefficient:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mmmm&nbsp;=&nbsp;ref&nbsp;(matrix_float_copy&nbsp;m)<br>
&nbsp;<span class="keyword">and</span>&nbsp;pppp&nbsp;=&nbsp;ref&nbsp;(matrix_float_copy&nbsp;p)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;vector_float_scal_mult&nbsp;coefficient&nbsp;!mmmm.(i)&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne&nbsp;=&nbsp;vector_float_scal_mult&nbsp;coefficient&nbsp;!pppp.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Pay attention to order : attention à l'ordre *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!mmmm.(j).(i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!pppp.(j)&nbsp;&lt;-&nbsp;vector_float_minus&nbsp;!pppp.(j)&nbsp;(&nbsp;vector_float_scal_mult&nbsp;coeff&nbsp;ligne&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mmmm.(j)&nbsp;&lt;-&nbsp;partial_float_minus&nbsp;j&nbsp;(i&nbsp;-&nbsp;1)&nbsp;!mmmm.(j)&nbsp;(&nbsp;partial_float_scal_mult&nbsp;j&nbsp;(i&nbsp;-&nbsp;1)&nbsp;coeff&nbsp;row&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!mmmm&nbsp;;&nbsp;!pppp&nbsp;|];;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_slow_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_slow_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;(&nbsp;min&nbsp;(numrows&nbsp;m)&nbsp;(numcolumns&nbsp;m)&nbsp;)&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(matrix_float_copy&nbsp;m)<br>
&nbsp;<span class="keyword">and</span>&nbsp;permucol&nbsp;=&nbsp;ref&nbsp;[]<br>
&nbsp;<span class="keyword">and</span>&nbsp;pp&nbsp;=&nbsp;ref&nbsp;(&nbsp;identity_float&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;float_slow_pivot_downward&nbsp;i&nbsp;!mm&nbsp;!pp&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp&nbsp;:=&nbsp;resultat.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;permucol&nbsp;:=&nbsp;resultat.(2)&nbsp;::&nbsp;!permucol&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(i)&nbsp;&lt;-&nbsp;resultat.(3).(0).(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!mm.(rr).(rr)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;coeff&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;in&nbsp;Matrix.float_slow_inv."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(rr)&nbsp;&lt;-&nbsp;1.&nbsp;/.&nbsp;coeff&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;rr&nbsp;<span class="keyword">downto</span>&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;float_slow_pivot_upward&nbsp;i&nbsp;!mm&nbsp;!pp&nbsp;diagonale.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp&nbsp;:=&nbsp;resultat.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;float_diag_left_mult&nbsp;diagonale&nbsp;!pp&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;[|&nbsp;[|&nbsp;0&nbsp;;&nbsp;0&nbsp;|]&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="constructor">Util</span>.list_non_empty&nbsp;!permucol&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;int_of_matrix&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;!permucol&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;exchange_row&nbsp;(!index.(0).(0))&nbsp;(!index.(0).(1))&nbsp;!mm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;permucol&nbsp;:=&nbsp;<span class="constructor">List</span>.tl&nbsp;!permucol&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_slow_left_quotient matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_slow_left_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;(&nbsp;min&nbsp;(numrows&nbsp;m)&nbsp;(numcolumns&nbsp;m)&nbsp;)&nbsp;<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_float_copy&nbsp;m&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;permucol&nbsp;=&nbsp;ref&nbsp;[]<br>
&nbsp;<span class="keyword">and</span>&nbsp;pp&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_float_copy&nbsp;p&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;float_slow_pivot_downward&nbsp;i&nbsp;!mm&nbsp;!pp&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp&nbsp;:=&nbsp;resultat.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;permucol&nbsp;:=&nbsp;resultat.(2)&nbsp;::&nbsp;!permucol&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(i)&nbsp;&lt;-&nbsp;resultat.(3).(0).(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!mm.(rr).(rr)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;coeff&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;in&nbsp;Matrix.float_slow_left_quotient."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(rr)&nbsp;&lt;-&nbsp;1.&nbsp;/.&nbsp;coeff&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;rr&nbsp;<span class="keyword">downto</span>&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;float_slow_pivot_upward&nbsp;i&nbsp;!mm&nbsp;!pp&nbsp;diagonale.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp&nbsp;:=&nbsp;resultat.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;float_diag_left_mult&nbsp;diagonale&nbsp;!pp&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;[|&nbsp;[|&nbsp;0&nbsp;;&nbsp;0&nbsp;|]&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="constructor">Util</span>.list_non_empty&nbsp;!permucol&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;int_of_matrix&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;!permucol&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;exchange_row&nbsp;(!index.(0).(0))&nbsp;(!index.(0).(1))&nbsp;!mm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;permucol&nbsp;:=&nbsp;<span class="constructor">List</span>.tl&nbsp;!permucol&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_slow_right_quotient matrix1 matrix2</pre> This gives matrix2 * (matrix1) ^ -1.
<p>

Ceci retourne matrix2 * (matrix1) ^ -1. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_slow_right_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;float_transpose&nbsp;(&nbsp;matrix_float_slow_left_quotient&nbsp;(float_transpose&nbsp;m)&nbsp;(float_transpose&nbsp;p)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line_float_slow_left_quotient matrix1 matrix_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;line_float_slow_left_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;matrix_float_slow_left_quotient&nbsp;m&nbsp;)&nbsp;p&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line_float_slow_right_quotient matrix1 matrix_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;line_float_slow_right_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;matrix_float_slow_right_quotient&nbsp;m&nbsp;)&nbsp;p&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_slow_invertibility matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_slow_invertibility&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(numcolumns&nbsp;m)<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(matrix_float_copy&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;output&nbsp;=&nbsp;ref&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;float_restricted_slow_pivot_downward&nbsp;!i&nbsp;!mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;resultat.(1).(0).(0)&nbsp;=&nbsp;0.&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;r&nbsp;;&nbsp;output&nbsp;:=&nbsp;<span class="keyword">false</span>&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;!output&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;!mm.(rr).(rr)&nbsp;&lt;&gt;&nbsp;0.&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!output&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_slow_invertibility_evaluation matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_slow_invertibility_evaluation&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(numcolumns&nbsp;m)<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(matrix_float_copy&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;output&nbsp;=&nbsp;ref&nbsp;max_float&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;float_restricted_slow_pivot_downward&nbsp;!i&nbsp;!mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;resultat.(1).(0).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;coeff&nbsp;=&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;r&nbsp;;&nbsp;output&nbsp;:=&nbsp;0.&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(!i)&nbsp;&lt;-&nbsp;coeff&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!output&nbsp;&lt;&gt;&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(rr)&nbsp;&lt;-&nbsp;!mm.(rr).(rr)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;absdiag&nbsp;=&nbsp;vector_float_abs&nbsp;diagonale&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mini&nbsp;=&nbsp;vector_float_min&nbsp;absdiag&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;vector_float_find_first&nbsp;mini&nbsp;absdiag&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(index)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;0.&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_slow_det matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_slow_det&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(numcolumns&nbsp;m)<br>
&nbsp;<span class="keyword">and</span>&nbsp;change_sign&nbsp;=&nbsp;ref&nbsp;<span class="keyword">false</span><br>
&nbsp;<span class="keyword">and</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;1.<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(matrix_float_copy&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;float_restricted_slow_pivot_downward&nbsp;!i&nbsp;!mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;resultat.(1).(0).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;coeff&nbsp;=&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;r&nbsp;;&nbsp;accu&nbsp;:=&nbsp;0.&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;resultat.(2).(0).(0)&nbsp;&lt;&gt;&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;change_sign&nbsp;:=&nbsp;not&nbsp;!change_sign&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(!i)&nbsp;&lt;-&nbsp;coeff&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!accu&nbsp;&lt;&gt;&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;diagonale.(i)&nbsp;*.&nbsp;!accu<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;candidat&nbsp;=&nbsp;!mm.(rr).(rr)&nbsp;*.&nbsp;!accu&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!change_sign&nbsp;<span class="keyword">then</span>&nbsp;-.&nbsp;candidat&nbsp;<span class="keyword">else</span>&nbsp;candidat<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;0.&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_pivot_downward i m p</pre> The matrix m is assumed to be upper triangular from line 0 to i - 1.
The matrix p registers the same changes as <code class="code">m</code>.
The coefficients under the diagonal of the output matrix mm are not modified since they wil not be used.
Output: pivot acted on the matrix <code class="code">m</code>, pivot acted on the matrix <code class="code">p</code>, 
pair of permutation indexes, value of the inverse of the pivot.
<p>

La matrice m est supposée, de la ligne 0 à i - 1, triangulaire supérieure. 
La matrice p enregistre les memes changements que <code class="code">m</code>.
Les coefficients sous la diagonale de la matrice <code class="code">mm</code> en sortie ne sont pas modifiés puisqu'ils ne seront pas utilisés.
Sortie : pivot effectué sur la matrice <code class="code">m</code>, pivot effecturé sur la matrice <code class="code">p</code>, 
paire d'indices de permutation, valeur de l'inverse du pivot. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_pivot_downward&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_copy&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;pp&nbsp;=&nbsp;identity_float&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;permutation&nbsp;=&nbsp;ref&nbsp;(&nbsp;[|&nbsp;[|&nbsp;0.&nbsp;;&nbsp;0.&nbsp;|]&nbsp;|]&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;mm.(i).(i)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;mm.(j).(i)&nbsp;&gt;&nbsp;abs_float&nbsp;!accu&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;accu&nbsp;:=&nbsp;mm.(j).(i)&nbsp;;&nbsp;index&nbsp;:=&nbsp;j&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;i&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;permutation&nbsp;:=&nbsp;float_of_matrix&nbsp;[|&nbsp;[|&nbsp;i&nbsp;;&nbsp;!index&nbsp;|]&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;aux&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;auxil&nbsp;=&nbsp;pp.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i)&nbsp;&lt;-&nbsp;mm.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(!index)&nbsp;&lt;-&nbsp;aux&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.(i)&nbsp;&lt;-&nbsp;pp.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.(!index)&nbsp;&lt;-&nbsp;auxil&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne&nbsp;=&nbsp;pp.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;piv&nbsp;=&nbsp;row.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;piv&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;in&nbsp;Matrix.float_pivot_downward."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;1.&nbsp;/.&nbsp;piv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;h&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mm.(h)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne_sortie&nbsp;=&nbsp;pp.(h)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;row_output.(i)&nbsp;*.&nbsp;coefficient&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ligne_sortie.(k)&nbsp;&lt;-&nbsp;ligne_sortie.(k)&nbsp;-.&nbsp;ligne.(k)&nbsp;*.&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ligne_sortie.(k)&nbsp;&lt;-&nbsp;ligne_sortie.(k)&nbsp;-.&nbsp;ligne.(k)&nbsp;*.&nbsp;coeff&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(k)&nbsp;&lt;-&nbsp;row_output.(k)&nbsp;-.&nbsp;row.(k)&nbsp;*.&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;mm&nbsp;;&nbsp;pp&nbsp;;&nbsp;!permutation&nbsp;;&nbsp;[|[|&nbsp;coefficient&nbsp;|]|]&nbsp;|]&nbsp;&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_pivot_upward i m p</pre> The matrix m is assumed to be diagonal from line i + 1 to r - 1.
The matrix p registers the same changes as m.
Output: pivot acted on the matrix <code class="code">m</code>, pivot acted on the matrix <code class="code">p</code>.
<p>

La matrice m est supposée, de la ligne i + 1 à r - 1, diagonale. 
La matrice p enregistre les memes changements que m.
Sortie : pivot effectué sur la matrice <code class="code">m</code>, pivot effecturé sur la matrice <code class="code">p</code>. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_pivot_upward&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array)&nbsp;(coefficient:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_copy&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;pp&nbsp;=&nbsp;matrix_float_copy&nbsp;p&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne&nbsp;=&nbsp;pp.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;jj&nbsp;=&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne_sortie&nbsp;=&nbsp;pp.(jj)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;mm.(jj).(i)&nbsp;*.&nbsp;coefficient&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;&nbsp;kk&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;jj&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ligne_sortie.(kk)&nbsp;&lt;-&nbsp;ligne_sortie.(kk)&nbsp;-.&nbsp;ligne.(kk)&nbsp;*.&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;kk&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ligne_sortie.(kk)&nbsp;&lt;-&nbsp;ligne_sortie.(kk)&nbsp;-.&nbsp;ligne.(kk)&nbsp;*.&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;kk&nbsp;=&nbsp;jj&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ligne_sortie.(kk)&nbsp;&lt;-&nbsp;ligne_sortie.(kk)&nbsp;-.&nbsp;ligne.(kk)&nbsp;*.&nbsp;coeff&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;mm&nbsp;;&nbsp;pp&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_copy&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;pp&nbsp;=&nbsp;identity_float&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;(<span class="constructor">Array</span>.length&nbsp;m.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
</code><table><tr><td></td><td><span class="comment">(** pivot downward : descendant *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;mm.(i).(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;mm.(j).(i)&nbsp;&gt;&nbsp;abs_float&nbsp;!accu&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;accu&nbsp;:=&nbsp;mm.(j).(i)&nbsp;;&nbsp;index&nbsp;:=&nbsp;j&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;i&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;aux&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;auxil&nbsp;=&nbsp;pp.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i)&nbsp;&lt;-&nbsp;mm.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(!index)&nbsp;&lt;-&nbsp;aux&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.(i)&nbsp;&lt;-&nbsp;pp.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.(!index)&nbsp;&lt;-&nbsp;auxil&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne&nbsp;=&nbsp;pp.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;piv&nbsp;=&nbsp;row.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;piv&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;in&nbsp;Matrix.float_inv."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;1.&nbsp;/.&nbsp;piv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(i)&nbsp;&lt;-&nbsp;coefficient&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;h&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;ref&nbsp;mm.(h)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne_sortie&nbsp;=&nbsp;ref&nbsp;pp.(h)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!row_output.(i)&nbsp;*.&nbsp;coefficient&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!ligne_sortie.(k)&nbsp;&lt;-&nbsp;!ligne_sortie.(k)&nbsp;-.&nbsp;ligne.(k)&nbsp;*.&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!ligne_sortie.(k)&nbsp;&lt;-&nbsp;!ligne_sortie.(k)&nbsp;-.&nbsp;ligne.(k)&nbsp;*.&nbsp;coeff&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!row_output.(k)&nbsp;&lt;-&nbsp;!row_output.(k)&nbsp;-.&nbsp;row.(k)&nbsp;*.&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.(h)&nbsp;&lt;-&nbsp;!ligne_sortie&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(h)&nbsp;&lt;-&nbsp;!row_output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;piv&nbsp;=&nbsp;mm.(&nbsp;rr&nbsp;).(&nbsp;rr&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;piv&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;at&nbsp;the&nbsp;last&nbsp;row&nbsp;in&nbsp;Matrix.float_inv."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(&nbsp;rr&nbsp;)&nbsp;&lt;-&nbsp;1.&nbsp;/.&nbsp;piv&nbsp;;<br>
</code><table><tr><td></td><td><span class="comment">(** pivot upward : montant *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;ii&nbsp;=&nbsp;rr&nbsp;<span class="keyword">downto</span>&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne&nbsp;=&nbsp;pp.(ii)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;diagonale.(ii)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;jj&nbsp;=&nbsp;ii&nbsp;-&nbsp;1&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne_sortie&nbsp;=&nbsp;ref&nbsp;pp.(jj)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;mm.(jj).(ii)&nbsp;*.&nbsp;coefficient&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;&nbsp;kk&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!ligne_sortie.(kk)&nbsp;&lt;-&nbsp;!ligne_sortie.(kk)&nbsp;-.&nbsp;ligne.(kk)&nbsp;*.&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.(jj)&nbsp;&lt;-&nbsp;!ligne_sortie&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
</code><table><tr><td></td><td><span class="comment">(** diagonale *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;hh&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_right&nbsp;=&nbsp;ref&nbsp;pp.(hh)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;coeff_diag&nbsp;=&nbsp;diagonale.(hh)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;ll&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!row_right.(ll)&nbsp;&lt;-&nbsp;!row_right.(ll)&nbsp;*.&nbsp;coeff_diag<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;pp.(hh)&nbsp;&lt;-&nbsp;!row_right<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;pp&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_left_quotient matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_left_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_copy&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;pp&nbsp;=&nbsp;matrix_float_copy&nbsp;p&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
</code><table><tr><td></td><td><span class="comment">(** pivot downward : descendant *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;mm.(i).(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;mm.(j).(i)&nbsp;&gt;&nbsp;abs_float&nbsp;!accu&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;accu&nbsp;:=&nbsp;mm.(j).(i)&nbsp;;&nbsp;index&nbsp;:=&nbsp;j&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;i&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;aux&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;auxil&nbsp;=&nbsp;pp.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i)&nbsp;&lt;-&nbsp;mm.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(!index)&nbsp;&lt;-&nbsp;aux&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.(i)&nbsp;&lt;-&nbsp;pp.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.(!index)&nbsp;&lt;-&nbsp;auxil&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne&nbsp;=&nbsp;pp.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;piv&nbsp;=&nbsp;row.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;piv&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;in&nbsp;Matrix.float_left_quotient."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;1.&nbsp;/.&nbsp;piv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(i)&nbsp;&lt;-&nbsp;coefficient&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;h&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;ref&nbsp;mm.(h)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne_sortie&nbsp;=&nbsp;ref&nbsp;pp.(h)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!row_output.(i)&nbsp;*.&nbsp;coefficient&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!ligne_sortie.(k)&nbsp;&lt;-&nbsp;!ligne_sortie.(k)&nbsp;-.&nbsp;ligne.(k)&nbsp;*.&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!ligne_sortie.(k)&nbsp;&lt;-&nbsp;!ligne_sortie.(k)&nbsp;-.&nbsp;ligne.(k)&nbsp;*.&nbsp;coeff&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!row_output.(k)&nbsp;&lt;-&nbsp;!row_output.(k)&nbsp;-.&nbsp;row.(k)&nbsp;*.&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.(h)&nbsp;&lt;-&nbsp;!ligne_sortie&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(h)&nbsp;&lt;-&nbsp;!row_output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;piv&nbsp;=&nbsp;mm.(&nbsp;rr&nbsp;).(&nbsp;rr&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;piv&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Division&nbsp;by&nbsp;zero&nbsp;at&nbsp;the&nbsp;last&nbsp;row&nbsp;in&nbsp;Matrix.float_left_quotient."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(&nbsp;rr&nbsp;)&nbsp;&lt;-&nbsp;1.&nbsp;/.&nbsp;piv&nbsp;;<br>
</code><table><tr><td></td><td><span class="comment">(** pivot upward : montant *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;ii&nbsp;=&nbsp;rr&nbsp;<span class="keyword">downto</span>&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne&nbsp;=&nbsp;pp.(ii)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;diagonale.(ii)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;jj&nbsp;=&nbsp;ii&nbsp;-&nbsp;1&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne_sortie&nbsp;=&nbsp;ref&nbsp;pp.(jj)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;mm.(jj).(ii)&nbsp;*.&nbsp;coefficient&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;&nbsp;kk&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!ligne_sortie.(kk)&nbsp;&lt;-&nbsp;!ligne_sortie.(kk)&nbsp;-.&nbsp;ligne.(kk)&nbsp;*.&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp.(jj)&nbsp;&lt;-&nbsp;!ligne_sortie&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
</code><table><tr><td></td><td><span class="comment">(** diagonale *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;hh&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_right&nbsp;=&nbsp;ref&nbsp;pp.(hh)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;coeff_diag&nbsp;=&nbsp;diagonale.(hh)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;ll&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!row_right.(ll)&nbsp;&lt;-&nbsp;!row_right.(ll)&nbsp;*.&nbsp;coeff_diag<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;pp.(hh)&nbsp;&lt;-&nbsp;!row_right<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;pp&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_right_quotient matrix1 matrix2</pre> This gives matrix2 * (matrix1) ^ -1.
<p>

Ceci retourne matrix2 * (matrix1) ^ -1. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_right_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;float_transpose&nbsp;(&nbsp;matrix_float_left_quotient&nbsp;(float_transpose&nbsp;m)&nbsp;(float_transpose&nbsp;p)&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line_float_left_quotient matrix1 matrix_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;line_float_left_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_float_left_quotient&nbsp;m)&nbsp;p&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line_float_right_quotient matrix1 matrix_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;line_float_right_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(p:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_float_right_quotient&nbsp;m)&nbsp;p&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_invertibility matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_invertibility&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_copy&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;resultat&nbsp;=&nbsp;ref&nbsp;<span class="keyword">true</span><br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;=&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;mm.(!i).(!i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;!i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;mm.(j).(!i)&nbsp;&gt;&nbsp;abs_float&nbsp;!accu&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;accu&nbsp;:=&nbsp;mm.(j).(!i)&nbsp;;&nbsp;index&nbsp;:=&nbsp;j&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!accu&nbsp;=&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;resultat&nbsp;:=&nbsp;<span class="keyword">false</span>&nbsp;;&nbsp;i&nbsp;:=&nbsp;r&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;!i&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;aux&nbsp;=&nbsp;mm.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(!i)&nbsp;&lt;-&nbsp;mm.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(!index)&nbsp;&lt;-&nbsp;aux<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;mm.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;1.&nbsp;/.&nbsp;!accu&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;h&nbsp;=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;ref&nbsp;mm.(h)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!row_output.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!row_output.(k)&nbsp;&lt;-&nbsp;!row_output.(k)&nbsp;-.&nbsp;row.(k)&nbsp;*.&nbsp;coeff&nbsp;*.&nbsp;coefficient<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(h)&nbsp;&lt;-&nbsp;!row_output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;mm.(rr).(rr)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;x&nbsp;=&nbsp;0.&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;resultat&nbsp;:=&nbsp;<span class="keyword">false</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!resultat&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_invertibility_evaluation matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_invertibility_evaluation&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_copy&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;resultat&nbsp;=&nbsp;ref&nbsp;max_float<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;=&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;mm.(!i).(!i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;!i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;mm.(j).(!i)&nbsp;&gt;&nbsp;abs_float&nbsp;!accu&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;accu&nbsp;:=&nbsp;mm.(j).(!i)&nbsp;;&nbsp;index&nbsp;:=&nbsp;j&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!accu&nbsp;=&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;resultat&nbsp;:=&nbsp;0.&nbsp;;&nbsp;i&nbsp;:=&nbsp;r&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;(abs_float&nbsp;!accu)&nbsp;&lt;&nbsp;(abs_float&nbsp;!resultat)&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;resultat&nbsp;:=&nbsp;!accu&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;!i&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;aux&nbsp;=&nbsp;mm.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(!i)&nbsp;&lt;-&nbsp;mm.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(!index)&nbsp;&lt;-&nbsp;aux<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;mm.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;1.&nbsp;/.&nbsp;!accu&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;h&nbsp;=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;ref&nbsp;mm.(h)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!row_output.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!row_output.(k)&nbsp;&lt;-&nbsp;!row_output.(k)&nbsp;-.&nbsp;row.(k)&nbsp;*.&nbsp;coeff&nbsp;*.&nbsp;coefficient<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(h)&nbsp;&lt;-&nbsp;!row_output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;mm.(rr).(rr)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;abs_float&nbsp;x&nbsp;&lt;&nbsp;abs_float&nbsp;!resultat&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;resultat&nbsp;:=&nbsp;x&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!resultat&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_det matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_det&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;change_sign&nbsp;=&nbsp;ref&nbsp;<span class="keyword">false</span><br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_copy&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;resultat&nbsp;=&nbsp;ref&nbsp;1.<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;=&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;mm.(!i).(!i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;!i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;mm.(j).(!i)&nbsp;&gt;&nbsp;abs_float&nbsp;!accu&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;accu&nbsp;:=&nbsp;mm.(j).(!i)&nbsp;;&nbsp;index&nbsp;:=&nbsp;j&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!accu&nbsp;=&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;resultat&nbsp;:=&nbsp;0.&nbsp;;&nbsp;i&nbsp;:=&nbsp;r&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resultat&nbsp;:=&nbsp;!accu&nbsp;*.&nbsp;!resultat&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;!i&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;change_sign&nbsp;:=&nbsp;not&nbsp;!change_sign&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;aux&nbsp;=&nbsp;mm.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(!i)&nbsp;&lt;-&nbsp;mm.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(!index)&nbsp;&lt;-&nbsp;aux<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;mm.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;1.&nbsp;/.&nbsp;!accu&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;h&nbsp;=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;ref&nbsp;mm.(h)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!row_output.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!row_output.(k)&nbsp;&lt;-&nbsp;!row_output.(k)&nbsp;-.&nbsp;row.(k)&nbsp;*.&nbsp;coeff&nbsp;*.&nbsp;coefficient<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(h)&nbsp;&lt;-&nbsp;!row_output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;mm.(rr).(rr)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;resultat&nbsp;:=&nbsp;x&nbsp;*.&nbsp;!resultat&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!change_sign&nbsp;<span class="keyword">then</span>&nbsp;-.&nbsp;!resultat&nbsp;<span class="keyword">else</span>&nbsp;!resultat&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_dirty_inv matrix</pre> This may apply to matrices near identity.
<p>

Ceci devrait s'appliquer aux matrices proches de l'identité. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_dirty_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;-.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(i)&nbsp;&lt;-&nbsp;2.&nbsp;-.&nbsp;row_input.(i)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;-.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i)&nbsp;&lt;-&nbsp;row_output<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>other_float_dirty_inv matrix</pre> This may apply to matrices near identity.
<p>

Ceci devrait s'appliquer aux matrices proches de l'identité. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;other_float_dirty_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;t&nbsp;=&nbsp;ref&nbsp;(&nbsp;float_trace&nbsp;m&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!t&nbsp;=&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;t&nbsp;:=&nbsp;2.&nbsp;*.&nbsp;(matrix_float_norm_inf&nbsp;m)&nbsp;/.&nbsp;(float&nbsp;r)&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;t&nbsp;:=&nbsp;2.&nbsp;*.&nbsp;!t&nbsp;/.&nbsp;(float&nbsp;r)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;-.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(i)&nbsp;&lt;-&nbsp;!t&nbsp;-.&nbsp;row_input.(i)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;-.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i)&nbsp;&lt;-&nbsp;row_output<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>slow_float_tune_inv norm matrix matrix_inv_candidate</pre> This is taken from the HP15C calulator's high level mathematical functions manual.
<p>

Input : &lt;matrix&gt; = x ; &lt;matrix_inv_candidate&gt; = y with y = x ^ -1 + epsilon ; &lt;norm&gt; may be any norm on matrices.
<p>

Output = &lt; candidate ; error &gt; with
<p>

candidate = 2 * y - y * x * y  and
<p>

error = norm ( x * candidate - Id ) &lt;= || x || ^ 2 * || epsilon || ^ 2.
Ceci provient du manuel des fonctions mathématiques de haut niveau de la calculette HP15C. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;slow_float_tune_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;(y:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_prod&nbsp;x&nbsp;y<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;lambda&nbsp;=&nbsp;scal_float&nbsp;r&nbsp;r&nbsp;2.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;matrix_float_minus&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;2.&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_float_prod&nbsp;mm&nbsp;mm&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;candidate&nbsp;=&nbsp;matrix_float_prod&nbsp;y&nbsp;(&nbsp;matrix_float_minus&nbsp;lambda&nbsp;mm&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;error&nbsp;=&nbsp;distance&nbsp;(&nbsp;matrix_float_minus&nbsp;delta&nbsp;(identity_float&nbsp;r&nbsp;r)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;candidate&nbsp;;&nbsp;[|[|error|]|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_tune_inv norm matrix matrix_inv_candidate</pre> This is taken from the HP15C calulator's high level mathematical functions manual.
<p>

Input : &lt;matrix&gt; = x ; &lt;matrix_inv_candidate&gt; = y with y = x ^ -1 + epsilon ; &lt;norm&gt; may be any norm on matrices.
<p>

Output = &lt; candidate ; error &gt; with
<p>

candidate = 2 * y - y * x * y  and
<p>

error = norm ( x * candidate - Id ) &lt;= || x || ^ 2 * || epsilon || ^ 2.
Ceci provient du manuel des fonctions mathématiques de haut niveau de la calculette HP15C. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_tune_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;(y:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_left&nbsp;=&nbsp;x.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;ref&nbsp;row_output.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeff&nbsp;:=&nbsp;!coeff&nbsp;+.&nbsp;row_left.(k)&nbsp;*.&nbsp;y.(k).(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;!coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i)&nbsp;&lt;-&nbsp;row_output<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;candidate&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_LEFT&nbsp;=&nbsp;y.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_OUTPUT&nbsp;=&nbsp;candidate.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;ref&nbsp;row_OUTPUT.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeff&nbsp;:=&nbsp;!coeff&nbsp;+.&nbsp;row_LEFT.(k)&nbsp;*.&nbsp;mm.(k).(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeff&nbsp;:=&nbsp;2.&nbsp;*.&nbsp;row_LEFT.(j)&nbsp;-.&nbsp;!coeff&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_OUTPUT.(j)&nbsp;&lt;-&nbsp;!coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;candidate.(i)&nbsp;&lt;-&nbsp;row_OUTPUT<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;delta&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_Left&nbsp;=&nbsp;x.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_Output&nbsp;=&nbsp;delta.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;ref&nbsp;row_Output.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeff&nbsp;:=&nbsp;!coeff&nbsp;+.&nbsp;row_Left.(k)&nbsp;*.&nbsp;candidate.(k).(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_Output.(j)&nbsp;&lt;-&nbsp;!coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_Output.(i)&nbsp;&lt;-&nbsp;row_Output.(i)&nbsp;-.&nbsp;1.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delta.(i)&nbsp;&lt;-&nbsp;row_Output<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;error&nbsp;=&nbsp;distance&nbsp;delta&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;candidate&nbsp;;&nbsp;[|[|error|]|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>slow_float_approx_inv norm invertor matrix</pre> If invertor = float_dirty_inv, then this may apply only to matrices near identity.
In other cases, it may enhance the precision of the result.
<p>

Dans le cas où l'inverseur vaut invertor = float_dirty_inv, ceci ne devrait s'appliquer qu'aux matrices proches de l'identité.
Dans les autres cas, la précision du résultat pourrait être améliorée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;slow_float_approx_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(invertor:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array&nbsp;array)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;invertor&nbsp;x<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;product&nbsp;=&nbsp;matrix_float_prod&nbsp;x&nbsp;y<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;result&nbsp;=&nbsp;slow_float_tune_inv&nbsp;distance&nbsp;x&nbsp;y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;error0&nbsp;=&nbsp;distance&nbsp;(&nbsp;matrix_float_minus&nbsp;product&nbsp;(identity_float&nbsp;r&nbsp;r)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;error1&nbsp;=&nbsp;result.(1).(0).(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;z&nbsp;=&nbsp;result.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;error1&nbsp;&gt;=&nbsp;error0&nbsp;<span class="keyword">then</span>&nbsp;[|&nbsp;y&nbsp;;&nbsp;[|[|&nbsp;error0&nbsp;|]|]&nbsp;|]&nbsp;<span class="keyword">else</span>&nbsp;[|&nbsp;z&nbsp;;&nbsp;[|[|&nbsp;error1&nbsp;|]|]&nbsp;|]&nbsp;;;&nbsp;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_approx_inv norm invertor matrix</pre> If invertor = float_dirty_inv, then this may apply only to matrices near identity.
In other cases, it may enhance the precision of the result.
<p>

Dans le cas où l'inverseur vaut invertor = float_dirty_inv, ceci ne devrait s'appliquer qu'aux matrices proches de l'identité.
Dans les autres cas, la précision du résultat pourrait être améliorée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_approx_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(invertor:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array&nbsp;array)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;invertor&nbsp;x<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;product&nbsp;=&nbsp;matrix_float_prod&nbsp;x&nbsp;y<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;result&nbsp;=&nbsp;float_tune_inv&nbsp;distance&nbsp;x&nbsp;y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;error0&nbsp;=&nbsp;distance&nbsp;(&nbsp;matrix_float_minus&nbsp;product&nbsp;(identity_float&nbsp;r&nbsp;r)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;error1&nbsp;=&nbsp;result.(1).(0).(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;z&nbsp;=&nbsp;result.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;error1&nbsp;&gt;=&nbsp;error0&nbsp;<span class="keyword">then</span>&nbsp;[|&nbsp;y&nbsp;;&nbsp;[|[|&nbsp;error0&nbsp;|]|]&nbsp;|]&nbsp;<span class="keyword">else</span>&nbsp;[|&nbsp;z&nbsp;;&nbsp;[|[|&nbsp;error1&nbsp;|]|]&nbsp;|]&nbsp;;;&nbsp;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>slow_float_loop_approx_inv norm invertor matrix</pre> If invertor = float_dirty_inv, then this may apply only to matrices near identity.
In other cases, it may enhance the precision of the result.
<p>

Dans le cas où invertor = float_dirty_inv, ceci ne devrait s'appliquer qu'aux matrices proches de l'identité.
Dans les autres cas, la précision du résultat pourrait être améliorée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;slow_float_loop_approx_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(invertor:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array&nbsp;array)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;(invertor&nbsp;x)<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;product&nbsp;=&nbsp;matrix_float_prod&nbsp;x&nbsp;!y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;error0&nbsp;=&nbsp;ref&nbsp;max_float<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;error1&nbsp;=&nbsp;ref&nbsp;(&nbsp;distance&nbsp;(&nbsp;matrix_float_minus&nbsp;product&nbsp;(identity_float&nbsp;r&nbsp;r)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;error1&nbsp;&lt;&nbsp;error0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;slow_float_tune_inv&nbsp;distance&nbsp;x&nbsp;!y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;error2&nbsp;=&nbsp;ref&nbsp;(&nbsp;result.(1).(0).(0)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!error2&nbsp;&lt;&nbsp;!error1&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error0&nbsp;:=&nbsp;!error1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error1&nbsp;:=&nbsp;!error2&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;result.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;error0&nbsp;:=&nbsp;!error1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;!y&nbsp;;&nbsp;[|[|&nbsp;!error1&nbsp;|]|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>slow_float_target_inv norm invertor threshold matrix</pre> If invertor = float_dirty_inv, then this may apply only to matrices near identity.
In other cases, it may enhance the precision of the result. The stop test is evaluated on the candidate for the inverse.
<p>

Dans le cas où invertor = float_dirty_inv, ceci ne devrait s'appliquer qu'aux matrices proches de l'identité.
Dans les autres cas, la précision du résultat pourrait être améliorée.
Le test d'arrêt est réalisé sur le candidat inverse. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;slow_float_target_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(invertor:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array&nbsp;array)&nbsp;(threshold:float)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;(&nbsp;zeros_float&nbsp;x&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;z&nbsp;=&nbsp;ref&nbsp;(&nbsp;invertor&nbsp;x&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;error0&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;error1&nbsp;=&nbsp;ref&nbsp;(&nbsp;distance&nbsp;!z&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;(&nbsp;!error1&nbsp;&gt;&nbsp;threshold&nbsp;)&nbsp;<span class="keyword">or</span>&nbsp;(&nbsp;!error1&nbsp;&gt;&nbsp;!error0&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;!z&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error0&nbsp;:=&nbsp;!error1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;slow_float_tune_inv&nbsp;distance&nbsp;x&nbsp;!y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:=&nbsp;result.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error1&nbsp;:=&nbsp;distance&nbsp;(&nbsp;matrix_float_minus&nbsp;!z&nbsp;!y&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;!z&nbsp;;&nbsp;[|[|&nbsp;!error1&nbsp;|]|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_loop_approx_inv norm invertor matrix</pre> If invertor = float_dirty_inv, then this may apply only to matrices near identity.
In other cases, it may enhance the precision of the result.
<p>

Dans le cas où invertor = float_dirty_inv, ceci ne devrait s'appliquer qu'aux matrices proches de l'identité.
Dans les autres cas, la précision du résultat pourrait être améliorée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_loop_approx_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(invertor:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array&nbsp;array)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;(invertor&nbsp;x)<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;product&nbsp;=&nbsp;matrix_float_prod&nbsp;x&nbsp;!y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;error0&nbsp;=&nbsp;ref&nbsp;max_float<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;error1&nbsp;=&nbsp;ref&nbsp;(&nbsp;distance&nbsp;(&nbsp;matrix_float_minus&nbsp;product&nbsp;(identity_float&nbsp;r&nbsp;r)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;error1&nbsp;&lt;&nbsp;error0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;float_tune_inv&nbsp;distance&nbsp;x&nbsp;!y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;error2&nbsp;=&nbsp;ref&nbsp;(&nbsp;result.(1).(0).(0)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!error2&nbsp;&lt;&nbsp;!error1&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error0&nbsp;:=&nbsp;!error1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error1&nbsp;:=&nbsp;!error2&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;result.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;error0&nbsp;:=&nbsp;!error1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;!y&nbsp;;&nbsp;[|[|&nbsp;!error1&nbsp;|]|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_target_inv norm invertor threshold matrix</pre> If invertor = float_dirty_inv, then this may apply only to matrices near identity.
In other cases, it may enhance the precision of the result. The stop test is evaluated on the candidate for the inverse.
<p>

Dans le cas où invertor = float_dirty_inv, ceci ne devrait s'appliquer qu'aux matrices proches de l'identité.
Dans les autres cas, la précision du résultat pourrait être améliorée.
Le test d'arrêt est réalisé sur le candidat inverse. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_target_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(invertor:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array&nbsp;array)&nbsp;(threshold:float)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;(&nbsp;zeros_float&nbsp;x&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;z&nbsp;=&nbsp;ref&nbsp;(&nbsp;invertor&nbsp;x&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;error0&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;error1&nbsp;=&nbsp;ref&nbsp;(&nbsp;distance&nbsp;!z&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;(&nbsp;!error1&nbsp;&gt;&nbsp;threshold&nbsp;)&nbsp;<span class="keyword">or</span>&nbsp;(&nbsp;!error1&nbsp;&gt;&nbsp;!error0&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;!z&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error0&nbsp;:=&nbsp;!error1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;float_tune_inv&nbsp;distance&nbsp;x&nbsp;!y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:=&nbsp;result.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error1&nbsp;:=&nbsp;distance&nbsp;(&nbsp;matrix_float_minus&nbsp;!z&nbsp;!y&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;error1&nbsp;&lt;&nbsp;error0&nbsp;<span class="keyword">then</span>&nbsp;[|&nbsp;!z&nbsp;;&nbsp;[|[|&nbsp;!error1&nbsp;|]|]&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;[|&nbsp;!y&nbsp;;&nbsp;[|[|&nbsp;!error0&nbsp;|]|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_target_inv_seq norm invertor threshold matrix</pre> If invertor = float_dirty_inv, then this may apply only to matrices near identity.
In other cases, it may enhance the precision of the result. The stop test is evaluated on the candidate for the inverse.
<p>

Dans le cas où invertor = float_dirty_inv, ceci ne devrait s'appliquer qu'aux matrices proches de l'identité.
Dans les autres cas, la précision du résultat pourrait être améliorée.
Le test d'arrêt est réalisé sur le candidat inverse. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_target_inv_seq&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(invertor:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array&nbsp;array)&nbsp;(threshold:float)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;(&nbsp;zeros_float&nbsp;x&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;z&nbsp;=&nbsp;ref&nbsp;(&nbsp;invertor&nbsp;x&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;error0&nbsp;=&nbsp;ref&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;seq&nbsp;=&nbsp;ref&nbsp;[|&nbsp;matrix_float_copy&nbsp;!z&nbsp;|]<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;error1&nbsp;=&nbsp;ref&nbsp;(&nbsp;distance&nbsp;!z&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;(&nbsp;!error1&nbsp;&gt;&nbsp;threshold&nbsp;)&nbsp;<span class="keyword">or</span>&nbsp;(&nbsp;!error1&nbsp;&gt;&nbsp;!error0&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;!z&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error0&nbsp;:=&nbsp;!error1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;float_tune_inv&nbsp;distance&nbsp;x&nbsp;!y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:=&nbsp;result.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seq&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!seq&nbsp;[|&nbsp;matrix_float_copy&nbsp;!z&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error1&nbsp;:=&nbsp;distance&nbsp;(&nbsp;matrix_float_minus&nbsp;!z&nbsp;!y&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;error1&nbsp;&gt;=&nbsp;error0&nbsp;<span class="keyword">then</span>&nbsp;seq&nbsp;:=&nbsp;<span class="constructor">Array</span>.sub&nbsp;!seq&nbsp;1&nbsp;(&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;!seq&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!seq&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_target_inv_seq accelearator norm invertor threshold matrix</pre> If invertor = float_dirty_inv, then this may apply only to matrices near identity.
In other cases, it may enhance the precision of the result. The stop test is evaluated on the candidate for the inverse.
<p>

Dans le cas où invertor = float_dirty_inv, ceci ne devrait s'appliquer qu'aux matrices proches de l'identité.
Dans les autres cas, la précision du résultat pourrait être améliorée.
Le test d'arrêt est réalisé sur le candidat inverse. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_compensated_target_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;accelerator&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(invertor:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array&nbsp;array)&nbsp;(threshold:float)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;float_target_inv_seq&nbsp;distance&nbsp;invertor&nbsp;threshold&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;accelerator&nbsp;s&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_cond norm invertor matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_cond&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(distance:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(invertor:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array&nbsp;array)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
(distance&nbsp;m)&nbsp;*.&nbsp;(&nbsp;distance&nbsp;(invertor&nbsp;m)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_naive_solve invertor matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_naive_solve&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(invertor:float&nbsp;array&nbsp;array&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float&nbsp;array&nbsp;array)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_vector_float_prod&nbsp;(invertor&nbsp;m)&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_solve matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_solve&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;p&nbsp;=&nbsp;float_transpose&nbsp;[|&nbsp;v&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;matrix_float_left_quotient&nbsp;m&nbsp;p&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;(&nbsp;float_transpose&nbsp;x&nbsp;).(0)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_slow_solve matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_slow_solve&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;p&nbsp;=&nbsp;float_transpose&nbsp;[|&nbsp;v&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;matrix_float_slow_left_quotient&nbsp;m&nbsp;p&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;(&nbsp;float_transpose&nbsp;x&nbsp;).(0)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_det matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_det&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;float_of_matrix&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;float_det&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Util</span>.round&nbsp;d&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_slow_det matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_slow_det&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;float_of_matrix&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;float_slow_det&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Util</span>.round&nbsp;d&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_invertibility threshold matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_invertibility&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(threshold:float)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;float_of_matrix&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;float_invertibility&nbsp;mm&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;float_det&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;(&nbsp;(abs_float&nbsp;d)&nbsp;-.&nbsp;1.&nbsp;)&nbsp;&lt;&nbsp;threshold&nbsp;<span class="keyword">then</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">false</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">false</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_slow_invertibility threshold matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_slow_invertibility&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(threshold:float)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;float_of_matrix&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;float_slow_invertibility&nbsp;mm&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;float_slow_det&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;(&nbsp;(abs_float&nbsp;d)&nbsp;-.&nbsp;1.&nbsp;)&nbsp;&lt;&nbsp;threshold&nbsp;<span class="keyword">then</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">false</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">false</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;int_invertibility&nbsp;0.5&nbsp;m&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;float_of_matrix&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_float_scal_left_div&nbsp;(matrix_float_norm_inf&nbsp;mm)&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_round&nbsp;(&nbsp;matrix_float_scal_left_div&nbsp;(matrix_float_norm_inf&nbsp;mm)&nbsp;(float_inv&nbsp;mmm)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">else</span>&nbsp;failwith&nbsp;<span class="string">"Inversion&nbsp;error&nbsp;in&nbsp;Matrix.int_inv."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_slow_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_slow_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;int_slow_invertibility&nbsp;0.5&nbsp;m&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;float_of_matrix&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_float_scal_left_div&nbsp;(matrix_float_norm_inf&nbsp;mm)&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_round&nbsp;(&nbsp;matrix_float_scal_left_div&nbsp;(matrix_float_norm_inf&nbsp;mm)&nbsp;(float_slow_inv&nbsp;mmm)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">else</span>&nbsp;failwith&nbsp;<span class="string">"Inversion&nbsp;error&nbsp;in&nbsp;Matrix.int_slow_inv."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_reciprocal vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_reciprocal&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;vector_float_scal_left_div&nbsp;(&nbsp;vector_float_square_norm_2&nbsp;v&nbsp;)&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_reciprocal vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_reciprocal&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_scal_left_div&nbsp;(&nbsp;matrix_float_square_frobenius&nbsp;m&nbsp;)&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_trans_reciprocal vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_trans_reciprocal&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_scal_left_div&nbsp;(&nbsp;matrix_float_square_frobenius&nbsp;m&nbsp;)&nbsp;(&nbsp;float_transpose&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Acclrateursdeconvergenceoucompensateursderreurs"><h1>Accélérateurs de convergence ou compensateurs d'erreurs</h1></span>
<span id="1_ConvergenceAcceleratorsorerrorcompensators"><h1>Convergence Accelerators or error compensators</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="2_SuitesdansfloatSequencesoffloat"><h2><center>Suites dans <code class="code">float</code>
---
Sequences of <code class="code">float</code></center> </h2></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_aitken_seki u(n) u(n+1) u(n+2)</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_aitken_seki&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(b:float)&nbsp;(c:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;b&nbsp;-.&nbsp;a<br>
&nbsp;<span class="keyword">and</span>&nbsp;e&nbsp;=&nbsp;c&nbsp;-.&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;d&nbsp;*.&nbsp;e<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;d&nbsp;-.&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;f&nbsp;/.&nbsp;g&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;+.&nbsp;h&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_aitken_seki_rec k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;float_aitken_seki_rec&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;&lt;=&nbsp;n&nbsp;+&nbsp;2&nbsp;*&nbsp;k&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;s.(n)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float_aitken_seki&nbsp;s.(n)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;2&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;pred&nbsp;k&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;float_aitken_seki_rec&nbsp;kk&nbsp;n&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;float_aitken_seki_rec&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;float_aitken_seki_rec&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;2&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;b&nbsp;-.&nbsp;a&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;c&nbsp;-.&nbsp;b&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;a&nbsp;-.&nbsp;c&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;float_aitken_seki&nbsp;a&nbsp;b&nbsp;c&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_shanks2 u(n) u(n+1) u(n+2) u(n+3) u(n+4)</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_shanks2&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float)&nbsp;(b:float)&nbsp;(c:float)&nbsp;(d:float)&nbsp;(e:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;delta0&nbsp;=&nbsp;b&nbsp;-.&nbsp;a<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta1&nbsp;=&nbsp;c&nbsp;-.&nbsp;b<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta2&nbsp;=&nbsp;d&nbsp;-.&nbsp;c<br>
&nbsp;<span class="keyword">and</span>&nbsp;delta3&nbsp;=&nbsp;e&nbsp;-.&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dd0&nbsp;=&nbsp;delta1&nbsp;-.&nbsp;delta0<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dd1&nbsp;=&nbsp;delta2&nbsp;-.&nbsp;delta1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dd2&nbsp;=&nbsp;delta3&nbsp;-.&nbsp;delta2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;denom&nbsp;=&nbsp;float_slow_det&nbsp;[|&nbsp;[|&nbsp;dd0&nbsp;;&nbsp;dd1&nbsp;|]&nbsp;;&nbsp;[|&nbsp;dd1&nbsp;;&nbsp;dd2&nbsp;|]&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;numer&nbsp;=&nbsp;float_slow_det&nbsp;[|&nbsp;[|&nbsp;a&nbsp;;&nbsp;b&nbsp;;&nbsp;c&nbsp;|]&nbsp;;&nbsp;[|&nbsp;b&nbsp;;&nbsp;c&nbsp;;&nbsp;d&nbsp;|]&nbsp;;&nbsp;[|&nbsp;c&nbsp;;&nbsp;d&nbsp;;&nbsp;e&nbsp;|]&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;numer&nbsp;/.&nbsp;denom&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_wynn k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;float_wynn&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.float_wynn."</span>&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0.<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.float_wynn."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.float_wynn."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;float_wynn&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;float_wynn&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;float_wynn&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;b&nbsp;-.&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;a&nbsp;+.&nbsp;1.&nbsp;/.&nbsp;d&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_wynn_rho k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;float_wynn_rho&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;float_wynn_rho&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;float_wynn_rho&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;float_wynn_rho&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;b&nbsp;-.&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;a&nbsp;+.&nbsp;(&nbsp;float&nbsp;k&nbsp;)&nbsp;/.&nbsp;d<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_brezinski k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;float_brezinski&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.float_brezinski."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.float_brezinski."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.float_brezinski."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;float_brezinski&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;float_brezinski&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;float_brezinski&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;b&nbsp;-.&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;a&nbsp;+.&nbsp;1.&nbsp;/.&nbsp;d<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;float_brezinski&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np2&nbsp;=&nbsp;succ&nbsp;np&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;float_brezinski&nbsp;km1&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;bb&nbsp;=&nbsp;float_brezinski&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;float_brezinski&nbsp;km2&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;float_brezinski&nbsp;km2&nbsp;np&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;b&nbsp;-.&nbsp;bb<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dd&nbsp;=&nbsp;c&nbsp;-.&nbsp;cc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ee&nbsp;=&nbsp;d&nbsp;*.&nbsp;dd<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;eee&nbsp;=&nbsp;(&nbsp;float_brezinski&nbsp;km1&nbsp;n&nbsp;s&nbsp;)&nbsp;+.&nbsp;(&nbsp;float_brezinski&nbsp;km1&nbsp;np2&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;eeee&nbsp;=&nbsp;eee&nbsp;-.&nbsp;(&nbsp;2.&nbsp;*.&nbsp;(&nbsp;float_brezinski&nbsp;km1&nbsp;np&nbsp;s&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;eeee&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;a&nbsp;+.&nbsp;ee&nbsp;/.&nbsp;eeee<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_approx value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_approx&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;rr&nbsp;/&nbsp;2<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;parity&nbsp;=&nbsp;rr&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;parity&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;float_aitken_seki_rec&nbsp;kk&nbsp;0&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;float_aitken_seki_rec&nbsp;kk&nbsp;1&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="2_SuitesdevecteursVectorsequences"><h2><center>Suites de vecteurs
---
Vector sequences</center> </h2></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_aitken_seki u(n) u(n+1) u(n+2)</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_aitken_seki&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float&nbsp;array)&nbsp;(b:float&nbsp;array)&nbsp;(c:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;vector_float_minus&nbsp;b&nbsp;a<br>
&nbsp;<span class="keyword">and</span>&nbsp;e&nbsp;=&nbsp;vector_float_minus&nbsp;c&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;vector_float_scal_prod&nbsp;d&nbsp;e<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;vector_float_minus&nbsp;d&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;vector_float_scal_mult&nbsp;f&nbsp;(&nbsp;vector_float_reciprocal&nbsp;g&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vector_float_plus&nbsp;b&nbsp;h&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_aitken_seki_rec k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_float_aitken_seki_rec&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.vector_float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.vector_float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;&lt;=&nbsp;n&nbsp;+&nbsp;2&nbsp;*&nbsp;k&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.vector_float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;s.(n)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_float_aitken_seki&nbsp;s.(n)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;2&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;pred&nbsp;k&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;vector_float_aitken_seki_rec&nbsp;kk&nbsp;n&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;vector_float_aitken_seki_rec&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;vector_float_aitken_seki_rec&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;2&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;vector_float_norm_inf&nbsp;(&nbsp;vector_float_minus&nbsp;b&nbsp;a&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;vector_float_norm_inf&nbsp;(&nbsp;vector_float_minus&nbsp;c&nbsp;b&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;vector_float_norm_inf&nbsp;(&nbsp;vector_float_minus&nbsp;a&nbsp;c&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;vector_float_aitken_seki&nbsp;a&nbsp;b&nbsp;c&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_wynn k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_float_wynn&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.vector_float_wynn."</span>&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0)&nbsp;)&nbsp;0.<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.vector_float_wynn."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.vector_float_wynn."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;vector_float_wynn&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;vector_float_wynn&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;vector_float_wynn&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;vector_float_minus&nbsp;b&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;vector_float_norm_inf&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;vector_float_plus&nbsp;a&nbsp;(&nbsp;vector_float_reciprocal&nbsp;d&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_wynn_rho k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_float_wynn_rho&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.vector_float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0)&nbsp;)&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.vector_float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.vector_float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;vector_float_wynn_rho&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;vector_float_wynn_rho&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;vector_float_wynn_rho&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;vector_float_minus&nbsp;b&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;vector_float_norm_inf&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;vector_float_plus&nbsp;a&nbsp;(&nbsp;vector_float_scal_mult&nbsp;(&nbsp;float&nbsp;k&nbsp;)&nbsp;(&nbsp;vector_float_reciprocal&nbsp;d&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_brezinski k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_float_brezinski&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.vector_float_brezinski."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.make&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0)&nbsp;)&nbsp;0.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.vector_float_brezinski."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.vector_float_brezinski."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;vector_float_brezinski&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;vector_float_brezinski&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;vector_float_brezinski&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;vector_float_minus&nbsp;b&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;vector_float_norm_inf&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;vector_float_plus&nbsp;a&nbsp;(&nbsp;vector_float_reciprocal&nbsp;d&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;vector_float_brezinski&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np2&nbsp;=&nbsp;succ&nbsp;np&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;vector_float_brezinski&nbsp;km1&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;bb&nbsp;=&nbsp;vector_float_brezinski&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;vector_float_brezinski&nbsp;km2&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;vector_float_brezinski&nbsp;km2&nbsp;np&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;vector_float_minus&nbsp;b&nbsp;bb<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dd&nbsp;=&nbsp;vector_float_minus&nbsp;c&nbsp;cc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ee&nbsp;=&nbsp;vector_float_scal_prod&nbsp;d&nbsp;dd<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;eee&nbsp;=&nbsp;vector_float_plus&nbsp;(&nbsp;vector_float_brezinski&nbsp;km1&nbsp;n&nbsp;s&nbsp;)&nbsp;(&nbsp;vector_float_brezinski&nbsp;km1&nbsp;np2&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;eeee&nbsp;=&nbsp;vector_float_minus&nbsp;eee&nbsp;(&nbsp;vector_float_scal_mult&nbsp;2.&nbsp;(&nbsp;vector_float_brezinski&nbsp;km1&nbsp;np&nbsp;s&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;vector_float_norm_inf&nbsp;eeee&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;vector_float_plus&nbsp;a&nbsp;(&nbsp;vector_float_scal_mult&nbsp;ee&nbsp;(&nbsp;vector_float_reciprocal&nbsp;eeee&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_approx value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_approx&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;rr&nbsp;/&nbsp;2<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;parity&nbsp;=&nbsp;rr&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;parity&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;vector_float_aitken_seki_rec&nbsp;kk&nbsp;0&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;vector_float_aitken_seki_rec&nbsp;kk&nbsp;1&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_approx_bis value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_approx_bis&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;rr&nbsp;/&nbsp;2<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;parity&nbsp;=&nbsp;rr&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;parity&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;vector_float_wynn&nbsp;(&nbsp;2&nbsp;*&nbsp;kk&nbsp;)&nbsp;0&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;vector_float_wynn&nbsp;(&nbsp;2&nbsp;*&nbsp;kk&nbsp;)&nbsp;1&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="2_SuitesdematricesMatrixsequences"><h2><center>Suites de matrices
---
Matrix sequences</center> </h2></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_aitken_seki_bis u(n) u(n+1) u(n+2)</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_aitken_seki_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float&nbsp;array&nbsp;array)&nbsp;(b:float&nbsp;array&nbsp;array)&nbsp;(c:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;a<br>
&nbsp;<span class="keyword">and</span>&nbsp;e&nbsp;=&nbsp;matrix_float_minus&nbsp;c&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;g&nbsp;=&nbsp;matrix_float_minus&nbsp;d&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;matrix_float_triple_prod&nbsp;d&nbsp;(&nbsp;float_transpose&nbsp;e&nbsp;)&nbsp;(&nbsp;matrix_float_reciprocal&nbsp;g&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_plus&nbsp;b&nbsp;h&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_aitken_seki u(n) u(n+1) u(n+2)</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_aitken_seki&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float&nbsp;array&nbsp;array)&nbsp;(b:float&nbsp;array&nbsp;array)&nbsp;(c:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;a<br>
&nbsp;<span class="keyword">and</span>&nbsp;e&nbsp;=&nbsp;matrix_float_minus&nbsp;c&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;matrix_float_frobenius_prod&nbsp;d&nbsp;e&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;matrix_float_minus&nbsp;d&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;matrix_float_scal_mult&nbsp;f&nbsp;(&nbsp;matrix_float_reciprocal&nbsp;g&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_plus&nbsp;b&nbsp;(&nbsp;float_transpose&nbsp;h&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_trans_float_aitken_seki_bis u(n) u(n+1) u(n+2)</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_trans_float_aitken_seki_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float&nbsp;array&nbsp;array)&nbsp;(b:float&nbsp;array&nbsp;array)&nbsp;(c:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;a<br>
&nbsp;<span class="keyword">and</span>&nbsp;e&nbsp;=&nbsp;matrix_float_minus&nbsp;c&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;g&nbsp;=&nbsp;matrix_float_minus&nbsp;d&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;matrix_float_triple_prod&nbsp;d&nbsp;(&nbsp;float_transpose&nbsp;e&nbsp;)&nbsp;(&nbsp;matrix_float_trans_reciprocal&nbsp;g&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_plus&nbsp;b&nbsp;h&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_trans_float_aitken_seki u(n) u(n+1) u(n+2)</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_trans_float_aitken_seki&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float&nbsp;array&nbsp;array)&nbsp;(b:float&nbsp;array&nbsp;array)&nbsp;(c:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;a<br>
&nbsp;<span class="keyword">and</span>&nbsp;e&nbsp;=&nbsp;matrix_float_minus&nbsp;c&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;matrix_float_frobenius_prod&nbsp;d&nbsp;e&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;matrix_float_minus&nbsp;d&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;matrix_float_scal_mult&nbsp;f&nbsp;(&nbsp;matrix_float_trans_reciprocal&nbsp;g&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_plus&nbsp;b&nbsp;(&nbsp;float_transpose&nbsp;h&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_aitken_seki_rec_bis k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_float_aitken_seki_rec_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_float_aitken_seki_rec_bis."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_aitken_seki_rec_bis."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;&lt;=&nbsp;n&nbsp;+&nbsp;2&nbsp;*&nbsp;k&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_aitken_seki_rec_bis."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;s.(n)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_float_aitken_seki_bis&nbsp;s.(n)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;2&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;pred&nbsp;k&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_float_aitken_seki_rec_bis&nbsp;kk&nbsp;n&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_float_aitken_seki_rec_bis&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_float_aitken_seki_rec_bis&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;2&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;b&nbsp;a&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;c&nbsp;b&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;a&nbsp;c&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_aitken_seki_bis&nbsp;a&nbsp;b&nbsp;c&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_aitken_seki_rec k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_float_aitken_seki_rec&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;&lt;=&nbsp;n&nbsp;+&nbsp;2&nbsp;*&nbsp;k&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;s.(n)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_float_aitken_seki&nbsp;s.(n)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;2&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;pred&nbsp;k&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_float_aitken_seki_rec&nbsp;kk&nbsp;n&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_float_aitken_seki_rec&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_float_aitken_seki_rec&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;2&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;b&nbsp;a&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;c&nbsp;b&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;a&nbsp;c&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_aitken_seki&nbsp;a&nbsp;b&nbsp;c&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_trans_float_aitken_seki_rec_bis k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_trans_float_aitken_seki_rec_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_trans_float_aitken_seki_rec_bis."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_aitken_seki_rec_bis."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;&lt;=&nbsp;n&nbsp;+&nbsp;2&nbsp;*&nbsp;k&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_aitken_seki_rec_bis."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;s.(n)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_trans_float_aitken_seki_bis&nbsp;s.(n)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;2&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;pred&nbsp;k&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_trans_float_aitken_seki_rec_bis&nbsp;kk&nbsp;n&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_trans_float_aitken_seki_rec_bis&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_trans_float_aitken_seki_rec_bis&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;2&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;b&nbsp;a&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;c&nbsp;b&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;a&nbsp;c&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_trans_float_aitken_seki_bis&nbsp;a&nbsp;b&nbsp;c&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_trans_float_aitken_seki_rec k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_trans_float_aitken_seki_rec&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_trans_float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;&lt;=&nbsp;n&nbsp;+&nbsp;2&nbsp;*&nbsp;k&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_aitken_seki_rec."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;s.(n)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_trans_float_aitken_seki&nbsp;s.(n)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s.(&nbsp;n&nbsp;+&nbsp;2&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;pred&nbsp;k&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_trans_float_aitken_seki_rec&nbsp;kk&nbsp;n&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_trans_float_aitken_seki_rec&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;1&nbsp;)&nbsp;s<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_trans_float_aitken_seki_rec&nbsp;kk&nbsp;(&nbsp;n&nbsp;+&nbsp;2&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;b&nbsp;a&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;c&nbsp;b&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keywordsign">||</span>&nbsp;matrix_float_norm_inf&nbsp;(&nbsp;matrix_float_minus&nbsp;a&nbsp;c&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_trans_float_aitken_seki&nbsp;a&nbsp;b&nbsp;c&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_wynn k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_float_wynn&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_float_wynn."</span>&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0).(0)&nbsp;)&nbsp;0.<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_wynn."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_wynn."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_float_wynn&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_float_wynn&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_float_wynn&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_reciprocal&nbsp;d&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_trans_float_wynn k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_trans_float_wynn&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_trans_float_wynn."</span>&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0).(0)&nbsp;)&nbsp;0.<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_wynn."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_wynn."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_trans_float_wynn&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_trans_float_wynn&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_trans_float_wynn&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_trans_reciprocal&nbsp;d&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_wynn_rho k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_float_wynn_rho&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0).(0)&nbsp;)&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_float_wynn_rho&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_float_wynn_rho&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_float_wynn_rho&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;(&nbsp;float&nbsp;k&nbsp;)&nbsp;(&nbsp;matrix_float_reciprocal&nbsp;d&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_trans_float_wynn_rho k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_trans_float_wynn_rho&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_trans_float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0).(0)&nbsp;)&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_wynn_rho."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_trans_float_wynn_rho&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_trans_float_wynn_rho&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_trans_float_wynn_rho&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;(&nbsp;float&nbsp;k&nbsp;)&nbsp;(&nbsp;matrix_float_trans_reciprocal&nbsp;d&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_brezinski_bis k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_float_brezinski_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_float_brezinski_bis."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0).(0)&nbsp;)&nbsp;0.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_brezinski_bis."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_brezinski_bis."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_float_brezinski_bis&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_float_brezinski_bis&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_float_brezinski_bis&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_reciprocal&nbsp;d&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_float_brezinski_bis&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np2&nbsp;=&nbsp;succ&nbsp;np&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;matrix_float_brezinski_bis&nbsp;km1&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;bb&nbsp;=&nbsp;matrix_float_brezinski_bis&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_float_brezinski_bis&nbsp;km2&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;matrix_float_brezinski_bis&nbsp;km2&nbsp;np&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;bb<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dd&nbsp;=&nbsp;matrix_float_minus&nbsp;c&nbsp;cc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;eee&nbsp;=&nbsp;matrix_float_plus&nbsp;(&nbsp;matrix_float_brezinski_bis&nbsp;km1&nbsp;n&nbsp;s&nbsp;)&nbsp;(&nbsp;matrix_float_brezinski_bis&nbsp;km1&nbsp;np2&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;eeee&nbsp;=&nbsp;matrix_float_minus&nbsp;eee&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;2.&nbsp;(&nbsp;matrix_float_brezinski_bis&nbsp;km1&nbsp;np&nbsp;s&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;eeee&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_triple_prod&nbsp;(&nbsp;float_transpose&nbsp;d&nbsp;)&nbsp;dd&nbsp;(&nbsp;matrix_float_reciprocal&nbsp;eeee&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_trans_float_brezinski_bis k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_trans_float_brezinski_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_trans_float_brezinski_bis."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0).(0)&nbsp;)&nbsp;0.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_brezinski_bis."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_brezinski_bis."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_trans_float_brezinski_bis&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_trans_float_brezinski_bis&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_trans_float_brezinski_bis&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_trans_reciprocal&nbsp;d&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_trans_float_brezinski_bis&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np2&nbsp;=&nbsp;succ&nbsp;np&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;matrix_trans_float_brezinski_bis&nbsp;km1&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;bb&nbsp;=&nbsp;matrix_trans_float_brezinski_bis&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_trans_float_brezinski_bis&nbsp;km2&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;matrix_trans_float_brezinski_bis&nbsp;km2&nbsp;np&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;bb<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dd&nbsp;=&nbsp;matrix_float_minus&nbsp;c&nbsp;cc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;eee&nbsp;=&nbsp;matrix_float_plus&nbsp;(&nbsp;matrix_trans_float_brezinski_bis&nbsp;km1&nbsp;n&nbsp;s&nbsp;)&nbsp;(&nbsp;matrix_trans_float_brezinski_bis&nbsp;km1&nbsp;np2&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;eeee&nbsp;=&nbsp;matrix_float_minus&nbsp;eee&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;2.&nbsp;(&nbsp;matrix_trans_float_brezinski_bis&nbsp;km1&nbsp;np&nbsp;s&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;eeee&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_triple_prod&nbsp;(&nbsp;float_transpose&nbsp;d&nbsp;)&nbsp;dd&nbsp;(&nbsp;matrix_float_trans_reciprocal&nbsp;eeee&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_brezinski k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_float_brezinski&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_float_brezinski."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0).(0)&nbsp;)&nbsp;0.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_brezinski."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_float_brezinski."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_float_brezinski&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_float_brezinski&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_float_brezinski&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_reciprocal&nbsp;d&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_float_brezinski&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np2&nbsp;=&nbsp;succ&nbsp;np&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;matrix_float_brezinski&nbsp;km1&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;bb&nbsp;=&nbsp;matrix_float_brezinski&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_float_brezinski&nbsp;km2&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;matrix_float_brezinski&nbsp;km2&nbsp;np&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;bb<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dd&nbsp;=&nbsp;matrix_float_minus&nbsp;c&nbsp;cc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ee&nbsp;=&nbsp;matrix_float_frobenius_prod&nbsp;d&nbsp;dd<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;eee&nbsp;=&nbsp;matrix_float_plus&nbsp;(&nbsp;matrix_float_brezinski&nbsp;km1&nbsp;n&nbsp;s&nbsp;)&nbsp;(&nbsp;matrix_float_brezinski&nbsp;km1&nbsp;np2&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;eeee&nbsp;=&nbsp;matrix_float_minus&nbsp;eee&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;2.&nbsp;(&nbsp;matrix_float_brezinski&nbsp;km1&nbsp;np&nbsp;s&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;eeee&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;ee&nbsp;(&nbsp;matrix_float_reciprocal&nbsp;eeee&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_trans_float_brezinski k n value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_trans_float_brezinski&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(k:int)&nbsp;(n:int)&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;k&nbsp;&lt;&nbsp;-1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Needed&nbsp;k&nbsp;&gt;=&nbsp;-1&nbsp;in&nbsp;Matrix.matrix_trans_float_brezinski."</span>&nbsp;;<br>
&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;-1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s.(0).(0)&nbsp;)&nbsp;0.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;index&nbsp;of&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_brezinski."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&gt;&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;sequence&nbsp;in&nbsp;Matrix.matrix_trans_float_brezinski."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;s.(n)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;km1&nbsp;=&nbsp;pred&nbsp;k<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;km2&nbsp;=&nbsp;k&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np&nbsp;=&nbsp;succ&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;k&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_trans_float_brezinski&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;matrix_trans_float_brezinski&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_trans_float_brezinski&nbsp;km1&nbsp;n&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;d&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_trans_reciprocal&nbsp;d&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_trans_float_brezinski&nbsp;km2&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;np2&nbsp;=&nbsp;succ&nbsp;np&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;matrix_trans_float_brezinski&nbsp;km1&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;bb&nbsp;=&nbsp;matrix_trans_float_brezinski&nbsp;km1&nbsp;np&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;matrix_trans_float_brezinski&nbsp;km2&nbsp;np2&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;matrix_trans_float_brezinski&nbsp;km2&nbsp;np&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_minus&nbsp;b&nbsp;bb<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dd&nbsp;=&nbsp;matrix_float_minus&nbsp;c&nbsp;cc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ee&nbsp;=&nbsp;matrix_float_frobenius_prod&nbsp;d&nbsp;dd<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;eee&nbsp;=&nbsp;matrix_float_plus&nbsp;(&nbsp;matrix_trans_float_brezinski&nbsp;km1&nbsp;n&nbsp;s&nbsp;)&nbsp;(&nbsp;matrix_trans_float_brezinski&nbsp;km1&nbsp;np2&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;eeee&nbsp;=&nbsp;matrix_float_minus&nbsp;eee&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;2.&nbsp;(&nbsp;matrix_trans_float_brezinski&nbsp;km1&nbsp;np&nbsp;s&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_float_norm_inf&nbsp;eeee&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_plus&nbsp;a&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;ee&nbsp;(&nbsp;matrix_float_trans_reciprocal&nbsp;eeee&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_approx_bis value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_approx_bis&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;rr&nbsp;/&nbsp;2<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;parity&nbsp;=&nbsp;rr&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;parity&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;matrix_float_wynn&nbsp;kk&nbsp;0&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;matrix_float_wynn&nbsp;kk&nbsp;1&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_approx value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_approx&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;rr&nbsp;/&nbsp;2<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;parity&nbsp;=&nbsp;rr&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;parity&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;matrix_float_aitken_seki_rec&nbsp;kk&nbsp;0&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;matrix_float_aitken_seki_rec&nbsp;kk&nbsp;1&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_trans_float_approx_bis value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_trans_float_approx_bis&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;rr&nbsp;/&nbsp;2<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;parity&nbsp;=&nbsp;rr&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;parity&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;matrix_trans_float_wynn&nbsp;kk&nbsp;0&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;matrix_trans_float_wynn&nbsp;kk&nbsp;1&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_trans_float_approx value_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_trans_float_approx&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;rr&nbsp;/&nbsp;2<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;parity&nbsp;=&nbsp;rr&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;parity&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;matrix_trans_float_aitken_seki_rec&nbsp;kk&nbsp;0&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;matrix_trans_float_aitken_seki_rec&nbsp;kk&nbsp;1&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="1_Calculsurlesmatricesparblocs"><h1>Calcul sur les matrices par blocs</h1></span>
<span id="1_Calculusonblockmatrices"><h1>Calculus on block matrices</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="2_DfinitionsetchangesDefinitionsandexchanges"><h2><center>Définitions et échanges
---
Definitions and exchanges</center> </h2></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** The <code class="code">float_or_array</code> recursive type is used to collect real numbers, real vectors, real matrices, and the corresponding block matrices.
<p>

Le type récursif <code class="code">float_or_array</code> sert à réunir nombres réels, vecteurs réels et matrices réelles avec les matrices par blocs correspondantes. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">type</span>&nbsp;float_or_array&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Empty</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;float&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;float&nbsp;array<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;float&nbsp;array&nbsp;array<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;float_or_array&nbsp;array<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;float_or_array&nbsp;array&nbsp;array&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_copy vector</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_copy&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;0.&nbsp;+.&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_float_copy&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_copy&nbsp;x.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;vvv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_eq vector1 vector2</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_eq&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float_or_array)&nbsp;(w:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;w&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x&nbsp;=&nbsp;y<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;w&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Util</span>.array_eq&nbsp;(&nbsp;=&nbsp;)&nbsp;x&nbsp;y<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;w&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Util</span>.array_eq&nbsp;vector_foa_eq&nbsp;x&nbsp;y<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_copy matrix</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_copy&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;0.&nbsp;+.&nbsp;y&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_copy&nbsp;y)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;y<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;y)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m.(i).(j)&nbsp;&lt;-&nbsp;matrix_foa_copy&nbsp;y.(i).(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;m_m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_demakeup coefficient</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Float_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0.&nbsp;+.&nbsp;y&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Float_cons&nbsp;in&nbsp;Matrix.float_demakeup."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_demakeup vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Float_vector_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_float_copy&nbsp;y<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Float_vector_cons&nbsp;in&nbsp;Matrix.vector_float_demakeup."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_demakeup matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Float_matrix_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_float_copy&nbsp;y<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Float_matrix_cons&nbsp;in&nbsp;Matrix.matrix_float_demakeup."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_demakeup vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_foa_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Foa_vector_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_copy&nbsp;y.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Foa_vector_cons&nbsp;in&nbsp;Matrix.vector_foa_demakeup."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_demakeup matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Foa_matrix_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;y<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;y)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m.(i).(j)&nbsp;&lt;-&nbsp;matrix_foa_copy&nbsp;y.(i).(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Foa_matrix_cons&nbsp;in&nbsp;Matrix.matrix_foa_demakeup."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_thickness coefficient-or-vector-or-matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;foa_thickness&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Float_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Float_vector_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Float_matrix_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Foa_vector_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;y)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;foa_thickness&nbsp;y.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;&gt;&nbsp;!accu&nbsp;<span class="keyword">then</span>&nbsp;accu&nbsp;:=&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;+&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Foa_matrix_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;y)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;y.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;foa_thickness&nbsp;row.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;&gt;&nbsp;!accu&nbsp;<span class="keyword">then</span>&nbsp;accu&nbsp;:=&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;+&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** The <code class="code">int_or_array</code> recursive type is used to collect integer numbers, integer vectors, integer matrices, and the corresponding block matrices.
<p>

Le type récursif <code class="code">int_or_array</code> sert à réunir nombres entiers, vecteurs entiers et matrices entières avec les matrices par blocs correspondantes. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">type</span>&nbsp;int_or_array&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Empty</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;int&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;int&nbsp;array<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;int&nbsp;array&nbsp;array<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;int_or_array&nbsp;array<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;int_or_array&nbsp;array&nbsp;array&nbsp;&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_copy vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_copy&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;0&nbsp;+&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_int_copy&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_copy&nbsp;x.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;vvv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_copy matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_copy&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;0&nbsp;+&nbsp;y&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_copy&nbsp;y)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;y<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;y)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m.(i).(j)&nbsp;&lt;-&nbsp;matrix_ioa_copy&nbsp;y.(i).(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;m_m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_demakeup coefficient</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Int_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0&nbsp;+&nbsp;y&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Int_cons&nbsp;in&nbsp;Matrix.int_demakeup."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_demakeup vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Int_vector_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_int_copy&nbsp;y<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Int_vector_cons&nbsp;in&nbsp;Matrix.vector_int_demakeup."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_demakeup matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Int_matrix_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_int_copy&nbsp;y<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Int_matrix_cons&nbsp;in&nbsp;Matrix.matrix_int_demakeup."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_demakeup vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_ioa_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Ioa_vector_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_copy&nbsp;y.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Ioa_vector_cons&nbsp;in&nbsp;Matrix.vector_ioa_demakeup."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_demakeup matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Ioa_matrix_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;numrows&nbsp;y<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;y)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m.(i).(j)&nbsp;&lt;-&nbsp;matrix_ioa_copy&nbsp;y.(i).(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Ioa_matrix_cons&nbsp;in&nbsp;Matrix.matrix_ioa_demakeup."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ioa_thickness coefficient-or-vector-or-matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;ioa_thickness&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Int_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Int_vector_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Int_matrix_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Ioa_vector_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;y)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;ioa_thickness&nbsp;y.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;&gt;&nbsp;!accu&nbsp;<span class="keyword">then</span>&nbsp;accu&nbsp;:=&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;+&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Ioa_matrix_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;y)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;y.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;ioa_thickness&nbsp;row.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;&gt;&nbsp;!accu&nbsp;<span class="keyword">then</span>&nbsp;accu&nbsp;:=&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;+&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_of_ioa integer_or_array</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;foa_of_ioa&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(float_of_int&nbsp;y)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;v&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;float_of_vector&nbsp;v&nbsp;)&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;z&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;z&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ww.(i)&nbsp;&lt;-&nbsp;foa_of_ioa&nbsp;z.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;ww<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;float_of_matrix&nbsp;m&nbsp;)&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w.(0)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;ww.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;foa_of_ioa&nbsp;(&nbsp;row_input.(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;ww<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;integer_or_array&nbsp;in&nbsp;Matrix.foa_of_ioa."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ioa_of_foa float_or_array</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;ioa_of_foa&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(int_of_float&nbsp;y)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;v&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;int_of_vector&nbsp;v&nbsp;)&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;z&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;z&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ww.(i)&nbsp;&lt;-&nbsp;ioa_of_foa&nbsp;z.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;ww<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;int_of_matrix&nbsp;m&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w.(0)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;ww.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;ioa_of_foa&nbsp;(&nbsp;row_input.(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;ww<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;in&nbsp;Matrix.ioa_of_foa."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_apply float_or_array</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;foa_apply&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(f:float&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(x:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(f&nbsp;y)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;v&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;v&nbsp;)&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;z&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;z&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ww.(i)&nbsp;&lt;-&nbsp;foa_apply&nbsp;f&nbsp;z.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;ww<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_apply&nbsp;f&nbsp;m&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w.(0)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;ww.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;foa_apply&nbsp;f&nbsp;(&nbsp;row_input.(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;ww<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;in&nbsp;Matrix.foa_apply."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** The type <code class="code">foa_strip</code> is used for diagonal multiplication and Gauss pivot.
<p>

Le type <code class="code">foa_strip</code> sert pour la multiplication diagonale et le pivot de Gauss. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">type</span>&nbsp;foa_strip&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Empty</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;float_or_array<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_strip_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;float_or_array&nbsp;array&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_strip_demakeup block-element</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;foa_strip_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:foa_strip)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Foa_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;ref&nbsp;y&nbsp;<span class="keyword">in</span>&nbsp;!z<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Foa_cons&nbsp;in&nbsp;Matrix.foa_strip_demakeup."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_strip_demakeup block-vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_foa_strip_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:foa_strip)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Foa_strip_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;ref&nbsp;y&nbsp;<span class="keyword">in</span>&nbsp;!z<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Foa_strip_cons&nbsp;in&nbsp;Matrix.vector_foa_strip_demakeup."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** The type <code class="code">ioa_strip</code> is used for diagonal multiplication.
<p>

Le type <code class="code">ioa_strip</code> sert pour la multiplication diagonale. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">type</span>&nbsp;ioa_strip&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Empty</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;int_or_array<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_strip_cons</span>&nbsp;<span class="keyword">of</span>&nbsp;int_or_array&nbsp;array&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ioa_strip_demakeup block-element</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ioa_strip_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:ioa_strip)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Ioa_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;ref&nbsp;y&nbsp;<span class="keyword">in</span>&nbsp;!z<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Ioa_cons&nbsp;in&nbsp;Matrix.ioa_strip_demakeup."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_strip_demakeup block-vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_ioa_strip_demakeup&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:ioa_strip)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;x&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;(<span class="constructor">Ioa_strip_cons</span>&nbsp;y)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;ref&nbsp;y&nbsp;<span class="keyword">in</span>&nbsp;!z<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;type&nbsp;Ioa_strip_cons&nbsp;in&nbsp;Matrix.vector_ioa_strip_demakeup."</span>&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="2_ConstructionsminimalespourlesmatricesparblocsMinimalconstructionsforblockmatrices"><h2><center>Constructions minimales pour les matrices par blocs
---
Minimal constructions for block matrices</center> </h2></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="9_Pastingandcuttingnumbersofrowsandcolumns"><div class="h9"> ++++++ Pasting and cutting, numbers of rows and columns.
<p>

Collage et découpage, nombres de lignes et de colonnes. ++++++ </div></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_cut parts vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_foa_cut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;=&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;v&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;y&nbsp;&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&lt;&nbsp;n&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;in&nbsp;Matrix.vector_foa_cut."</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k&nbsp;=&nbsp;r&nbsp;/&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;y&nbsp;(k*i)&nbsp;(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;y&nbsp;(k*(n&nbsp;-&nbsp;1))&nbsp;(r-k*(n&nbsp;-&nbsp;1))&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;vv&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&lt;&nbsp;n&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;in&nbsp;Matrix.vector_foa_cut."</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k&nbsp;=&nbsp;r&nbsp;/&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;w&nbsp;(k*i)&nbsp;(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;w&nbsp;(k*(n&nbsp;-&nbsp;1))&nbsp;(r-k*(n&nbsp;-&nbsp;1))&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;vv<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_cut."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_paste vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_foa_paste&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;v<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_foa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;vector_float_demakeup&nbsp;vv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvvv&nbsp;=&nbsp;<span class="constructor">Array</span>.to_list&nbsp;vvv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(<span class="constructor">Array</span>.concat&nbsp;vvvv)&nbsp;<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_foa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;vector_foa_demakeup&nbsp;vv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvvv&nbsp;=&nbsp;<span class="constructor">Array</span>.to_list&nbsp;vvv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;(<span class="constructor">Array</span>.concat&nbsp;vvvv)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_cut parts vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_ioa_cut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;=&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;v&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;vector_int_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&lt;&nbsp;n&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;in&nbsp;Matrix.vector_ioa_cut."</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k&nbsp;=&nbsp;r&nbsp;/&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;w&nbsp;(k*i)&nbsp;(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;w&nbsp;(k*(n&nbsp;-&nbsp;1))&nbsp;(r-k*(n&nbsp;-&nbsp;1))&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;vv&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;vector_ioa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&lt;&nbsp;n&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;in&nbsp;Matrix.vector_ioa_cut."</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k&nbsp;=&nbsp;r&nbsp;/&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;w&nbsp;(k*i)&nbsp;(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vv.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;w&nbsp;(k*(n&nbsp;-&nbsp;1))&nbsp;(r-k*(n&nbsp;-&nbsp;1))&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_paste vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_ioa_paste&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;v<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_ioa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;vector_int_demakeup&nbsp;vv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvvv&nbsp;=&nbsp;<span class="constructor">Array</span>.to_list&nbsp;vvv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(<span class="constructor">Array</span>.concat&nbsp;vvvv)&nbsp;<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_ioa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;vector_ioa_demakeup&nbsp;vv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvvv&nbsp;=&nbsp;<span class="constructor">Array</span>.to_list&nbsp;vvv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;(<span class="constructor">Array</span>.concat&nbsp;vvvv)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_numrows matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;foa_numrows&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;numrows&nbsp;(matrix_float_demakeup&nbsp;m)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;numrows&nbsp;(matrix_foa_demakeup&nbsp;m)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_numcolumns matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;foa_numcolumns&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;numcolumns&nbsp;(matrix_float_demakeup&nbsp;m)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;numcolumns&nbsp;(matrix_foa_demakeup&nbsp;m)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ioa_numrows matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ioa_numrows&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;numrows&nbsp;(matrix_int_demakeup&nbsp;m)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;numrows&nbsp;(matrix_ioa_demakeup&nbsp;m)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ioa_numcolumns matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ioa_numcolumns&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;numcolumns&nbsp;(matrix_int_demakeup&nbsp;m)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;numcolumns&nbsp;(matrix_ioa_demakeup&nbsp;m)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_cut parts matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_cut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(w:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;=&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;[|&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;(&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|&nbsp;0.&nbsp;;&nbsp;0.&nbsp;|]&nbsp;|]&nbsp;)&nbsp;|]&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pg&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;r&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;(float&nbsp;pg)&nbsp;/.&nbsp;(float&nbsp;n)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;k&nbsp;*&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;kk&nbsp;-&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;kk&nbsp;-&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;nn&nbsp;=&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;kk&nbsp;kk&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.blit&nbsp;row_input&nbsp;0&nbsp;row_output&nbsp;0&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(rr&nbsp;&gt;&nbsp;0)&nbsp;<span class="keyword">or</span>&nbsp;(cc&nbsp;&gt;&nbsp;0)&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c)&nbsp;<span class="keyword">to</span>&nbsp;kk&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k_k&nbsp;=&nbsp;k&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;nn&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;nn&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;k&nbsp;k&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;ii&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;k_k&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne_sortie&nbsp;=&nbsp;mm.(ii)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne_entree&nbsp;=&nbsp;m.(&nbsp;k&nbsp;*&nbsp;i&nbsp;+&nbsp;ii&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;jj&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;k_k&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ligne_sortie.(jj)&nbsp;&lt;-&nbsp;ligne_entree.(&nbsp;k&nbsp;*&nbsp;j&nbsp;+&nbsp;jj&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm&nbsp;;&nbsp;(&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|&nbsp;float&nbsp;rr&nbsp;;&nbsp;float&nbsp;cc&nbsp;|]&nbsp;|]&nbsp;)&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_cut parts matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_cut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;=&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;m&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;foa_numrows&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;foa_numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pp&nbsp;=&nbsp;min&nbsp;r&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;pp&nbsp;&lt;&nbsp;n&nbsp;<span class="keyword">then</span>&nbsp;&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;in&nbsp;Matrix.matrix_foa_cut."</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k&nbsp;=&nbsp;pp&nbsp;/&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;k*i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;fin&nbsp;=&nbsp;k*(i&nbsp;+&nbsp;1)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;float_sub_matrix&nbsp;w&nbsp;debut&nbsp;fin&nbsp;(k*j)&nbsp;(k*(j&nbsp;+&nbsp;1)&nbsp;-&nbsp;1)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;float_sub_matrix&nbsp;w&nbsp;debut&nbsp;fin&nbsp;(k*(n&nbsp;-&nbsp;1))&nbsp;(c&nbsp;-&nbsp;1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mm.(n&nbsp;-&nbsp;1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;k&nbsp;*&nbsp;(&nbsp;n&nbsp;-&nbsp;1&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;fin&nbsp;=&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;float_sub_matrix&nbsp;w&nbsp;debut&nbsp;fin&nbsp;(k*j)&nbsp;(k*(j&nbsp;+&nbsp;1)&nbsp;-&nbsp;1)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;float_sub_matrix&nbsp;w&nbsp;debut&nbsp;fin&nbsp;debut&nbsp;(c&nbsp;-&nbsp;1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;k*i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;fin&nbsp;=&nbsp;k*(i&nbsp;+&nbsp;1)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;(&nbsp;sub_matrix&nbsp;ww&nbsp;debut&nbsp;fin&nbsp;(k*j)&nbsp;(k*(j&nbsp;+&nbsp;1)&nbsp;-&nbsp;1)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;(&nbsp;sub_matrix&nbsp;ww&nbsp;debut&nbsp;fin&nbsp;(k*(n&nbsp;-&nbsp;1))&nbsp;(c&nbsp;-&nbsp;1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mm.(n&nbsp;-&nbsp;1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;k&nbsp;*&nbsp;(&nbsp;n&nbsp;-&nbsp;1&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;fin&nbsp;=&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;(&nbsp;sub_matrix&nbsp;ww&nbsp;debut&nbsp;fin&nbsp;(k*j)&nbsp;(k*(j&nbsp;+&nbsp;1)&nbsp;-&nbsp;1)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;(&nbsp;sub_matrix&nbsp;ww&nbsp;debut&nbsp;fin&nbsp;debut&nbsp;(c&nbsp;-&nbsp;1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_cut."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_paste matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_paste&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;m<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;mm)&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;m_m&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;matrix_float_demakeup&nbsp;w.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;ref&nbsp;ww.(k)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!row_output&nbsp;(&nbsp;(&nbsp;matrix_float_demakeup&nbsp;w.(j)&nbsp;).(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ww.(k)&nbsp;&lt;-&nbsp;!row_output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m&nbsp;:=&nbsp;ww::!m_m<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;m_m&nbsp;:=&nbsp;<span class="constructor">List</span>.rev&nbsp;!m_m&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(<span class="constructor">Array</span>.concat&nbsp;!m_m)<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;foa_numrows&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(foa_numcolumns&nbsp;m)&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;m_m&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;(matrix_foa_demakeup&nbsp;m).(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;mm.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;foa_numrows&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;ref&nbsp;mmm.(k)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!row_output&nbsp;(&nbsp;(&nbsp;matrix_foa_demakeup&nbsp;mm.(j)&nbsp;).(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mmm.(k)&nbsp;&lt;-&nbsp;!row_output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m&nbsp;:=&nbsp;mmm::!m_m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m&nbsp;:=&nbsp;<span class="constructor">List</span>.rev&nbsp;!m_m&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;(<span class="constructor">Array</span>.concat&nbsp;!m_m)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_crash data</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_crash&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(data:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;data.(0)&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;vector_foa_demakeup&nbsp;data.(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;margin&nbsp;=&nbsp;vector_float_demakeup&nbsp;s.(0)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_demakeup&nbsp;(matrix_foa_paste&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;endrow&nbsp;=&nbsp;(<span class="constructor">Array</span>.length&nbsp;mm)&nbsp;-&nbsp;(int_of_float&nbsp;margin.(0))&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;endcolumn&nbsp;=&nbsp;(numcolumns&nbsp;mm)&nbsp;-&nbsp;(int_of_float&nbsp;margin.(1))&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float_sub_matrix&nbsp;mm&nbsp;0&nbsp;endrow&nbsp;0&nbsp;endcolumn&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_cut parts matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_cut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(w:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;=&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;[|&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;(&nbsp;[|&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;[|&nbsp;0&nbsp;;&nbsp;0&nbsp;|]&nbsp;|]&nbsp;)&nbsp;|]&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pg&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;r&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;(float&nbsp;pg)&nbsp;/.&nbsp;(float&nbsp;n)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;kk&nbsp;=&nbsp;k&nbsp;*&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;kk&nbsp;-&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;kk&nbsp;-&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;nn&nbsp;=&nbsp;n&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;kk&nbsp;kk&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.blit&nbsp;row_input&nbsp;0&nbsp;row_output&nbsp;0&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(rr&nbsp;&gt;&nbsp;0)&nbsp;<span class="keyword">or</span>&nbsp;(cc&nbsp;&gt;&nbsp;0)&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c)&nbsp;<span class="keyword">to</span>&nbsp;kk&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k_k&nbsp;=&nbsp;k&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;nn&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;nn&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;k&nbsp;k&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;ii&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;k_k&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne_sortie&nbsp;=&nbsp;mm.(ii)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne_entree&nbsp;=&nbsp;m.(&nbsp;k&nbsp;*&nbsp;i&nbsp;+&nbsp;ii&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;jj&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;k_k&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ligne_sortie.(jj)&nbsp;&lt;-&nbsp;ligne_entree.(&nbsp;k&nbsp;*&nbsp;j&nbsp;+&nbsp;jj&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm&nbsp;;&nbsp;(&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;[|&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;[|&nbsp;rr&nbsp;;&nbsp;cc&nbsp;|]&nbsp;|]&nbsp;)&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_cut parts matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_cut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;n&nbsp;&lt;=&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;m&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;ioa_numrows&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;ioa_numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pp&nbsp;=&nbsp;min&nbsp;r&nbsp;c<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;pp&nbsp;&lt;&nbsp;n&nbsp;<span class="keyword">then</span>&nbsp;&nbsp;failwith&nbsp;<span class="string">"Too&nbsp;short&nbsp;in&nbsp;Matrix.matrix_ioa_cut."</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;k&nbsp;=&nbsp;pp&nbsp;/&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;k*i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;fin&nbsp;=&nbsp;k*(i&nbsp;+&nbsp;1)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;int_sub_matrix&nbsp;w&nbsp;debut&nbsp;fin&nbsp;(k*j)&nbsp;(k*(j&nbsp;+&nbsp;1)&nbsp;-&nbsp;1)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;int_sub_matrix&nbsp;w&nbsp;debut&nbsp;fin&nbsp;(k*(n&nbsp;-&nbsp;1))&nbsp;(c&nbsp;-&nbsp;1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mm.(n&nbsp;-&nbsp;1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;k&nbsp;*&nbsp;(&nbsp;n&nbsp;-&nbsp;1&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;fin&nbsp;=&nbsp;rr&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;int_sub_matrix&nbsp;w&nbsp;debut&nbsp;fin&nbsp;(k*j)&nbsp;(k*(j&nbsp;+&nbsp;1)&nbsp;-&nbsp;1)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;int_sub_matrix&nbsp;w&nbsp;debut&nbsp;fin&nbsp;debut&nbsp;(c&nbsp;-&nbsp;1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;k*i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;fin&nbsp;=&nbsp;k*(i&nbsp;+&nbsp;1)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;(&nbsp;sub_matrix&nbsp;ww&nbsp;debut&nbsp;fin&nbsp;(k*j)&nbsp;(k*(j&nbsp;+&nbsp;1)&nbsp;-&nbsp;1)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;(&nbsp;sub_matrix&nbsp;ww&nbsp;debut&nbsp;fin&nbsp;(k*(n&nbsp;-&nbsp;1))&nbsp;(c&nbsp;-&nbsp;1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mm.(n&nbsp;-&nbsp;1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;k&nbsp;*&nbsp;(&nbsp;n&nbsp;-&nbsp;1&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;fin&nbsp;=&nbsp;rr&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;n-2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;(&nbsp;sub_matrix&nbsp;ww&nbsp;debut&nbsp;fin&nbsp;(k*j)&nbsp;(k*(j&nbsp;+&nbsp;1)&nbsp;-&nbsp;1)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(n&nbsp;-&nbsp;1)&nbsp;&lt;-&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;(&nbsp;sub_matrix&nbsp;ww&nbsp;debut&nbsp;fin&nbsp;debut&nbsp;(c&nbsp;-&nbsp;1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_cut."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_paste matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_paste&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;m<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;ioa_numrows&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(ioa_numcolumns&nbsp;m)&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;m_m&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;(matrix_ioa_demakeup&nbsp;m).(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_int_demakeup&nbsp;mm.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;ioa_numrows&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;-1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;ref&nbsp;mmm.(k)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!row_output&nbsp;(&nbsp;(matrix_int_demakeup&nbsp;mm.(j)).(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mmm.(k)&nbsp;&lt;-&nbsp;!row_output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m&nbsp;:=&nbsp;mmm::!m_m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m&nbsp;:=&nbsp;<span class="constructor">List</span>.rev&nbsp;!m_m&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(<span class="constructor">Array</span>.concat&nbsp;!m_m)<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;ioa_numrows&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(ioa_numcolumns&nbsp;m)&nbsp;-&nbsp;1&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;m_m&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;(matrix_ioa_demakeup&nbsp;m).(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;mm.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;ioa_numrows&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;ref&nbsp;mmm.(k)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!row_output&nbsp;(&nbsp;(matrix_ioa_demakeup&nbsp;mm.(j)).(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mmm.(k)&nbsp;&lt;-&nbsp;!row_output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m&nbsp;:=&nbsp;mmm::!m_m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_m&nbsp;:=&nbsp;<span class="constructor">List</span>.rev&nbsp;!m_m&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;(<span class="constructor">Array</span>.concat&nbsp;!m_m)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_hash base matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_hash&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;b&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;foa_numrows&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;foa_numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pp&nbsp;=&nbsp;min&nbsp;r&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;b&nbsp;&gt;=&nbsp;pp&nbsp;<span class="keyword">then</span>&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_cut&nbsp;(pp/b)&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;matrix_foa_hash&nbsp;b&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_hash base matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_hash&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;b&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;ioa_numrows&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;ioa_numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pp&nbsp;=&nbsp;min&nbsp;r&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;b&nbsp;&gt;=&nbsp;pp&nbsp;<span class="keyword">then</span>&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_ioa_cut&nbsp;(pp/b)&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;matrix_ioa_hash&nbsp;b&nbsp;mm&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_crash matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_crash&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;foa_thickness&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_paste&nbsp;m&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_crash&nbsp;(matrix_foa_paste&nbsp;m)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_crash matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_crash&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;ioa_thickness&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_paste&nbsp;m&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_crash&nbsp;(matrix_ioa_paste&nbsp;m)&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="9_Operationsonfloatvectors"><div class="h9">++++++ Operations on float vectors.
<p>

Opérations sur les vecteurs réels. ++++++ </div></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_scal_mult coefficient vector</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;x&nbsp;*.&nbsp;lambda&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;vector_float_scal_mult&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_scal_mult&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_scal_mult."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_scal_add coefficient vector</pre> Inner blocks reduced to a real are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;lambda&nbsp;+.&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;vector_float_scal_add&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_scal_add&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_scal_add."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_scal_right_div coefficient vector</pre> Inner blocks reduced to a real are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;x&nbsp;/.&nbsp;lambda&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;vector_float_scal_right_div&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_scal_right_div&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_scal_right_div."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_scal_left_div coefficient vector</pre> Inner blocks reduced to areal are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;lambda&nbsp;/.&nbsp;x&nbsp;)&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;vector_float_scal_left_div&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_scal_left_div&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_scal_left_div."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_scal_right_sub coefficient vector</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;-.&nbsp;lambda&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;vector_float_scal_right_sub&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_scal_right_sub&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_scal_right_sub."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_scal_left_sub coefficient vector</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;lambda<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;vector_float_scal_left_sub&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_scal_left_sub&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_scal_left_sub."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_opp vector</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_opp&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;vector_float_opp&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_opp&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_opp."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_coeff_prod vector1 vector2</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float_or_array)&nbsp;(vv:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_foa_scal_mult&nbsp;x&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vv<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;&nbsp;vector_foa_scal_mult&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;uu&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;vector_float_coeff_prod&nbsp;u&nbsp;uu&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;of&nbsp;thickness&nbsp;0&nbsp;in&nbsp;Matrix.vector_foa_coeff_prod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vv<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_foa_scal_mult&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_coeff_prod&nbsp;w.(i)&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;of&nbsp;same&nbsp;thickness&nbsp;in&nbsp;Matrix.vector_foa_coeff_prod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_coeff_prod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_sum vector</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_sum&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_float_sum&nbsp;u<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv&nbsp;:=&nbsp;!vvv&nbsp;+.&nbsp;vector_foa_sum&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_sum."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_scal_prod vector1 vector2</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_scal_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float_or_array)&nbsp;(vv:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x&nbsp;*.&nbsp;vector_foa_sum&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;y&nbsp;*.&nbsp;vector_float_sum&nbsp;u<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;uu&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_float_scal_prod&nbsp;u&nbsp;uu<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;of&nbsp;thickness&nbsp;0&nbsp;in&nbsp;Matrix.vector_foa_scal_prod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;y&nbsp;*.&nbsp;vector_foa_sum&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv&nbsp;:=&nbsp;!vvv&nbsp;+.&nbsp;vector_foa_scal_prod&nbsp;w.(i)&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;of&nbsp;same&nbsp;thickness&nbsp;in&nbsp;Matrix.vector_foa_scal_prod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_scal_prod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_max vector</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_max&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_float_max&nbsp;u<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(&nbsp;-.&nbsp;max_float&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv&nbsp;:=&nbsp;max&nbsp;!vvv&nbsp;(&nbsp;vector_foa_max&nbsp;w.(i)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!vvv<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_max."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_min vector</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_min&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_float_min&nbsp;u<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;max_float<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv&nbsp;:=&nbsp;min&nbsp;!vvv&nbsp;(&nbsp;vector_foa_min&nbsp;w.(i)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!vvv<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_min."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_plus vector1 vector2</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float_or_array)&nbsp;(vv:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_foa_scal_add&nbsp;x&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;&nbsp;vector_foa_scal_add&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;uu&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;vector_float_plus&nbsp;u&nbsp;uu&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;of&nbsp;thickness&nbsp;0&nbsp;in&nbsp;Matrix.vector_foa_plus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_foa_scal_add&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_plus&nbsp;w.(i)&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;of&nbsp;same&nbsp;thickness&nbsp;in&nbsp;Matrix.vector_foa_plus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_plus."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_minus vector1 vector2</pre> Inner blocks reduced to the real 0. are accepted.
<p>

Des blocs réduits au réel 0. sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float_or_array)&nbsp;(vv:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_foa_opp&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_foa_scal_right_sub&nbsp;x&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;&nbsp;vector_foa_scal_left_sub&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;uu&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;vector_float_minus&nbsp;u&nbsp;uu&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;of&nbsp;thickness&nbsp;0&nbsp;in&nbsp;Matrix.vector_foa_minus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_foa_scal_left_sub&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_foa_minus&nbsp;w.(i)&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;of&nbsp;same&nbsp;thickness&nbsp;in&nbsp;Matrix.vector_foa_minus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_foa_minus."</span>&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="9_Operationsonintegervectors"><div class="h9">++++++ Operations on integer vectors.
<p>

Opérations sur les vecteurs entiers. ++++++ </div></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_scal_mult coefficient vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_scal_mult&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_scal_mult&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_scal_mult."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_scal_add coefficient vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;lambda<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_scal_add&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_scal_add&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_scal_add."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_scal_right_div coefficient vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_scal_right_div&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_scal_right_div&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_scal_right_div."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_scal_left_div coefficient vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Division_by_zero&nbsp;in&nbsp;Matrix.vector_ioa_scal_left_div."</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_scal_left_div&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_scal_left_div&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_scal_left_div."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_scal_right_mod coefficient vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_scal_right_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_scal_right_mod&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_scal_right_mod&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_scal_right_mod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_scal_left_mod coefficient vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_scal_left_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;lambda<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_scal_left_mod&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_scal_left_mod&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_scal_left_mod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_scal_right_sub coefficient vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;-&nbsp;lambda&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_scal_right_sub&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_scal_right_sub&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_scal_right_sub."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_scal_left_sub coefficient vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;lambda<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_scal_left_sub&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_scal_left_sub&nbsp;lambda&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_scal_left_sub."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_opp vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_opp&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_opp&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_opp&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_opp."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_coeff_prod vector1 vector2</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int_or_array)&nbsp;(vv:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_scal_mult&nbsp;x&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vv<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;&nbsp;vector_ioa_scal_mult&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;uu&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_coeff_prod&nbsp;u&nbsp;uu&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;thickness&nbsp;0&nbsp;in&nbsp;Matrix.vector_ioa_coeff_prod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vv<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_scal_mult&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_coeff_prod&nbsp;w.(i)&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;same&nbsp;thickness&nbsp;in&nbsp;Matrix.vector_ioa_coeff_prod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_coeff_prod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_coeff_div vector1 vector2</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int_or_array)&nbsp;(vv:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_scal_mult&nbsp;x&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vv<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;&nbsp;vector_ioa_scal_mult&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;uu&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_coeff_div&nbsp;u&nbsp;uu&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;thickness&nbsp;0&nbsp;in&nbsp;Matrix.vector_ioa_coeff_div."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vv<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_scal_mult&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_coeff_div&nbsp;w.(i)&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;same&nbsp;thickness&nbsp;in&nbsp;Matrix.vector_ioa_coeff_div."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_coeff_div."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_coeff_mod vector1 vector2</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_coeff_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int_or_array)&nbsp;(vv:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_scal_mult&nbsp;x&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vv<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;&nbsp;vector_ioa_scal_mult&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;uu&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_coeff_mod&nbsp;u&nbsp;uu&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;thickness&nbsp;0&nbsp;in&nbsp;Matrix.vector_ioa_coeff_mod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vv<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_scal_mult&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_coeff_mod&nbsp;w.(i)&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;same&nbsp;thickness&nbsp;in&nbsp;Matrix.vector_ioa_coeff_mod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_coeff_mod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_sum vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_sum&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_int_sum&nbsp;u<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv&nbsp;:=&nbsp;!vvv&nbsp;+&nbsp;vector_ioa_sum&nbsp;w.(i)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_sum."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_scal_prod vector1 vector2</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_scal_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int_or_array)&nbsp;(vv:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x&nbsp;*&nbsp;vector_ioa_sum&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;y&nbsp;*&nbsp;vector_int_sum&nbsp;u<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;uu&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_int_scal_prod&nbsp;u&nbsp;uu<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;thickness&nbsp;0&nbsp;in&nbsp;Matrix.vector_ioa_scal_prod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;y&nbsp;*&nbsp;vector_ioa_sum&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv&nbsp;:=&nbsp;!vvv&nbsp;+&nbsp;vector_ioa_scal_prod&nbsp;w.(i)&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;same&nbsp;thickness&nbsp;in&nbsp;Matrix.vector_ioa_scal_prod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_scal_prod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_max vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_max&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_int_max&nbsp;u<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(&nbsp;-&nbsp;max_int&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv&nbsp;:=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;!vvv&nbsp;(&nbsp;vector_ioa_max&nbsp;w.(i)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!vvv<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_max."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_min vector</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_min&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_int_min&nbsp;u<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;max_int<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv&nbsp;:=&nbsp;min&nbsp;!vvv&nbsp;(&nbsp;vector_ioa_min&nbsp;w.(i)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!vvv<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_min."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_plus vector1 vector2</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int_or_array)&nbsp;(vv:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_scal_add&nbsp;x&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;&nbsp;vector_ioa_scal_add&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;uu&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_plus&nbsp;u&nbsp;uu&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;thickness&nbsp;0&nbsp;in&nbsp;Matrix.vector_ioa_plus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_scal_add&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_plus&nbsp;w.(i)&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;same&nbsp;thickness&nbsp;in&nbsp;Matrix.vector_ioa_plus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_plus."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_minus vector1 vector2</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int_or_array)&nbsp;(vv:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;v&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_opp&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_scal_right_sub&nbsp;x&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;&nbsp;vector_ioa_scal_left_sub&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;uu&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;vector_int_minus&nbsp;u&nbsp;uu&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;thickness&nbsp;0&nbsp;in&nbsp;Matrix.vector_ioa_minus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;vv&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_scal_left_sub&nbsp;y&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vvv&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Array</span>.make&nbsp;r&nbsp;w.(0))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!vvv.(i)&nbsp;&lt;-&nbsp;vector_ioa_minus&nbsp;w.(i)&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!vvv&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;of&nbsp;same&nbsp;thickness&nbsp;in&nbsp;Matrix.vector_ioa_minus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;vector&nbsp;in&nbsp;Matrix.vector_ioa_minus."</span>&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="9_Searchextractionaffectationmeasureanddisplay"><div class="h9">++++++ Search, extraction, affectation, measure and display.
<p>

Recherche, extraction, affectation, mesure et affichage. ++++++ </div></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_max matrix</pre> Inner blocks reduced to a real are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_max&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_float_max&nbsp;u<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-.&nbsp;max_float)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;max&nbsp;!accu&nbsp;(&nbsp;matrix_foa_max&nbsp;row.(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_max."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_min matrix</pre> Inner blocks reduced to a real are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_min&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_float_min&nbsp;u<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(max_float)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;min&nbsp;!accu&nbsp;(&nbsp;matrix_foa_min&nbsp;row.(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_min."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_find_last element vector</pre> vector_foa_find_last returns [-1] if it does not find:
<p>

vector_foa_find_last retourne [-1] s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_find_last&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[&nbsp;vector_float_find_last&nbsp;x&nbsp;(vector_float_demakeup&nbsp;v)&nbsp;]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;vector_foa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;suite&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;(&nbsp;r&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;essaisuite&nbsp;=&nbsp;vector_foa_find_last&nbsp;x&nbsp;w.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(<span class="constructor">List</span>.hd&nbsp;essaisuite&nbsp;&lt;&gt;&nbsp;-1)&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index:=&nbsp;!i&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;suite&nbsp;:=&nbsp;essaisuite&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;-1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;-&nbsp;1&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!index::!suite&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_find_first element vector</pre> vector_foa_find_first returns [-1] if it does not find:
<p>

vector_foa_find_first retourne [-1] s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_find_first&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[&nbsp;vector_float_find_first&nbsp;x&nbsp;(vector_float_demakeup&nbsp;v)&nbsp;]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;vector_foa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;suite&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;essaisuite&nbsp;=&nbsp;vector_foa_find_first&nbsp;x&nbsp;w.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(<span class="constructor">List</span>.hd&nbsp;essaisuite&nbsp;&lt;&gt;&nbsp;-1)&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;!i&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;suite&nbsp;:=&nbsp;essaisuite&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;r&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!index::!suite&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_extract_element position vector</pre> vector_foa_extract_element walks 
along the layers following the list of indexes up to the desired depth.
<p>

vector_foa_extract_element parcourt les couches en suivant la liste des indices jusqu'à la profondeur souhaitée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_extract_element&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(pos:int&nbsp;list)&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">List</span>.length&nbsp;pos&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"List&nbsp;too&nbsp;short&nbsp;in&nbsp;Matrix.vector_foa_extract_element."</span>&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(vector_float_demakeup&nbsp;v).(<span class="constructor">List</span>.hd&nbsp;pos)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(vector_foa_demakeup&nbsp;v).(<span class="constructor">List</span>.hd&nbsp;pos)&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_foa_extract_element&nbsp;(<span class="constructor">List</span>.tl&nbsp;pos)&nbsp;(vector_foa_demakeup&nbsp;v).(<span class="constructor">List</span>.hd&nbsp;pos)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_extract_element position matrix</pre> matrix_foa_extract_element walks 
along the layers following the list of indexes up to the desired depth.
<p>

matrix_foa_extract_element parcourt les couches en suivant la liste des indices jusqu'à la profondeur souhaitée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_extract_element&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(pos:int&nbsp;array&nbsp;list)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">List</span>.length&nbsp;pos&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"List&nbsp;too&nbsp;short&nbsp;in&nbsp;Matrix.matrix_foa_extract_element."</span>&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;pos&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(matrix_float_demakeup&nbsp;m).(index.(0)).(index.(1))<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(matrix_foa_demakeup&nbsp;m).(index.(0)).(index.(1))<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;pos&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;matrix_foa_extract_element&nbsp;(<span class="constructor">List</span>.tl&nbsp;pos)&nbsp;(matrix_foa_demakeup&nbsp;m).(index.(0)).(index.(1))&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_extract_column column matrix</pre> matrix_foa_extract_column works on the superficial layer.
<p>

matrix_foa_extract_column travaille sur la couche superficielle. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_extract_column&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;col&nbsp;=&nbsp;extract_column&nbsp;i&nbsp;(matrix_float_demakeup&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;col<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;col&nbsp;=&nbsp;extract_column&nbsp;i&nbsp;(matrix_foa_demakeup&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;col&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_extract_row row matrix</pre> matrix_foa_extract_row works on the superficial layer.
<p>

matrix_foa_extract_row travaille sur la couche superficielle. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_extract_row&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;(&nbsp;(matrix_float_demakeup&nbsp;m).(i)&nbsp;)<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;(&nbsp;(matrix_foa_demakeup&nbsp;m).(i)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_size matrix</pre> matrix_foa_size works on the superficial layer. 
Inner blocks reduced to a real are accepted.
<p>

matrix_foa_size travaille sur la couche superficielle.
Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_size&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;[|&nbsp;1&nbsp;;&nbsp;1&nbsp;|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;mm&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;[|&nbsp;<span class="constructor">Array</span>.length&nbsp;mm&nbsp;;&nbsp;numcolumns&nbsp;mm&nbsp;|]&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;[|&nbsp;<span class="constructor">Array</span>.length&nbsp;mm&nbsp;;&nbsp;numcolumns&nbsp;mm&nbsp;|]&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_rec_size depth matrix</pre> matrix_foa_rec_size walks 
along the layers up to the desired depth.
Inner blocks reduced to a real are accepted.
<p>

matrix_foa_rec_size parcourt les couches jusqu'à la profondeur souhaitée.
Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_rec_size&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:int)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_size&nbsp;m&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;[|&nbsp;1&nbsp;;&nbsp;1&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_size&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;mm&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;m_m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_rec_size&nbsp;(&nbsp;d&nbsp;-&nbsp;1&nbsp;)&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;m_m<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_affect index element vector</pre> vector_foa_affect works on the superficial layer.
<p>

vector_foa_affect travaille sur la couche superficielle. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_foa_affect&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(index:int)&nbsp;(x:float_or_array)&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_float_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;vv.(index)&nbsp;&lt;-&nbsp;float_demakeup&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_foa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;vv.(index)&nbsp;&lt;-&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;vv&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_affect_element position element vector</pre> vector_foa_affect_element walks 
along the layers following the list of indexes up to the desired depth.
<p>

vector_foa_affect_element parcourt les couches en suivant la liste des indices jusqu'à la profondeur souhaitée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_affect_element&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(position:int&nbsp;list)&nbsp;&nbsp;(x:float_or_array)&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">List</span>.length&nbsp;position&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"List&nbsp;too&nbsp;short&nbsp;in&nbsp;Matrix.vector_foa_affect_element."</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_foa_affect&nbsp;(<span class="constructor">List</span>.hd&nbsp;position)&nbsp;x&nbsp;v<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_foa_demakeup&nbsp;v<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pos&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;position&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;vv.(pos)&nbsp;&lt;-&nbsp;vector_foa_affect_element&nbsp;(<span class="constructor">List</span>.tl&nbsp;position)&nbsp;x&nbsp;vv.(pos)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;vv&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_affect index element matrix</pre> matrix_foa_affect works on the superficial layer.
<p>

matrix_foa_affect travaille sur la couche superficielle. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_affect&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(index:int&nbsp;array)&nbsp;(x:float_or_array)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;mm.(index.(0)).(index.(1))&nbsp;&lt;-&nbsp;float_demakeup&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;mm.(index.(0)).(index.(1))&nbsp;&lt;-&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_affect_element position element matrix</pre> matrix_foa_affect_element walks 
along the layers following the list of indexes up to the desired depth.
<p>

matrix_foa_affect_element parcourt les couches en suivant la liste des indices jusqu'à la profondeur souhaitée.*)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_affect_element&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(position:int&nbsp;array&nbsp;list)&nbsp;(x:float_or_array)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">List</span>.length&nbsp;position&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"List&nbsp;too&nbsp;short&nbsp;in&nbsp;Matrix.matrix_foa_affect_element."</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_affect&nbsp;(<span class="constructor">List</span>.hd&nbsp;position)&nbsp;x&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pos&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;position&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;mm.(&nbsp;pos.(0)&nbsp;).(&nbsp;pos.(1)&nbsp;)&nbsp;&lt;-&nbsp;matrix_foa_affect_element&nbsp;(<span class="constructor">List</span>.tl&nbsp;position)&nbsp;x&nbsp;mm.(&nbsp;pos.(0)&nbsp;).(&nbsp;pos.(1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_affect_row index vector matrix</pre> matrix_foa_affect_row works on the superficial layer.
The size of the vector may be bigger than the number of rows of the matrix.
<p>

matrix_foa_affect_row travaille sur la couche superficielle. 
La taille du vecteur peut dépassr le nombre de lignes de la matrice. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_affect_row&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(index:int)&nbsp;(v:float_or_array)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;mm.(index)&nbsp;&lt;-&nbsp;vector_float_demakeup&nbsp;v&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;mm.(index)&nbsp;&lt;-&nbsp;vector_foa_demakeup&nbsp;v&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_affect_column index vector matrix</pre> matrix_foa_affect_column works on the superficial layer.
The size of the vector may be bigger than the number of rows of the matrix.
<p>

matrix_foa_affect_column travaille sur la couche superficielle.
La taille du vecteur peut dépassr le nombre de lignes de la matrice. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_affect_column&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(index:int)&nbsp;(v:float_or_array)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;affect_column&nbsp;index&nbsp;(vector_float_demakeup&nbsp;v)&nbsp;mm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i).(index)&nbsp;&lt;-&nbsp;(&nbsp;vector_foa_demakeup&nbsp;v&nbsp;).(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_find_last element matrix</pre> matrix_foa_find_last returns [[|-1;-1|]] if it does not find:
<p>

matrix_foa_find_last retourne [[|-1;-1|]] s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_find_last&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[&nbsp;matrix_float_find_last&nbsp;x&nbsp;(matrix_float_demakeup&nbsp;m)&nbsp;]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;([|-1;-1|])&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;suite&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;(&nbsp;r&nbsp;-&nbsp;1&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;(&nbsp;c&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;mm.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!j&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;essaisuite&nbsp;=&nbsp;matrix_foa_find_last&nbsp;x&nbsp;(&nbsp;row_input.(!j)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;essaisuite&nbsp;&lt;&gt;&nbsp;[|-1;-1|]&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;[|!i;!j|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;suite&nbsp;:=&nbsp;essaisuite&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;:=&nbsp;-1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;-1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;!index&nbsp;=&nbsp;[|-1;-1|]&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!index::!suite&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_find_first element matrix</pre> matrix_foa_find_first returns [[|-1;-1|]] if it does not find:
<p>

matrix_foa_find_first retourne [[|-1;-1|]] s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_find_first&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[&nbsp;matrix_float_find_first&nbsp;x&nbsp;(matrix_float_demakeup&nbsp;m)&nbsp;]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;([|-1;-1|])&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;suite&nbsp;=&nbsp;ref&nbsp;[]<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;mm.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!j&nbsp;&lt;&nbsp;c&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;essaisuite&nbsp;=&nbsp;matrix_foa_find_first&nbsp;x&nbsp;(&nbsp;row_input.(!j)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;essaisuite&nbsp;&lt;&gt;&nbsp;[|-1;-1|]&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;[|!i;!j|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;suite&nbsp;:=&nbsp;essaisuite&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;:=&nbsp;c&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;r&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;!index&nbsp;=&nbsp;[|-1;-1|]&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!index::!suite&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_foa_print vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_foa_print&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;bare_vector_float_print&nbsp;(vector_float_demakeup&nbsp;v)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;vector_foa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"[|&nbsp;"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vector_foa_print&nbsp;w.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"&nbsp;;&nbsp;"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;rr&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vector_foa_print&nbsp;w.(i)&nbsp;;&nbsp;print_string&nbsp;<span class="string">"&nbsp;;&nbsp;"</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vector_foa_print&nbsp;w.(rr)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"&nbsp;|]"</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_print matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_print&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(foa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_float_print&nbsp;(matrix_float_demakeup&nbsp;m)&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"[|&nbsp;with&nbsp;"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_int&nbsp;r&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"&nbsp;rows"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_newline&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_foa_print&nbsp;row.(j)&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"|]&nbsp;and&nbsp;"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_int&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"&nbsp;columns"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_newline&nbsp;()&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_max matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_max&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_int_max&nbsp;u<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;(-&nbsp;max_int)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;!accu&nbsp;(&nbsp;matrix_ioa_max&nbsp;row.(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_max."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_min matrix</pre> Inner blocks reduced to the integer 0 are accepted.
<p>

Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_min&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_int_min&nbsp;u<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;max_int&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(<span class="constructor">Array</span>.length&nbsp;row)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;min&nbsp;!accu&nbsp;(&nbsp;matrix_ioa_min&nbsp;row.(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!accu<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_min."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_find_last element vector</pre> vector_ioa_find_last returns [-1] if it does not find:
<p>

vector_ioa_find_last retourne [-1] s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_find_last&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[&nbsp;vector_int_find_last&nbsp;x&nbsp;(vector_int_demakeup&nbsp;v)&nbsp;]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;vector_ioa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;suite&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;(r&nbsp;-&nbsp;1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;essaisuite&nbsp;=&nbsp;vector_ioa_find_last&nbsp;x&nbsp;w.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(<span class="constructor">List</span>.hd&nbsp;essaisuite&nbsp;&lt;&gt;&nbsp;-1)&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index:=&nbsp;!i&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;suite&nbsp;:=&nbsp;essaisuite&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;-1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;-&nbsp;1&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!index::!suite&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_find_first element vector</pre> vector_ioa_find_first returns [-1] if it does not find:
<p>

vector_ioa_find_first retourne [-1] s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_find_first&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[&nbsp;vector_int_find_first&nbsp;x&nbsp;(vector_int_demakeup&nbsp;v)&nbsp;]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;vector_ioa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;(-1)&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;suite&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;&nbsp;!i&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;essaisuite&nbsp;=&nbsp;vector_ioa_find_first&nbsp;x&nbsp;w.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(<span class="constructor">List</span>.hd&nbsp;essaisuite&nbsp;&lt;&gt;&nbsp;-1)&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;!i&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;suite&nbsp;:=&nbsp;essaisuite&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;r&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!index::!suite&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_extract_element position vector</pre> vector_ioa_extract_element walks 
along the layers following the list of indexes up to the desired depth.
<p>

vector_ioa_extract_element parcourt les couches en suivant la liste des indices jusqu'à la profondeur souhaitée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_extract_element&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(pos:int&nbsp;list)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">List</span>.length&nbsp;pos&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"List&nbsp;too&nbsp;short&nbsp;in&nbsp;Matrix.vector_ioa_extract_element."</span>&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(vector_int_demakeup&nbsp;v).(<span class="constructor">List</span>.hd&nbsp;pos)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(vector_ioa_demakeup&nbsp;v).(<span class="constructor">List</span>.hd&nbsp;pos)&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_extract_element&nbsp;(<span class="constructor">List</span>.tl&nbsp;pos)&nbsp;(vector_ioa_demakeup&nbsp;v).(<span class="constructor">List</span>.hd&nbsp;pos)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_extract_element position matrix</pre> matrix_ioa_extract_element walks 
along the layers following the list of indexes up to the desired depth.
<p>

matrix_ioa_extract_element parcourt les couches en suivant la liste des indices jusqu'à la profondeur souhaitée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_extract_element&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(pos:int&nbsp;array&nbsp;list)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">List</span>.length&nbsp;pos&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"List&nbsp;too&nbsp;short&nbsp;in&nbsp;Matrix.matrix_ioa_extract_element."</span>&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;pos&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(matrix_int_demakeup&nbsp;m).(index.(0)).(index.(1))<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(matrix_ioa_demakeup&nbsp;m).(index.(0)).(index.(1))<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;pos&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;matrix_ioa_extract_element&nbsp;(<span class="constructor">List</span>.tl&nbsp;pos)&nbsp;(matrix_ioa_demakeup&nbsp;m).(index.(0)).(index.(1))&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_extract_column column matrix</pre> matrix_ioa_extract_column works on the superficial layer.
<p>

matrix_ioa_extract_column travaille sur la couche superficielle. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_extract_column&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;col&nbsp;=&nbsp;extract_column&nbsp;i&nbsp;(matrix_int_demakeup&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;col<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;col&nbsp;=&nbsp;extract_column&nbsp;i&nbsp;(matrix_ioa_demakeup&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;col&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_extract_row row matrix</pre> matrix_ioa_extract_row works on the superficial layer.
<p>

matrix_ioa_extract_row travaille sur la couche superficielle. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_extract_row&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;(matrix_int_demakeup&nbsp;m).(i)&nbsp;)<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;(&nbsp;(matrix_ioa_demakeup&nbsp;m).(i)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_size matrix</pre> matrix_ioa_size works on the superficial layer. 
Inner blocks reduced to the integer 0 are accepted.
<p>

matrix_ioa_size travaille sur la couche superficielle.
Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_size&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;[|&nbsp;1&nbsp;;&nbsp;1&nbsp;|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;mm&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;[|&nbsp;<span class="constructor">Array</span>.length&nbsp;mm&nbsp;;&nbsp;numcolumns&nbsp;mm&nbsp;|]&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;(&nbsp;[|&nbsp;<span class="constructor">Array</span>.length&nbsp;mm&nbsp;;&nbsp;numcolumns&nbsp;mm&nbsp;|]&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_rec_size depth matrix</pre> matrix_ioa_rec_size walks 
along the layers up to the desired depth.
Inner blocks reduced to the integer 0 are accepted.
<p>

matrix_ioa_rec_size parcourt les couches jusqu'à la profondeur souhaitée.
Des blocs réduits à l'entier 0 sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_rec_size&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_size&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;[|&nbsp;1&nbsp;;&nbsp;1&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_size&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;mm&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;m_m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_rec_size&nbsp;(&nbsp;d&nbsp;-&nbsp;1&nbsp;)&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;m_m<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_affect index element vector</pre> vector_ioa_affect works on the superficial layer.
<p>

vector_ioa_affect travaille sur la couche superficielle. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_ioa_affect&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(index:int)&nbsp;(x:int_or_array)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_int_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;vv.(index)&nbsp;&lt;-&nbsp;int_demakeup&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;vv<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_ioa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;vv.(index)&nbsp;&lt;-&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;vv&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_affect_element position element vector</pre> vector_ioa_affect_element walks 
along the layers following the list of indexes up to the desired depth.
<p>

vector_ioa_affect_element parcourt les couches en suivant la liste des indices jusqu'à la profondeur souhaitée. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_affect_element&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(position:int&nbsp;list)&nbsp;(x:int_or_array)&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">List</span>.length&nbsp;position&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"List&nbsp;too&nbsp;short&nbsp;in&nbsp;Matrix.vector_ioa_affect_element."</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_ioa_affect&nbsp;(<span class="constructor">List</span>.hd&nbsp;position)&nbsp;x&nbsp;v<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_ioa_demakeup&nbsp;v<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pos&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;position&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;vv.(pos)&nbsp;&lt;-&nbsp;vector_ioa_affect_element&nbsp;(<span class="constructor">List</span>.tl&nbsp;position)&nbsp;x&nbsp;vv.(pos)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;vv&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_affect index element matrix</pre> matrix_ioa_affect works on the superficial layer.
<p>

matrix_ioa_affect travaille sur la couche superficielle. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_affect&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(index:int&nbsp;array)&nbsp;(x:int_or_array)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_int_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;mm.(index.(0)).(index.(1))&nbsp;&lt;-&nbsp;int_demakeup&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;mm.(index.(0)).(index.(1))&nbsp;&lt;-&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_affect_element position element matrix</pre> matrix_ioa_affect_element walks 
along the layers following the list of indexes up to the desired depth.
<p>

matrix_ioa_affect_element parcourt les couches en suivant la liste des indices jusqu'à la profondeur souhaitée.*)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_affect_element&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(position:int&nbsp;array&nbsp;list)&nbsp;(x:int_or_array)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">List</span>.length&nbsp;position&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"List&nbsp;too&nbsp;short&nbsp;in&nbsp;Matrix.matrix_ioa_affect_element."</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_affect&nbsp;(<span class="constructor">List</span>.hd&nbsp;position)&nbsp;x&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pos&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;position&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;mm.(&nbsp;pos.(0)&nbsp;).(&nbsp;pos.(1)&nbsp;)&nbsp;&lt;-&nbsp;matrix_ioa_affect_element&nbsp;(<span class="constructor">List</span>.tl&nbsp;position)&nbsp;x&nbsp;mm.(&nbsp;pos.(0)&nbsp;).(&nbsp;pos.(1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_affect_row index vector matrix</pre> matrix_ioa_affect_row works on the superficial layer.
The size of the vector may be bigger than the number of rows of the matrix.
<p>

matrix_ioa_affect_row travaille sur la couche superficielle. 
La taille du vecteur peut dépassr le nombre de lignes de la matrice. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_affect_row&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(index:int)&nbsp;(v:int_or_array)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_int_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;mm.(index)&nbsp;&lt;-&nbsp;vector_int_demakeup&nbsp;v&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;mm.(index)&nbsp;&lt;-&nbsp;vector_ioa_demakeup&nbsp;v&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_affect_column index vector matrix</pre> matrix_ioa_affect_column works on the superficial layer.
The size of the vector may be bigger than the number of rows of the matrix.
<p>

matrix_ioa_affect_column travaille sur la couche superficielle.
La taille du vecteur peut dépassr le nombre de lignes de la matrice. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_affect_column&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(index:int)&nbsp;(v:int_or_array)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_int_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;affect_column&nbsp;index&nbsp;(vector_int_demakeup&nbsp;v)&nbsp;mm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i).(index)&nbsp;&lt;-&nbsp;(&nbsp;vector_ioa_demakeup&nbsp;v&nbsp;).(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_find_last element matrix</pre> matrix_ioa_find_last returns [[|-1;-1|]] if it does not find:
<p>

matrix_ioa_find_last retourne [[|-1;-1|]] s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_find_last&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[&nbsp;matrix_int_find_last&nbsp;x&nbsp;(matrix_int_demakeup&nbsp;m)&nbsp;]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;([|-1;-1|])&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;suite&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;(&nbsp;r&nbsp;-&nbsp;1&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;(&nbsp;c&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;mm.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!j&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;essaisuite&nbsp;=&nbsp;matrix_ioa_find_last&nbsp;x&nbsp;(&nbsp;row_input.(!j)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;essaisuite&nbsp;&lt;&gt;&nbsp;[|-1;-1|]&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;[|!i;!j|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;suite&nbsp;:=&nbsp;essaisuite&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;:=&nbsp;-1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;-1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;!index&nbsp;=&nbsp;[|-1;-1|]&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;-&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!index::!suite&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_find_first element matrix</pre> matrix_ioa_find_first returns [[|-1;-1|]] if it does not find:
<p>

matrix_ioa_find_first retourne [[|-1;-1|]] s'il ne trouve pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_find_first&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[&nbsp;matrix_int_find_first&nbsp;x&nbsp;(matrix_int_demakeup&nbsp;m)&nbsp;]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;([|-1;-1|])&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;suite&nbsp;=&nbsp;ref&nbsp;[]<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;j&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;mm.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!j&nbsp;&lt;&nbsp;c&nbsp;<span class="keyword">do</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;essaisuite&nbsp;=&nbsp;matrix_ioa_find_first&nbsp;x&nbsp;(&nbsp;row_input.(!j)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;essaisuite&nbsp;&lt;&gt;&nbsp;[|-1;-1|]&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;[|!i;!j|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;suite&nbsp;:=&nbsp;essaisuite&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;:=&nbsp;c&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;r&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;j&nbsp;:=&nbsp;!j&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;!index&nbsp;=&nbsp;[|-1;-1|]&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!index::!suite&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_ioa_print vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;vector_ioa_print&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;v)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;bare_vector_int_print&nbsp;(vector_int_demakeup&nbsp;v)&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;vector_ioa_demakeup&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"[|&nbsp;"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vector_ioa_print&nbsp;w.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"&nbsp;;&nbsp;"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;rr&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;vector_ioa_print&nbsp;w.(i)&nbsp;;&nbsp;print_string&nbsp;<span class="string">"&nbsp;;&nbsp;"</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;vector_ioa_print&nbsp;w.(rr)&nbsp;;<br>
&nbsp;&nbsp;print_string&nbsp;<span class="string">"|]"</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_print matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_print&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(ioa_thickness&nbsp;m)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_int_print&nbsp;(matrix_int_demakeup&nbsp;m)&nbsp;<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"[|&nbsp;with&nbsp;"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_int&nbsp;r&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"&nbsp;rows"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_newline&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_ioa_print&nbsp;row.(j)&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"|]&nbsp;and&nbsp;"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_int&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_string&nbsp;<span class="string">"&nbsp;columns"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;print_newline&nbsp;()&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="2_CalcullmentairesurlesmatricesparblocsElementarycalculusonblockmatrices"><h2><center>Calcul élémentaire sur les matrices par blocs
---
Elementary calculus on block matrices</center> </h2></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_scal_add coefficient matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;lambda&nbsp;+.&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_add&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_add&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_scal_add."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_scal_mult coefficient matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;lambda&nbsp;*.&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_mult&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_scal_mult."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_scal_left_div coefficient matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;x&nbsp;/.&nbsp;lambda&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_left_div&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_left_div&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_scal_left_div."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_scal_right_div coefficient matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;lambda&nbsp;/.&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_right_div&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_right_div&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_scal_right_div."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_scal_right_sub coefficient matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;x&nbsp;-.&nbsp;lambda&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_right_sub&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_right_sub&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_scal_right_sub."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_scal_left_sub coefficient matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;lambda&nbsp;-.&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_left_sub&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_left_sub&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_scal_left_sub."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_opp matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_opp&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_foa_scal_right_sub&nbsp;0.&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_plus matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(mm:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_add&nbsp;x&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_add&nbsp;y&nbsp;u&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_plus&nbsp;u&nbsp;(&nbsp;matrix_float_demakeup&nbsp;mm&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_add&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_left&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_right&nbsp;=&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;z.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_plus&nbsp;row_left.(j)&nbsp;row_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;z<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;thickness&nbsp;in&nbsp;Matrix.matrix_foa_plus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_plus."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_minus matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(mm:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_right_sub&nbsp;x&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_left_sub&nbsp;y&nbsp;u&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_minus&nbsp;u&nbsp;(&nbsp;matrix_float_demakeup&nbsp;mm&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_left_sub&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_left&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_right&nbsp;=&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;z.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_minus&nbsp;row_left.(j)&nbsp;row_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;z<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;thickness&nbsp;in&nbsp;Matrix.matrix_foa_minus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_minus."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_coeff_prod matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(mm:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_mult&nbsp;x&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;y&nbsp;u&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_coeff_prod&nbsp;u&nbsp;(&nbsp;matrix_float_demakeup&nbsp;mm&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_mult&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_left&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_right&nbsp;=&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;z.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_coeff_prod&nbsp;row_left.(j)&nbsp;row_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;z<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;thickness&nbsp;in&nbsp;Matrix.matrix_foa_coeff_prod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_coeff_prod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_coeff_div matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(mm:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_right_div&nbsp;x&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_left_div&nbsp;y&nbsp;u&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_coeff_div&nbsp;u&nbsp;(&nbsp;matrix_float_demakeup&nbsp;mm&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_left_div&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_left&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_right&nbsp;=&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;z.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_coeff_div&nbsp;row_left.(j)&nbsp;row_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;z<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;thickness&nbsp;in&nbsp;Matrix.matrix_foa_coeff_div."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;float_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_foa_coeff_div."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_transpose matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;foa_transpose&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;float_transpose&nbsp;w&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mmm.(j).(i)&nbsp;&lt;-&nbsp;foa_transpose&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_trace matrix</pre> foa_trace works on the superficial layer.
Inner blocks reduced to a real number are accepted.
<p>

foa_trace travaille sur la couche superficielle.
Des blocs réduits à un réel sont tolérés.  *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;foa_trace&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;float_trace&nbsp;w&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;(numcolumns&nbsp;w)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accumulateur&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;accumulateur&nbsp;:=&nbsp;matrix_foa_plus&nbsp;!accumulateur&nbsp;w.(i).(i)&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!accumulateur&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_rec_trace matrix</pre> foa_rec_trace walks along all the layers. 
Inner blocks reduced to a real number are accepted.
<p>

foa_rec_trace parcourt toutes les couches.
Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;foa_rec_trace&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float_trace&nbsp;w<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;(numcolumns&nbsp;w)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accumulateur&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;accumulateur&nbsp;:=&nbsp;!accumulateur&nbsp;+.&nbsp;foa_rec_trace&nbsp;w.(i).(i)&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!accumulateur&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line_foa_plus line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;line_foa_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:float_or_array&nbsp;array)&nbsp;(t:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(i)&nbsp;&lt;-&nbsp;matrix_foa_plus&nbsp;s.(i)&nbsp;t.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line_foa_minus line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;line_foa_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:float_or_array&nbsp;array)&nbsp;(t:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(i)&nbsp;&lt;-&nbsp;matrix_foa_minus&nbsp;s.(i)&nbsp;t.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_foa_plus beginning end line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_foa_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(s:float_or_array&nbsp;array)&nbsp;(t:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;(<span class="constructor">Array</span>.length&nbsp;t)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_foa_plus&nbsp;s.(k)&nbsp;t.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_foa_minus beginning end line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_foa_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(s:float_or_array&nbsp;array)&nbsp;(t:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;(<span class="constructor">Array</span>.length&nbsp;t)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_foa_minus&nbsp;s.(k)&nbsp;t.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_foa_coeff_prod beginning end line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_foa_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(s:float_or_array&nbsp;array)&nbsp;(t:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;(<span class="constructor">Array</span>.length&nbsp;t)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_foa_coeff_prod&nbsp;s.(k)&nbsp;t.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_foa_coeff_div beginning end line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_foa_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(s:float_or_array&nbsp;array)&nbsp;(t:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;(<span class="constructor">Array</span>.length&nbsp;t)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_foa_coeff_div&nbsp;s.(k)&nbsp;t.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_sym matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;foa_sym&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_foa_scal_mult&nbsp;0.5&nbsp;(&nbsp;matrix_foa_plus&nbsp;(foa_transpose&nbsp;m)&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_antisym matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;foa_antisym&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_foa_scal_mult&nbsp;0.5&nbsp;(&nbsp;matrix_foa_minus&nbsp;m&nbsp;(foa_transpose&nbsp;m)&nbsp;)&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_scal_add coefficient matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_scal_add&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;lambda&nbsp;+&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_add&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_add&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_scal_add."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_scal_mult coefficient matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_scal_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;lambda&nbsp;*&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_mult&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_mult&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_scal_mult."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_scal_right_div coefficient matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_scal_right_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;x&nbsp;/&nbsp;lambda&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_right_div&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_right_div&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_scal_right_div."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_scal_left_div coefficient matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_scal_left_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;lambda&nbsp;/&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_left_div&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_left_div&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_scal_left_div."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_scal_right_mod coefficient matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_scal_right_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;x&nbsp;<span class="keyword">mod</span>&nbsp;lambda&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_right_mod&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_right_mod&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_scal_right_mod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_scal_left_mod coefficient matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_scal_left_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;lambda&nbsp;<span class="keyword">mod</span>&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_left_mod&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_left_mod&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_scal_left_mod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_scal_right_sub coefficient matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_scal_right_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;x&nbsp;-&nbsp;lambda&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_right_sub&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_right_sub&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_scal_right_sub."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_scal_left_sub coefficient matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_scal_left_sub&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;lambda&nbsp;-&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_left_sub&nbsp;lambda&nbsp;u&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_left_sub&nbsp;lambda&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_scal_left_sub."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_opp matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_opp&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_ioa_scal_right_sub&nbsp;0&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_plus matrix1 matrix2</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_add&nbsp;x&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_add&nbsp;y&nbsp;u&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_plus&nbsp;u&nbsp;(&nbsp;matrix_int_demakeup&nbsp;mm&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_add&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_left&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_right&nbsp;=&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;z.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_plus&nbsp;row_left.(j)&nbsp;row_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;z<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;thickness&nbsp;in&nbsp;Matrix.matrix_ioa_plus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_plus."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_minus matrix1 matrix2</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_right_sub&nbsp;x&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_left_sub&nbsp;y&nbsp;u&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_minus&nbsp;u&nbsp;(&nbsp;matrix_int_demakeup&nbsp;mm&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_left_sub&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_left&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_right&nbsp;=&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;z.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_minus&nbsp;row_left.(j)&nbsp;row_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;z<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;thickness&nbsp;in&nbsp;Matrix.matrix_ioa_minus."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_minus."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_coeff_prod matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_mult&nbsp;x&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_mult&nbsp;y&nbsp;u&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_coeff_prod&nbsp;u&nbsp;(&nbsp;matrix_int_demakeup&nbsp;mm&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_mult&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_left&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_right&nbsp;=&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;z.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_coeff_prod&nbsp;row_left.(j)&nbsp;row_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;z<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;thickness&nbsp;in&nbsp;Matrix.matrix_ioa_coeff_prod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_coeff_prod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_coeff_div matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_right_div&nbsp;x&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_left_div&nbsp;y&nbsp;u&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_coeff_div&nbsp;u&nbsp;(&nbsp;matrix_int_demakeup&nbsp;mm&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_left_div&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_left&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_right&nbsp;=&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;z.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_coeff_div&nbsp;row_left.(j)&nbsp;row_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;z<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;thickness&nbsp;in&nbsp;Matrix.matrix_ioa_coeff_div."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_coeff_div."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_coeff_mod matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_coeff_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_left_mod&nbsp;x&nbsp;mm<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;u&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_right_mod&nbsp;y&nbsp;u&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_coeff_mod&nbsp;u&nbsp;(&nbsp;matrix_int_demakeup&nbsp;mm&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_right_mod&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_left&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_right&nbsp;=&nbsp;ww.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;z.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_coeff_mod&nbsp;row_left.(j)&nbsp;row_right.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;z<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;thickness&nbsp;in&nbsp;Matrix.matrix_ioa_coeff_mod."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;int_or_array&nbsp;matrix&nbsp;in&nbsp;Matrix.matrix_ioa_coeff_mod."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ioa_transpose matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;ioa_transpose&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;int_transpose&nbsp;w&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;r&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mmm.(j).(i)&nbsp;&lt;-&nbsp;ioa_transpose&nbsp;row_input.(j)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ioa_trace matrix</pre> ioa_trace works on the superficial layer.
Inner blocks reduced to an integer are accepted.
<p>

ioa_trace travaille sur la couche superficielle.
Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ioa_trace&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(&nbsp;int_trace&nbsp;w&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;(numcolumns&nbsp;w)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accumulateur&nbsp;=&nbsp;ref&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;accumulateur&nbsp;:=&nbsp;matrix_ioa_plus&nbsp;!accumulateur&nbsp;w.(i).(i)&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!accumulateur&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ioa_rec_trace matrix</pre> ioa_rec_trace walks 
along all the layers.
Inner blocks reduced to an integer are accepted.
<p>

ioa_rec_trace parcourt toutes les couches.
Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;ioa_rec_trace&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;int_trace&nbsp;w<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;(numcolumns&nbsp;w)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accumulateur&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;accumulateur&nbsp;:=&nbsp;!accumulateur&nbsp;+&nbsp;ioa_rec_trace&nbsp;w.(i).(i)&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!accumulateur&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line_ioa_plus line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;line_ioa_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int_or_array&nbsp;array)&nbsp;(t:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(i)&nbsp;&lt;-&nbsp;matrix_ioa_plus&nbsp;s.(i)&nbsp;t.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line_ioa_minus line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;line_ioa_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int_or_array&nbsp;array)&nbsp;(t:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(i)&nbsp;&lt;-&nbsp;matrix_ioa_minus&nbsp;s.(i)&nbsp;t.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_ioa_plus beginning end line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_ioa_plus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(s:int_or_array&nbsp;array)&nbsp;(t:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;(<span class="constructor">Array</span>.length&nbsp;t)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_ioa_plus&nbsp;s.(k)&nbsp;t.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_ioa_minus beginning end line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_ioa_minus&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(s:int_or_array&nbsp;array)&nbsp;(t:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;(<span class="constructor">Array</span>.length&nbsp;t)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_ioa_minus&nbsp;s.(k)&nbsp;t.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_ioa_coeff_prod beginning end line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_ioa_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(s:int_or_array&nbsp;array)&nbsp;(t:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;(<span class="constructor">Array</span>.length&nbsp;t)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_ioa_coeff_prod&nbsp;s.(k)&nbsp;t.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_ioa_coeff_div beginning end line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_ioa_coeff_div&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(s:int_or_array&nbsp;array)&nbsp;(t:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;(<span class="constructor">Array</span>.length&nbsp;t)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_ioa_coeff_div&nbsp;s.(k)&nbsp;t.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_ioa_coeff_mod beginning end line1 line2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_ioa_coeff_mod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(s:int_or_array&nbsp;array)&nbsp;(t:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;min&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;(<span class="constructor">Array</span>.length&nbsp;t)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_ioa_coeff_mod&nbsp;s.(k)&nbsp;t.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="2_ConstructiondematricesparblocsConstructionofblockmatrices"><h2><center>Construction de matrices par blocs
---
Construction of block matrices</center> </h2></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>zeros_foa matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;zeros_foa&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_foa_scal_mult&nbsp;0.&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>null_foa numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;null_foa&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>identity_foa numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;identity_foa&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>eye_foa matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;eye_foa&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;identity_float&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;(<span class="constructor">Array</span>.length&nbsp;w.(0))&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;foa_numrows&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;foa_numcolumns&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mmm&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i).(i)&nbsp;&lt;-&nbsp;eye_foa&nbsp;mmm.(i).(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>scal_foa real matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;scal_foa&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:float)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;lambda<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;scal_float&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;(<span class="constructor">Array</span>.length&nbsp;w.(0))&nbsp;lambda&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;foa_numrows&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;foa_numcolumns&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i).(i)&nbsp;&lt;-&nbsp;scal_foa&nbsp;lambda&nbsp;w.(i).(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>diag_foa line</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;diag_foa&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i).(i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_permu size index1 index2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_permu&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(i:int)&nbsp;(j:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)<br>
&nbsp;<span class="keyword">and</span>&nbsp;ii&nbsp;=&nbsp;min&nbsp;i&nbsp;j<br>
&nbsp;<span class="keyword">and</span>&nbsp;jj&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;i&nbsp;j&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;ii&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k).(k)&nbsp;&lt;-&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w.(ii).(jj)&nbsp;&lt;-&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;ii&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;jj&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k).(k)&nbsp;&lt;-&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w.(jj).(ii)&nbsp;&lt;-&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;jj&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k).(k)&nbsp;&lt;-&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>oblique_foa numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;oblique_foa&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(i).(s&nbsp;-&nbsp;i)&nbsp;&lt;-&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antiscal_foa numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antiscal_foa&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(i).(s&nbsp;-&nbsp;i)&nbsp;&lt;-&nbsp;<span class="constructor">Float_cons</span>&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antidiag_foa line</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antidiag_foa&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i).(r&nbsp;-&nbsp;1&nbsp;-&nbsp;i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gen_sympl_foa</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gen_sympl_foa&nbsp;=<br>
&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;[|&nbsp;[|&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;;&nbsp;<span class="constructor">Float_cons</span>&nbsp;(-1.)&nbsp;|]&nbsp;;&nbsp;[|&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.&nbsp;;&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>zeros_ioa matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;zeros_ioa&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_ioa_scal_mult&nbsp;0&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>null_ioa numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;null_ioa&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>identity_ioa numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;identity_ioa&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;m.(i).(i)&nbsp;&lt;-&nbsp;<span class="constructor">Int_cons</span>&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>eye_ioa matrix</pre> Inner blocks reduced to an integer are accepted.
<p>

Des blocs réduits à un entier sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;eye_ioa&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;1<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;identity_int&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;(<span class="constructor">Array</span>.length&nbsp;w.(0))&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;ioa_numrows&nbsp;m&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;ioa_numcolumns&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mmm&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i).(i)&nbsp;&lt;-&nbsp;eye_ioa&nbsp;mmm.(i).(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>scal_ioa real matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;scal_ioa&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(lambda:int)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;lambda<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;scal_int&nbsp;(<span class="constructor">Array</span>.length&nbsp;w)&nbsp;(<span class="constructor">Array</span>.length&nbsp;w.(0))&nbsp;lambda&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;ioa_numrows&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;ioa_numcolumns&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i).(i)&nbsp;&lt;-&nbsp;scal_ioa&nbsp;lambda&nbsp;w.(i).(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>diag_ioa line matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;diag_ioa&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i).(i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_permu size index1 index2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_permu&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(i:int)&nbsp;(j:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;n&nbsp;n&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;ii&nbsp;=&nbsp;min&nbsp;i&nbsp;j<br>
&nbsp;<span class="keyword">and</span>&nbsp;jj&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;i&nbsp;j&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;ii&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k).(k)&nbsp;&lt;-&nbsp;<span class="constructor">Int_cons</span>&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w.(ii).(jj)&nbsp;&lt;-&nbsp;<span class="constructor">Int_cons</span>&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;ii&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;jj&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k).(k)&nbsp;&lt;-&nbsp;<span class="constructor">Int_cons</span>&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;w.(jj).(ii)&nbsp;&lt;-&nbsp;<span class="constructor">Int_cons</span>&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;jj&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;n&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(k).(k)&nbsp;&lt;-&nbsp;<span class="constructor">Int_cons</span>&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>oblique_ioa numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;oblique_ioa&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(i).(s&nbsp;-&nbsp;i)&nbsp;&lt;-&nbsp;<span class="constructor">Int_cons</span>&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antiscal_ioa numrows numcolumns</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antiscal_ioa&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;(&nbsp;min&nbsp;r&nbsp;c&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;w.(i).(s&nbsp;-&nbsp;i)&nbsp;&lt;-&nbsp;<span class="constructor">Int_cons</span>&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antidiag_ioa line matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antidiag_ioa&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(i).(r&nbsp;-&nbsp;1&nbsp;-&nbsp;i)&nbsp;&lt;-&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gen_sympl_ioa</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gen_sympl_ioa&nbsp;=<br>
&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;[|&nbsp;[|&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;;&nbsp;<span class="constructor">Int_cons</span>&nbsp;(-1)&nbsp;|]&nbsp;;&nbsp;[|&nbsp;<span class="constructor">Int_cons</span>&nbsp;1&nbsp;;&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="2_DcoupagercursifdesmatricesparblocsRecursivecuttingofblockmatrices"><h2><center>Découpage récursif des matrices par blocs
---
Recursive cutting of block matrices</center> </h2></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>hash_threshold number base</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;hash_threshold&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(b:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;n&nbsp;<span class="keyword">mod</span>&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;m&nbsp;=&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;0&nbsp;<span class="keyword">else</span>&nbsp;b&nbsp;-&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>square_ioa_hash base matrix sequence</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;square_ioa_hash&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(b:int)&nbsp;(m:int_or_array)&nbsp;(s:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;ioa_numrows&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;ioa_numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pp&nbsp;=&nbsp;min&nbsp;r&nbsp;c<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pg&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;r&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;b&nbsp;&gt;=&nbsp;pp&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;matrix_ioa_copy&nbsp;m&nbsp;;&nbsp;vector_ioa_copy&nbsp;s&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keyword">false</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">match</span>&nbsp;ioa_thickness&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sequence&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_ioa_demakeup&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;hash_threshold&nbsp;pg&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;nouveau&nbsp;=&nbsp;t&nbsp;+&nbsp;pg&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;morerows&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;morecolumns&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequence&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;[|&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;[|&nbsp;morerows&nbsp;;&nbsp;morecolumns&nbsp;|]&nbsp;|]&nbsp;!sequence&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_int_demakeup&nbsp;(matrix_ioa_copy&nbsp;m)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morecolumns&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;terminaison&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;morecolumns&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm.(i)&nbsp;terminaison<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morerows&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;termin&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;morerows&nbsp;nouveau&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm&nbsp;termin&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;pp&nbsp;<span class="keyword">to</span>&nbsp;nouveau&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i).(i)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;square_ioa_hash&nbsp;b&nbsp;(&nbsp;matrix_ioa_cut&nbsp;(nouveau&nbsp;/&nbsp;b)&nbsp;(<span class="constructor">Int_matrix_cons</span>&nbsp;!mm)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!sequence&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sequence&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_ioa_demakeup&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;hash_threshold&nbsp;pg&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;nouveau&nbsp;=&nbsp;t&nbsp;+&nbsp;pg&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;morerows&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;morecolumns&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequence&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;[|&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;[|&nbsp;morerows&nbsp;;&nbsp;morecolumns&nbsp;|]&nbsp;|]&nbsp;!sequence&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morecolumns&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;terminaison&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;morecolumns&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm.(i)&nbsp;terminaison<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morerows&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;termin&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;morerows&nbsp;nouveau&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm&nbsp;termin&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;pp&nbsp;<span class="keyword">to</span>&nbsp;nouveau&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i).(i)&nbsp;&lt;-&nbsp;<span class="constructor">Int_cons</span>&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;square_ioa_hash&nbsp;b&nbsp;(&nbsp;matrix_ioa_cut&nbsp;(nouveau&nbsp;/&nbsp;b)&nbsp;(<span class="constructor">Ioa_matrix_cons</span>&nbsp;!mm)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!sequence&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>square_ioa_crash [| matrix ; sequence |]</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;square_ioa_crash&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(data:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;data.(0)&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;vector_ioa_demakeup&nbsp;data.(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;margin&nbsp;=&nbsp;vector_int_demakeup&nbsp;s.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;ioa_thickness&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;endrow&nbsp;=&nbsp;(ioa_numrows&nbsp;m)&nbsp;-&nbsp;margin.(0)&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;endcolumn&nbsp;=&nbsp;(ioa_numcolumns&nbsp;m)&nbsp;-&nbsp;margin.(1)&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;s&nbsp;1&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;matrix&nbsp;=&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;int_sub_matrix&nbsp;(matrix_int_demakeup&nbsp;m)&nbsp;0&nbsp;endrow&nbsp;0&nbsp;endcolumn&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;matrix&nbsp;;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;t&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_ioa_paste&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;endrow&nbsp;=&nbsp;(ioa_numrows&nbsp;mm)&nbsp;-&nbsp;margin.(0)&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;endcolumn&nbsp;=&nbsp;(ioa_numcolumns&nbsp;mm)&nbsp;-&nbsp;margin.(1)&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;s&nbsp;1&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;matrix&nbsp;=&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;int_sub_matrix&nbsp;(matrix_int_demakeup&nbsp;mm)&nbsp;0&nbsp;endrow&nbsp;0&nbsp;endcolumn&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;square_ioa_crash&nbsp;[|&nbsp;matrix&nbsp;;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;t&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_ioa_paste&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;endrow&nbsp;=&nbsp;(ioa_numrows&nbsp;mm)&nbsp;-&nbsp;margin.(0)&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;endcolumn&nbsp;=&nbsp;(ioa_numcolumns&nbsp;mm)&nbsp;-&nbsp;margin.(1)&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;s&nbsp;1&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;matrix&nbsp;=&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;(&nbsp;sub_matrix&nbsp;(matrix_ioa_demakeup&nbsp;mm)&nbsp;0&nbsp;endrow&nbsp;0&nbsp;endcolumn&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;square_ioa_crash&nbsp;[|&nbsp;matrix&nbsp;;&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;t&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>square_foa_hash base matrix sequence</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;square_foa_hash&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(b:int)&nbsp;(m:float_or_array)&nbsp;(s:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;foa_numrows&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;foa_numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pp&nbsp;=&nbsp;min&nbsp;r&nbsp;c<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pg&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;r&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;b&nbsp;&gt;=&nbsp;pp&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;matrix_foa_copy&nbsp;m&nbsp;;&nbsp;vector_foa_copy&nbsp;s&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keyword">false</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">match</span>&nbsp;foa_thickness&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sequence&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_foa_demakeup&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;hash_threshold&nbsp;pg&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;nouveau&nbsp;=&nbsp;t&nbsp;+&nbsp;pg&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;morerows&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;morecolumns&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequence&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|&nbsp;float&nbsp;morerows&nbsp;;&nbsp;float&nbsp;morecolumns&nbsp;|]&nbsp;|]&nbsp;!sequence&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_float_demakeup&nbsp;(matrix_foa_copy&nbsp;m)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morecolumns&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;terminaison&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;morecolumns&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm.(i)&nbsp;terminaison<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morerows&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;termin&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;morerows&nbsp;nouveau&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm&nbsp;termin&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;pp&nbsp;<span class="keyword">to</span>&nbsp;nouveau&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i).(i)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;square_foa_hash&nbsp;b&nbsp;(&nbsp;matrix_foa_cut&nbsp;(nouveau&nbsp;/&nbsp;b)&nbsp;(<span class="constructor">Float_matrix_cons</span>&nbsp;!mm)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!sequence&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sequence&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_foa_demakeup&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;hash_threshold&nbsp;pg&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;nouveau&nbsp;=&nbsp;t&nbsp;+&nbsp;pg&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;morerows&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;morecolumns&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequence&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|&nbsp;float&nbsp;morerows&nbsp;;&nbsp;float&nbsp;morecolumns&nbsp;|]&nbsp;|]&nbsp;!sequence&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morecolumns&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;terminaison&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;morecolumns&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm.(i)&nbsp;terminaison<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morerows&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;termin&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;morerows&nbsp;nouveau&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm&nbsp;termin&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;pp&nbsp;<span class="keyword">to</span>&nbsp;nouveau&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i).(i)&nbsp;&lt;-&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;square_foa_hash&nbsp;b&nbsp;(&nbsp;matrix_foa_cut&nbsp;(nouveau&nbsp;/&nbsp;b)&nbsp;(<span class="constructor">Foa_matrix_cons</span>&nbsp;!mm)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!sequence&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>square_foa_crash [| matrix ; sequence |]</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;square_foa_crash&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(data:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;data.(0)&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;vector_foa_demakeup&nbsp;data.(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;margin&nbsp;=&nbsp;vector_float_demakeup&nbsp;s.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;foa_thickness&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;endrow&nbsp;=&nbsp;(foa_numrows&nbsp;m)&nbsp;-&nbsp;(int_of_float&nbsp;margin.(0))&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;endcolumn&nbsp;=&nbsp;(foa_numcolumns&nbsp;m)&nbsp;-&nbsp;(int_of_float&nbsp;margin.(1))&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;s&nbsp;1&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;matrix&nbsp;=&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;float_sub_matrix&nbsp;(matrix_float_demakeup&nbsp;m)&nbsp;0&nbsp;endrow&nbsp;0&nbsp;endcolumn&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;matrix&nbsp;;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;t&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_paste&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;endrow&nbsp;=&nbsp;(foa_numrows&nbsp;mm)&nbsp;-&nbsp;(int_of_float&nbsp;margin.(0))&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;endcolumn&nbsp;=&nbsp;(foa_numcolumns&nbsp;mm)&nbsp;-&nbsp;(int_of_float&nbsp;margin.(1))&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;s&nbsp;1&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;matrix&nbsp;=&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;float_sub_matrix&nbsp;(matrix_float_demakeup&nbsp;mm)&nbsp;0&nbsp;endrow&nbsp;0&nbsp;endcolumn&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;square_foa_crash&nbsp;[|&nbsp;matrix&nbsp;;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;t&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_foa_paste&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;endrow&nbsp;=&nbsp;(foa_numrows&nbsp;mm)&nbsp;-&nbsp;(int_of_float&nbsp;margin.(0))&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;endcolumn&nbsp;=&nbsp;(foa_numcolumns&nbsp;mm)&nbsp;-&nbsp;(int_of_float&nbsp;margin.(1))&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;s&nbsp;1&nbsp;(&nbsp;(<span class="constructor">Array</span>.length&nbsp;s)&nbsp;-&nbsp;1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;matrix&nbsp;=&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;(&nbsp;sub_matrix&nbsp;(matrix_foa_demakeup&nbsp;mm)&nbsp;0&nbsp;endrow&nbsp;0&nbsp;endcolumn&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;square_foa_crash&nbsp;[|&nbsp;matrix&nbsp;;&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;t&nbsp;|]&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>exp_ioa_hash base matrix sequence</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;exp_ioa_hash&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(b:int)&nbsp;(m:int_or_array)&nbsp;(s:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;ioa_numrows&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;ioa_numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pp&nbsp;=&nbsp;min&nbsp;r&nbsp;c<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pg&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;r&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;b&nbsp;&gt;=&nbsp;pp&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;matrix_ioa_copy&nbsp;m&nbsp;;&nbsp;vector_ioa_copy&nbsp;s&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keyword">false</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;epaisseur&nbsp;=&nbsp;ioa_thickness&nbsp;m&nbsp;<span class="keyword">in</span>&nbsp;<span class="keyword">match</span>&nbsp;epaisseur&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sequence&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_ioa_demakeup&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;hash_threshold&nbsp;pg&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;nouveau&nbsp;=&nbsp;t&nbsp;+&nbsp;pg&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;morerows&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;morecolumns&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequence&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;[|&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;[|&nbsp;morerows&nbsp;;&nbsp;morecolumns&nbsp;|]&nbsp;|]&nbsp;!sequence&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_int_demakeup&nbsp;(matrix_ioa_copy&nbsp;m)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morecolumns&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;terminaison&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;morecolumns&nbsp;(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm.(i)&nbsp;terminaison<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morerows&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;termin&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;morerows&nbsp;nouveau&nbsp;(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm&nbsp;termin&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;pp&nbsp;<span class="keyword">to</span>&nbsp;nouveau&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i).(i)&nbsp;&lt;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exp_ioa_hash&nbsp;b&nbsp;(&nbsp;matrix_ioa_cut&nbsp;(nouveau&nbsp;/&nbsp;b)&nbsp;(<span class="constructor">Int_matrix_cons</span>&nbsp;!mm)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!sequence&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sequence&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_ioa_demakeup&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;hash_threshold&nbsp;pg&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;nouveau&nbsp;=&nbsp;t&nbsp;+&nbsp;pg&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;morerows&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;morecolumns&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequence&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;[|&nbsp;<span class="constructor">Int_vector_cons</span>&nbsp;[|&nbsp;morerows&nbsp;;&nbsp;morecolumns&nbsp;|]&nbsp;|]&nbsp;!sequence&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morecolumns&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;terminaison&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;morecolumns&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm.(i)&nbsp;terminaison<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morerows&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;termin&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;morerows&nbsp;nouveau&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm&nbsp;termin&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;pp&nbsp;<span class="keyword">to</span>&nbsp;nouveau&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i).(i)&nbsp;&lt;-&nbsp;<span class="constructor">Int_cons</span>&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;fragment&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;(float&nbsp;nouveau)&nbsp;/.&nbsp;(float&nbsp;b)&nbsp;**&nbsp;(float&nbsp;(1&nbsp;+&nbsp;epaisseur))&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exp_ioa_hash&nbsp;b&nbsp;(&nbsp;matrix_ioa_cut&nbsp;(fragment)&nbsp;(<span class="constructor">Ioa_matrix_cons</span>&nbsp;!mm)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Ioa_vector_cons</span>&nbsp;!sequence&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>exp_foa_hash base matrix sequence</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;exp_foa_hash&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(b:int)&nbsp;(m:float_or_array)&nbsp;(s:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;foa_numrows&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;foa_numcolumns&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pp&nbsp;=&nbsp;min&nbsp;r&nbsp;c<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pg&nbsp;=&nbsp;<span class="constructor">Util</span>.int_max&nbsp;r&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;b&nbsp;&gt;=&nbsp;pp&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;matrix_foa_copy&nbsp;m&nbsp;;&nbsp;vector_foa_copy&nbsp;s&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keyword">false</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;epaisseur&nbsp;=&nbsp;foa_thickness&nbsp;m&nbsp;<span class="keyword">in</span>&nbsp;<span class="keyword">match</span>&nbsp;epaisseur&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sequence&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_foa_demakeup&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;hash_threshold&nbsp;pg&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;nouveau&nbsp;=&nbsp;t&nbsp;+&nbsp;pg&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;morerows&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;morecolumns&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequence&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|&nbsp;float&nbsp;morerows&nbsp;;&nbsp;float&nbsp;morecolumns&nbsp;|]&nbsp;|]&nbsp;!sequence&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_float_demakeup&nbsp;(matrix_foa_copy&nbsp;m)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morecolumns&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;terminaison&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;morecolumns&nbsp;(0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm.(i)&nbsp;terminaison<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morerows&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;termin&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;morerows&nbsp;nouveau&nbsp;(0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm&nbsp;termin&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;pp&nbsp;<span class="keyword">to</span>&nbsp;nouveau&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i).(i)&nbsp;&lt;-&nbsp;1.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exp_foa_hash&nbsp;b&nbsp;(&nbsp;matrix_foa_cut&nbsp;(nouveau&nbsp;/&nbsp;b)&nbsp;(<span class="constructor">Float_matrix_cons</span>&nbsp;!mm)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!sequence&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sequence&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_foa_demakeup&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;t&nbsp;=&nbsp;hash_threshold&nbsp;pg&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;nouveau&nbsp;=&nbsp;t&nbsp;+&nbsp;pg&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;morerows&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;morecolumns&nbsp;=&nbsp;nouveau&nbsp;-&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequence&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|&nbsp;float&nbsp;morerows&nbsp;;&nbsp;float&nbsp;morecolumns&nbsp;|]&nbsp;|]&nbsp;!sequence&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morecolumns&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;terminaison&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;morecolumns&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i)&nbsp;&lt;-&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm.(i)&nbsp;terminaison<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;morerows&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;termin&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;morerows&nbsp;nouveau&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!mm&nbsp;termin&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;pp&nbsp;<span class="keyword">to</span>&nbsp;nouveau&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm.(i).(i)&nbsp;&lt;-&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;fragment&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;(float&nbsp;nouveau)&nbsp;/.&nbsp;(float&nbsp;b)&nbsp;**&nbsp;(float&nbsp;(1&nbsp;+&nbsp;epaisseur))&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exp_foa_hash&nbsp;b&nbsp;(&nbsp;matrix_foa_cut&nbsp;(fragment)&nbsp;(<span class="constructor">Foa_matrix_cons</span>&nbsp;!mm)&nbsp;)&nbsp;(&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;!sequence&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="2_CalculsubstantielsurlesmatricesparblocsSubstantialcalculusonblockmatrices"><h2><center>Calcul substantiel sur les matrices par blocs
---
Substantial calculus on block matrices</center> </h2></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_twisted_prod matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_twisted_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(mm:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">Util</span>.int_max&nbsp;(foa_thickness&nbsp;m)&nbsp;(foa_thickness&nbsp;mm)&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices plates --- flat matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(x&nbsp;*.&nbsp;y)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;x&nbsp;(&nbsp;float_transpose&nbsp;(matrix_float_demakeup&nbsp;mm)&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;y&nbsp;(matrix_float_demakeup&nbsp;m)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_twisted_prod&nbsp;(matrix_float_demakeup&nbsp;m)&nbsp;(matrix_float_demakeup&nbsp;mm)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices plates --- flat matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices épaisses --- thick matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_mult&nbsp;x&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est plate --- m is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_right&nbsp;=&nbsp;ww.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_mult&nbsp;row_input.(0)&nbsp;(&nbsp;foa_transpose&nbsp;row_right.(0)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_foa_scal_mult&nbsp;row_input.(k)&nbsp;(&nbsp;foa_transpose&nbsp;row_right.(k)&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est plate --- m is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est épaisse --- m is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_mult&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est plate --- mm is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_right&nbsp;=&nbsp;ww.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_mult&nbsp;row_right.(0)&nbsp;row_input.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_foa_scal_mult&nbsp;row_right.(k)&nbsp;row_input.(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est plate --- mm is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est épaisse --- mm is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;ww&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_right&nbsp;=&nbsp;ww.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_twisted_prod&nbsp;row_input.(0)&nbsp;row_right.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_foa_twisted_prod&nbsp;row_input.(k)&nbsp;row_right.(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est épaisse --- mm is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est épaisse --- m is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices épaisses --- thick matrices *)</span></td></tr></table><code class="code">&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_prod matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(mm:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_foa_twisted_prod&nbsp;m&nbsp;(&nbsp;foa_transpose&nbsp;mm&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_triple_prod matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_triple_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:float_or_array)&nbsp;(b:float_or_array)&nbsp;(c:float_or_array)<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_foa_twisted_prod&nbsp;a&nbsp;(&nbsp;matrix_foa_twisted_prod&nbsp;(&nbsp;foa_transpose&nbsp;c&nbsp;)&nbsp;b&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_twisted_commut matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_twisted_commut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(mm:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_foa_minus&nbsp;(&nbsp;matrix_foa_twisted_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_foa_twisted_prod&nbsp;mm&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_twisted_commut_bis matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_twisted_commut_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(mm:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;foa_transpose&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;m_mm&nbsp;=&nbsp;foa_transpose&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_foa_minus&nbsp;(&nbsp;matrix_foa_twisted_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_foa_twisted_prod&nbsp;m_mm&nbsp;m_m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_commut matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_commut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(mm:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_foa_minus&nbsp;(&nbsp;matrix_foa_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_foa_prod&nbsp;mm&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_naive_prod matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_naive_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(mm:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">Util</span>.int_max&nbsp;(foa_thickness&nbsp;m)&nbsp;(foa_thickness&nbsp;mm)&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices plates --- flat matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(x&nbsp;*.&nbsp;y)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;x&nbsp;(matrix_float_demakeup&nbsp;mm)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;y&nbsp;(matrix_float_demakeup&nbsp;m)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_prod&nbsp;(matrix_float_demakeup&nbsp;m)&nbsp;(matrix_float_demakeup&nbsp;mm)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices plates --- flat matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices épaisses --- thick matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_mult&nbsp;x&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est plate --- m is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_mult&nbsp;row_input.(0)&nbsp;ww.(0).(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_foa_scal_mult&nbsp;row_input.(k)&nbsp;ww.(k).(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est plate --- m is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est épaisse --- m is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_mult&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est plate --- mm is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_mult&nbsp;ww.(0).(j)&nbsp;row_input.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_foa_scal_mult&nbsp;ww.(k).(j)&nbsp;row_input.(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est plate --- mm is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est épaisse --- mm is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;ww&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_naive_prod&nbsp;row_input.(0)&nbsp;ww.(0).(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_foa_naive_prod&nbsp;row_input.(k)&nbsp;ww.(k).(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est épaisse --- mm is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est épaisse --- m is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices épaisses --- thick matrices *)</span></td></tr></table><code class="code">&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_coeff_prod matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_foa_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(mm:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_mult&nbsp;x&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;y&nbsp;w&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_coeff_prod&nbsp;w&nbsp;ww&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;numcolumns&nbsp;ww&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ww.(i).(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_mult&nbsp;w.(i).(j)&nbsp;ww.(i).(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;ww<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_mult&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_coeff_prod&nbsp;mm&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;mm&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;numcolumns&nbsp;ww&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ww.(i).(j)&nbsp;&lt;-&nbsp;matrix_foa_coeff_prod&nbsp;w.(i).(j)&nbsp;ww.(i).(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;ww<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_diag_left_mult blockVector matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;foa_diag_left_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:foa_strip)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_mult&nbsp;y&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_foa_strip_demakeup&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;(&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i).(i)&nbsp;&lt;-&nbsp;matrix_foa_scal_mult&nbsp;y&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_prod&nbsp;x&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_foa_strip_demakeup&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;numcolumns&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;coeff&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_mult&nbsp;row_input.(j)&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_prod&nbsp;x&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_foa_strip_demakeup&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;numcolumns&nbsp;w&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;coeff&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_prod&nbsp;coeff&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_diag_right_mult blockVector matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;foa_diag_right_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:foa_strip)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;foa_diag_left_mult&nbsp;d&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_prod&nbsp;m&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** idem foa_diag_left_mult *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_foa_strip_demakeup&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_scal_mult&nbsp;row_input.(j)&nbsp;v.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foa_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_prod&nbsp;m&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_foa_strip_demakeup&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;numcolumns&nbsp;w&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_foa_prod&nbsp;row_input.(j)&nbsp;v.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_foa_left_prod beginning end element line</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_foa_left_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(x:float_or_array)&nbsp;(s:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_foa_prod&nbsp;x&nbsp;s.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_foa_left_twisted_prod beginning end element line</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_foa_left_twisted_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(x:float_or_array)&nbsp;(s:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_foa_twisted_prod&nbsp;x&nbsp;s.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_foa_right_prod beginning end element line</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_foa_right_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(x:float_or_array)&nbsp;(s:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_foa_prod&nbsp;s.(k)&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_foa_right_twisted_prod beginning end element line</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_foa_right_twisted_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(x:float_or_array)&nbsp;(s:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_foa_twisted_prod&nbsp;s.(k)&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>other_partial_foa_right_twisted_prod beginning end element line</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;other_partial_foa_right_twisted_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(x:float_or_array)&nbsp;(s:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_foa_twisted_prod&nbsp;(&nbsp;foa_transpose&nbsp;s.(k)&nbsp;)&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_twisted_prod matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_twisted_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">Util</span>.int_max&nbsp;(ioa_thickness&nbsp;m)&nbsp;(ioa_thickness&nbsp;mm)&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices plates --- flat matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(x&nbsp;*&nbsp;y)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_mult&nbsp;x&nbsp;(&nbsp;int_transpose&nbsp;(matrix_int_demakeup&nbsp;mm)&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_mult&nbsp;y&nbsp;(matrix_int_demakeup&nbsp;m)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_twisted_prod&nbsp;(matrix_int_demakeup&nbsp;m)&nbsp;(matrix_int_demakeup&nbsp;mm)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices plates --- flat matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices épaisses --- thick matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_mult&nbsp;x&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est plate --- m is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_right&nbsp;=&nbsp;ww.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_mult&nbsp;row_input.(0)&nbsp;(&nbsp;ioa_transpose&nbsp;row_right.(0)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_ioa_scal_mult&nbsp;row_input.(k)&nbsp;(&nbsp;ioa_transpose&nbsp;row_right.(k)&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est plate --- m is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est épaisse --- m is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_mult&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est plate --- mm is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_right&nbsp;=&nbsp;ww.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_mult&nbsp;row_right.(0)&nbsp;row_input.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_ioa_scal_mult&nbsp;row_right.(k)&nbsp;row_input.(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est plate --- mm is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est épaisse --- mm is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;ww&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_right&nbsp;=&nbsp;ww.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_twisted_prod&nbsp;row_input.(0)&nbsp;row_right.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_ioa_twisted_prod&nbsp;row_input.(k)&nbsp;row_right.(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est épaisse --- mm is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est épaisse --- m is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices épaisses --- thick matrices *)</span></td></tr></table><code class="code">&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_prod matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_ioa_twisted_prod&nbsp;m&nbsp;(&nbsp;ioa_transpose&nbsp;mm&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_triple_prod matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_triple_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:int_or_array)&nbsp;(b:int_or_array)&nbsp;(c:int_or_array)<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_ioa_twisted_prod&nbsp;a&nbsp;(&nbsp;matrix_ioa_twisted_prod&nbsp;(&nbsp;ioa_transpose&nbsp;c&nbsp;)&nbsp;b&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_twisted_commut matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_twisted_commut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_ioa_minus&nbsp;(&nbsp;matrix_ioa_twisted_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_ioa_twisted_prod&nbsp;mm&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_twisted_commut_bis matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_twisted_commut_bis&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;ioa_transpose&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;m_mm&nbsp;=&nbsp;ioa_transpose&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_ioa_minus&nbsp;(&nbsp;matrix_ioa_twisted_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_ioa_twisted_prod&nbsp;m_mm&nbsp;m_m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_commut matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_ioa_commut&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_ioa_minus&nbsp;(&nbsp;matrix_ioa_prod&nbsp;m&nbsp;mm&nbsp;)&nbsp;(&nbsp;matrix_ioa_prod&nbsp;mm&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_naive_prod matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_naive_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;(&nbsp;<span class="constructor">Util</span>.int_max&nbsp;(ioa_thickness&nbsp;m)&nbsp;(ioa_thickness&nbsp;mm)&nbsp;)&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices plates --- flat matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;(x&nbsp;*&nbsp;y)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_mult&nbsp;x&nbsp;(matrix_int_demakeup&nbsp;mm)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_mult&nbsp;y&nbsp;(matrix_int_demakeup&nbsp;m)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_prod&nbsp;(matrix_int_demakeup&nbsp;m)&nbsp;(matrix_int_demakeup&nbsp;mm)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices plates --- flat matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices épaisses --- thick matrices *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_mult&nbsp;x&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est plate --- m is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_mult&nbsp;row_input.(0)&nbsp;ww.(0).(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_ioa_scal_mult&nbsp;row_input.(k)&nbsp;ww.(k).(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est plate --- m is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est épaisse --- m is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_mult&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est plate --- mm is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_mult&nbsp;ww.(0).(j)&nbsp;row_input.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_ioa_scal_mult&nbsp;ww.(k).(j)&nbsp;row_input.(k)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est plate --- mm is flat *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est épaisse --- mm is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">and</span>&nbsp;ww&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;-&nbsp;1&nbsp;+&nbsp;numcolumns&nbsp;ww&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(r&nbsp;+&nbsp;1)&nbsp;(c&nbsp;+&nbsp;1)&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_naive_prod&nbsp;row_input.(0)&nbsp;ww.(0).(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_plus&nbsp;row_output.(j)&nbsp;(&nbsp;matrix_ioa_naive_prod&nbsp;row_input.(k)&nbsp;ww.(k).(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mmm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** mm est épaisse --- mm is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** m est épaisse --- m is thick *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** matrices épaisses --- thick matrices *)</span></td></tr></table><code class="code">&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_ioa_coeff_prod matrix1 matrix2</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;matrix_ioa_coeff_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int_or_array)&nbsp;(mm:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_mult&nbsp;x&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_scal_mult&nbsp;y&nbsp;w&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;matrix_int_coeff_prod&nbsp;w&nbsp;ww&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;numcolumns&nbsp;ww&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ww.(i).(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_mult&nbsp;w.(i).(j)&nbsp;ww.(i).(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;ww<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;mm&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_mult&nbsp;y&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;ww&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_coeff_prod&nbsp;mm&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;mm&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;ww<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;numcolumns&nbsp;ww&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ww.(i).(j)&nbsp;&lt;-&nbsp;matrix_ioa_coeff_prod&nbsp;w.(i).(j)&nbsp;ww.(i).(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;ww<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ioa_diag_left_mult blockVector matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ioa_diag_left_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:ioa_strip)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_scal_mult&nbsp;y&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_ioa_strip_demakeup&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;(&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm.(i).(i)&nbsp;&lt;-&nbsp;matrix_ioa_scal_mult&nbsp;y&nbsp;v.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_prod&nbsp;x&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_ioa_strip_demakeup&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;numcolumns&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;coeff&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_mult&nbsp;row_input.(j)&nbsp;coeff<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_prod&nbsp;x&nbsp;m<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_ioa_strip_demakeup&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;numcolumns&nbsp;w&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;coeff&nbsp;=&nbsp;v.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_prod&nbsp;coeff&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ioa_diag_right_mult blockVector matrix</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ioa_diag_right_mult&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(d:ioa_strip)&nbsp;(m:int_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_cons</span>&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;ioa_diag_left_mult&nbsp;d&nbsp;m<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_prod&nbsp;m&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** idem ioa_diag_left_mult *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_ioa_strip_demakeup&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(numcolumns&nbsp;w)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_scal_mult&nbsp;row_input.(j)&nbsp;v.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_ioa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;d&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Ioa_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_ioa_prod&nbsp;m&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;vector_ioa_strip_demakeup&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;(&nbsp;numcolumns&nbsp;w&nbsp;)&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;(cc&nbsp;+&nbsp;1)&nbsp;(&nbsp;<span class="constructor">Int_cons</span>&nbsp;0&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;mm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;matrix_ioa_prod&nbsp;row_input.(j)&nbsp;v.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;mm<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_ioa_left_prod beginning end element line</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_ioa_left_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(x:int_or_array)&nbsp;(s:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_ioa_prod&nbsp;x&nbsp;s.(k)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>partial_ioa_right_prod beginning end element line</pre> Inner blocks reduced to a real number are accepted.
<p>

Des blocs réduits à un réel sont tolérés. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;partial_ioa_right_prod&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(j:int)&nbsp;(x:int_or_array)&nbsp;(s:int_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;(<span class="constructor">Int_cons</span>&nbsp;0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;i&nbsp;<span class="keyword">to</span>&nbsp;j&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m.(k)&nbsp;&lt;-&nbsp;matrix_ioa_prod&nbsp;s.(k)&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** Les définitions des neuf fonctions qui suivent sont mutuellement récursives.
<p>

The definitions of the nine following functions are mutually recursive. *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_slow_pivot_downward i m p</pre> The block matrix m is assumed to be upper triangular from line 0 to i - 1.
The matrix p registers the same changes as m.
<p>

La matrice par blocs m est supposée, de la ligne 0 à i - 1, triangulaire supérieure. 
La matrice p enregistre les memes changements que m. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;foa_slow_pivot_downward&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:float_or_array)&nbsp;(p:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;m&nbsp;;&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.&nbsp;;&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;[|&nbsp;[|&nbsp;0.&nbsp;;&nbsp;0.&nbsp;|]&nbsp;|]&nbsp;;&nbsp;<span class="constructor">Float_cons</span>&nbsp;(1.&nbsp;/.&nbsp;x)&nbsp;|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;float_slow_pivot_downward&nbsp;i&nbsp;w&nbsp;(matrix_float_demakeup&nbsp;p)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;[|&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;resultat.(0)&nbsp;;&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;resultat.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;resultat.(2)&nbsp;;&nbsp;<span class="constructor">Float_cons</span>&nbsp;resultat.(3).(0).(0)&nbsp;|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mmmm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pppp&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_foa_demakeup&nbsp;p&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;min&nbsp;r&nbsp;c&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;permutation&nbsp;=&nbsp;ref&nbsp;(&nbsp;[|&nbsp;[|&nbsp;0.&nbsp;;&nbsp;0.&nbsp;|]&nbsp;|]&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ww&nbsp;=&nbsp;sub_matrix&nbsp;w&nbsp;i&nbsp;(r&nbsp;-&nbsp;1)&nbsp;i&nbsp;(c&nbsp;-&nbsp;1)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;k&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!k&nbsp;&lt;&nbsp;<span class="constructor">Array</span>.length&nbsp;ww&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;foa_slow_invertibility&nbsp;ww.(!k).(0)&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!k&nbsp;;&nbsp;k&nbsp;:=&nbsp;r&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;k&nbsp;:=&nbsp;!k&nbsp;+&nbsp;1&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mmmm&nbsp;:=&nbsp;exchange_row&nbsp;i&nbsp;(i&nbsp;+&nbsp;!index)&nbsp;!mmmm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pppp&nbsp;:=&nbsp;exchange_row&nbsp;i&nbsp;(i&nbsp;+&nbsp;!index)&nbsp;!pppp&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;bloc&nbsp;=&nbsp;!mmmm.(i).(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;not&nbsp;(&nbsp;foa_slow_invertibility&nbsp;bloc&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Block&nbsp;non&nbsp;invertible&nbsp;in&nbsp;Matrix.foa_slow_pivot_downward."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;foa_slow_inv&nbsp;bloc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_foa_prod&nbsp;coefficient)&nbsp;!pppp.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row&nbsp;=&nbsp;partial_foa_left_prod&nbsp;(i&nbsp;+&nbsp;1)&nbsp;(c&nbsp;-&nbsp;1)&nbsp;coefficient&nbsp;!mmmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Pay attention to order: attention à l'ordre *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!mmmm.(j).(i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!pppp.(j)&nbsp;&lt;-&nbsp;line_foa_minus&nbsp;!pppp.(j)&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_foa_prod&nbsp;coeff)&nbsp;ligne&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mmmm.(j)&nbsp;&lt;-&nbsp;partial_foa_minus&nbsp;(i&nbsp;+&nbsp;1)&nbsp;(c&nbsp;-&nbsp;1)&nbsp;!mmmm.(j)&nbsp;(&nbsp;partial_foa_left_prod&nbsp;(i&nbsp;+&nbsp;1)&nbsp;(c&nbsp;-&nbsp;1)&nbsp;coeff&nbsp;row&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;!mmmm&nbsp;;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;!pppp&nbsp;;&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;!permutation&nbsp;;&nbsp;coefficient&nbsp;|]<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_restricted_slow_pivot_downward i m</pre> The block matrix m is assumed to be upper triangular from line 0 to i - 1.
<p>

La matrice par blocs m est supposée, de la ligne 0 à i - 1, triangulaire supérieure. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;foa_restricted_slow_pivot_downward&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;m&nbsp;;&nbsp;m&nbsp;|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;float_restricted_slow_pivot_downward&nbsp;i&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;[|&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;resultat.(0)&nbsp;;&nbsp;<span class="constructor">Float_cons</span>&nbsp;resultat.(1).(0).(0)&nbsp;|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mmmm&nbsp;=&nbsp;ref&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;min&nbsp;r&nbsp;c&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ww&nbsp;=&nbsp;sub_matrix&nbsp;w&nbsp;i&nbsp;(r&nbsp;-&nbsp;1)&nbsp;i&nbsp;(c&nbsp;-&nbsp;1)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;k&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!k&nbsp;&lt;&nbsp;<span class="constructor">Array</span>.length&nbsp;ww&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;foa_slow_invertibility&nbsp;ww.(!k).(0)&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!k&nbsp;;&nbsp;k&nbsp;:=&nbsp;r&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;k&nbsp;:=&nbsp;!k&nbsp;+&nbsp;1&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;mmmm&nbsp;:=&nbsp;exchange_row&nbsp;i&nbsp;(i&nbsp;+&nbsp;!index)&nbsp;!mmmm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;element&nbsp;=&nbsp;ref&nbsp;!mmmm.(i).(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;foa_slow_invertibility&nbsp;!element&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;foa_slow_inv&nbsp;!element&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;partial_foa_left_prod&nbsp;(i&nbsp;+&nbsp;1)&nbsp;(c&nbsp;-&nbsp;1)&nbsp;coefficient&nbsp;!mmmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;+&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!mmmm.(j).(i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mmmm.(j)&nbsp;&lt;-&nbsp;partial_foa_minus&nbsp;(i&nbsp;+&nbsp;1)&nbsp;(c&nbsp;-&nbsp;1)&nbsp;!mmmm.(j)&nbsp;(&nbsp;partial_foa_left_prod&nbsp;(i&nbsp;+&nbsp;1)&nbsp;(c&nbsp;-&nbsp;1)&nbsp;coeff&nbsp;row&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;element&nbsp;:=&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;!mmmm&nbsp;;&nbsp;!element&nbsp;|]<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_slow_pivot_upward i m p</pre> The block matrix m is assumed to be diagonal from line i + 1 to r - 1.
The matrix p registers the same changes as m.
<p>

La matrice par blocs m est supposée, de la ligne i + 1 à r - 1, diagonale. 
La matrice p enregistre les memes changements que m. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;foa_slow_pivot_upward&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(m:float_or_array)&nbsp;(p:float_or_array)&nbsp;(coefficient:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[|&nbsp;m&nbsp;;&nbsp;<span class="constructor">Float_cons</span>&nbsp;1.&nbsp;|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;float_slow_pivot_upward&nbsp;i&nbsp;w&nbsp;(matrix_float_demakeup&nbsp;p)&nbsp;(float_demakeup&nbsp;coefficient)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;[|&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;resultat.(0)&nbsp;;&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;resultat.(1)&nbsp;|]<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmmm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pppp&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_foa_demakeup&nbsp;p&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_foa_prod&nbsp;coefficient)&nbsp;!pppp.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row&nbsp;=&nbsp;partial_foa_left_prod&nbsp;0&nbsp;(i&nbsp;-&nbsp;1)&nbsp;coefficient&nbsp;!mmmm.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Pay attention to order : attention à l'ordre *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;!mmmm.(j).(i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!pppp.(j)&nbsp;&lt;-&nbsp;line_foa_minus&nbsp;!pppp.(j)&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_foa_prod&nbsp;coeff)&nbsp;ligne&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mmmm.(j)&nbsp;&lt;-&nbsp;partial_foa_minus&nbsp;j&nbsp;(i&nbsp;-&nbsp;1)&nbsp;!mmmm.(j)&nbsp;(&nbsp;partial_foa_left_prod&nbsp;j&nbsp;(i&nbsp;-&nbsp;1)&nbsp;coeff&nbsp;row&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;!mmmm&nbsp;;&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;!pppp&nbsp;|]<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_slow_invertibility matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;foa_slow_invertibility&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x&nbsp;&lt;&gt;&nbsp;0.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float_slow_invertibility&nbsp;w<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(foa_numrows&nbsp;m)&nbsp;(foa_numcolumns&nbsp;m)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(matrix_foa_copy&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;output&nbsp;=&nbsp;ref&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;foa_restricted_slow_pivot_downward&nbsp;!i&nbsp;!mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;resultat.(1)&nbsp;=&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;r&nbsp;;&nbsp;output&nbsp;:=&nbsp;<span class="keyword">false</span>&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;!output&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;foa_slow_invertibility&nbsp;(&nbsp;matrix_foa_demakeup&nbsp;!mm&nbsp;).(rr).(rr)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!output<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_slow_invertibility_evaluation matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;foa_slow_invertibility_evaluation&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float_slow_invertibility_evaluation&nbsp;w<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(foa_numrows&nbsp;m)&nbsp;(foa_numcolumns&nbsp;m)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(matrix_foa_copy&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;output&nbsp;=&nbsp;ref&nbsp;max_float&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;foa_restricted_slow_pivot_downward&nbsp;!i&nbsp;!mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;resultat.(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;coeff&nbsp;=&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;r&nbsp;;&nbsp;output&nbsp;:=&nbsp;0.&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(!i)&nbsp;&lt;-&nbsp;coeff&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!output&nbsp;&lt;&gt;&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(rr)&nbsp;&lt;-&nbsp;(matrix_foa_demakeup&nbsp;!mm).(rr).(rr)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;suite&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;foa_slow_invertibility_evaluation&nbsp;)&nbsp;diagonale&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;absdiag&nbsp;=&nbsp;vector_float_abs&nbsp;suite&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mini&nbsp;=&nbsp;<span class="constructor">Util</span>.vector_min&nbsp;absdiag&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;vector_float_find_first&nbsp;mini&nbsp;absdiag&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;suite.(index)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;0.<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_slow_abs_det matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;foa_slow_abs_det&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;abs_float&nbsp;(&nbsp;float_slow_det&nbsp;w&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(foa_numrows&nbsp;m)&nbsp;(foa_numcolumns&nbsp;m)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(matrix_foa_copy&nbsp;m)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;foa_restricted_slow_pivot_downward&nbsp;!i&nbsp;!mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;resultat.(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;coeff&nbsp;=&nbsp;<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;r&nbsp;;&nbsp;accu&nbsp;:=&nbsp;0.&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;!accu&nbsp;*.&nbsp;(&nbsp;foa_slow_abs_det&nbsp;coeff&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!accu&nbsp;&lt;&gt;&nbsp;0.&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abs_float&nbsp;(&nbsp;!accu&nbsp;*.&nbsp;(&nbsp;foa_slow_abs_det&nbsp;(&nbsp;matrix_foa_demakeup&nbsp;!mm&nbsp;).(rr).(rr)&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;0.<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_slow_left_quotient matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;matrix_foa_slow_left_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(q:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_left_div&nbsp;x&nbsp;q<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(matrix_float_slow_left_quotient&nbsp;w&nbsp;(&nbsp;matrix_float_demakeup&nbsp;q&nbsp;)&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(foa_numrows&nbsp;m)&nbsp;(foa_numcolumns&nbsp;m)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_foa_copy&nbsp;m&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pp&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_foa_copy&nbsp;q&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;foa_slow_pivot_downward&nbsp;i&nbsp;!mm&nbsp;!pp&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp&nbsp;:=&nbsp;resultat.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(i)&nbsp;&lt;-&nbsp;resultat.(3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;bloc&nbsp;=&nbsp;(matrix_foa_demakeup&nbsp;!mm).(rr).(rr)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;not&nbsp;(&nbsp;foa_slow_invertibility&nbsp;bloc&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Block&nbsp;non&nbsp;invertible&nbsp;in&nbsp;Matrix.matrix_foa_slow_left_quotient."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(rr)&nbsp;&lt;-&nbsp;foa_slow_inv&nbsp;bloc&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;rr&nbsp;<span class="keyword">downto</span>&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;foa_slow_pivot_upward&nbsp;i&nbsp;!mm&nbsp;!pp&nbsp;diagonale.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp&nbsp;:=&nbsp;resultat.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;foa_diag_left_mult&nbsp;(&nbsp;<span class="constructor">Foa_strip_cons</span>&nbsp;diagonale&nbsp;)&nbsp;!pp&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line_foa_slow_left_quotient matrix1 matrix_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;line_foa_slow_left_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(q:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;matrix_foa_slow_left_quotient&nbsp;m&nbsp;)&nbsp;q<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_slow_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;foa_slow_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;1.&nbsp;/.&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(float_slow_inv&nbsp;w)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;min&nbsp;(foa_numrows&nbsp;m)&nbsp;(foa_numcolumns&nbsp;m)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;(matrix_foa_copy&nbsp;m)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;pp&nbsp;=&nbsp;ref&nbsp;(eye_foa&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;foa_slow_pivot_downward&nbsp;i&nbsp;!mm&nbsp;!pp&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp&nbsp;:=&nbsp;resultat.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(i)&nbsp;&lt;-&nbsp;resultat.(3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;bloc&nbsp;=&nbsp;(matrix_foa_demakeup&nbsp;!mm).(rr).(rr)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;not&nbsp;(&nbsp;foa_slow_invertibility&nbsp;bloc&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Block&nbsp;non&nbsp;invertible&nbsp;in&nbsp;Matrix.foa_slow_inv."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(rr)&nbsp;&lt;-&nbsp;foa_slow_inv&nbsp;bloc&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;rr&nbsp;<span class="keyword">downto</span>&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;foa_slow_pivot_upward&nbsp;i&nbsp;!mm&nbsp;!pp&nbsp;diagonale.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp&nbsp;:=&nbsp;resultat.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;foa_diag_left_mult&nbsp;(&nbsp;<span class="constructor">Foa_strip_cons</span>&nbsp;diagonale&nbsp;)&nbsp;!pp&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!mm&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** Fin des neuf définitions mutuellement récursives.
<p>

End of the nine mutually recursive definitions. *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_slow_right_quotient matrix1 matrix2</pre> This gives matrix2 * (matrix1) ^ -1.
<p>

Ceci retourne matrix2 * (matrix1) ^ -1. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_slow_right_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(q:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;foa_transpose&nbsp;(&nbsp;matrix_foa_slow_left_quotient&nbsp;(foa_transpose&nbsp;m)&nbsp;(foa_transpose&nbsp;q)&nbsp;)&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** Les définitions des six fonctions qui suivent sont mutuellement récursives.
<p>

The definitions of the six following functions are mutually recursive. *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_invertibility matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;foa_invertibility&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x&nbsp;&lt;&gt;&nbsp;0.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float_invertibility&nbsp;w<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;output&nbsp;=&nbsp;ref&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;min&nbsp;r&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ii&nbsp;=&nbsp;!i&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;!i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;k&nbsp;=&nbsp;ref&nbsp;!i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!k&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;foa_invertibility&nbsp;w.(!k).(!i)&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!k&nbsp;;&nbsp;k&nbsp;:=&nbsp;r&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;k&nbsp;:=&nbsp;!k&nbsp;+&nbsp;1&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;!i&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;auxil&nbsp;=&nbsp;w.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(!i)&nbsp;&lt;-&nbsp;w.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(!index)&nbsp;&lt;-&nbsp;auxil&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;element&nbsp;=&nbsp;ref&nbsp;w.(!i).(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;foa_invertibility&nbsp;!element&nbsp;)&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;foa_inv&nbsp;!element&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;other_partial_foa_right_twisted_prod&nbsp;ii&nbsp;cc&nbsp;coefficient&nbsp;w.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;ii&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;w.(j).(!i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(j)&nbsp;&lt;-&nbsp;partial_foa_minus&nbsp;ii&nbsp;cc&nbsp;w.(j)&nbsp;(&nbsp;partial_foa_left_twisted_prod&nbsp;ii&nbsp;cc&nbsp;coeff&nbsp;row&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;ii<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;r&nbsp;;&nbsp;output&nbsp;:=&nbsp;<span class="keyword">false</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;!output&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;foa_invertibility&nbsp;w.(rr).(rr)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!output<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_invertibility_evaluation matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;foa_invertibility_evaluation&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float_invertibility_evaluation&nbsp;w<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;min&nbsp;r&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;output&nbsp;=&nbsp;ref&nbsp;max_float&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ii&nbsp;=&nbsp;!i&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;!i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;k&nbsp;=&nbsp;ref&nbsp;!i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!k&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;foa_invertibility&nbsp;w.(!k).(!i)&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!k&nbsp;;&nbsp;k&nbsp;:=&nbsp;r&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;k&nbsp;:=&nbsp;!k&nbsp;+&nbsp;1&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;!i&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;auxil&nbsp;=&nbsp;w.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(!i)&nbsp;&lt;-&nbsp;w.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(!index)&nbsp;&lt;-&nbsp;auxil&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;element&nbsp;=&nbsp;ref&nbsp;w.(!i).(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;foa_invertibility&nbsp;!element&nbsp;)&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(!i)&nbsp;&lt;-&nbsp;foa_invertibility_evaluation&nbsp;!element&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;foa_inv&nbsp;!element&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;other_partial_foa_right_twisted_prod&nbsp;ii&nbsp;cc&nbsp;coefficient&nbsp;w.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;ii&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;w.(j).(!i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(j)&nbsp;&lt;-&nbsp;partial_foa_minus&nbsp;ii&nbsp;cc&nbsp;w.(j)&nbsp;(&nbsp;partial_foa_left_twisted_prod&nbsp;ii&nbsp;cc&nbsp;coeff&nbsp;row&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;ii<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;r&nbsp;;&nbsp;output&nbsp;:=&nbsp;0.&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!output&nbsp;&lt;&gt;&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(rr)&nbsp;&lt;-&nbsp;foa_invertibility_evaluation&nbsp;w.(rr).(rr)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;absdiag&nbsp;=&nbsp;vector_float_abs&nbsp;diagonale&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mini&nbsp;=&nbsp;<span class="constructor">Util</span>.vector_min&nbsp;absdiag&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;vector_float_find_first&nbsp;mini&nbsp;absdiag&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(index)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;0.<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_abs_det matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;foa_abs_det&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;abs_float&nbsp;x<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;abs_float&nbsp;(&nbsp;float_det&nbsp;w&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;min&nbsp;r&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ii&nbsp;=&nbsp;!i&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;!i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;k&nbsp;=&nbsp;ref&nbsp;!i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!k&nbsp;&lt;&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;foa_invertibility&nbsp;w.(!k).(!i)&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!k&nbsp;;&nbsp;k&nbsp;:=&nbsp;r&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;k&nbsp;:=&nbsp;!k&nbsp;+&nbsp;1&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;!i&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;auxil&nbsp;=&nbsp;w.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(!i)&nbsp;&lt;-&nbsp;w.(!index)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(!index)&nbsp;&lt;-&nbsp;auxil&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;element&nbsp;=&nbsp;ref&nbsp;w.(!i).(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;foa_invertibility&nbsp;!element&nbsp;)&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;!accu&nbsp;*.&nbsp;(&nbsp;foa_abs_det&nbsp;!element&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;foa_inv&nbsp;!element&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;other_partial_foa_right_twisted_prod&nbsp;ii&nbsp;cc&nbsp;coefficient&nbsp;w.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;ii&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;w.(j).(!i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(j)&nbsp;&lt;-&nbsp;partial_foa_minus&nbsp;ii&nbsp;cc&nbsp;w.(j)&nbsp;(&nbsp;partial_foa_left_twisted_prod&nbsp;ii&nbsp;cc&nbsp;coeff&nbsp;row&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;ii<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;r&nbsp;;&nbsp;accu&nbsp;:=&nbsp;0.&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!accu&nbsp;&lt;&gt;&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!accu&nbsp;*.&nbsp;(&nbsp;foa_abs_det&nbsp;w.(rr).(rr)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;0.<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_left_quotient matrix1 matrix2</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;matrix_foa_left_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(q:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_scal_mult&nbsp;(&nbsp;1.&nbsp;/.&nbsp;x&nbsp;)&nbsp;q<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;matrix_float_left_quotient&nbsp;w&nbsp;(matrix_float_demakeup&nbsp;q)&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;p&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;q&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ii&nbsp;=&nbsp;i&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;k&nbsp;=&nbsp;ref&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!k&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(foa_invertibility&nbsp;w.(!k).(i)&nbsp;=&nbsp;<span class="keyword">true</span>)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!k&nbsp;;&nbsp;k&nbsp;:=&nbsp;r&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;k&nbsp;:=&nbsp;!k&nbsp;+&nbsp;1&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;i&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;auxil&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;aux&nbsp;=&nbsp;p.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;w.(&nbsp;!index&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(&nbsp;!index&nbsp;)&nbsp;&lt;-&nbsp;auxil&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.(i)&nbsp;&lt;-&nbsp;p.(&nbsp;!index&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.(&nbsp;!index&nbsp;)&nbsp;&lt;-&nbsp;aux<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;bloc&nbsp;=&nbsp;w.(i).(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;not&nbsp;(&nbsp;foa_invertibility&nbsp;bloc&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Block&nbsp;non&nbsp;invertible&nbsp;in&nbsp;Matrix.matrix_foa_left_quotient."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;foa_inv&nbsp;bloc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;(<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_twisted_prod&nbsp;(foa_transpose&nbsp;x)&nbsp;coefficient)&nbsp;p.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row&nbsp;=&nbsp;other_partial_foa_right_twisted_prod&nbsp;ii&nbsp;cc&nbsp;coefficient&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;ii&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Pay attention to order: attention à l'ordre *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;w.(j).(i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.(j)&nbsp;&lt;-&nbsp;line_foa_minus&nbsp;p.(j)&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_foa_twisted_prod&nbsp;coeff)&nbsp;ligne&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(j)&nbsp;&lt;-&nbsp;partial_foa_minus&nbsp;ii&nbsp;cc&nbsp;w.(j)&nbsp;(&nbsp;partial_foa_left_twisted_prod&nbsp;ii&nbsp;cc&nbsp;coeff&nbsp;row&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(i)&nbsp;&lt;-&nbsp;coefficient&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;bloc&nbsp;=&nbsp;w.(rr).(rr)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;not&nbsp;(&nbsp;foa_invertibility&nbsp;bloc&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Last&nbsp;block&nbsp;non&nbsp;invertible&nbsp;in&nbsp;Matrix.matrix_foa_left_quotient."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(rr)&nbsp;&lt;-&nbsp;foa_inv&nbsp;bloc&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;rr&nbsp;<span class="keyword">downto</span>&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;diagonale.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;iii&nbsp;=&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;(<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_twisted_prod&nbsp;(foa_transpose&nbsp;x)&nbsp;coefficient)&nbsp;p.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;iii&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Pay attention to order: attention à l'ordre *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;w.(j).(i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.(j)&nbsp;&lt;-&nbsp;line_foa_minus&nbsp;p.(j)&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_foa_twisted_prod&nbsp;coeff)&nbsp;ligne&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foa_diag_left_mult&nbsp;(&nbsp;<span class="constructor">Foa_strip_cons</span>&nbsp;diagonale&nbsp;)&nbsp;(&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;p&nbsp;)<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line_foa_left_quotient matrix1 matrix_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;line_foa_left_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(q:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_foa_left_quotient&nbsp;m)&nbsp;q<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>foa_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">and</span>&nbsp;foa_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;m&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_cons</span>&nbsp;(&nbsp;1.&nbsp;/.&nbsp;x&nbsp;)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(float_inv&nbsp;w)<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;p&nbsp;=&nbsp;matrix_foa_demakeup&nbsp;(&nbsp;eye_foa&nbsp;m&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;w<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;numcolumns&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;diagonale&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;(<span class="constructor">Float_cons</span>&nbsp;0.)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ii&nbsp;=&nbsp;i&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;k&nbsp;=&nbsp;ref&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!k&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(foa_invertibility&nbsp;w.(!k).(i)&nbsp;=&nbsp;<span class="keyword">true</span>)&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;index&nbsp;:=&nbsp;!k&nbsp;;&nbsp;k&nbsp;:=&nbsp;r&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;k&nbsp;:=&nbsp;!k&nbsp;+&nbsp;1&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!index&nbsp;&lt;&gt;&nbsp;i&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;auxil&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;aux&nbsp;=&nbsp;p.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(i)&nbsp;&lt;-&nbsp;w.(&nbsp;!index&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(&nbsp;!index&nbsp;)&nbsp;&lt;-&nbsp;auxil&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.(i)&nbsp;&lt;-&nbsp;p.(&nbsp;!index&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.(&nbsp;!index&nbsp;)&nbsp;&lt;-&nbsp;aux<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;bloc&nbsp;=&nbsp;w.(i).(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;not&nbsp;(&nbsp;foa_invertibility&nbsp;bloc&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Block&nbsp;non&nbsp;invertible&nbsp;in&nbsp;Matrix.foa_inv."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;foa_inv&nbsp;bloc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;(<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_twisted_prod&nbsp;(foa_transpose&nbsp;x)&nbsp;coefficient)&nbsp;p.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row&nbsp;=&nbsp;other_partial_foa_right_twisted_prod&nbsp;ii&nbsp;cc&nbsp;coefficient&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;ii&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Pay attention to order: attention à l'ordre *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;w.(j).(i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.(j)&nbsp;&lt;-&nbsp;line_foa_minus&nbsp;p.(j)&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_foa_twisted_prod&nbsp;coeff)&nbsp;ligne&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(j)&nbsp;&lt;-&nbsp;partial_foa_minus&nbsp;ii&nbsp;cc&nbsp;w.(j)&nbsp;(&nbsp;partial_foa_left_twisted_prod&nbsp;ii&nbsp;cc&nbsp;coeff&nbsp;row&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(i)&nbsp;&lt;-&nbsp;coefficient&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;bloc&nbsp;=&nbsp;w.(rr).(rr)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;not&nbsp;(&nbsp;foa_invertibility&nbsp;bloc&nbsp;)&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Last&nbsp;block&nbsp;non&nbsp;invertible&nbsp;in&nbsp;Matrix.foa_inv."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diagonale.(rr)&nbsp;&lt;-&nbsp;foa_inv&nbsp;bloc&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;rr&nbsp;<span class="keyword">downto</span>&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coefficient&nbsp;=&nbsp;diagonale.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;iii&nbsp;=&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ligne&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;(<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;matrix_foa_twisted_prod&nbsp;(foa_transpose&nbsp;x)&nbsp;coefficient)&nbsp;p.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;iii&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** Pay attention to order: attention à l'ordre *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;w.(j).(i)&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.(j)&nbsp;&lt;-&nbsp;line_foa_minus&nbsp;p.(j)&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_foa_twisted_prod&nbsp;coeff)&nbsp;ligne&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foa_diag_left_mult&nbsp;(&nbsp;<span class="constructor">Foa_strip_cons</span>&nbsp;diagonale&nbsp;)&nbsp;(&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;p&nbsp;)&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** Fin des six définitions mutuellement récursives.
<p>

End of the six mutually recursive definitions. *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_foa_right_quotient matrix1 matrix2</pre> This gives matrix2 * (matrix1) ^ -1.
<p>

Ceci retourne matrix2 * (matrix1) ^ -1. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_foa_right_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(q:float_or_array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;foa_transpose&nbsp;(&nbsp;matrix_foa_left_quotient&nbsp;(foa_transpose&nbsp;m)&nbsp;(foa_transpose&nbsp;q)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line_foa_right_quotient matrix1 matrix_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;line_foa_right_quotient&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float_or_array)&nbsp;(q:float_or_array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(matrix_foa_right_quotient&nbsp;m)&nbsp;q&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="2_ExprimentationspardcoupagedesmatricesplatesExperimentationswithcuttingofflatmatrices"><h2><center>Expérimentations par découpage des matrices plates
---
Experimentations with cutting of flat matrices</center> </h2></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>special_exponent size</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;special_exponent&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;r&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;1.&nbsp;/.&nbsp;(&nbsp;max&nbsp;1.&nbsp;(log&nbsp;r)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;0.45&nbsp;*.&nbsp;s&nbsp;+.&nbsp;(1.&nbsp;-.&nbsp;s)&nbsp;*.&nbsp;1.29&nbsp;/.&nbsp;(&nbsp;max&nbsp;2.&nbsp;(log10&nbsp;r)&nbsp;)&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>square_float_slow_inv base matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;square_float_slow_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;b&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;debut&nbsp;=&nbsp;(&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|0.;0.|]&nbsp;|]&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;square_foa_hash&nbsp;b&nbsp;(<span class="constructor">Float_matrix_cons</span>&nbsp;m)&nbsp;debut&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;foa_slow_inv&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmmm&nbsp;=&nbsp;square_foa_crash&nbsp;[|&nbsp;mmm&nbsp;;&nbsp;mm.(1)&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_demakeup&nbsp;mmmm.(0)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>exp_float_slow_inv base matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;exp_float_slow_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;b&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;debut&nbsp;=&nbsp;(&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|0.;0.|]&nbsp;|]&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;exp_foa_hash&nbsp;b&nbsp;(<span class="constructor">Float_matrix_cons</span>&nbsp;m)&nbsp;debut&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;foa_slow_inv&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmmm&nbsp;=&nbsp;square_foa_crash&nbsp;[|&nbsp;mmm&nbsp;;&nbsp;mm.(1)&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_demakeup&nbsp;mmmm.(0)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sqrt_float_slow_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sqrt_float_slow_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;10&nbsp;+&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;sqrt&nbsp;(&nbsp;float&nbsp;(numrows&nbsp;m)&nbsp;)&nbsp;)&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;(&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|0.;0.|]&nbsp;|]&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;square_foa_hash&nbsp;b&nbsp;(<span class="constructor">Float_matrix_cons</span>&nbsp;m)&nbsp;debut&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;foa_slow_inv&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmmm&nbsp;=&nbsp;square_foa_crash&nbsp;[|&nbsp;mmm&nbsp;;&nbsp;mm.(1)&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_demakeup&nbsp;mmmm.(0)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>alpha_float_slow_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;alpha_float_slow_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;float&nbsp;(numrows&nbsp;m)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;alpha&nbsp;=&nbsp;special_exponent&nbsp;r<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;seuil&nbsp;=&nbsp;10.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;seuil&nbsp;*.&nbsp;(&nbsp;r&nbsp;/.&nbsp;seuil&nbsp;)&nbsp;**&nbsp;alpha&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;(&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|0.;0.|]&nbsp;|]&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;exp_foa_hash&nbsp;b&nbsp;(<span class="constructor">Float_matrix_cons</span>&nbsp;m)&nbsp;debut&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;foa_slow_inv&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmmm&nbsp;=&nbsp;square_foa_crash&nbsp;[|&nbsp;mmm&nbsp;;&nbsp;mm.(1)&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_demakeup&nbsp;mmmm.(0)&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>square_float_inv base matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;square_float_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;b&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;debut&nbsp;=&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|0.;0.|]&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;square_foa_hash&nbsp;b&nbsp;(<span class="constructor">Float_matrix_cons</span>&nbsp;m)&nbsp;debut&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;foa_inv&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmmm&nbsp;=&nbsp;square_foa_crash&nbsp;[|&nbsp;mmm&nbsp;;&nbsp;mm.(1)&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_demakeup&nbsp;mmmm.(0)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>exp_float_inv base matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;exp_float_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;b&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;debut&nbsp;=&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|0.;0.|]&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;exp_foa_hash&nbsp;b&nbsp;(<span class="constructor">Float_matrix_cons</span>&nbsp;m)&nbsp;debut&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;foa_inv&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmmm&nbsp;=&nbsp;square_foa_crash&nbsp;[|&nbsp;mmm&nbsp;;&nbsp;mm.(1)&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_demakeup&nbsp;mmmm.(0)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sqrt_float_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sqrt_float_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;10&nbsp;+&nbsp;int_of_float&nbsp;(&nbsp;ceil&nbsp;(&nbsp;sqrt&nbsp;(&nbsp;float&nbsp;(numrows&nbsp;m)&nbsp;)&nbsp;)&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|0.;0.|]&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;square_foa_hash&nbsp;b&nbsp;(<span class="constructor">Float_matrix_cons</span>&nbsp;m)&nbsp;debut&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;foa_inv&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmmm&nbsp;=&nbsp;square_foa_crash&nbsp;[|&nbsp;mmm&nbsp;;&nbsp;mm.(1)&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_demakeup&nbsp;mmmm.(0)&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>beta_float_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;beta_float_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;0.4&nbsp;*.&nbsp;sqrt&nbsp;(&nbsp;float&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_cut&nbsp;b&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;foa_inv&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_crash&nbsp;[|&nbsp;mmm&nbsp;;&nbsp;mm.(1)&nbsp;|]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gamma_float_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gamma_float_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** let b = int_of_float ( 0.4 *. sqrt ( float (Array.length m) ) ) in *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&lt;&nbsp;2000&nbsp;<span class="keyword">then</span>&nbsp;float_inv&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;(&nbsp;float&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;)&nbsp;/.&nbsp;70.&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_cut&nbsp;b&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;debut&nbsp;=&nbsp;[|&nbsp;<span class="constructor">Float_vector_cons</span>&nbsp;[|0.;0.|]&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;square_foa_hash&nbsp;8&nbsp;mm.(0)&nbsp;(&nbsp;<span class="constructor">Foa_vector_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.append&nbsp;(vector_foa_demakeup&nbsp;mm.(1))&nbsp;debut&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;foa_inv&nbsp;ww.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmmm&nbsp;=&nbsp;square_foa_crash&nbsp;[|&nbsp;mmm&nbsp;;&nbsp;ww.(1)&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_demakeup&nbsp;mmmm.(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>delta_float_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;delta_float_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&lt;&nbsp;1250&nbsp;<span class="keyword">then</span>&nbsp;float_inv&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** ordre = 1250 : réduction de l' exposant qui compense l'augmentation de C dans : &lt;&lt; temps ( n ) ~= C * ( n ** exposant ) &gt;&gt; *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;float&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;alpha&nbsp;=&nbsp;special_exponent&nbsp;rr&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;floor&nbsp;(&nbsp;rr&nbsp;**&nbsp;alpha&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_cut&nbsp;b&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;foa_inv&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_crash&nbsp;[|&nbsp;mmm&nbsp;;&nbsp;mm.(1)&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="1_FonctionsetconstructionssupplmentairesFurtherfunctionsandconstructions"><h1><center>Fonctions et constructions supplémentaires
---
Further functions and constructions</center> </h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>critical_order</pre> Order = 1250: reduction of the exponent which compensates
the augmentation of C in:
&lt;&lt; duration ( n ) ~= C * ( n ** exponent ) &gt;&gt;
<p>

Ordre = 1250 : réduction de l' exposant qui compense l'augmentation de C dans : 
&lt;&lt; temps ( n ) ~= C * ( n ** exposant ) &gt;&gt; *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;critical_order&nbsp;=&nbsp;1250&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>generic_float_inv matrix</pre> For big ordres, the matrix must be invertible by blocks. 
This is achieved for some matrices obtained from the random float generator of Ocaml.
<p>

Pour de grands ordres, la matrice doit être bloc-inversible.
C'est vérifié pour certaines matrices construites à partir du générateur aléatoire de réels d'Ocaml. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;generic_float_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&lt;&nbsp;critical_order&nbsp;<span class="keyword">then</span>&nbsp;float_inv&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;float&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;alpha&nbsp;=&nbsp;special_exponent&nbsp;rr&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;floor&nbsp;(&nbsp;rr&nbsp;**&nbsp;alpha&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_cut&nbsp;b&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;foa_inv&nbsp;mm.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_crash&nbsp;[|&nbsp;mmm&nbsp;;&nbsp;mm.(1)&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>generic_float_invertibility matrix</pre> For big ordres, the matrix must be invertible by blocks. 
This is achieved for some matrices obtained from the random float generator of Ocaml.
<p>

Pour de grands ordres, la matrice doit être bloc-inversible.
C'est vérifié pour certaines matrices construites à partir du générateur aléatoire de réels d'Ocaml. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;generic_float_invertibility&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&lt;&nbsp;critical_order&nbsp;<span class="keyword">then</span>&nbsp;float_invertibility&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;float&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;alpha&nbsp;=&nbsp;special_exponent&nbsp;rr&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;floor&nbsp;(&nbsp;rr&nbsp;**&nbsp;alpha&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_cut&nbsp;b&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foa_invertibility&nbsp;mm.(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>generic_float_invertibility_evaluation matrix</pre> For big ordres, the matrix must be invertible by blocks. 
This is achieved for some matrices obtained from the random float generator of Ocaml.
<p>

Pour de grands ordres, la matrice doit être bloc-inversible.
C'est vérifié pour certaines matrices construites à partir du générateur aléatoire de réels d'Ocaml. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;generic_float_invertibility_evaluation&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&lt;&nbsp;critical_order&nbsp;<span class="keyword">then</span>&nbsp;float_invertibility_evaluation&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;float&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;alpha&nbsp;=&nbsp;special_exponent&nbsp;rr&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;floor&nbsp;(&nbsp;rr&nbsp;**&nbsp;alpha&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_cut&nbsp;b&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foa_invertibility_evaluation&nbsp;mm.(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>generic_float_abs_det matrix</pre> For big ordres, the matrix must be invertible by blocks. 
This is achieved for some matrices obtained from the random float generator of Ocaml.
<p>

Pour de grands ordres, la matrice doit être bloc-inversible.
C'est vérifié pour certaines matrices construites à partir du générateur aléatoire de réels d'Ocaml. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;generic_float_abs_det&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;r&nbsp;&lt;&nbsp;critical_order&nbsp;<span class="keyword">then</span>&nbsp;abs_float&nbsp;(&nbsp;float_det&nbsp;m&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;float&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;alpha&nbsp;=&nbsp;special_exponent&nbsp;rr&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;floor&nbsp;(&nbsp;rr&nbsp;**&nbsp;alpha&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_cut&nbsp;b&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foa_abs_det&nbsp;mm.(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_bal_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;upper_trig_float_bal_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;float_sym&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_biased_float_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_biased_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;upper_trig_float_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;float_sym&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_signed_float_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_signed_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;sym_biased_float_random&nbsp;r&nbsp;x<br>
&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;matrix_float_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_float_twisted_prod&nbsp;(&nbsp;matrix_float_twisted_prod&nbsp;w&nbsp;m&nbsp;)&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_positive_float_random order rank range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_positive_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(rank:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;rank_float_matrix&nbsp;r&nbsp;r&nbsp;rank<br>
&nbsp;<span class="keyword">and</span>&nbsp;p&nbsp;=&nbsp;matrix_float_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_float_twisted_prod&nbsp;p&nbsp;(&nbsp;matrix_float_twisted_prod&nbsp;p&nbsp;j&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_positive_float_bal_random order rank range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_positive_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(rank:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;rank_float_matrix&nbsp;r&nbsp;r&nbsp;rank<br>
&nbsp;<span class="keyword">and</span>&nbsp;p&nbsp;=&nbsp;matrix_float_bal_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_float_twisted_prod&nbsp;p&nbsp;(&nbsp;matrix_float_twisted_prod&nbsp;p&nbsp;j&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antisym_biased_float_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antisym_biased_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;upper_nil_float_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;float_antisym&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antisym_float_bal_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antisym_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;upper_nil_float_bal_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;float_antisym&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>special_float_pseudo_random order approx_quadratic_range</pre> The result is in SL(n,R),
the lower right coefficient is always <code class="code">1.</code>.
<p>

Le résultat est dans SL(n,R), le coefficient en bas à droite est toujours <code class="code">1.</code>. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;special_float_pseudo_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;upper_unip_float_bal_random&nbsp;r&nbsp;r&nbsp;x<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;upper_unip_float_bal_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_float_twisted_prod&nbsp;a&nbsp;b&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>special_float_random order approx_quartic_range</pre> The result is in SL(n,R).
<p>

Le résultat est dans SL(n,R). *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;special_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;pred&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;special_float_pseudo_random&nbsp;r&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;vector_float_sign_random&nbsp;rr<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;d&nbsp;=&nbsp;vector_float_random&nbsp;rr&nbsp;2.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;special_float_pseudo_random&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;<span class="constructor">Random</span>.int&nbsp;rr<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ddd&nbsp;=&nbsp;vector_float_coeff_prod&nbsp;s&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dd&nbsp;=&nbsp;<span class="constructor">Array</span>.append&nbsp;(&nbsp;<span class="constructor">Array</span>.append&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;ddd&nbsp;0&nbsp;i&nbsp;)&nbsp;[|&nbsp;1.&nbsp;/.&nbsp;(&nbsp;vector_float_contraction&nbsp;ddd&nbsp;)&nbsp;|]&nbsp;)&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;ddd&nbsp;i&nbsp;(&nbsp;rr&nbsp;-&nbsp;i&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_twisted_prod&nbsp;a&nbsp;(&nbsp;float_diag_left_mult&nbsp;dd&nbsp;b&nbsp;)&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_int_bal_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_int_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;upper_trig_int_bal_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;int_sym&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_biased_int_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_biased_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;upper_trig_int_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;int_sym&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_signed_int_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_signed_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;sym_biased_int_random&nbsp;r&nbsp;x<br>
&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;matrix_int_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_int_twisted_prod&nbsp;(&nbsp;matrix_int_twisted_prod&nbsp;w&nbsp;m&nbsp;)&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_positive_int_random order rank range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_positive_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(rank:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;rank_int_matrix&nbsp;r&nbsp;r&nbsp;rank<br>
&nbsp;<span class="keyword">and</span>&nbsp;p&nbsp;=&nbsp;matrix_int_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_int_twisted_prod&nbsp;p&nbsp;(&nbsp;matrix_int_twisted_prod&nbsp;p&nbsp;j&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_positive_int_bal_random order rank range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_positive_int_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(rank:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;rank_int_matrix&nbsp;r&nbsp;r&nbsp;rank<br>
&nbsp;<span class="keyword">and</span>&nbsp;p&nbsp;=&nbsp;matrix_int_bal_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_int_twisted_prod&nbsp;p&nbsp;(&nbsp;matrix_int_twisted_prod&nbsp;p&nbsp;j&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antisym_biased_int_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antisym_biased_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;upper_nil_int_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;int_antisym&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>antisym_int_bal_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;antisym_int_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;upper_nil_int_bal_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;int_antisym&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>special_int_pseudo_random order approx_quadratic_range</pre> The result is in SL(n,Z),
the lower right coefficient is always <code class="code">1</code>.
<p>

Le résultat est dans SL(n,Z), le coefficient en bas à droite est toujours <code class="code">1</code>. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;special_int_pseudo_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;upper_unip_int_bal_random&nbsp;r&nbsp;r&nbsp;2<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;upper_unip_int_bal_random&nbsp;r&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_int_twisted_prod&nbsp;a&nbsp;b&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>special_int_random order approx_quartic_range</pre> The result is in SL(n,Z).
<p>

Le résultat est dans SL(n,Z). *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;special_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;special_int_pseudo_random&nbsp;r&nbsp;x<br>
&nbsp;<span class="keyword">and</span>&nbsp;d&nbsp;=&nbsp;vector_int_sign_random&nbsp;(&nbsp;pred&nbsp;r&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;special_int_pseudo_random&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dd&nbsp;=&nbsp;<span class="constructor">Array</span>.append&nbsp;d&nbsp;[|&nbsp;vector_int_contraction&nbsp;d&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;matrix_int_twisted_prod&nbsp;a&nbsp;(&nbsp;int_diag_left_mult&nbsp;dd&nbsp;b&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>invertible_int_random order approx_quartic_range</pre> The result is in GL(n,Z).
<p>

Le résultat est dans GL(n,Z).*)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;invertible_int_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;special_int_pseudo_random&nbsp;r&nbsp;x<br>
&nbsp;<span class="keyword">and</span>&nbsp;d&nbsp;=&nbsp;vector_int_sign_random&nbsp;r<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;special_int_pseudo_random&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_int_twisted_prod&nbsp;a&nbsp;(&nbsp;int_diag_left_mult&nbsp;d&nbsp;b&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gen_sympl_float half_dimension</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gen_sympl_float&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(n:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;null_float&nbsp;n&nbsp;n&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;u&nbsp;=&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;identity_float&nbsp;n&nbsp;n&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;uu&nbsp;=&nbsp;<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;scal_float&nbsp;n&nbsp;n&nbsp;(-1.)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;matrix_float_demakeup&nbsp;(&nbsp;matrix_foa_paste&nbsp;(&nbsp;<span class="constructor">Foa_matrix_cons</span>&nbsp;[|&nbsp;[|&nbsp;z&nbsp;;&nbsp;uu&nbsp;|]&nbsp;;&nbsp;[|&nbsp;u&nbsp;;&nbsp;z&nbsp;|]&nbsp;|]&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gen_sympl_int half-dimension</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gen_sympl_int&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(n:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;null_int&nbsp;n&nbsp;n&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;u&nbsp;=&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;identity_int&nbsp;n&nbsp;n&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;uu&nbsp;=&nbsp;<span class="constructor">Int_matrix_cons</span>&nbsp;(&nbsp;scal_int&nbsp;n&nbsp;n&nbsp;(-1)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;matrix_int_demakeup&nbsp;(&nbsp;matrix_ioa_paste&nbsp;(&nbsp;<span class="constructor">Ioa_matrix_cons</span>&nbsp;[|&nbsp;[|&nbsp;z&nbsp;;&nbsp;uu&nbsp;|]&nbsp;;&nbsp;[|&nbsp;u&nbsp;;&nbsp;z&nbsp;|]&nbsp;|]&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_companion vector</pre> The vector contains the coefficients of a unitary polynomial 
(except the principal).
<p>

Le vecteur contient les coefficients d'un polynome unitaire (sauf le principal). *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_companion&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;m&nbsp;=&nbsp;matrix_float_nil&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(rr)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;-.&nbsp;v.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;float_transpose&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_companion vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_companion&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;m&nbsp;=&nbsp;matrix_int_nil&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(rr)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;-&nbsp;v.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;int_transpose&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ortho_float_antisym matrix</pre> The input matrix is supposed to be antisymmetric.
<p>

La matrice entrante est supposée antisymétrique. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ortho_float_antisym&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(a:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;eye_float&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;matrix_float_plus&nbsp;i&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;float_approx_inv&nbsp;matrix_float_norm_inf&nbsp;float_inv&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_minus&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;2.&nbsp;c.(0)&nbsp;)&nbsp;i&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>generic_ortho_float_antisym matrix</pre> The input matrix is supposed to be antisymmetric.
<p>

La matrice entrante est supposée antisymétrique. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;generic_ortho_float_antisym&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(a:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;eye_float&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;matrix_float_plus&nbsp;i&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;float_approx_inv&nbsp;matrix_float_norm_inf&nbsp;generic_float_inv&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_minus&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;2.&nbsp;c.(0)&nbsp;)&nbsp;i&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ortho_biased_float_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ortho_biased_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;antisym_biased_float_random&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;generic_ortho_float_antisym&nbsp;a&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ortho_float_bal_random order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ortho_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;antisym_float_bal_random&nbsp;r&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;generic_ortho_float_antisym&nbsp;a&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sympl_float_sym matrix</pre> The input matrix is supposed to be symmetric.
<p>

La matrice entrante est supposée symétrique. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sympl_float_sym&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(a:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;eye_float&nbsp;a<br>
&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;gen_sympl_float&nbsp;(&nbsp;l&nbsp;/&nbsp;2&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;matrix_float_prod&nbsp;a&nbsp;j&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;matrix_float_plus&nbsp;i&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;float_approx_inv&nbsp;matrix_float_norm_inf&nbsp;float_inv&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_minus&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;2.&nbsp;d.(0)&nbsp;)&nbsp;i&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sympl_biased_float_random half-order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sympl_biased_float_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;sym_biased_float_random&nbsp;(&nbsp;2&nbsp;*&nbsp;r&nbsp;)&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;eye_float&nbsp;a<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;gen_sympl_float&nbsp;(&nbsp;l&nbsp;/&nbsp;2&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;matrix_float_prod&nbsp;a&nbsp;j&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;matrix_float_plus&nbsp;i&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;float_approx_inv&nbsp;matrix_float_norm_inf&nbsp;generic_float_inv&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_minus&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;2.&nbsp;d.(0)&nbsp;)&nbsp;i&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sympl_float_bal_random half-order range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sympl_float_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;sym_float_bal_random&nbsp;(&nbsp;2&nbsp;*&nbsp;r&nbsp;)&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;eye_float&nbsp;a<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;gen_sympl_float&nbsp;(&nbsp;l&nbsp;/&nbsp;2&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;matrix_float_prod&nbsp;a&nbsp;j&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;matrix_float_plus&nbsp;i&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;float_approx_inv&nbsp;matrix_float_norm_inf&nbsp;generic_float_inv&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_minus&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;2.&nbsp;d.(0)&nbsp;)&nbsp;i&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>givens_matrix order first_index second_index angle</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;givens_matrix&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(i:int)&nbsp;(j:int)&nbsp;(t:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;identity_float&nbsp;r&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;i&nbsp;&lt;&nbsp;j&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;j&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne&nbsp;=&nbsp;w.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;cos&nbsp;t<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;sin&nbsp;t&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;c&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;-.&nbsp;s&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ligne.(i)&nbsp;&lt;-&nbsp;s&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ligne.(j)&nbsp;&lt;-&nbsp;c&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;j&nbsp;&lt;&nbsp;i&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;i&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ligne&nbsp;=&nbsp;w.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;cos&nbsp;t<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;sin&nbsp;t&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(i)&nbsp;&lt;-&nbsp;c&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;s&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ligne.(i)&nbsp;&lt;-&nbsp;-.&nbsp;s&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ligne.(j)&nbsp;&lt;-&nbsp;c&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>jacobi_step_angle threshold Mii Mjj Mij</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;jacobi_step_angle&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(threshold:float)&nbsp;(x:float)&nbsp;(y:float)&nbsp;(z:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;(&nbsp;x&nbsp;-.&nbsp;y&nbsp;)&nbsp;&lt;&nbsp;threshold&nbsp;<span class="keyword">then</span>&nbsp;atan&nbsp;1.<br>
&nbsp;<span class="keyword">else</span>&nbsp;0.5&nbsp;*.&nbsp;(&nbsp;atan2&nbsp;(&nbsp;y&nbsp;-.&nbsp;x&nbsp;)&nbsp;(&nbsp;2.&nbsp;*.&nbsp;z&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_classical_jacobi_step threshold matrix</pre> Output : the transformed matrix of the matrix <code class="code">m</code>, 
the left factor of the previous triple product, the right factor of the triple product.
<p>

Input : threshold for <code class="code">jacobi_step_angle</code>, symmetric matrix.
<p>

Entrée : seuil pour <code class="code">jacobi_step_angle</code>, matrice symétrique.
<p>

Sortie : la matrice transformée de la matrice <code class="code">m</code>, le facteur de gauche du triple produit précédent, le facteur de droite du triple produit. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_classical_jacobi_step&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(threshold:float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_abs&nbsp;(&nbsp;matrix_float_non_diag_part&nbsp;m&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_float_copy&nbsp;m&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_max&nbsp;mm<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;ref&nbsp;(&nbsp;identity_float&nbsp;r&nbsp;r&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;gg&nbsp;=&nbsp;ref&nbsp;(&nbsp;identity_float&nbsp;r&nbsp;r&nbsp;)&nbsp;<span class="keyword">in</span><br>
</code><table><tr><td></td><td><span class="comment">(** Une recherche polymorphe fonctionne mieux qu'une recherche dans la catégorie <code class="code">float</code>,
probablement à cause de troncatures de mantisses : 
A polymorphic query operates better than a query inside the <code class="code">float</code> category, 
probably because of truncatures of mantissas. *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;index&nbsp;=&nbsp;matrix_float_find_first_last&nbsp;mmm&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;index.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;j&nbsp;=&nbsp;index.(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;i&nbsp;&lt;&gt;&nbsp;j&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ii&nbsp;=&nbsp;min&nbsp;i&nbsp;j<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;jj&nbsp;=&nbsp;max&nbsp;i&nbsp;j&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(ii)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;t&nbsp;=&nbsp;jacobi_step_angle&nbsp;threshold&nbsp;row.(ii)&nbsp;m.(jj).(jj)&nbsp;row.(jj)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;:=&nbsp;givens_matrix&nbsp;r&nbsp;ii&nbsp;jj&nbsp;t&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gg&nbsp;:=&nbsp;givens_matrix&nbsp;r&nbsp;ii&nbsp;jj&nbsp;(&nbsp;-.&nbsp;t&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;:=&nbsp;matrix_float_triple_prod&nbsp;!gg&nbsp;m&nbsp;!g<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;!w&nbsp;;&nbsp;!gg&nbsp;;&nbsp;!g&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_classical_jacobi_reduc step_threshold elasticity diag_threshold max_steps matrix</pre> 
Input : threshold for <code class="code">jacobi_step_angle</code>, elasticity to rule overshoot, threshold for non-diagonality norm, maximal number of steps, symmetric matrix.
<p>

Output : approximate eigenvalues, left orthogonal transformation whose rows 
are the approximate eigenvectors, final iteration close to the diagonal matrix, 
right orthogonal transformation whose columns are the approximate eigenvectors,
measure of non_diagonality.
<p>

The elasticity is supposed to be between 0 and 1. The more it gets closer to zero,
the more one allows the error to diagonality to climb up between two steps.
<p>

Entrée : seuil pour <code class="code">jacobi_step_angle</code>, élasticité pour réguler l'outrepassement, seuil pour la norme de non-diagonalité, nombre maximal de pas, matrice symétrique.
<p>

Sortie : valeurs propres approchées, changement de coordonnées isométrique gauche dont les lignes 
sont les vecteurs propres approchés, itération finale approchant la matrice diagonalisée, 
changement de coordonnées isométrique droit dont les colonnes sont les vecteurs propres approchés, 
écart à la diagonalité.
<p>

L'élasticité est censée être comprise entre 0 et 1. Plus on s'approche de zéro, 
plus on tolère une remontée de l'écart à la diagonalité entre deux pas. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_classical_jacobi_reduc&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(step_threshold:float)&nbsp;(elasticity:float)&nbsp;(diag_threshold:float)&nbsp;(s:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;measure&nbsp;=&nbsp;ref&nbsp;(&nbsp;matrix_float_non_diagonality&nbsp;matrix_float_square_frobenius&nbsp;m&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;old_measure&nbsp;=&nbsp;ref&nbsp;max_float<br>
&nbsp;<span class="keyword">and</span>&nbsp;steps&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;old_mm&nbsp;=&nbsp;ref&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;identity_float&nbsp;r&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;left&nbsp;=&nbsp;ref&nbsp;i<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;right&nbsp;=&nbsp;ref&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;(&nbsp;!measure&nbsp;&gt;&nbsp;diag_threshold&nbsp;)&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;(&nbsp;!old_measure&nbsp;&gt;&nbsp;elasticity&nbsp;*.&nbsp;!measure&nbsp;)&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;!steps&nbsp;&lt;&nbsp;s&nbsp;)&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;sym_float_classical_jacobi_step&nbsp;step_threshold&nbsp;!mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;old_mm&nbsp;:=&nbsp;!mm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;old_measure&nbsp;:=&nbsp;!measure&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;measure&nbsp;:=&nbsp;matrix_float_non_diagonality&nbsp;matrix_float_square_frobenius&nbsp;!mm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;elasticity&nbsp;*.&nbsp;!measure&nbsp;&lt;&nbsp;!old_measure&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left&nbsp;:=&nbsp;matrix_float_prod&nbsp;resultat.(1)&nbsp;!left&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right&nbsp;:=&nbsp;matrix_float_prod&nbsp;!right&nbsp;resultat.(2)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;steps&nbsp;:=&nbsp;!steps&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;!old_mm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;measure&nbsp;:=&nbsp;!old_measure&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;steps&nbsp;:=&nbsp;max_int&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;[|&nbsp;extract_diag&nbsp;!mm&nbsp;|]&nbsp;;&nbsp;!left&nbsp;;&nbsp;!mm&nbsp;;&nbsp;!right&nbsp;;&nbsp;[|[|&nbsp;!measure&nbsp;|]|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_adapt matrix</pre> This is taken from the HP15C calulator's high level mathematical functions manual.
<p>

WARNING : THE SPECIFICATIONS FOR THIS ALGORITHM ARE UNKNOWN TO US.
CERTAIN SYMMETRIC MATRICES MAY PREVENT THIS ALGORITHM TO START: FOR EXAMPLE <code class="code">[| [| 1. ; 1. |] ; [| 1. ; 1. |] |]</code>.
<p>

The matrix obtained through orthogonal transformation should be closer to a diagonal matrix.
<p>

Output : the transformed matrix of the matrix <code class="code">m</code>, the left factor of the previous triple product, the right factor of the triple product.
<p>

La matrice obtenue par changement de coordonnées isométrique est censée se rapprocher d'une matrice diagonale.
<p>

AVERTISSEMENT : LES SPÉCIFICATIONS POUR CET ALGORITHME NOUS SONT INCONNUES.
CERTAINES MATRICES SYMÉTRIQUES PEUVENT EMPÊCHER CET ALGORITHME DE DÉMARRER : PAR EXEMPLE <code class="code">[| [| 1. ; 1. |] ; [| 1. ; 1. |] |]</code>.
<p>

Ceci provient du manuel des fonctions mathématiques de haut niveau de la calculette HP15C. 
<p>

Sortie : la matrice transformée de la matrice <code class="code">m</code>, le facteur de gauche du triple produit précédent, le facteur de droite du triple produit.*)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_adapt&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;r&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;d&nbsp;=&nbsp;extract_diag&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;a.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;aa&nbsp;=&nbsp;d.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;i&nbsp;&lt;&gt;&nbsp;j&nbsp;)&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;row_input.(j)&nbsp;&lt;&gt;&nbsp;0.&nbsp;)&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;angle&nbsp;=&nbsp;2.&nbsp;*.&nbsp;row_input.(j)&nbsp;/.&nbsp;(&nbsp;aa&nbsp;-.&nbsp;d.(j)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;tan&nbsp;(&nbsp;(atan&nbsp;angle)&nbsp;/.&nbsp;4.&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;float_antisym&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;q&nbsp;=&nbsp;ortho_float_antisym&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;qq&nbsp;=&nbsp;float_transpose&nbsp;q&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;matrix_float_triple_prod&nbsp;qq&nbsp;m&nbsp;q&nbsp;;&nbsp;qq&nbsp;;&nbsp;q&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_reduc threshold max_steps matrix</pre> This is taken from the HP15C calulator's high level mathematical functions manual.
<p>

WARNING : THE SPECIFICATIONS FOR THIS ALGORITHM ARE UNKNOWN TO US.
CERTAIN SYMMETRIC MATRICES MAY PREVENT THIS ALGORITHM TO START: FOR EXAMPLE <code class="code">[| [| 1. ; 1. |] ; [| 1. ; 1. |] |]</code>.
<p>

Input : threshold for non-diagonality norm, maximal number of steps, symmetric matrix.
<p>

Output : approximate eigenvalues, left orthogonal transformation whose rows 
are the approximate eigenvectors, final iteration close to the diagonal matrix, 
right orthogonal transformation whose columns are the approximate eigenvectors,
measure of non_diagonality.
<p>

A threshold equal to <code class="code"> sqrt ( epsilon_float ) </code> is good for small orders.
A bigger threshold is recommended for big orders.
<p>

AVERTISSEMENT : LES SPÉCIFICATIONS POUR CET ALGORITHME NOUS SONT INCONNUES.
CERTAINES MATRICES SYMÉTRIQUES PEUVENT EMPÊCHER CET ALGORITHME DE DÉMARRER : PAR EXEMPLE <code class="code">[| [| 1. ; 1. |] ; [| 1. ; 1. |] |]</code>.
<p>

Entrée : seuil pour la norme de non-diagonalité, nombre maximal de pas, matrice symétrique.
<p>

Sortie : valeurs propres approchées, changement de coordonnées isométrique gauche dont les lignes 
sont les vecteurs propres approchés, itération finale approchant la matrice diagonalisée, 
changement de coordonnées isométrique droit dont les colonnes sont les vecteurs propres approchés, 
écart à la diagonalité.
<p>

Un seuil égal à <code class="code"> sqrt ( epsilon_float ) </code> convient aux petits ordres.
Augmenter le seuil pour les grands ordres.
<p>

Ceci provient du manuel des fonctions mathématiques de haut niveau de la calculette HP15C. 
Certaines matrices symétriques peuvent mettre cet algorithme en échec :
utiliser sym_float_tune_reduc à la place.
*)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_reduc&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(threshold:float)&nbsp;(s:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;measure&nbsp;=&nbsp;ref&nbsp;max_float<br>
&nbsp;<span class="keyword">and</span>&nbsp;steps&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;identity_float&nbsp;r&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;left&nbsp;=&nbsp;ref&nbsp;i<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;right&nbsp;=&nbsp;ref&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;(&nbsp;!measure&nbsp;&gt;&nbsp;threshold&nbsp;)&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;!steps&nbsp;&lt;&nbsp;s&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;sym_float_adapt&nbsp;!mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left&nbsp;:=&nbsp;matrix_float_prod&nbsp;resultat.(1)&nbsp;!left&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right&nbsp;:=&nbsp;matrix_float_prod&nbsp;!right&nbsp;resultat.(2)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;measure&nbsp;:=&nbsp;matrix_float_non_diagonality&nbsp;matrix_float_norm_inf&nbsp;!mm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;steps&nbsp;:=&nbsp;!steps&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;[|&nbsp;extract_diag&nbsp;!mm&nbsp;|]&nbsp;;&nbsp;!left&nbsp;;&nbsp;!mm&nbsp;;&nbsp;!right&nbsp;;&nbsp;[|[|&nbsp;!measure&nbsp;|]|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_tune_reduc threshold max_steps matrix</pre> This may give better results than <code class="code">sym_float_reduc</code>.
<p>

WARNING : THE SPECIFICATIONS FOR THIS ALGORITHM ARE UNKNOWN TO US.
WE DO NOT KNOW FOR WHICH SYMMETRIC MATRIX THE ALGORITHM STARTS.
<p>

The input and output have the same form as for <code class="code">sym_float_reduc</code>.
<p>

Les résultats peuvent être meilleurs qu'avec <code class="code">sym_float_reduc</code>.
<p>

AVERTISSEMENT : LES SPÉCIFICATIONS POUR CET ALGORITHME NOUS SONT INCONNUES.
NOUS NE SAVONS PAS POUR QUELLES MATRICES SYMÉTRIQUES CET ALGORITHME DÉMARRE.
<p>

Les entrée et sortie ont la même forme que pour <code class="code">sym_float_reduc</code>. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_tune_reduc&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(threshold:float)&nbsp;(s:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;g&nbsp;=&nbsp;ortho_float_bal_random&nbsp;(<span class="constructor">Array</span>.length&nbsp;m)&nbsp;0.1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;gg&nbsp;=&nbsp;float_transpose&nbsp;g&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_prod&nbsp;gg&nbsp;(&nbsp;matrix_float_prod&nbsp;m&nbsp;g&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;sym_float_reduc&nbsp;threshold&nbsp;s&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;q&nbsp;=&nbsp;matrix_float_prod&nbsp;g&nbsp;result.(3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;qq&nbsp;=&nbsp;matrix_float_prod&nbsp;result.(1)&nbsp;gg&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;result.(0)&nbsp;;&nbsp;qq&nbsp;;&nbsp;result.(2)&nbsp;;&nbsp;q&nbsp;;&nbsp;result.(4)&nbsp;|]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_sort_reduc methode matrix</pre> The eigenvalues are sorted in increasing order.
<p>

The reduction method <code class="code">methode</code> must be stated with all its parameters.
<p>

Output : approximate eigenvalues, left orthogonal transformation whose rows 
are the approximate eigenvectors, final iteration close to the diagonal matrix, 
right orthogonal transformation whose columns are the approximate eigenvectors,
measure of non_diagonality.
<p>

Les valeurs propres sont triées dans l'ordre croissant.
<p>

La méthode de réduction <code class="code">methode</code> doit être précisée avec tous ses paramètres.
<p>

Sortie : valeurs propres approchées, changement de coordonnées isométrique gauche dont les lignes 
sont les vecteurs propres approchés, itération finale approchant la matrice diagonalisée, 
changement de coordonnées isométrique droit dont les colonnes sont les vecteurs propres approchés, 
écart à la diagonalité. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_sort_reduc&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;methode&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;r.(0).(0)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;left&nbsp;=&nbsp;ref&nbsp;r.(1)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;right&nbsp;=&nbsp;ref&nbsp;r.(3)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;index&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;l&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dd&nbsp;=&nbsp;vector_float_copy&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.fast_sort&nbsp;compare&nbsp;dd&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;vector_float_find_first&nbsp;dd.(i)&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.(j)&nbsp;&lt;-&nbsp;max_float&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index.(i)&nbsp;&lt;-&nbsp;j&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right&nbsp;:=&nbsp;exchange_column&nbsp;i&nbsp;j&nbsp;!right&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left&nbsp;:=&nbsp;exchange_row&nbsp;i&nbsp;j&nbsp;!left&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;matrix_float_triple_prod&nbsp;!left&nbsp;m&nbsp;!right&nbsp;<span class="keyword">in</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;measure&nbsp;=&nbsp;matrix_float_non_diagonality&nbsp;matrix_float_norm_inf&nbsp;result&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;[|&nbsp;dd&nbsp;|]&nbsp;;&nbsp;!left&nbsp;;&nbsp;result&nbsp;;&nbsp;!right&nbsp;;&nbsp;[|[|&nbsp;measure&nbsp;|]|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_trans_orthonormalize matrix</pre> The rows of the matrix form the basis of the subspace in question.
<p>

Les lignes de la matrices forment la base du sous-espace considéré. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_trans_orthonormalize&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;init&nbsp;=&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;init<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;accu&nbsp;=&nbsp;matrix_float_copy&nbsp;m<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;result.(0)&nbsp;&lt;-&nbsp;vector_float_scal_left_div&nbsp;(&nbsp;vector_float_norm_2&nbsp;init&nbsp;)&nbsp;init&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;ref&nbsp;accu.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;ii&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;i&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;(&nbsp;vector_float_scal_prod&nbsp;!row&nbsp;result.(ii)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row&nbsp;:=&nbsp;vector_float_minus&nbsp;!row&nbsp;(&nbsp;vector_float_scal_mult&nbsp;x&nbsp;result.(ii)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.(i)&nbsp;&lt;-&nbsp;vector_float_scal_left_div&nbsp;(&nbsp;vector_float_norm_2&nbsp;!row)&nbsp;!row<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_orthonormalize matrix</pre> The columns of the matrix form the basis of the subspace in question.
<p>

Les colonnes de la matrices forment la base du sous-espace considéré. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_orthonormalize&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;float_transpose&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;float_transpose&nbsp;(&nbsp;float_trans_orthonormalize&nbsp;mm&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_indirect_reduc factor methode_reduc matrix</pre> 
Output : approximate eigenvalues, left orthogonal transformation whose rows 
are the approximate eigenvectors, final iteration close to the diagonal matrix, 
right orthogonal transformation whose columns are the approximate eigenvectors,
measure of non_diagonality.
<p>

Sortie : valeurs propres approchées, changement de coordonnées isométrique gauche dont les lignes 
sont les vecteurs propres approchés, itération finale approchant la matrice diagonalisée, 
changement de coordonnées isométrique droit dont les colonnes sont les vecteurs propres approchés, 
écart à la diagonalité. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_indirect_reduc&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;res&nbsp;=&nbsp;methode_reduc&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;p&nbsp;=&nbsp;res.(3)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;q&nbsp;=&nbsp;float_trans_orthonormalize&nbsp;p&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pp&nbsp;=&nbsp;float_transpose&nbsp;q&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;matrix_float_triple_prod&nbsp;pp&nbsp;m&nbsp;q&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;methode_reduc&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;result.(0)&nbsp;;&nbsp;matrix_float_prod&nbsp;pp&nbsp;result.(1)&nbsp;;&nbsp;result.(2)&nbsp;;&nbsp;matrix_float_prod&nbsp;result.(3)&nbsp;q&nbsp;;&nbsp;result.(4)&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_pca methode_reduc matrix</pre> The columns of the input matrix are the coordinates of the sample points.
The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; it must contain all the parameters.
Output : a two_rows matrix containing the isobarycentre and the eigenvalues, the left factor in the diagonalization, 
the right factor in the diagonalization, the measure of non diagonality.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres.
Les colonnes de la matrice entrante forment les coordonnées des points-échantillons.
Sortie : une matrice à deux lignes contenant l'isobarycentre et les valeurs propres, le facteur de gauche de la diagonalisation,
le facteur de droite de la diagonalisation, la mesure de non-diagonalité. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_pca&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;float&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;x.(0)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xbar&nbsp;=&nbsp;matrix_float_mean_by_row&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xxx&nbsp;=&nbsp;<span class="constructor">Array</span>.mapi&nbsp;(&nbsp;<span class="keyword">function</span>&nbsp;i&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_float_scal_left_sub&nbsp;xbar.(i)&nbsp;)&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;matrix_float_scal_left_div&nbsp;(&nbsp;sqrt&nbsp;cc&nbsp;)&nbsp;xxx&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;matrix_float_twisted_prod&nbsp;xx&nbsp;xx&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;zz&nbsp;=&nbsp;methode_reduc&nbsp;z&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;[|&nbsp;xbar&nbsp;;&nbsp;zz.(0).(0)&nbsp;|]&nbsp;;&nbsp;zz.(1)&nbsp;;&nbsp;zz.(2)&nbsp;;&nbsp;zz.(3)&nbsp;;&nbsp;zz.(4)&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_iterate steps matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_iterate&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;matrix_vector_float_prod&nbsp;x&nbsp;!y<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;&nbsp;(&nbsp;float_approx_inv&nbsp;matrix_float_norm_inf&nbsp;float_inv&nbsp;x&nbsp;).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;abs&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;matrix_vector_float_prod&nbsp;xx&nbsp;!y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!y&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_normalized_iterate norm steps matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_normalized_iterate&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;norm&nbsp;(s:int)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;power&nbsp;forbidden&nbsp;in&nbsp;Matrix.float_normalized_iterate."</span>&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_float_scal_left_div&nbsp;(&nbsp;norm&nbsp;v&nbsp;)&nbsp;v&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;ref&nbsp;!y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;=&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:=&nbsp;matrix_vector_float_prod&nbsp;x&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:=&nbsp;vector_float_scal_left_div&nbsp;(&nbsp;norm&nbsp;!z&nbsp;)&nbsp;!z&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;norm&nbsp;(&nbsp;vector_float_minus&nbsp;!z&nbsp;!y&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;i&nbsp;:=&nbsp;max_int<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;&nbsp;y&nbsp;:=&nbsp;!z&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!z&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_power steps matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;float_power&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;eye_float&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;s&nbsp;/&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;factor&nbsp;=&nbsp;float_power&nbsp;n&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;prod&nbsp;=&nbsp;matrix_float_prod&nbsp;factor&nbsp;factor&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;prod<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_prod&nbsp;prod&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;(&nbsp;float_approx_inv&nbsp;matrix_float_norm_inf&nbsp;float_inv&nbsp;x&nbsp;).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;float_power&nbsp;(&nbsp;abs&nbsp;s&nbsp;)&nbsp;xx<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_nilpotence_order norm threshold matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_nilpotence_order&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;norm&nbsp;(threshold:float)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;ref&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;norm&nbsp;x&nbsp;&gt;=&nbsp;threshold&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;factor&nbsp;=&nbsp;ref&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;exponent&nbsp;=&nbsp;ref&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!exponent&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;prod&nbsp;=&nbsp;matrix_float_prod&nbsp;!factor&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;norm&nbsp;prod&nbsp;&lt;&nbsp;threshold&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;s&nbsp;:=&nbsp;1.&nbsp;+.&nbsp;(&nbsp;float&nbsp;!exponent&nbsp;)&nbsp;;&nbsp;exponent&nbsp;:=&nbsp;max_int&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;factor&nbsp;:=&nbsp;prod&nbsp;;&nbsp;s&nbsp;:=&nbsp;infinity&nbsp;;&nbsp;exponent&nbsp;:=&nbsp;succ&nbsp;!exponent&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;!s&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>generic_float_iterate steps matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;generic_float_iterate&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;matrix_vector_float_prod&nbsp;x&nbsp;!y<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;&nbsp;(&nbsp;float_approx_inv&nbsp;matrix_float_norm_inf&nbsp;generic_float_inv&nbsp;x&nbsp;).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;abs&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;matrix_vector_float_prod&nbsp;xx&nbsp;!y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!y&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>generic_float_power steps matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;generic_float_power&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;eye_float&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;s&nbsp;/&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;factor&nbsp;=&nbsp;float_power&nbsp;n&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;prod&nbsp;=&nbsp;matrix_float_prod&nbsp;factor&nbsp;factor&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;prod<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_float_prod&nbsp;prod&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;(&nbsp;float_approx_inv&nbsp;matrix_float_norm_inf&nbsp;generic_float_inv&nbsp;x&nbsp;).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;float_power&nbsp;(&nbsp;abs&nbsp;s&nbsp;)&nbsp;xx<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_iterate steps matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_iterate&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int)&nbsp;(x:int&nbsp;array&nbsp;array)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;matrix_vector_int_prod&nbsp;x&nbsp;!y<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;int_inv&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;abs&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;matrix_vector_int_prod&nbsp;xx&nbsp;!y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!y&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_normalized_iterate norm steps matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_normalized_iterate&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;norm&nbsp;(s:int)&nbsp;(x:int&nbsp;array&nbsp;array)&nbsp;(v:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;power&nbsp;forbidden&nbsp;in&nbsp;Matrix.int_normalized_iterate."</span>&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_int_scal_left_div&nbsp;(&nbsp;norm&nbsp;v&nbsp;)&nbsp;v&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;ref&nbsp;!y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;=&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:=&nbsp;matrix_vector_int_prod&nbsp;x&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:=&nbsp;vector_int_scal_left_div&nbsp;(&nbsp;norm&nbsp;!z&nbsp;)&nbsp;!z&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;norm&nbsp;(&nbsp;vector_int_minus&nbsp;!z&nbsp;!y&nbsp;)&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;i&nbsp;:=&nbsp;max_int<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;&nbsp;y&nbsp;:=&nbsp;!z&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!z&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_power steps matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;int_power&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int)&nbsp;(x:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;eye_int&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;s&nbsp;/&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;factor&nbsp;=&nbsp;int_power&nbsp;n&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;prod&nbsp;=&nbsp;matrix_int_prod&nbsp;factor&nbsp;factor&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;prod<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;matrix_int_prod&nbsp;prod&nbsp;x<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;int_inv&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;int_power&nbsp;(&nbsp;abs&nbsp;s&nbsp;)&nbsp;xx<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_nilpotence_order threshold matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_nilpotence_order&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;ref&nbsp;1.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_int_norm_inf&nbsp;x&nbsp;&lt;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;factor&nbsp;=&nbsp;ref&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;exponent&nbsp;=&nbsp;ref&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!exponent&nbsp;&lt;&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;prod&nbsp;=&nbsp;matrix_int_prod&nbsp;!factor&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;matrix_int_norm_inf&nbsp;prod&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;s&nbsp;:=&nbsp;1.&nbsp;+.&nbsp;(&nbsp;float&nbsp;!exponent&nbsp;)&nbsp;;&nbsp;exponent&nbsp;:=&nbsp;max_int&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;factor&nbsp;:=&nbsp;prod&nbsp;;&nbsp;s&nbsp;:=&nbsp;infinity&nbsp;;&nbsp;exponent&nbsp;:=&nbsp;succ&nbsp;!exponent&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;!s&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_principal steps matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_principal&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_float_norm_inf&nbsp;v&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_float_scal_left_div&nbsp;!n&nbsp;v&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;matrix_vector_float_prod&nbsp;x&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;:=&nbsp;vector_float_norm_inf&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;!accu&nbsp;+.&nbsp;log&nbsp;!n&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;vector_float_scal_left_div&nbsp;!n&nbsp;!y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;!accu&nbsp;/.&nbsp;(&nbsp;float&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;&nbsp;(&nbsp;float_approx_inv&nbsp;matrix_float_norm_inf&nbsp;float_inv&nbsp;x&nbsp;).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;abs&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;matrix_vector_float_prod&nbsp;xx&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;:=&nbsp;vector_float_norm_inf&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;!accu&nbsp;+.&nbsp;log&nbsp;!n&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;vector_float_scal_left_div&nbsp;!n&nbsp;!y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;!accu&nbsp;/.&nbsp;(&nbsp;abs_float&nbsp;(&nbsp;float&nbsp;s&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;[|&nbsp;!accu&nbsp;|]&nbsp;;&nbsp;!y&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>generic_float_principal steps matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;generic_float_principal&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_float_norm_inf&nbsp;v&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_float_scal_left_div&nbsp;!n&nbsp;v&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;matrix_vector_float_prod&nbsp;x&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;:=&nbsp;vector_float_norm_inf&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;!accu&nbsp;+.&nbsp;log&nbsp;!n&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;vector_float_scal_left_div&nbsp;!n&nbsp;!y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;!accu&nbsp;/.&nbsp;(&nbsp;float&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;&nbsp;(&nbsp;float_approx_inv&nbsp;matrix_float_norm_inf&nbsp;generic_float_inv&nbsp;x&nbsp;).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;abs&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;matrix_vector_float_prod&nbsp;xx&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;:=&nbsp;vector_float_norm_inf&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;!accu&nbsp;+.&nbsp;log&nbsp;!n&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;vector_float_scal_left_div&nbsp;!n&nbsp;!y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu&nbsp;:=&nbsp;!accu&nbsp;/.&nbsp;(&nbsp;abs_float&nbsp;(&nbsp;float&nbsp;s&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;[|&nbsp;!accu&nbsp;|]&nbsp;;&nbsp;!y&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_Gram matrix</pre> The vectors in question are the rows of the matrix.
<p>

Les vecteurs à étudier forment les lignes de la matrice. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_Gram&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_twisted_prod&nbsp;x&nbsp;x&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_Gram matrix</pre> The vectors in question are the rows of the matrix.
<p>

Les vecteurs à étudier forment les lignes de la matrice. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_Gram&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_int_twisted_prod&nbsp;x&nbsp;x&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_rank matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;float_rank&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;ref&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;ref&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;m_m&nbsp;=&nbsp;ref&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!c&nbsp;&lt;&nbsp;!r&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;m_m&nbsp;:=&nbsp;float_transpose&nbsp;m&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;:=&nbsp;!r&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;:=&nbsp;<span class="constructor">Array</span>.length&nbsp;!m_m&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;!r&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">if</span>&nbsp;vector_float_norm_inf&nbsp;!m_m.(0)&nbsp;=&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;0&nbsp;<span class="keyword">else</span>&nbsp;1<br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;2&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;!m_m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_float_abs&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;vector_float_max&nbsp;vv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;float_rank&nbsp;[|&nbsp;!m_m.(1)&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;vector_float_find_twin&nbsp;x&nbsp;vv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;!m_m.(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;vector_float_minus&nbsp;w&nbsp;(&nbsp;vector_float_scal_mult&nbsp;(&nbsp;w.(i)&nbsp;/.&nbsp;v.(i)&nbsp;)&nbsp;v&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;+&nbsp;float_rank&nbsp;[|&nbsp;ww&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;!m_m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;vector_float_abs&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;vector_float_max&nbsp;vv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;x&nbsp;=&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;float_rank&nbsp;(&nbsp;float_sub_matrix&nbsp;!m_m&nbsp;1&nbsp;(!r&nbsp;-&nbsp;1)&nbsp;0&nbsp;(!c&nbsp;-&nbsp;1)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;vector_float_find_twin&nbsp;x&nbsp;vv&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;float_sub_matrix&nbsp;!m_m&nbsp;1&nbsp;(!r&nbsp;-&nbsp;1)&nbsp;0&nbsp;(!c&nbsp;-&nbsp;1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;!r&nbsp;-&nbsp;2&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.(j)&nbsp;&lt;-&nbsp;vector_float_minus&nbsp;w.(j)&nbsp;(&nbsp;vector_float_scal_mult&nbsp;(&nbsp;w.(j).(i)&nbsp;/.&nbsp;v.(i)&nbsp;)&nbsp;v&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;+&nbsp;float_rank&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_im matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_im&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rank&nbsp;=&nbsp;float_rank&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;rank&nbsp;r&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;rank&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(!i)&nbsp;&lt;-&nbsp;matrix_vector_float_prod&nbsp;m&nbsp;(&nbsp;vector_float_random&nbsp;c&nbsp;1.&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;float_sub_matrix&nbsp;w&nbsp;0&nbsp;!i&nbsp;0&nbsp;rr&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;float_rank&nbsp;ww&nbsp;=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_ker methode_reduc threshold matrix</pre> The rows of the output form a basis of the kernel of the matrix.
The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres.
Les lignes de la sortie forment une base du noyau de la matrice. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_ker&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(threshold:float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;float_transpose&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;matrix_float_twisted_prod&nbsp;mm&nbsp;mm<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;result&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;p&nbsp;=&nbsp;methode_reduc&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;diag&nbsp;=&nbsp;p.(0).(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;base&nbsp;=&nbsp;p.(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;diag.(i)&nbsp;&lt;=&nbsp;threshold&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;:=&nbsp;&nbsp;base.(i)&nbsp;::&nbsp;!result&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.of_list&nbsp;!result&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_rank matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_rank&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;float_of_matrix&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;float_rank&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_im matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_im&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;rank&nbsp;=&nbsp;int_rank&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;accu&nbsp;=&nbsp;ref&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;rank&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;rank&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;w.(!i)&nbsp;&lt;-&nbsp;matrix_vector_int_prod&nbsp;m&nbsp;(&nbsp;vector_int_bal_random&nbsp;c&nbsp;!accu&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;int_sub_matrix&nbsp;w&nbsp;0&nbsp;!i&nbsp;0&nbsp;rr&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;int_rank&nbsp;ww&nbsp;=&nbsp;!i&nbsp;+&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;&nbsp;accu&nbsp;:=&nbsp;1&nbsp;)&nbsp;<span class="keyword">else</span>&nbsp;accu&nbsp;:=&nbsp;1&nbsp;+&nbsp;!accu<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>hyper_proj</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;hyper_proj&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;v&nbsp;w&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;vector_float_minus&nbsp;w&nbsp;(&nbsp;vector_float_scal_mult&nbsp;(&nbsp;(&nbsp;vector_float_scal_prod&nbsp;v&nbsp;w&nbsp;)&nbsp;/.&nbsp;(&nbsp;vector_float_norm_2&nbsp;v&nbsp;)&nbsp;)&nbsp;v&nbsp;)<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_ortho_proj matrix vector</pre> The columns of the matrix are required to be a basis of the subspace of the orthogonal projection.
<p>

Les colonnes de la matrice sont censées former une base du sous-espace de projection orthogonale. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_ortho_proj&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;float_transpose&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;column&nbsp;=&nbsp;mm.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;(&nbsp;(&nbsp;vector_float_scal_prod&nbsp;v&nbsp;column&nbsp;)&nbsp;/.&nbsp;vector_float_square_norm_2&nbsp;column&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu.(i)&nbsp;&lt;-&nbsp;accu.(i)&nbsp;+.&nbsp;column.(i)&nbsp;*.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_trans_ortho_proj matrix vector</pre> The rows of the matrix are required to be a basis of the subspace of the orthogonal projection.
<p>

Les lignes de la matrice sont censées former une base du sous-espace de projection orthogonale. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_trans_ortho_proj&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;accu&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;c&nbsp;0.<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;(&nbsp;(&nbsp;vector_float_scal_prod&nbsp;v&nbsp;row&nbsp;)&nbsp;/.&nbsp;vector_float_square_norm_2&nbsp;row&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accu.(j)&nbsp;&lt;-&nbsp;accu.(j)&nbsp;+.&nbsp;row.(j)&nbsp;*.&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;accu&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_ortho_sym matrix vector</pre> The columns of the matrix are the generators of the subspace of the orthogonal symmetry.
<p>

Les colonnes de la matrices forment les générateurs du sous-espace de symétrie orthogonale. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_ortho_sym&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;vector_float_minus&nbsp;(&nbsp;vector_float_scal_mult&nbsp;2.&nbsp;(&nbsp;float_ortho_proj&nbsp;m&nbsp;v&nbsp;)&nbsp;)&nbsp;v&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_trans_ortho_sym matrix vector</pre> The rows of the matrix are the generators of the subspace of the orthogonal symmetry.
<p>

Les lignes de la matrices forment les générateurs du sous-espace de symétrie orthogonale. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_trans_ortho_sym&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;vector_float_minus&nbsp;(&nbsp;vector_float_scal_mult&nbsp;2.&nbsp;(&nbsp;float_trans_ortho_proj&nbsp;m&nbsp;v&nbsp;)&nbsp;)&nbsp;v&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_chose_3 vector</pre> The aim is to complete the image of a vector by a homothety into an orthonormal basis
whose second vector is included in the horizontal plane. The vectors of the basis rae output by row.
<p>

Il s'agit de compléter l'homothétique unitaire d'un vecteur quelconque de R^3 en une base orthonormée dont le deuxième vecteur est dans le plan horizontal.
Les vecteurs de la base sortent par ligne. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_chose_3&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(u:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;u.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;u.(1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;u.(2)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;a&nbsp;*.&nbsp;a&nbsp;+.&nbsp;b&nbsp;*.&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;d&nbsp;&lt;&gt;&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;e&nbsp;=&nbsp;c&nbsp;*.&nbsp;c&nbsp;+.&nbsp;d&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;eee&nbsp;=&nbsp;sqrt&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ee&nbsp;=&nbsp;1.&nbsp;/.&nbsp;eee&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;uu&nbsp;=&nbsp;vector_float_scal_mult&nbsp;ee&nbsp;u<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dd&nbsp;=&nbsp;1.&nbsp;/.&nbsp;(&nbsp;sqrt&nbsp;d&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;[|&nbsp;-.&nbsp;b&nbsp;*.&nbsp;dd&nbsp;;&nbsp;a&nbsp;*.&nbsp;dd&nbsp;;&nbsp;0.&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;c&nbsp;&gt;&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;[|&nbsp;uu&nbsp;;&nbsp;v&nbsp;;&nbsp;<span class="constructor">Util</span>.vector_float_prod_3&nbsp;uu&nbsp;v&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;&nbsp;[|&nbsp;uu&nbsp;;&nbsp;v&nbsp;;&nbsp;<span class="constructor">Util</span>.vector_float_prod_3&nbsp;v&nbsp;uu&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;c&nbsp;&gt;&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;[|&nbsp;0.&nbsp;;&nbsp;0.&nbsp;;&nbsp;1.&nbsp;|]&nbsp;;&nbsp;[|&nbsp;1.&nbsp;;&nbsp;0.&nbsp;;&nbsp;0.&nbsp;|]&nbsp;;&nbsp;[|&nbsp;0.&nbsp;;&nbsp;1.&nbsp;;&nbsp;0.&nbsp;|]&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;[|&nbsp;0.&nbsp;;&nbsp;0.&nbsp;;&nbsp;-1.&nbsp;|]&nbsp;;&nbsp;[|&nbsp;1.&nbsp;;&nbsp;0.&nbsp;;&nbsp;0.&nbsp;|]&nbsp;;&nbsp;[|&nbsp;0.&nbsp;;&nbsp;1.&nbsp;;&nbsp;0.&nbsp;|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_pinv methode_reduc threshold matrix</pre> This comes from the <code class="code">scilab</code> source code, 
restricted to the case when the matrix is symmetric.
<p>

Ceci provient du code source de <code class="code">scilab</code>, restreint au cas où la matrice est symétrique. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_pinv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(threshold:float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;p&nbsp;=&nbsp;methode_reduc&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;diag&nbsp;=&nbsp;p.(0).(0)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;base&nbsp;=&nbsp;p.(1)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;tbase&nbsp;=&nbsp;p.(3)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;diag.(i)&nbsp;&gt;&nbsp;threshold&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diag.(i)&nbsp;&lt;-&nbsp;1.&nbsp;/.&nbsp;diag.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;diag.(i)&nbsp;&lt;-&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;matrix_float_prod&nbsp;tbase&nbsp;(&nbsp;float_diag_left_mult&nbsp;diag&nbsp;base&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_apply methode_reduc function matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_apply&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(f:float&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;float)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;p&nbsp;=&nbsp;methode_reduc&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;diag&nbsp;=&nbsp;p.(0).(0)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;base&nbsp;=&nbsp;p.(1)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;tbase&nbsp;=&nbsp;p.(3)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;-&nbsp;1&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;diag.(i)&nbsp;&lt;-&nbsp;f&nbsp;diag.(i)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;matrix_float_prod&nbsp;tbase&nbsp;(&nbsp;float_diag_left_mult&nbsp;diag&nbsp;base&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_sqrt methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_sqrt&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;sqrt&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_log methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_log&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;log&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_log10 methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_log10&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;log10&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_cos methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_cos&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;cos&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_sin methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_sin&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;sin&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_tan methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_tan&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;tan&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_acos methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_acos&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;acos&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_asin methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_asin&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;asin&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_atan methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_atan&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;atan&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_cosh methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_cosh&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;cosh&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_sinh methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_sinh&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;sinh&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_tanh methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_tanh&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;tanh&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_abs_float methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_abs_float&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;abs_float&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_frac methode_reduc matrix</pre> The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; 
it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_frac&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;sym_float_apply&nbsp;methode_reduc&nbsp;<span class="constructor">Util</span>.frac&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>clean_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;clean_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
(&nbsp;float_tune_inv&nbsp;matrix_float_norm_inf&nbsp;m&nbsp;(&nbsp;float_slow_inv&nbsp;m&nbsp;)&nbsp;).(0)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>slow_clean_inv matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;slow_clean_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
(&nbsp;slow_float_tune_inv&nbsp;matrix_float_norm_inf&nbsp;m&nbsp;(&nbsp;float_slow_inv&nbsp;m&nbsp;)&nbsp;).(0)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_singular_random rows columns rank range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_singular_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(rank:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;rank_float_matrix&nbsp;r&nbsp;c&nbsp;rank<br>
&nbsp;<span class="keyword">and</span>&nbsp;p&nbsp;=&nbsp;matrix_float_random&nbsp;r&nbsp;c&nbsp;x<br>
&nbsp;<span class="keyword">and</span>&nbsp;q&nbsp;=&nbsp;matrix_float_random&nbsp;r&nbsp;c&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_float_triple_prod&nbsp;p&nbsp;j&nbsp;q&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_singular_bal_random rows columns rank range</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_singular_bal_random&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(r:int)&nbsp;(c:int)&nbsp;(rank:int)&nbsp;(x:float)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;j&nbsp;=&nbsp;rank_float_matrix&nbsp;r&nbsp;c&nbsp;rank<br>
&nbsp;<span class="keyword">and</span>&nbsp;p&nbsp;=&nbsp;matrix_float_bal_random&nbsp;r&nbsp;c&nbsp;x<br>
&nbsp;<span class="keyword">and</span>&nbsp;q&nbsp;=&nbsp;matrix_float_bal_random&nbsp;r&nbsp;c&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_float_triple_prod&nbsp;p&nbsp;j&nbsp;q&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
<span id="2_ExprimentationsdiversesMiscellanousexperimentations"><h2><center>Expérimentations diverses
---
Miscellanous experimentations</center> </h2></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>right_float_pinv methode_reduc matrix</pre> This functions, but it is slow.
The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres.
Cela fonctionne, mais c'est lent. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;right_float_pinv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(threshold:float)&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;float_transpose&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;mmm&nbsp;=&nbsp;matrix_float_twisted_prod&nbsp;mm&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;sym_float_pinv&nbsp;methode_reduc&nbsp;threshold&nbsp;mmm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_twisted_prod&nbsp;m_m&nbsp;mm&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>left_float_pinv methode_reduc matrix</pre> This functions, but it is slow.
The reduction methode <code class="code">methode_reduc</code> applies to symmetric matrices ; it must contain all the parameters.
<p>

La méthode de réduction <code class="code">methode_reduc</code> s'applique aux matrices symétriques ; elle doit comprendre tous ses paramètres.
Cela fonctionne, mais c'est lent. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;left_float_pinv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(threshold:float)&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_twisted_prod&nbsp;m&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m_m&nbsp;=&nbsp;sym_float_pinv&nbsp;methode_reduc&nbsp;threshold&nbsp;mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;matrix_float_prod&nbsp;(float_transpose&nbsp;m)&nbsp;m_m&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sym_float_reduc_seq threshold max_steps matrix</pre> Some symmetric matrices may cause this algorithm to fail: use sym_float_tune_reduc instead.
<p>

Input : threshold for non-diagonality norm, maximal number of steps, symmetric matrix.
<p>

Output : final iteration close to the diagonal matrix, left orthogonal transformation whose rows are the approximate eigenvectors, 
right orthogonal transformation whose columns are the approximate eigenvectors.
<p>

Entrée : seuil pour la norme de non-diagonalité, nombre maximal de pas, matrice symétrique.
<p>

Sortie : itération finale approchant la matrice diagonalisée, changement de coordonnées isométrique gauche dont les lignes 
sont les vecteurs propres approchés, changement de coordonnées isométrique droit dont les colonnes sont les vecteurs propres approchés.
<p>

Certaines matrices symétriques peuvent mettre cet algorithme en échec :
utiliser sym_float_tune_reduc_seq à la place.
*)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sym_float_reduc_seq&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(threshold:float)&nbsp;(s:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;measure&nbsp;=&nbsp;ref&nbsp;max_float<br>
&nbsp;<span class="keyword">and</span>&nbsp;seq_left&nbsp;=&nbsp;ref&nbsp;[|&nbsp;|]<br>
&nbsp;<span class="keyword">and</span>&nbsp;seq_right&nbsp;=&nbsp;ref&nbsp;[|&nbsp;|]<br>
&nbsp;<span class="keyword">and</span>&nbsp;seq_candidate&nbsp;=&nbsp;ref&nbsp;[|&nbsp;|]<br>
&nbsp;<span class="keyword">and</span>&nbsp;steps&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;mm&nbsp;=&nbsp;ref&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;identity_float&nbsp;r&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;left&nbsp;=&nbsp;ref&nbsp;i<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;right&nbsp;=&nbsp;ref&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;(&nbsp;!measure&nbsp;&gt;&nbsp;threshold&nbsp;)&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;!steps&nbsp;&lt;&nbsp;s&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;resultat&nbsp;=&nbsp;sym_float_adapt&nbsp;!mm&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mm&nbsp;:=&nbsp;resultat.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seq_candidate&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!seq_candidate&nbsp;[|&nbsp;!mm&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left&nbsp;:=&nbsp;matrix_float_prod&nbsp;resultat.(1)&nbsp;!left&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seq_left&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!seq_left&nbsp;[|&nbsp;!left&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right&nbsp;:=&nbsp;matrix_float_prod&nbsp;!right&nbsp;resultat.(2)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seq_right&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!seq_right&nbsp;[|&nbsp;!right&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;measure&nbsp;:=&nbsp;matrix_float_non_diagonality&nbsp;matrix_float_norm_inf&nbsp;!mm&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;steps&nbsp;:=&nbsp;!steps&nbsp;+&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;!seq_candidate&nbsp;;&nbsp;!seq_left&nbsp;;&nbsp;!seq_right&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_normalized_iterate_seq norm steps matrix vector</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_normalized_iterate_seq&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;norm&nbsp;(s:int)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;(v:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s&nbsp;&lt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Negative&nbsp;power&nbsp;forbidden&nbsp;in&nbsp;Matrix.float_normalized_iterate."</span>&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;(&nbsp;vector_float_scal_left_div&nbsp;(&nbsp;norm&nbsp;v&nbsp;)&nbsp;v&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;seq&nbsp;=&nbsp;ref&nbsp;[|&nbsp;|]<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;ref&nbsp;!y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;=&nbsp;s&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:=&nbsp;matrix_vector_float_prod&nbsp;x&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:=&nbsp;vector_float_scal_left_div&nbsp;(&nbsp;norm&nbsp;!z&nbsp;)&nbsp;!z&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;seq&nbsp;:=&nbsp;<span class="constructor">Array</span>.append&nbsp;!seq&nbsp;[|&nbsp;!z&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;norm&nbsp;(&nbsp;vector_float_minus&nbsp;!z&nbsp;!y&nbsp;)&nbsp;==&nbsp;0.&nbsp;<span class="keyword">then</span>&nbsp;i&nbsp;:=&nbsp;max_int<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(&nbsp;i&nbsp;:=&nbsp;!i&nbsp;+&nbsp;1&nbsp;;&nbsp;y&nbsp;:=&nbsp;!z&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;!seq&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>extrap_inv parameter matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;extrap_inv&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(parameter:float)&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y0&nbsp;=&nbsp;float_slow_inv&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y1&nbsp;=&nbsp;(&nbsp;float_tune_inv&nbsp;matrix_float_norm_inf&nbsp;x&nbsp;y0&nbsp;).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;matrix_float_plus&nbsp;y1&nbsp;(&nbsp;matrix_float_scal_mult&nbsp;parameter&nbsp;(&nbsp;matrix_float_minus&nbsp;y1&nbsp;y0&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>aggressive_inv parameter matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;aggressive_inv&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;extrap_inv&nbsp;epsilon_float&nbsp;x&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** linear_regression methode_reduc departure arrival *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;linear_regression&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;methode_reduc&nbsp;(x:float&nbsp;array&nbsp;array)&nbsp;(y:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;bx&nbsp;=&nbsp;matrix_float_mean_by_row&nbsp;x<br>
&nbsp;<span class="keyword">and</span>&nbsp;by&nbsp;=&nbsp;matrix_float_mean_by_row&nbsp;y<br>
&nbsp;<span class="keyword">and</span>&nbsp;dim&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;x&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;v&nbsp;bb&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_float_minus&nbsp;v&nbsp;bb<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;d&nbsp;=&nbsp;pred&nbsp;dim&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;matrix_float_column_apply_vect&nbsp;(&nbsp;f&nbsp;bx&nbsp;)&nbsp;x<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;yy&nbsp;=&nbsp;matrix_float_column_apply_vect&nbsp;(&nbsp;f&nbsp;by&nbsp;)&nbsp;y<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dd&nbsp;=&nbsp;d&nbsp;+&nbsp;dim&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;float_pca&nbsp;methode_reduc&nbsp;(&nbsp;<span class="constructor">Array</span>.append&nbsp;yy&nbsp;xx&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;sqrt&nbsp;z.(0).(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;zz&nbsp;=&nbsp;matrix_float_prod&nbsp;z.(3)&nbsp;(&nbsp;<span class="constructor">Array</span>.mapi&nbsp;(&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;v&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;vector_float_scal_mult&nbsp;r.(i)&nbsp;v&nbsp;)&nbsp;z.(1)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;alpha&nbsp;=&nbsp;float_sub_matrix&nbsp;zz&nbsp;0&nbsp;d&nbsp;0&nbsp;d<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;beta&nbsp;=&nbsp;float_sub_matrix&nbsp;zz&nbsp;0&nbsp;d&nbsp;dim&nbsp;dd<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;gamma&nbsp;=&nbsp;float_sub_matrix&nbsp;zz&nbsp;dim&nbsp;dd&nbsp;0&nbsp;d<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;delta&nbsp;=&nbsp;float_sub_matrix&nbsp;zz&nbsp;dim&nbsp;dd&nbsp;dim&nbsp;dd&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a0&nbsp;=&nbsp;matrix_float_prod&nbsp;alpha&nbsp;(&nbsp;aggressive_inv&nbsp;gamma&nbsp;)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;a1&nbsp;=&nbsp;matrix_float_prod&nbsp;beta&nbsp;(&nbsp;aggressive_inv&nbsp;delta&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;matrix_float_scal_mult&nbsp;0.5&nbsp;(&nbsp;matrix_float_plus&nbsp;a0&nbsp;a1&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;vector_float_minus&nbsp;by&nbsp;(&nbsp;matrix_vector_float_prod&nbsp;a&nbsp;bx&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;a&nbsp;;&nbsp;[|&nbsp;b&nbsp;|]&nbsp;|]&nbsp;;;<br>
<br>
<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ § § </center> *)</span></td></tr></table><code class="code"><br>
<br>
<span class="keyword">end</span></code></body></html>