<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Graphicmath" rel="Chapter" href="Graphicmath.html"><title>Graphicmath.Readwrite</title>
</head>
<body>
<code class="code"><span class="keyword">struct</span><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Introduction"><h1>Introduction</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(**
The mathematician will find in this module:
<p>
<ul>
<li>utility functions in order to permit the following exchanges between Ocaml and the file system:</li>
</ul>
<OL>
<li>read and write integer or real vectors and matrices,</li>
<li>read and write text files, </li>
<li>read XPM picture files (which are text files indeed),</li>
<li>read PNM picture files of type P4, which means bitmap pictures in binary data,</li>
<li>read and write PNM picture files of types P5 and P6, which means gray levels pictures (PGM) or trichromic pictures (PPM) in binary data,</li>
<li>read and write BMP picture files,</li>
<li>read and write sound files in the AU float 32 bits format, </li>
<li>read and write real vectors and matrices in the AU float 64 bits format,</li>
<li>read and write sound files in some WAV format,</li>
<li>read the directories,</li>
</OL>
<ul>
<li>methods to treat the characters obtained from these files,</li>
</ul>
<ul>
<li>conversions between different ways to record pictures inside Ocaml,</li>
</ul>
<ul>
<li>utility functions in order to retrieve data about the environment of the operating system.</li>
</ul>

<span id="2_Conventions"><h2>Conventions</h2></span>
<p>

The color used in the Graphics module of Ocaml is coded by an integer according to the formula
color = red * 256 * 256 + green * 256 + blue
where the integers red, green, blue are between 0 and 255.
<p>

<span id="2_Comments"><h2>Comments</h2></span>
<p>

The reading and writing of float 64 bits AU sound files (real vectors and matrices) makes use of
the commands <code class="code">head</code> and <code class="code">tail</code> available on every minimal UNIX system.
<p>

The reading and writing of float 32 bits AU sound files (real vectors) makes use of
conversions with the class <code class="code">int</code> which are only correct on 64 bits machines.
<p>

The functions about environment use instructions that vary considerably 
from one operating system to another. They have been only tested under FreeBSD.
<p>

The functions for reading the content of a file into a list and writing the content of a file from an Ocaml structure come from P. Manoury: 
Programmation de droite à gauche et vice-versa, Paracamplus, Paris, 2011:
<p>

<code class="code">www.paracamplus.com</code>
<p>

This module is distributed under the same licence as Ocaml.
<p>

<center>§ </center>
<p>

La mathématicienne ou le mathématicien trouvera dans ce module :
<p>
<ul>
<li>des fonctions utilitaires permettant les échanges suivants entre Ocaml et le système de fichiers : </li>
</ul>
<OL>
<li>lecture et écriture des vecteurs et matrices entiers ou réels,</li>
<li>lecture et écriture des fichiers textes, </li>
<li>lecture des fichiers d'images XPM (qui sont en fait des fichiers textes), </li>
<li>lecture des fichiers d'images PNM de type P4, c'est-à-dire des images noir-blanc en données binaires,</li>
<li>lecture et écriture des fichiers d'images PNM de types P5 et P6, c'est-à-dire des images soit en niveaux de gris (PGM) soit trichromiques (PPM) en données binaires,</li>
<li>lecture et écriture des fichiers d'images BMP,</li>
<li>lecture et écriture des fichiers sons au format AU float 32 bits, </li>
<li>lecture et écriture des vecteurs et matrices réels au format AU float 64 bits,</li>
<li>lecture et écriture de fichiers sons à certains formats WAV,</li>
<li>lecture des répertoires,</li>
</OL>
<ul>
<li>des méthodes pour traiter les caractères obtenus de ces fichiers,</li>
</ul>
<ul>
<li>des conversions entre différentes manières de consigner les images à l'intérieur d'Ocaml,</li>
</ul>
<ul>
<li>des fonctions utilitaires permettant de récupérer des données sur l'environnement du système d'exploitation.</li>
</ul>

<span id="2_Conventions"><h2>Conventions</h2></span>
<p>

La couleur utilisée dans le module Graphics d'Ocaml est codée par entier selon la formule
couleur = rouge * 256 * 256 + vert * 256 + bleu 
où les entiers rouge, vert, bleu sont compris entre 0 et 255.
<p>

<span id="2_Commentaires"><h2>Commentaires</h2></span>
<p>

La lecture et l'écriture de fichiers sons AU float 64 bits (vecteurs et matrices réels)
utilise les commandes <code class="code">head</code> et <code class="code">tail</code> fournies dans tous les systèmes UNIX minimaux.
<p>

La lecture et l'écriture des fichiers sons AU float 32 bits utilisent des conversions avec 
la classe <code class="code">int</code> qui ne sont correctes que sur les machines 64 bits.
<p>

Les informations sur l'environnement utilisent des instructions qui varient fortement
d'un système d'exploitation à l'autre. Elles ne sont testées que sous FreeBSD.
<p>

Les fonctions de lecture d'un fichier vers une liste ou d'écriture d'un fichier depuis une structure d'Ocaml proviennent de P. Manoury : 
Programmation de droite à gauche et vice-versa, Paracamplus, Paris, 2011 :
<p>

<code class="code">www.paracamplus.com</code>
<p>

Ce module est distribué selon la même licence qu'Ocaml.
<p>

<center>Copyright Stéphane Grognet </center>
<center>Laboratoire de mathématiques Jean Leray UMR 6629 CNRS </center>
<center>Fédération de recherche mathématique des Pays de la Loire </center>
<center>IREM des Pays de la Loire - Université de Nantes </center>
<center>version 0.3</center>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
@version 0.3
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
@author Stéphane Grognet
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(**
@since 2013
*)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Util</span>&nbsp;;;<br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Matrix</span>&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Fichierstextesfichiersbinairesettraitementdeschanesdecaractres"><h1>Fichiers textes, fichiers binaires et traitement des chaînes de caractères</h1></span>
<span id="1_Textfilesbinaryfilesandcharacterstringstreatment"><h1>Text files, binary files and character strings treatment</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_match regexp string start</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_match&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;r&nbsp;s&nbsp;i&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Str</span>.search_forward&nbsp;r&nbsp;s&nbsp;i&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">true</span><br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">Not_found</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>list_read_reverse_text_file file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;list_read_reverse_text_file&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;:=&nbsp;(&nbsp;input_line&nbsp;ic&nbsp;)&nbsp;::&nbsp;!l&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!l&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>list_read_reverse_text_header file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;list_read_reverse_text_header&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(h:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;h&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;:=&nbsp;(&nbsp;input_line&nbsp;ic&nbsp;)&nbsp;::&nbsp;!l&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!l&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>list_read_text_file file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;list_read_text_file&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">List</span>.rev&nbsp;(&nbsp;list_read_reverse_text_file&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>array_read_reverse_text_file file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;array_read_reverse_text_file&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;list_read_reverse_text_file&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>array_read_text_file file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;array_read_text_file&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;list_read_text_file&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>list_write_text_file string_list file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;list_write_text_file&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(l:string&nbsp;list)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;ll&nbsp;=&nbsp;ref&nbsp;l&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="constructor">List</span>.length&nbsp;!ll&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;output_string&nbsp;oc&nbsp;(&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;!ll&nbsp;)&nbsp;^&nbsp;<span class="string">"\n"</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;ll&nbsp;:=&nbsp;<span class="constructor">List</span>.tl&nbsp;!ll<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>array_write_text_file string_array file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;array_write_text_file&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(a:string&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;a&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;output_string&nbsp;oc&nbsp;(&nbsp;a.(i)&nbsp;^&nbsp;<span class="string">"\n"</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>list_read_text_header size file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;list_read_text_header&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(h:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">List</span>.rev&nbsp;(&nbsp;list_read_reverse_text_header&nbsp;h&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>array_read_reverse_text_header size file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;array_read_reverse_text_header&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(h:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;list_read_reverse_text_header&nbsp;h&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>array_read_text_header size file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;array_read_text_header&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(h:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;list_read_text_header&nbsp;h&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>list_read_reverse_binary_file file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;list_read_reverse_binary_file&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in_bin&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;:=&nbsp;(&nbsp;input_byte&nbsp;ic&nbsp;)&nbsp;::&nbsp;!l<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!l&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>list_read_binary_file file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;list_read_binary_file&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">List</span>.rev&nbsp;(&nbsp;list_read_reverse_binary_file&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>step_read_binary_file buffer block_size file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;step_read_binary_file&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(b:<span class="constructor">Buffer</span>.t)&nbsp;(block_size:int)&nbsp;(ic:in_channel)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Buffer</span>.add_channel&nbsp;b&nbsp;ic&nbsp;block_size&nbsp;;<br>
&nbsp;&nbsp;&nbsp;block_size<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;block_size&nbsp;/&nbsp;2&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>buffer_to_binary_array buffer</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;buffer_to_binary_array&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(b:<span class="constructor">Buffer</span>.t)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Buffer</span>.length&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;r&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;a.(i)&nbsp;&lt;-&nbsp;int_of_char&nbsp;(&nbsp;<span class="constructor">Buffer</span>.nth&nbsp;b&nbsp;i&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;a&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>array_read_binary_file init_size file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;array_read_binary_file&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(init_size:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Buffer</span>.create&nbsp;init_size<br>
&nbsp;<span class="keyword">and</span>&nbsp;block_size&nbsp;=&nbsp;ref&nbsp;init_size<br>
&nbsp;<span class="keyword">and</span>&nbsp;ic&nbsp;=&nbsp;open_in_bin&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;block_size&nbsp;:=&nbsp;step_read_binary_file&nbsp;b&nbsp;!block_size&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!block_size&nbsp;&gt;=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;(&nbsp;f&nbsp;()&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;()<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;buffer_to_binary_array&nbsp;b&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>array_write_binary_file vector file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;array_write_binary_file&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;a&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;a<br>
&nbsp;<span class="keyword">and</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;a.(i)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>hexa_char_to_int figure</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;hexa_char_to_int&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(c:char)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;c&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'0'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'1'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;1<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'2'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;2<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'3'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;3<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'4'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;4<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'5'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;5<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'6'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;6<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'7'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;7<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'8'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;8<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'9'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;9<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'A'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;10<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'B'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;11<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'C'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;12<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'D'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;13<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'E'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;14<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'F'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;15<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'a'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;10<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'b'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;11<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'c'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;12<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'d'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;13<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'e'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;14<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'f'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;15<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Hexadecimal&nbsp;character&nbsp;not&nbsp;recognized&nbsp;in&nbsp;Readwrite.hexa_char_to_int."</span>&nbsp;;;<br>
&nbsp;<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>int_to_hexa_char figure</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;int_to_hexa_char&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;c&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;0&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'0'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'1'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;2&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'2'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;3&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'3'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;4&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'4'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;5&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'5'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;6&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'6'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;7&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'7'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;8&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'8'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;9&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'9'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;10&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'A'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;11&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'B'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;12&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'C'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;13&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'D'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;14&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'E'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;15&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">'F'</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Hexadecimal&nbsp;figure&nbsp;not&nbsp;allowed&nbsp;in&nbsp;Readwrite.int_to_hexa_char."</span>&nbsp;;;<br>
&nbsp;<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>byte_string_to_int string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;byte_string_to_int&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;hexa_char_to_int&nbsp;s.[0]<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;hexa_char_to_int&nbsp;s.[1]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;16&nbsp;*&nbsp;a&nbsp;+&nbsp;b&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>triple_byte_string_to_int_luminance string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;triple_byte_string_to_int_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** The string begins with a #. *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;indices&nbsp;=&nbsp;[|&nbsp;1&nbsp;;&nbsp;2&nbsp;;&nbsp;3&nbsp;;&nbsp;4&nbsp;;&nbsp;5&nbsp;;&nbsp;6&nbsp;|]<br>
&nbsp;<span class="keyword">and</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;i&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;hexa_char_to_int&nbsp;s.[i]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;indices&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;16&nbsp;*&nbsp;(&nbsp;v.(0)&nbsp;+&nbsp;v.(2)&nbsp;+&nbsp;v.(4)&nbsp;)&nbsp;+&nbsp;v.(1)&nbsp;+&nbsp;v.(3)&nbsp;+&nbsp;v.(5)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>triple_byte_string_to_int_red string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;triple_byte_string_to_int_red&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** The string begins with a #. *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;hexa_char_to_int&nbsp;s.[1]<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;hexa_char_to_int&nbsp;s.[2]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;16&nbsp;*&nbsp;a&nbsp;+&nbsp;b&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>triple_byte_string_to_int_green string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;triple_byte_string_to_int_green&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** The string begins with a #. *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;hexa_char_to_int&nbsp;s.[3]<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;hexa_char_to_int&nbsp;s.[4]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;16&nbsp;*&nbsp;a&nbsp;+&nbsp;b&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>triple_byte_string_to_int_blue string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;triple_byte_string_to_int_blue&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** The string begins with a #. *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;hexa_char_to_int&nbsp;s.[5]<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;hexa_char_to_int&nbsp;s.[6]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;16&nbsp;*&nbsp;a&nbsp;+&nbsp;b&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>triple_byte_string_to_int_rgb string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;triple_byte_string_to_int_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** The string begins with a #. *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;indices&nbsp;=&nbsp;[|&nbsp;1&nbsp;;&nbsp;2&nbsp;;&nbsp;3&nbsp;;&nbsp;4&nbsp;;&nbsp;5&nbsp;;&nbsp;6&nbsp;|]<br>
&nbsp;<span class="keyword">and</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;i&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;hexa_char_to_int&nbsp;s.[i]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;indices&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;[|&nbsp;16&nbsp;*&nbsp;v.(0)&nbsp;+&nbsp;v.(1)&nbsp;;&nbsp;16&nbsp;*&nbsp;v.(2)&nbsp;+&nbsp;v.(3)&nbsp;;&nbsp;16&nbsp;*&nbsp;v.(4)&nbsp;+&nbsp;v.(5)&nbsp;|]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>triple_byte_string_to_color string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;triple_byte_string_to_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** The string begins with a #. *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;indices&nbsp;=&nbsp;[|&nbsp;1&nbsp;;&nbsp;2&nbsp;;&nbsp;3&nbsp;;&nbsp;4&nbsp;;&nbsp;5&nbsp;;&nbsp;6&nbsp;|]<br>
&nbsp;<span class="keyword">and</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;i&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;hexa_char_to_int&nbsp;s.[i]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;indices&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;(((((&nbsp;16&nbsp;*&nbsp;v.(0)&nbsp;)&nbsp;+&nbsp;v.(1)&nbsp;)&nbsp;*&nbsp;16&nbsp;+&nbsp;v.(2)&nbsp;)&nbsp;*&nbsp;16&nbsp;+&nbsp;v.(3)&nbsp;)&nbsp;*&nbsp;16&nbsp;+&nbsp;v.(4)&nbsp;)&nbsp;*&nbsp;16&nbsp;+&nbsp;v.(5)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>hexa_char_to_float figure</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;hexa_char_to_float&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(c:char)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;c&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'0'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'1'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;1.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'2'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;2.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'3'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;3.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'4'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;4.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'5'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;5.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'6'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;6.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'7'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;7.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'8'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;8.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'9'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;9.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'A'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;10.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'B'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;11.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'C'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;12.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'D'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;13.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'E'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;14.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'F'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;15.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'a'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;10.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'b'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;11.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'c'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;12.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'d'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;13.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'e'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;14.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'f'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;15.<br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Hexadecimal&nbsp;character&nbsp;not&nbsp;recognized&nbsp;in&nbsp;Readwrite.hexa_char_to_float."</span>&nbsp;;;<br>
&nbsp;<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>byte_string_to_float string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;byte_string_to_float&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;hexa_char_to_float&nbsp;s.[0]<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;hexa_char_to_float&nbsp;s.[1]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;16.&nbsp;*.&nbsp;a&nbsp;+.&nbsp;b&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>triple_byte_string_to_float_luminance string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;triple_byte_string_to_float_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** The string begins with a #. *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;indices&nbsp;=&nbsp;[|&nbsp;1&nbsp;;&nbsp;2&nbsp;;&nbsp;3&nbsp;;&nbsp;4&nbsp;;&nbsp;5&nbsp;;&nbsp;6&nbsp;|]<br>
&nbsp;<span class="keyword">and</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;i&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;hexa_char_to_float&nbsp;s.[i]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;indices&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;16.&nbsp;*.&nbsp;(&nbsp;v.(0)&nbsp;+.&nbsp;v.(2)&nbsp;+.&nbsp;v.(4)&nbsp;)&nbsp;+.&nbsp;v.(1)&nbsp;+.&nbsp;v.(3)&nbsp;+.&nbsp;v.(5)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>triple_byte_string_to_float_red string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;triple_byte_string_to_float_red&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** The string begins with a #. *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;hexa_char_to_float&nbsp;s.[1]<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;hexa_char_to_float&nbsp;s.[2]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;16.&nbsp;*.&nbsp;a&nbsp;+.&nbsp;b&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>triple_byte_string_to_float_green string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;triple_byte_string_to_float_green&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** The string begins with a #. *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;hexa_char_to_float&nbsp;s.[3]<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;hexa_char_to_float&nbsp;s.[4]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;16.&nbsp;*.&nbsp;a&nbsp;+.&nbsp;b&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>triple_byte_string_to_float_blue string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;triple_byte_string_to_float_blue&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** The string begins with a #. *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;hexa_char_to_float&nbsp;s.[5]<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;hexa_char_to_float&nbsp;s.[6]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;16.&nbsp;*.&nbsp;a&nbsp;+.&nbsp;b&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>triple_byte_string_to_float_rgb string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;triple_byte_string_to_float_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** The string begins with a #. *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;indices&nbsp;=&nbsp;[|&nbsp;1&nbsp;;&nbsp;2&nbsp;;&nbsp;3&nbsp;;&nbsp;4&nbsp;;&nbsp;5&nbsp;;&nbsp;6&nbsp;|]<br>
&nbsp;<span class="keyword">and</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;i&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;hexa_char_to_float&nbsp;s.[i]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;indices&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;[|&nbsp;16.&nbsp;*.&nbsp;v.(0)&nbsp;+.&nbsp;v.(1)&nbsp;;&nbsp;16.&nbsp;*.&nbsp;v.(2)&nbsp;+.&nbsp;v.(3)&nbsp;;&nbsp;16.&nbsp;*.&nbsp;v.(4)&nbsp;+.&nbsp;v.(5)&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gray_string_to_float_luminance string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gray_string_to_float_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;4&nbsp;(&nbsp;l&nbsp;-&nbsp;4&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;float_of_string&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;7.65&nbsp;*.&nbsp;n&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gray_string_to_float_unicolor string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gray_string_to_float_unicolor&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
</code><table><tr><td></td><td><span class="comment">(** The character "G" has been suppressed. *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;4&nbsp;(&nbsp;l&nbsp;-&nbsp;4&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;float_of_string&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;2.55&nbsp;*.&nbsp;n&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gray_string_to_float_rgb string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gray_string_to_float_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;gray_string_to_float_unicolor&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.make&nbsp;3&nbsp;c&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gray_string_to_int_unicolor string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gray_string_to_int_unicolor&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;min&nbsp;255&nbsp;(&nbsp;<span class="constructor">Util</span>.round&nbsp;(&nbsp;gray_string_to_float_unicolor&nbsp;s&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gray_string_to_int_luminance string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gray_string_to_int_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;min&nbsp;255&nbsp;(&nbsp;<span class="constructor">Util</span>.round&nbsp;(&nbsp;gray_string_to_float_luminance&nbsp;s&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gray_string_to_int_rgb string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gray_string_to_int_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;gray_string_to_int_unicolor&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.make&nbsp;3&nbsp;c&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>gray_string_to_color string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;gray_string_to_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;min&nbsp;16777215&nbsp;(&nbsp;65793&nbsp;*&nbsp;(&nbsp;<span class="constructor">Util</span>.round&nbsp;(&nbsp;gray_string_to_float_unicolor&nbsp;s&nbsp;)&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>name_to_triple_byte string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;name_to_triple_byte&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">match</span>&nbsp;s&nbsp;<span class="keyword">with</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"AntiqueWhite"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FAEBD7"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Aqua"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#00FFFF"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Aquamarine"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#7FFFD4"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Azure"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#F0FFFF"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Beige"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#F5F5DC"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Bisque"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFE4C4"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Black"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#000000"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"BlanchedAlmond"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFEBCD"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Blue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#0000FF"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"BlueViolet"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#8A2BE2"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Brown"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#A52A2A"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Burlywood"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#DEB887"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"CadetBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#5F9EA0"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Chartreuse"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#7FFF00"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Chocolate"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#D2691E"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Coral"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FF7F50"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Cornflower"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#6495ED"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Cornsilk"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFF8DC"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Crimson"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#DC143C"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Cyan"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#00FFFF"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#00008B"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkCyan"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#008B8B"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkGoldenrod"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#B8860B"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkGray"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#A9A9A9"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#006400"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkKhaki"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#BDB76B"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkMagenta"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#8B008B"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkOliveGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#556B2F"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkOrange"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FF8C00"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkOrchid"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#9932CC"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkRed"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#8B0000"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkSalmon"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#E9967A"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkSeaGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#8FBC8F"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkSlateBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#483D8B"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkSlateGray"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#2F4F4F"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkTurquoise"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#00CED1"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DarkViolet"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#9400D3"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DeepPink"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FF1493"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DeepSkyBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#00BFFF"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DimGray"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#696969"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"DodgerBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#1E90FF"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Firebrick"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#B22222"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"FloralWhite"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFFAF0"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"ForestGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#228B22"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Fuchsia"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FF00FF"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Gainsboro"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#DCDCDC"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"GhostWhite"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#F8F8FF"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Gold"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFD700"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Goldenrod"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#DAA520"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Gray"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#BEBEBE"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Green"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#00FF00"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"GreenYellow"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#ADFF2F"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Honeydew"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#F0FFF0"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"HotPink"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FF69B4"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"IndianRed"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#CD5C5C"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Indigo"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#4B0082"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Ivory"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFFFF0"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Khaki"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#F0E68C"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Lavender"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#E6E6FA"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LavenderBlush"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFF0F5"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LawnGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#7CFC00"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LemonChiffon"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFFACD"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#ADD8E6"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightCoral"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#F08080"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightCyan"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#E0FFFF"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightGoldenrod"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FAFAD2"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightGray"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#D3D3D3"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#90EE90"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightPink"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFB6C1"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightSalmon"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFA07A"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightSeaGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#20B2AA"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightSkyBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#87CEFA"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightSlateGray"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#778899"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightSteelBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#B0C4DE"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LightYellow"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFFFE0"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Lime"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#00FF00"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"LimeGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#32CD32"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Linen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FAF0E6"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Magenta"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FF00FF"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Maroon"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#B03060"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MediumAquamarine"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#66CDAA"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MediumBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#0000CD"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MediumOrchid"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#BA55D3"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MediumPurple"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#9370DB"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MediumSeaGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#3CB371"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MediumSlateBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#7B68EE"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MediumSpringGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#00FA9A"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MediumTurquoise"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#48D1CC"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MediumVioletRed"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#C71585"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MidnightBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#191970"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MintCream"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#F5FFFA"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"MistyRose"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFE4E1"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Moccasin"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFE4B5"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"NavajoWhite"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFDEAD"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Navy"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#000080"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"OldLace"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FDF5E6"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Olive"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#808000"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"OliveDrab"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#6B8E23"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Orange"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFA500"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"OrangeRed"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FF4500"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Orchid"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#DA70D6"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"PaleGoldenrod"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#EEE8AA"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"PaleGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#98FB98"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"PaleTurquoise"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#AFEEEE"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"PaleVioletRed"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#DB7093"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"PapayaWhip"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFEFD5"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"PeachPuff"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFDAB9"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Peru"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#CD853F"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Pink"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFC0CB"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Plum"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#DDA0DD"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"PowderBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#B0E0E6"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Purple"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#A020F0"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Red"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FF0000"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"RosyBrown"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#BC8F8F"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"RoyalBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#4169E1"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"SaddleBrown"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#8B4513"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Salmon"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FA8072"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"SandyBrown"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#F4A460"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"SeaGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#2E8B57"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Seashell"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFF5EE"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Sienna"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#A0522D"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Silver"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#C0C0C0"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"SkyBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#87CEEB"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"SlateBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#6A5ACD"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"SlateGray"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#708090"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Snow"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFFAFA"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"SpringGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#00FF7F"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"SteelBlue"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#4682B4"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Tan"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#D2B48C"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Teal"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#008080"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Thistle"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#D8BFD8"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Tomato"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FF6347"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Turquoise"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#40E0D0"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Violet"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#EE82EE"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Wheat"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#F5DEB3"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"White"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFFFFF"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"WhiteSmoke"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#F5F5F5"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"Yellow"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#FFFF00"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">"YellowGreen"</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"#9ACD32"</span><br>
&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;an&nbsp;X11&nbsp;color&nbsp;name&nbsp;in&nbsp;Readwrite.name_to_triple_byte."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_to_float_red string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_to_float_red&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s.[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">then</span>&nbsp;triple_byte_string_to_float_red&nbsp;s<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Str</span>.string_match&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"Gray[0-9]"</span>&nbsp;)&nbsp;s&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;gray_string_to_float_unicolor&nbsp;s<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;triple_byte_string_to_float_red&nbsp;(&nbsp;name_to_triple_byte&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_to_float_green string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_to_float_green&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s.[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">then</span>&nbsp;triple_byte_string_to_float_green&nbsp;s<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Str</span>.string_match&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"Gray[0-9]"</span>&nbsp;)&nbsp;s&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;gray_string_to_float_unicolor&nbsp;s<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;triple_byte_string_to_float_green&nbsp;(&nbsp;name_to_triple_byte&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_to_float_blue string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_to_float_blue&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s.[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">then</span>&nbsp;triple_byte_string_to_float_blue&nbsp;s<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Str</span>.string_match&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"Gray[0-9]"</span>&nbsp;)&nbsp;s&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;gray_string_to_float_unicolor&nbsp;s<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;triple_byte_string_to_float_blue&nbsp;(&nbsp;name_to_triple_byte&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_to_float_luminance string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_to_float_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s.[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">then</span>&nbsp;triple_byte_string_to_float_luminance&nbsp;s<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Str</span>.string_match&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"Gray[0-9]"</span>&nbsp;)&nbsp;s&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;gray_string_to_float_luminance&nbsp;s<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;triple_byte_string_to_float_luminance&nbsp;(&nbsp;name_to_triple_byte&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_to_float_rgb string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_to_float_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s.[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">then</span>&nbsp;triple_byte_string_to_float_rgb&nbsp;s<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Str</span>.string_match&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"Gray[0-9]"</span>&nbsp;)&nbsp;s&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;gray_string_to_float_rgb&nbsp;s<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;triple_byte_string_to_float_rgb&nbsp;(&nbsp;name_to_triple_byte&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_to_int_red string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_to_int_red&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s.[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">then</span>&nbsp;triple_byte_string_to_int_red&nbsp;s<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Str</span>.string_match&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"Gray[0-9]"</span>&nbsp;)&nbsp;s&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;gray_string_to_int_unicolor&nbsp;s<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;triple_byte_string_to_int_red&nbsp;(&nbsp;name_to_triple_byte&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_to_int_green string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_to_int_green&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s.[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">then</span>&nbsp;triple_byte_string_to_int_green&nbsp;s<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Str</span>.string_match&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"Gray[0-9]"</span>&nbsp;)&nbsp;s&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;gray_string_to_int_unicolor&nbsp;s<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;triple_byte_string_to_int_green&nbsp;(&nbsp;name_to_triple_byte&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_to_int_blue string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_to_int_blue&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s.[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">then</span>&nbsp;triple_byte_string_to_int_blue&nbsp;s<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Str</span>.string_match&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"Gray[0-9]"</span>&nbsp;)&nbsp;s&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;gray_string_to_int_unicolor&nbsp;s<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;triple_byte_string_to_int_blue&nbsp;(&nbsp;name_to_triple_byte&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_to_int_luminance string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_to_int_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s.[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">then</span>&nbsp;triple_byte_string_to_int_luminance&nbsp;s<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Str</span>.string_match&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"Gray[0-9]"</span>&nbsp;)&nbsp;s&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;gray_string_to_int_luminance&nbsp;s<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;triple_byte_string_to_int_luminance&nbsp;(&nbsp;name_to_triple_byte&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_to_int_rgb string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_to_int_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s.[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">then</span>&nbsp;triple_byte_string_to_int_rgb&nbsp;s<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Str</span>.string_match&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"Gray[0-9]"</span>&nbsp;)&nbsp;s&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;gray_string_to_int_rgb&nbsp;s<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;triple_byte_string_to_int_rgb&nbsp;(&nbsp;name_to_triple_byte&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>string_to_color string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;string_to_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;s.[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">then</span>&nbsp;triple_byte_string_to_color&nbsp;s<br>
&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Str</span>.string_match&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;<span class="string">"Gray[0-9]"</span>&nbsp;)&nbsp;s&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;gray_string_to_color&nbsp;s<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;triple_byte_string_to_color&nbsp;(&nbsp;name_to_triple_byte&nbsp;s&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_float_value file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_float_value&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
(&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;input_value&nbsp;ic&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;close_in_noerr&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:&nbsp;float&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_float_array_value file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_float_array_value&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
(&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;input_value&nbsp;ic&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;close_in_noerr&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:&nbsp;float&nbsp;array&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_float_value real file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_float_value&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;output_value&nbsp;oc&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_float_array_value real_vector file_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_float_array_value&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(x:float&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;output_value&nbsp;oc&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Conversionsdimages"><h1>Conversions d'images</h1></span>
<span id="1_Pictureconversions"><h1>Picture conversions</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>color_to_int_rgb color</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;color_to_int_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;c&nbsp;/&nbsp;65536&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;(&nbsp;c&nbsp;/&nbsp;256&nbsp;)&nbsp;<span class="keyword">mod</span>&nbsp;256&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;c&nbsp;<span class="keyword">mod</span>&nbsp;256&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;[|&nbsp;r&nbsp;;&nbsp;g&nbsp;;&nbsp;b&nbsp;|]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>color_to_float_rgb color</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;color_to_float_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(c:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;c&nbsp;/&nbsp;65536&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;(&nbsp;c&nbsp;/&nbsp;256&nbsp;)&nbsp;<span class="keyword">mod</span>&nbsp;256&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;c&nbsp;<span class="keyword">mod</span>&nbsp;256&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;float&nbsp;[|&nbsp;r&nbsp;;&nbsp;g&nbsp;;&nbsp;b&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_color_to_int_rgb color_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_color_to_int_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_red&nbsp;=&nbsp;r.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_green&nbsp;=&nbsp;g.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_blue&nbsp;=&nbsp;b.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;color&nbsp;=&nbsp;row_input.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;couleur&nbsp;=&nbsp;color&nbsp;/256&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_red.(j)&nbsp;&lt;-&nbsp;couleur&nbsp;/&nbsp;256&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_green.(j)&nbsp;&lt;-&nbsp;couleur&nbsp;<span class="keyword">mod</span>&nbsp;256&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_blue.(j)&nbsp;&lt;-&nbsp;color&nbsp;<span class="keyword">mod</span>&nbsp;256&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;[|&nbsp;r&nbsp;;&nbsp;g&nbsp;;&nbsp;b&nbsp;|]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_rgb_to_color rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_rgb_to_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;red&nbsp;=&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;green&nbsp;=&nbsp;m.(1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;blue&nbsp;=&nbsp;m.(2)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;blue<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;blue.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_red&nbsp;=&nbsp;red.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_green&nbsp;=&nbsp;green.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_blue&nbsp;=&nbsp;blue.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_blue.(j)&nbsp;+&nbsp;256&nbsp;*&nbsp;(&nbsp;row_green.(j)&nbsp;+&nbsp;256&nbsp;*&nbsp;row_red.(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_unicolor_to_color matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_unicolor_to_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Matrix</span>.matrix_int_scal_mult&nbsp;65793&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_rgb_to_int_rgb rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_rgb_to_int_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Matrix</span>.matrix_int_clip&nbsp;255&nbsp;(&nbsp;<span class="constructor">Matrix</span>.matrix_float_round&nbsp;x&nbsp;)&nbsp;)&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_rgb_to_float_rgb rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_rgb_to_float_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;<span class="constructor">Matrix</span>.float_of_matrix&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_rgb_to_color rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_rgb_to_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_int_rgb_to_color&nbsp;(&nbsp;matrix_float_rgb_to_int_rgb&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_color_to_float_rgb color_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_color_to_float_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;<span class="constructor">Matrix</span>.float_of_matrix&nbsp;(&nbsp;matrix_color_to_int_rgb&nbsp;m&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_unicolor_to_color matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_unicolor_to_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Matrix</span>.matrix_int_clip&nbsp;16777215&nbsp;(&nbsp;<span class="constructor">Matrix</span>.matrix_int_scal_mult&nbsp;65793&nbsp;(&nbsp;<span class="constructor">Matrix</span>.matrix_float_round&nbsp;m&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_rgb_to_gray rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_rgb_to_gray&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;m.(1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;m.(2)<br>
&nbsp;<span class="keyword">and</span>&nbsp;constant&nbsp;=&nbsp;1.&nbsp;/.&nbsp;3.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;r.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;n.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_red&nbsp;=&nbsp;r.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_green&nbsp;=&nbsp;g.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_blue&nbsp;=&nbsp;b.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;constant&nbsp;*.&nbsp;(&nbsp;row_red.(j)&nbsp;+.&nbsp;row_green.(j)&nbsp;+.&nbsp;row_blue.(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_rgb_to_gray rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_rgb_to_gray&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;matrix_int_rgb_to_float_rgb&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;o&nbsp;=&nbsp;matrix_float_rgb_to_gray&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Matrix</span>.matrix_int_clip&nbsp;255&nbsp;(&nbsp;<span class="constructor">Matrix</span>.matrix_float_round&nbsp;o&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_color_to_int_gray color_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_color_to_int_gray&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;matrix_color_to_int_rgb&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_int_rgb_to_gray&nbsp;n&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_color_to_float_gray color_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_color_to_float_gray&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;matrix_color_to_float_rgb&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_float_rgb_to_gray&nbsp;n&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_rgb_to_luminance rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_rgb_to_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;m.(1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;m.(2)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;r.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;n.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_red&nbsp;=&nbsp;r.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_green&nbsp;=&nbsp;g.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_blue&nbsp;=&nbsp;b.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_red.(j)&nbsp;+&nbsp;row_green.(j)&nbsp;+&nbsp;row_blue.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_color_to_int_luminance color_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_color_to_int_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;matrix_color_to_int_rgb&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_int_rgb_to_luminance&nbsp;n&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_rgb_to_luminance rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_rgb_to_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;m.(1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;m.(2)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;r.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;n.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_red&nbsp;=&nbsp;r.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_green&nbsp;=&nbsp;g.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_blue&nbsp;=&nbsp;b.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row_red.(j)&nbsp;+.&nbsp;row_green.(j)&nbsp;+.&nbsp;row_blue.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_color_to_float_luminance color_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_color_to_float_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;matrix_color_to_float_rgb&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;matrix_float_rgb_to_luminance&nbsp;n&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_unicolor_under_sample edge matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_unicolor_under_sample&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;r&nbsp;<span class="keyword">mod</span>&nbsp;n&nbsp;!=&nbsp;0&nbsp;)&nbsp;<span class="keywordsign">||</span>&nbsp;(&nbsp;c&nbsp;<span class="keyword">mod</span>&nbsp;n&nbsp;!=&nbsp;0&nbsp;)&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;failwith&nbsp;<span class="string">"The&nbsp;edge&nbsp;of&nbsp;the&nbsp;square&nbsp;must&nbsp;be&nbsp;a&nbsp;divisor&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;and&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;columns&nbsp;of&nbsp;the&nbsp;matrix&nbsp;in&nbsp;Readwrite.matrix_float_unicolor_under_sample."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;rr&nbsp;=&nbsp;r&nbsp;/&nbsp;n<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;c&nbsp;/&nbsp;n<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Matrix</span>.vector_float_sum&nbsp;(&nbsp;<span class="constructor">Matrix</span>.vector_float_demakeup&nbsp;x&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;1.&nbsp;/.&nbsp;(&nbsp;float&nbsp;(&nbsp;n&nbsp;*&nbsp;n&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;nn&nbsp;=&nbsp;pred&nbsp;n&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;rr&nbsp;cc&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;cc&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Matrix</span>.vector_foa_demakeup&nbsp;(&nbsp;<span class="constructor">Matrix</span>.vector_foa_cut&nbsp;cc&nbsp;(&nbsp;<span class="constructor">Matrix</span>.<span class="constructor">Float_vector_cons</span>&nbsp;x&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ccc&nbsp;=&nbsp;pred&nbsp;cc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;(&nbsp;g&nbsp;x&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;rr&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ni&nbsp;=&nbsp;n&nbsp;*&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;k&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;nn&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;h&nbsp;m.(&nbsp;ni&nbsp;+&nbsp;k&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;ccc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;row.(j)&nbsp;+.&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;ccc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;row.(j)&nbsp;*.&nbsp;s&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_rgb_under_sample edge rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_rgb_under_sample&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(m:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;matrix_float_unicolor_under_sample&nbsp;n&nbsp;)&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_unicolor_under_sample edge matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_unicolor_under_sample&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Matrix</span>.int_of_matrix&nbsp;(&nbsp;matrix_float_unicolor_under_sample&nbsp;n&nbsp;(&nbsp;<span class="constructor">Matrix</span>.float_of_matrix&nbsp;m&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_rgb_under_sample edge rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_rgb_under_sample&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(m:int&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_rgb_to_int_rgb&nbsp;(&nbsp;matrix_float_rgb_under_sample&nbsp;n&nbsp;(&nbsp;matrix_int_rgb_to_float_rgb&nbsp;m&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>rgb_crop rgb_matrix beg-row end-row beg-col end-col</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;rgb_crop&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;m&nbsp;(i:int)&nbsp;(ii:int)&nbsp;(j:int)&nbsp;(jj:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Matrix</span>.sub_matrix&nbsp;x&nbsp;i&nbsp;ii&nbsp;j&nbsp;jj&nbsp;)&nbsp;m&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_unicolor_magnify factor matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_unicolor_magnify&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(factor:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;r&nbsp;c&nbsp;(&nbsp;<span class="constructor">Matrix</span>.<span class="constructor">Float_cons</span>&nbsp;0.&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;r&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_input&nbsp;=&nbsp;m.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_output&nbsp;=&nbsp;w.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Matrix</span>.<span class="constructor">Float_matrix_cons</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;factor&nbsp;factor&nbsp;row_input.(j)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Matrix</span>.matrix_float_demakeup&nbsp;(&nbsp;<span class="constructor">Matrix</span>.matrix_foa_paste&nbsp;(&nbsp;<span class="constructor">Matrix</span>.<span class="constructor">Foa_matrix_cons</span>&nbsp;w&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>float_rgb_magnify factor rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;float_rgb_magnify&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(factor:int)&nbsp;(m:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;float_unicolor_magnify&nbsp;factor&nbsp;)&nbsp;m&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Fichiersdevecteursetmatrices"><h1>Fichiers de vecteurs et matrices</h1></span>
<span id="1_Vectorandmatrixfiles"><h1>Vector and matrix files</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_of_string string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_of_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;st&nbsp;=&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;3&nbsp;(&nbsp;l&nbsp;-&nbsp;6&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;liste&nbsp;=&nbsp;ref&nbsp;(&nbsp;<span class="constructor">Str</span>.split&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp_string&nbsp;<span class="string">"&nbsp;;&nbsp;"</span>&nbsp;)&nbsp;st&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ll&nbsp;=&nbsp;<span class="constructor">List</span>.length&nbsp;!liste&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;ll&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;ll&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;int_of_string&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;!liste&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;liste&nbsp;:=&nbsp;<span class="constructor">List</span>.tl&nbsp;!liste&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_write vector filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_write&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;output_string&nbsp;oc&nbsp;(&nbsp;(&nbsp;string_of_int&nbsp;v.(i)&nbsp;)&nbsp;^&nbsp;<span class="string">"\n"</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_write matrix filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_write&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:int&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;output_string&nbsp;oc&nbsp;(&nbsp;(&nbsp;<span class="constructor">Matrix</span>.string_of_vector_int&nbsp;v.(i)&nbsp;)&nbsp;^&nbsp;<span class="string">"\n"</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>list_reverse_int_read</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;list_reverse_int_read&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;:=&nbsp;(&nbsp;int_of_string&nbsp;(&nbsp;input_line&nbsp;ic&nbsp;)&nbsp;)&nbsp;::&nbsp;!l&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!l&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>list_int_read</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;list_int_read&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">List</span>.rev&nbsp;(&nbsp;list_reverse_int_read&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_reverse_int_read</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_reverse_int_read&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;list_reverse_int_read&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_int_read</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_int_read&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;list_int_read&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_int_read filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_int_read&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;ref&nbsp;[]<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;:=&nbsp;(&nbsp;input_line&nbsp;ic&nbsp;)&nbsp;::&nbsp;!l&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;succ&nbsp;!i&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(&nbsp;succ&nbsp;!i&nbsp;)&nbsp;0&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;pred&nbsp;!i&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.(j)&nbsp;&lt;-&nbsp;vector_int_of_string&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;!l&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;:=&nbsp;<span class="constructor">List</span>.tl&nbsp;!l&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_of_string string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_of_string&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;st&nbsp;=&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;3&nbsp;(&nbsp;l&nbsp;-&nbsp;6&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;liste&nbsp;=&nbsp;ref&nbsp;(&nbsp;<span class="constructor">Str</span>.split&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp_string&nbsp;<span class="string">"&nbsp;;&nbsp;"</span>&nbsp;)&nbsp;st&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ll&nbsp;=&nbsp;<span class="constructor">List</span>.length&nbsp;!liste&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;ll&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;ll&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;float_of_string&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;!liste&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;liste&nbsp;:=&nbsp;<span class="constructor">List</span>.tl&nbsp;!liste&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_write vector filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_write&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(v:float&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;output_string&nbsp;oc&nbsp;(&nbsp;(&nbsp;string_of_float&nbsp;v.(i)&nbsp;)&nbsp;^&nbsp;<span class="string">"\n"</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_write matrix filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_write&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;output_string&nbsp;oc&nbsp;(&nbsp;(&nbsp;<span class="constructor">Matrix</span>.string_of_vector_float&nbsp;m.(i)&nbsp;)&nbsp;^&nbsp;<span class="string">"\n"</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>list_reverse_float_read</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;list_reverse_float_read&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;:=&nbsp;(&nbsp;float_of_string&nbsp;(&nbsp;input_line&nbsp;ic&nbsp;)&nbsp;)&nbsp;::&nbsp;!l&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;!l&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>list_float_read</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;list_float_read&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">List</span>.rev&nbsp;(&nbsp;list_reverse_float_read&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_reverse_float_read</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_reverse_float_read&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;list_reverse_float_read&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>vector_float_read</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;vector_float_read&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;list_float_read&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>matrix_float_read filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;matrix_float_read&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;ref&nbsp;[]<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;:=&nbsp;(&nbsp;input_line&nbsp;ic&nbsp;)&nbsp;::&nbsp;!l&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;succ&nbsp;!i&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;(&nbsp;succ&nbsp;!i&nbsp;)&nbsp;0&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;pred&nbsp;!i&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.(j)&nbsp;&lt;-&nbsp;vector_float_of_string&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;!l&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;:=&nbsp;<span class="constructor">List</span>.tl&nbsp;!l&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Fichiersdimagesxpm"><h1>Fichiers d'images xpm</h1></span>
<span id="1_Xpmpicturefiles"><h1>Xpm picture files</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** The XPM files are of type text; they are supposed to have already been
introduced in the memory of Ocaml as arrays of character strings.
<p>

Les fichiers XPM sont de type texte ; on suppose qu'ils ont déja été rentrés 
dans la mémoire d'Ocaml sous forme de tableaux de chaînes de caractères.*)</span></td></tr></table><code class="code"><br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_colors_index string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_colors_index&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Util</span>.vector_find_first&nbsp;<span class="constructor">Util</span>.string_eq&nbsp;<span class="string">"/*&nbsp;colors&nbsp;*/"</span>&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_pixels_index string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_pixels_index&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Util</span>.vector_find_first&nbsp;<span class="constructor">Util</span>.string_eq&nbsp;<span class="string">"/*&nbsp;pixels&nbsp;*/"</span>&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_pixels_end string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_pixels_end&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Util</span>.vector_find_first&nbsp;<span class="constructor">Util</span>.string_eq&nbsp;<span class="string">"};"</span>&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_sizes string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_sizes&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
</code><table><tr><td></td><td><span class="comment">(** Output format : <code class="code"><span class="keywordsign">|</span> width ; height ; ncolors ; chars_per_pixel <span class="keywordsign">|</span></code> *)</span></td></tr></table><code class="code"><br>
&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;xpm_colors_index&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;v.(&nbsp;pred&nbsp;i&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;<span class="constructor">String</span>.sub&nbsp;c&nbsp;1&nbsp;(&nbsp;l&nbsp;-&nbsp;3&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Str</span>.regexp_string&nbsp;<span class="string">"&nbsp;"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;<span class="constructor">Str</span>.split&nbsp;r&nbsp;cc&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;int_of_string&nbsp;w&nbsp;<span class="keyword">in</span><br>
</code><table><tr><td></td><td><span class="comment">(** Eliminate the last color : "None". *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x.(2)&nbsp;&lt;-&nbsp;pred&nbsp;x.(2)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_colors_strings string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_colors_strings&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;xpm_colors_index&nbsp;v<br>
&nbsp;<span class="keyword">and</span>&nbsp;j&nbsp;=&nbsp;xpm_pixels_index&nbsp;v&nbsp;<span class="keyword">in</span><br>
</code><table><tr><td></td><td><span class="comment">(** Eliminate the last color : "None". *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.sub&nbsp;v&nbsp;(&nbsp;succ&nbsp;i&nbsp;)&nbsp;(&nbsp;j&nbsp;-&nbsp;i&nbsp;-&nbsp;2&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_colors_symbols string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_colors_symbols&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;(xpm_sizes&nbsp;v).(3)<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;xpm_colors_strings&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Str</span>.regexp_string&nbsp;(&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;1&nbsp;l&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;c&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_colors_values string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_colors_values&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;(xpm_sizes&nbsp;v).(3)<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;xpm_colors_strings&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;tout&nbsp;=&nbsp;<span class="constructor">Str</span>.string_after&nbsp;s&nbsp;(&nbsp;4&nbsp;+&nbsp;l&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Str</span>.string_before&nbsp;tout&nbsp;(&nbsp;(&nbsp;<span class="constructor">String</span>.length&nbsp;tout&nbsp;)&nbsp;-&nbsp;2&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;c&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_colors_substitution string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_colors_substitution&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;symbols&nbsp;=&nbsp;xpm_colors_symbols&nbsp;v<br>
&nbsp;<span class="keyword">and</span>&nbsp;values&nbsp;=&nbsp;xpm_colors_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;symbols&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">function</span>&nbsp;(y:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;z&nbsp;=&nbsp;ref&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!i&nbsp;&lt;&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;expression&nbsp;=&nbsp;symbols.(!i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;string_match&nbsp;expression&nbsp;!z&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;:=&nbsp;<span class="constructor">Str</span>.global_substitute&nbsp;expression&nbsp;(&nbsp;<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;values.(!i)&nbsp;)&nbsp;y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;l<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;i&nbsp;:=&nbsp;succ&nbsp;!i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!z<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>pixels_line_splitting string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;pixels_line_splitting&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(c:int)&nbsp;(x:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;<span class="constructor">String</span>.length&nbsp;x&nbsp;)&nbsp;&lt;&nbsp;2&nbsp;+&nbsp;n&nbsp;*&nbsp;c&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;sizes&nbsp;in&nbsp;Readwrite.pixels_line_splitting"</span>&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;n&nbsp;<span class="string">""</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;n&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ii&nbsp;=&nbsp;1&nbsp;+&nbsp;i&nbsp;*&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(i)&nbsp;&lt;-&nbsp;<span class="constructor">String</span>.sub&nbsp;x&nbsp;ii&nbsp;c<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;v&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_pixels_strings string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_pixels_strings&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;xpm_pixels_end&nbsp;v<br>
&nbsp;<span class="keyword">and</span>&nbsp;sizes&nbsp;=&nbsp;xpm_sizes&nbsp;v<br>
&nbsp;<span class="keyword">and</span>&nbsp;j&nbsp;=&nbsp;xpm_pixels_index&nbsp;v&nbsp;<span class="keyword">in</span><br>
</code><table><tr><td></td><td><span class="comment">(** Eliminate the trailing lines. *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;v&nbsp;(&nbsp;succ&nbsp;j&nbsp;)&nbsp;(&nbsp;l&nbsp;-&nbsp;j&nbsp;-&nbsp;1&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;sizes.(3)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;sizes.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;pixels_line_splitting&nbsp;w&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_pixels_values string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_pixels_values&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;p&nbsp;=&nbsp;xpm_pixels_strings&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;lines&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;p&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;replace&nbsp;=&nbsp;xpm_colors_substitution&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;lines&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.(j)&nbsp;&lt;-&nbsp;<span class="constructor">Array</span>.map&nbsp;replace&nbsp;p.(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_int_red string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_int_red&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;xpm_pixels_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;string_to_int_red&nbsp;)&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_int_green string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_int_green&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;xpm_pixels_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;string_to_int_green&nbsp;)&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_int_blue string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_int_blue&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;xpm_pixels_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;string_to_int_blue&nbsp;)&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_int_luminance string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_int_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;xpm_pixels_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;string_to_int_luminance&nbsp;)&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_int_rgb string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_int_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;xpm_pixels_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;vv<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;vv.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;red&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;w&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;green&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;w&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;blue&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;w&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ww&nbsp;=&nbsp;pred&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;red_output&nbsp;=&nbsp;red.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;green_output&nbsp;=&nbsp;green.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;blue_output&nbsp;=&nbsp;blue.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;vv.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;ww&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;string_to_int_rgb&nbsp;row_input.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;red_output.(j)&nbsp;&lt;-&nbsp;x.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;green_output.(j)&nbsp;&lt;-&nbsp;x.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blue_output.(j)&nbsp;&lt;-&nbsp;x.(2)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;red&nbsp;;&nbsp;green&nbsp;;&nbsp;blue&nbsp;|]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_float_red string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_float_red&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;xpm_pixels_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;string_to_float_red&nbsp;)&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_float_green string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_float_green&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;xpm_pixels_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;string_to_float_green&nbsp;)&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_float_blue string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_float_blue&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;xpm_pixels_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;string_to_float_blue&nbsp;)&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_float_luminance string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_float_luminance&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;xpm_pixels_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;string_to_float_luminance&nbsp;)&nbsp;vv&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_float_rgb string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_float_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;xpm_pixels_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;vv<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;vv.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;red&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;w&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;green&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;w&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;blue&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;w&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ww&nbsp;=&nbsp;pred&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;red_output&nbsp;=&nbsp;red.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;green_output&nbsp;=&nbsp;green.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;blue_output&nbsp;=&nbsp;blue.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;vv.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;ww&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;string_to_float_rgb&nbsp;row_input.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;red_output.(j)&nbsp;&lt;-&nbsp;x.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;green_output.(j)&nbsp;&lt;-&nbsp;x.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blue_output.(j)&nbsp;&lt;-&nbsp;x.(2)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;red&nbsp;;&nbsp;green&nbsp;;&nbsp;blue&nbsp;|]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>xpm_color_array string_array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;xpm_color_array&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(v:string&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;xpm_pixels_values&nbsp;v&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;vv<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;vv.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;p&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;w&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ww&nbsp;=&nbsp;pred&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_output&nbsp;=&nbsp;p.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_input&nbsp;=&nbsp;vv.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;ww&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_output.(j)&nbsp;&lt;-&nbsp;string_to_color&nbsp;row_input.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Fichiersdimagespnmpgmetppm"><h1>Fichiers d'images pnm : pgm et ppm</h1></span>
<span id="1_Pnmpicturefilespgmandppm"><h1>Pnm picture files: pgm and ppm</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** The PNM files split into three classes: PBM with one bit per pixel,
PGM with grey levels, PPM with three primary colors. They may be saved in text files
or in consecutive bytes.
<p>

Les fichiers PNM se décomposent en trois classes : PBM à un bit par pixel, 
PGM en niveaux de gris, PPM en trichromie. Ils peuvent être stockés en fichiers textes
ou en octets consécutifs. *)</span></td></tr></table><code class="code"><br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pnm_header filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pnm_header&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;a&nbsp;=&nbsp;ref&nbsp;(&nbsp;array_read_text_header&nbsp;3&nbsp;s&nbsp;)<br>
&nbsp;<span class="keyword">and</span>&nbsp;i&nbsp;=&nbsp;ref&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!a.(!i).[0]&nbsp;=&nbsp;<span class="string">'#'</span>&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;a&nbsp;:=&nbsp;array_read_text_header&nbsp;(&nbsp;!i&nbsp;+&nbsp;3&nbsp;)&nbsp;s&nbsp;;<br>
&nbsp;&nbsp;&nbsp;incr&nbsp;i<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;!a&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>ppm_header_of_rgb rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;ppm_header_of_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;[|&nbsp;<span class="string">"P6"</span>&nbsp;;&nbsp;(&nbsp;string_of_int&nbsp;c&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;l&nbsp;)&nbsp;;&nbsp;<span class="string">"255"</span>&nbsp;|]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>pgm_header_of_unicolor matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;pgm_header_of_unicolor&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;[|&nbsp;<span class="string">"P5"</span>&nbsp;;&nbsp;(&nbsp;string_of_int&nbsp;c&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;l&nbsp;)&nbsp;;&nbsp;<span class="string">"255"</span>&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pbm_binary_int_gray filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pbm_binary_int_gray&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;e&nbsp;=&nbsp;read_pnm_header&nbsp;s<br>
&nbsp;<span class="keyword">and</span>&nbsp;maximum&nbsp;=&nbsp;255<br>
&nbsp;<span class="keyword">and</span>&nbsp;dot&nbsp;=&nbsp;<span class="constructor">String</span>.make&nbsp;1&nbsp;(&nbsp;char_of_int&nbsp;10&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;e.(0).[1]&nbsp;!=&nbsp;<span class="string">'4'</span>&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;pbm_binary&nbsp;file&nbsp;in&nbsp;Readwrite.read_pbm_binary_int_gray."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;one&nbsp;=&nbsp;l&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;sharp&nbsp;=&nbsp;(&nbsp;<span class="keyword">if</span>&nbsp;l&nbsp;=&nbsp;3&nbsp;<span class="keyword">then</span>&nbsp;<span class="string">""</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="constructor">Array</span>.fold_left&nbsp;(&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x&nbsp;^&nbsp;dot&nbsp;^&nbsp;y&nbsp;)&nbsp;<span class="string">""</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;e&nbsp;1&nbsp;(&nbsp;l&nbsp;-&nbsp;3&nbsp;)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;size&nbsp;=&nbsp;e.(one)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Str</span>.regexp_string&nbsp;<span class="string">"&nbsp;"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dim&nbsp;=&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;<span class="constructor">Str</span>.split&nbsp;r&nbsp;size&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;int_of_string&nbsp;dim.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;int_of_string&nbsp;dim.(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;chaine&nbsp;=&nbsp;e.(0)&nbsp;^&nbsp;dot&nbsp;^&nbsp;e.(one)&nbsp;^&nbsp;dot&nbsp;^&nbsp;sharp<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;taille&nbsp;=&nbsp;l&nbsp;*&nbsp;c&nbsp;/&nbsp;8&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;offset&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;chaine&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;array_read_binary_file&nbsp;(&nbsp;offset&nbsp;+&nbsp;taille&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;v&nbsp;offset&nbsp;taille<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;result&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;l&nbsp;c&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;result.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ii&nbsp;=&nbsp;i&nbsp;*&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;jj&nbsp;=&nbsp;ii&nbsp;+&nbsp;j&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.(j)&nbsp;&lt;-&nbsp;(&nbsp;1&nbsp;-&nbsp;(&nbsp;(&nbsp;vv.(&nbsp;jj&nbsp;/&nbsp;8&nbsp;)&nbsp;<span class="keyword">lsr</span>&nbsp;(&nbsp;7&nbsp;-&nbsp;(&nbsp;jj&nbsp;<span class="keyword">mod</span>&nbsp;8&nbsp;)&nbsp;)&nbsp;)&nbsp;<span class="keyword">mod</span>&nbsp;2&nbsp;)&nbsp;)&nbsp;*&nbsp;maximum<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pbm_binary_int_unicolor filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pbm_binary_int_unicolor&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;read_pbm_binary_int_gray&nbsp;s&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pbm_binary_int_rbg filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pbm_binary_int_rbg&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;read_pbm_binary_int_gray&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;g&nbsp;=&nbsp;<span class="constructor">Matrix</span>.matrix_int_copy&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Matrix</span>.matrix_int_copy&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;[|&nbsp;r&nbsp;;&nbsp;g&nbsp;;&nbsp;b&nbsp;|]<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pbm_binary_color filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pbm_binary_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;(&nbsp;*&nbsp;)&nbsp;65793&nbsp;)&nbsp;)&nbsp;(&nbsp;read_pbm_binary_int_gray&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pbm_binary_float_gray filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pbm_binary_float_gray&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;float&nbsp;)&nbsp;(&nbsp;read_pbm_binary_int_gray&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pbm_binary_float_unicolor filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pbm_binary_float_unicolor&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;read_pbm_binary_float_gray&nbsp;s&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pbm_binary_float_rgb filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pbm_binary_float_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;read_pbm_binary_float_gray&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;g&nbsp;=&nbsp;<span class="constructor">Matrix</span>.matrix_float_copy&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Matrix</span>.matrix_float_copy&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;[|&nbsp;r&nbsp;;&nbsp;g&nbsp;;&nbsp;b&nbsp;|]<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pgm_binary_int_gray filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pgm_binary_int_gray&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;e&nbsp;=&nbsp;read_pnm_header&nbsp;s<br>
&nbsp;<span class="keyword">and</span>&nbsp;dot&nbsp;=&nbsp;<span class="constructor">String</span>.make&nbsp;1&nbsp;(&nbsp;char_of_int&nbsp;10&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;e.(0).[1]&nbsp;!=&nbsp;<span class="string">'5'</span>&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;pgm_binary&nbsp;file&nbsp;in&nbsp;Readwrite.read_pgm_binary_int_gray."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;one&nbsp;=&nbsp;l&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;two&nbsp;=&nbsp;l&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;sharp&nbsp;=&nbsp;(&nbsp;<span class="keyword">if</span>&nbsp;l&nbsp;=&nbsp;3&nbsp;<span class="keyword">then</span>&nbsp;<span class="string">""</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="constructor">Array</span>.fold_left&nbsp;(&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x&nbsp;^&nbsp;dot&nbsp;^&nbsp;y&nbsp;)&nbsp;<span class="string">""</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;e&nbsp;1&nbsp;(&nbsp;l&nbsp;-&nbsp;3&nbsp;)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;size&nbsp;=&nbsp;e.(one)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;depth&nbsp;=&nbsp;e.(two)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Str</span>.regexp_string&nbsp;<span class="string">"&nbsp;"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dim&nbsp;=&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;<span class="constructor">Str</span>.split&nbsp;r&nbsp;size&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;atom&nbsp;=&nbsp;int_of_string&nbsp;depth&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;atom&nbsp;!=&nbsp;255&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Only&nbsp;gray&nbsp;files&nbsp;with&nbsp;depth&nbsp;255&nbsp;are&nbsp;taken&nbsp;in&nbsp;account&nbsp;in&nbsp;Readwrite.read_pgm_binary_int_gray."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;int_of_string&nbsp;dim.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;int_of_string&nbsp;dim.(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;chaine&nbsp;=&nbsp;e.(0)&nbsp;^&nbsp;dot&nbsp;^&nbsp;e.(one)&nbsp;^&nbsp;dot&nbsp;^&nbsp;e.(two)&nbsp;^&nbsp;dot&nbsp;^&nbsp;sharp&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;offset&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;chaine&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;array_read_binary_file&nbsp;(&nbsp;offset&nbsp;+&nbsp;l&nbsp;*&nbsp;c&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Util</span>.vector_to_matrix&nbsp;l&nbsp;c&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;v&nbsp;offset&nbsp;(&nbsp;l&nbsp;*&nbsp;c&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pgm_binary_int_unicolor filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pgm_binary_int_unicolor&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;read_pgm_binary_int_gray&nbsp;s&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pgm_binary_int_rbg filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pgm_binary_int_rbg&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;read_pgm_binary_int_gray&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;g&nbsp;=&nbsp;<span class="constructor">Matrix</span>.matrix_int_copy&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Matrix</span>.matrix_int_copy&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;[|&nbsp;r&nbsp;;&nbsp;g&nbsp;;&nbsp;b&nbsp;|]<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_pgm_binary_int_unicolor matrix filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_pgm_binary_int_unicolor&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;output_string&nbsp;oc&nbsp;(&nbsp;<span class="string">"P5\n"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;c&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;l&nbsp;)&nbsp;^&nbsp;<span class="string">"\n255\n"</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;set_binary_mode_out&nbsp;oc&nbsp;<span class="keyword">true</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;row.(j)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pgm_binary_color filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pgm_binary_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;(&nbsp;*&nbsp;)&nbsp;65793&nbsp;)&nbsp;)&nbsp;(&nbsp;read_pgm_binary_int_gray&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pgm_binary_float_gray filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pgm_binary_float_gray&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Array</span>.map&nbsp;float&nbsp;)&nbsp;(&nbsp;read_pgm_binary_int_gray&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pgm_binary_float_unicolor filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pgm_binary_float_unicolor&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;read_pgm_binary_float_gray&nbsp;s&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pgm_binary_float_rgb filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pgm_binary_float_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;read_pgm_binary_float_gray&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;g&nbsp;=&nbsp;<span class="constructor">Matrix</span>.matrix_float_copy&nbsp;r<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Matrix</span>.matrix_float_copy&nbsp;r&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;[|&nbsp;r&nbsp;;&nbsp;g&nbsp;;&nbsp;b&nbsp;|]<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_pgm_binary_float_unicolor matrix filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_pgm_binary_float_unicolor&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;output_string&nbsp;oc&nbsp;(&nbsp;<span class="string">"P5\n"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;c&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;l&nbsp;)&nbsp;^&nbsp;<span class="string">"\n255\n"</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;set_binary_mode_out&nbsp;oc&nbsp;<span class="keyword">true</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;(&nbsp;min&nbsp;255&nbsp;(&nbsp;<span class="constructor">Util</span>.round&nbsp;row.(j)&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_int_rgb filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_int_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;e&nbsp;=&nbsp;read_pnm_header&nbsp;s<br>
&nbsp;<span class="keyword">and</span>&nbsp;dot&nbsp;=&nbsp;<span class="constructor">String</span>.make&nbsp;1&nbsp;(&nbsp;char_of_int&nbsp;10&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;e.(0).[1]&nbsp;!=&nbsp;<span class="string">'6'</span>&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;ppm_binary&nbsp;file&nbsp;in&nbsp;Readwrite.read_ppm_binary_int_rgb."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;one&nbsp;=&nbsp;l&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;two&nbsp;=&nbsp;l&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;sharp&nbsp;=&nbsp;(&nbsp;<span class="keyword">if</span>&nbsp;l&nbsp;=&nbsp;3&nbsp;<span class="keyword">then</span>&nbsp;<span class="string">""</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="constructor">Array</span>.fold_left&nbsp;(&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x&nbsp;^&nbsp;dot&nbsp;^&nbsp;y&nbsp;)&nbsp;<span class="string">""</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;e&nbsp;1&nbsp;(&nbsp;l&nbsp;-&nbsp;3&nbsp;)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;size&nbsp;=&nbsp;e.(one)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;depth&nbsp;=&nbsp;e.(two)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Str</span>.regexp_string&nbsp;<span class="string">"&nbsp;"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dim&nbsp;=&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;<span class="constructor">Str</span>.split&nbsp;r&nbsp;size&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;atom&nbsp;=&nbsp;int_of_string&nbsp;depth&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;atom&nbsp;!=&nbsp;255&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Only&nbsp;color&nbsp;files&nbsp;with&nbsp;depth&nbsp;255&nbsp;are&nbsp;taken&nbsp;in&nbsp;account&nbsp;in&nbsp;Readwrite.read_ppm_binary_int_rgb."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;int_of_string&nbsp;dim.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;int_of_string&nbsp;dim.(1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dot&nbsp;=&nbsp;<span class="constructor">String</span>.make&nbsp;1&nbsp;(&nbsp;char_of_int&nbsp;10&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;chaine&nbsp;=&nbsp;e.(0)&nbsp;^&nbsp;dot&nbsp;^&nbsp;e.(one)&nbsp;^&nbsp;dot&nbsp;^&nbsp;e.(two)&nbsp;^&nbsp;dot&nbsp;^&nbsp;sharp<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;taille&nbsp;=&nbsp;3&nbsp;*&nbsp;l&nbsp;*&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;offset&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;chaine&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;array_read_binary_file&nbsp;(&nbsp;offset&nbsp;+&nbsp;taille&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;v&nbsp;offset&nbsp;taille&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Util</span>.vector_to_matrix&nbsp;l&nbsp;c&nbsp;)&nbsp;(&nbsp;<span class="constructor">Util</span>.vector_spray&nbsp;3&nbsp;vv&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_int_red filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_int_red&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;(&nbsp;read_ppm_binary_int_rgb&nbsp;s&nbsp;).(0)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_int_green filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_int_green&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;(&nbsp;read_ppm_binary_int_rgb&nbsp;s&nbsp;).(1)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_int_blue filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_int_blue&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;(&nbsp;read_ppm_binary_int_rgb&nbsp;s&nbsp;).(2)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_ppm_binary_int_rgb rgb_matrix filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_ppm_binary_int_rgb&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;red&nbsp;=&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;green&nbsp;=&nbsp;m.(1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;blue&nbsp;=&nbsp;m.(2)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;blue<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;blue.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;output_string&nbsp;oc&nbsp;(&nbsp;<span class="string">"P6\n"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;c&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;l&nbsp;)&nbsp;^&nbsp;<span class="string">"\n255\n"</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;set_binary_mode_out&nbsp;oc&nbsp;<span class="keyword">true</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_red&nbsp;=&nbsp;red.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_green&nbsp;=&nbsp;green.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_blue&nbsp;=&nbsp;blue.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;row_red.(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;row_green.(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;row_blue.(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_color filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;e&nbsp;=&nbsp;read_pnm_header&nbsp;s<br>
&nbsp;<span class="keyword">and</span>&nbsp;dot&nbsp;=&nbsp;<span class="constructor">String</span>.make&nbsp;1&nbsp;(&nbsp;char_of_int&nbsp;10&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;e.(0).[1]&nbsp;!=&nbsp;<span class="string">'6'</span>&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;ppm_binary&nbsp;file&nbsp;in&nbsp;Readwrite.read_ppm_binary_color."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;one&nbsp;=&nbsp;l&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;two&nbsp;=&nbsp;l&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;sharp&nbsp;=&nbsp;(&nbsp;<span class="keyword">if</span>&nbsp;l&nbsp;=&nbsp;3&nbsp;<span class="keyword">then</span>&nbsp;<span class="string">""</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="constructor">Array</span>.fold_left&nbsp;(&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x&nbsp;^&nbsp;dot&nbsp;^&nbsp;y&nbsp;)&nbsp;<span class="string">""</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;e&nbsp;1&nbsp;(&nbsp;l&nbsp;-&nbsp;3&nbsp;)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;size&nbsp;=&nbsp;e.(one)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;depth&nbsp;=&nbsp;e.(two)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Str</span>.regexp_string&nbsp;<span class="string">"&nbsp;"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dim&nbsp;=&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;<span class="constructor">Str</span>.split&nbsp;r&nbsp;size&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;atom&nbsp;=&nbsp;int_of_string&nbsp;depth&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;atom&nbsp;!=&nbsp;255&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Only&nbsp;color&nbsp;files&nbsp;with&nbsp;depth&nbsp;255&nbsp;are&nbsp;taken&nbsp;in&nbsp;account&nbsp;in&nbsp;Readwrite.read_ppm_binary_color."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;int_of_string&nbsp;dim.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;int_of_string&nbsp;dim.(1)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;chaine&nbsp;=&nbsp;e.(0)&nbsp;^&nbsp;dot&nbsp;^&nbsp;e.(one)&nbsp;^&nbsp;dot&nbsp;^&nbsp;e.(two)&nbsp;^&nbsp;dot&nbsp;^&nbsp;sharp<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;length&nbsp;=&nbsp;l&nbsp;*&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;offset&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;chaine<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;taille&nbsp;=&nbsp;3&nbsp;*&nbsp;length&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;array_read_binary_file&nbsp;(&nbsp;offset&nbsp;+&nbsp;taille&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;v&nbsp;offset&nbsp;taille<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;vvv&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;length&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;length&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ii&nbsp;=&nbsp;3&nbsp;*&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vvv.(i)&nbsp;&lt;-&nbsp;(&nbsp;(&nbsp;256&nbsp;*&nbsp;vv.(ii)&nbsp;)&nbsp;+&nbsp;vv.(&nbsp;ii&nbsp;+&nbsp;1&nbsp;)&nbsp;)&nbsp;*&nbsp;256&nbsp;+&nbsp;vv.(&nbsp;ii&nbsp;+&nbsp;2&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Util</span>.vector_to_matrix&nbsp;l&nbsp;c&nbsp;vvv&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_ppm_binary_color matrix filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_ppm_binary_color&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;output_string&nbsp;oc&nbsp;(&nbsp;<span class="string">"P6\n"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;c&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;l&nbsp;)&nbsp;^&nbsp;<span class="string">"\n255\n"</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;set_binary_mode_out&nbsp;oc&nbsp;<span class="keyword">true</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row&nbsp;=&nbsp;m.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;row.(j)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;x&nbsp;/&nbsp;256&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;(&nbsp;xx&nbsp;/&nbsp;256&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;(&nbsp;xx&nbsp;<span class="keyword">mod</span>&nbsp;256&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;(&nbsp;x&nbsp;<span class="keyword">mod</span>&nbsp;256&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_float_rgb filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_float_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;e&nbsp;=&nbsp;read_pnm_header&nbsp;s<br>
&nbsp;<span class="keyword">and</span>&nbsp;dot&nbsp;=&nbsp;<span class="constructor">String</span>.make&nbsp;1&nbsp;(&nbsp;char_of_int&nbsp;10&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;e.(0).[1]&nbsp;!=&nbsp;<span class="string">'6'</span>&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;ppm_binary&nbsp;file&nbsp;in&nbsp;Readwrite.read_ppm_binary_float_rgb."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;e&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;one&nbsp;=&nbsp;l&nbsp;-&nbsp;2<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;two&nbsp;=&nbsp;l&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;sharp&nbsp;=&nbsp;(&nbsp;<span class="keyword">if</span>&nbsp;l&nbsp;=&nbsp;3&nbsp;<span class="keyword">then</span>&nbsp;<span class="string">""</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="constructor">Array</span>.fold_left&nbsp;(&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x&nbsp;^&nbsp;dot&nbsp;^&nbsp;y&nbsp;)&nbsp;<span class="string">""</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;e&nbsp;1&nbsp;(&nbsp;l&nbsp;-&nbsp;3&nbsp;)&nbsp;)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;size&nbsp;=&nbsp;e.(one)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;depth&nbsp;=&nbsp;e.(two)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Str</span>.regexp_string&nbsp;<span class="string">"&nbsp;"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dim&nbsp;=&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;<span class="constructor">Str</span>.split&nbsp;r&nbsp;size&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;atom&nbsp;=&nbsp;int_of_string&nbsp;depth&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;atom&nbsp;!=&nbsp;255&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Only&nbsp;color&nbsp;files&nbsp;with&nbsp;depth&nbsp;255&nbsp;are&nbsp;taken&nbsp;in&nbsp;account&nbsp;in&nbsp;Readwrite.read_ppm_binary_float_rgb."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;int_of_string&nbsp;dim.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;int_of_string&nbsp;dim.(1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;dot&nbsp;=&nbsp;<span class="constructor">String</span>.make&nbsp;1&nbsp;(&nbsp;char_of_int&nbsp;10&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;chaine&nbsp;=&nbsp;e.(0)&nbsp;^&nbsp;dot&nbsp;^&nbsp;e.(one)&nbsp;^&nbsp;dot&nbsp;^&nbsp;e.(two)&nbsp;^&nbsp;dot&nbsp;^&nbsp;sharp&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;offset&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;chaine<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;taille&nbsp;=&nbsp;3&nbsp;*&nbsp;l&nbsp;*&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;array_read_binary_file&nbsp;(&nbsp;offset&nbsp;+&nbsp;taille&nbsp;)&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vv&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;float&nbsp;(&nbsp;<span class="constructor">Array</span>.sub&nbsp;v&nbsp;offset&nbsp;taille&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Util</span>.vector_to_matrix&nbsp;l&nbsp;c&nbsp;)&nbsp;(&nbsp;<span class="constructor">Util</span>.vector_spray&nbsp;3&nbsp;vv&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_float_red filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_float_red&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;(&nbsp;read_ppm_binary_float_rgb&nbsp;s&nbsp;).(0)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_float_green filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_float_green&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;(&nbsp;read_ppm_binary_float_rgb&nbsp;s&nbsp;).(1)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_float_blue filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_float_blue&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;(&nbsp;read_ppm_binary_float_rgb&nbsp;s&nbsp;).(2)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_ppm_binary_float_rgb rgb_matrix filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_ppm_binary_float_rgb&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;red&nbsp;=&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;green&nbsp;=&nbsp;m.(1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;blue&nbsp;=&nbsp;m.(2)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;blue<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;blue.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;output_string&nbsp;oc&nbsp;(&nbsp;<span class="string">"P6\n"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;c&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;l&nbsp;)&nbsp;^&nbsp;<span class="string">"\n255\n"</span>&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;set_binary_mode_out&nbsp;oc&nbsp;<span class="keyword">true</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_red&nbsp;=&nbsp;red.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_green&nbsp;=&nbsp;green.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_blue&nbsp;=&nbsp;blue.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;(&nbsp;&nbsp;min&nbsp;255&nbsp;(&nbsp;<span class="constructor">Util</span>.round&nbsp;row_red.(j)&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;(&nbsp;min&nbsp;255&nbsp;(&nbsp;<span class="constructor">Util</span>.round&nbsp;row_green.(j)&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;(&nbsp;min&nbsp;255&nbsp;(&nbsp;<span class="constructor">Util</span>.round&nbsp;row_blue.(j)&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_under_sample_float_rgb edge filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_under_sample_float_rgb&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_rgb_under_sample&nbsp;n&nbsp;(&nbsp;read_ppm_binary_float_rgb&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_under_sample_float_red edge filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_under_sample_float_red&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_unicolor_under_sample&nbsp;n&nbsp;(&nbsp;read_ppm_binary_float_red&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_under_sample_float_green edge filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_under_sample_float_green&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_unicolor_under_sample&nbsp;n&nbsp;(&nbsp;read_ppm_binary_float_green&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_under_sample_float_blue edge filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_under_sample_float_blue&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_unicolor_under_sample&nbsp;n&nbsp;(&nbsp;read_ppm_binary_float_blue&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_under_sample_color edge filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_under_sample_color&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_rgb_to_color&nbsp;(&nbsp;read_ppm_binary_under_sample_float_rgb&nbsp;n&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_under_sample_int_rgb edge filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_under_sample_int_rgb&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;matrix_float_rgb_to_int_rgb&nbsp;(&nbsp;read_ppm_binary_under_sample_float_rgb&nbsp;n&nbsp;fname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_under_sample_int_red edge filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_under_sample_int_red&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Matrix</span>.matrix_int_clip&nbsp;255&nbsp;(&nbsp;<span class="constructor">Matrix</span>.matrix_float_round&nbsp;(&nbsp;read_ppm_binary_under_sample_float_red&nbsp;n&nbsp;fname&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_under_sample_int_green edge filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_under_sample_int_green&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Matrix</span>.matrix_int_clip&nbsp;255&nbsp;(&nbsp;<span class="constructor">Matrix</span>.matrix_float_round&nbsp;(&nbsp;read_ppm_binary_under_sample_float_green&nbsp;n&nbsp;fname&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_ppm_binary_under_sample_int_blue edge filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_ppm_binary_under_sample_int_blue&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(n:int)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Matrix</span>.matrix_int_clip&nbsp;255&nbsp;(&nbsp;<span class="constructor">Matrix</span>.matrix_float_round&nbsp;(&nbsp;read_ppm_binary_under_sample_float_blue&nbsp;n&nbsp;fname&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Fichiersdimagesbitmap"><h1>Fichiers d'images bitmap</h1></span>
<span id="1_Bitmappicturefiles"><h1>Bitmap picture files</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** A description of the bmp format is available in the numbers 62 and 100 of the magazine LOGIN: pages 64-67.
<p>

Une description du format bmp est disponible dans les numéros 62 et 100 du magazine LOGIN: pages 64-67. *)</span></td></tr></table><code class="code"><br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>f32 offset array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;f32&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(x:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;string_of_int&nbsp;(&nbsp;x.(i)&nbsp;+&nbsp;256&nbsp;*&nbsp;(&nbsp;x.(&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;+&nbsp;256&nbsp;*&nbsp;(&nbsp;x.(&nbsp;i&nbsp;+&nbsp;2&nbsp;)&nbsp;+&nbsp;256&nbsp;*&nbsp;x.(&nbsp;i&nbsp;+&nbsp;3&nbsp;)&nbsp;)&nbsp;)&nbsp;)<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>f16 offset array</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;f16&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(i:int)&nbsp;(x:int&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;string_of_int&nbsp;(&nbsp;x.(i)&nbsp;+&nbsp;256&nbsp;*&nbsp;(&nbsp;x.(&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;)&nbsp;)<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>g16 integer</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;g16&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;[|&nbsp;x&nbsp;<span class="keyword">mod</span>&nbsp;256&nbsp;;&nbsp;x&nbsp;/&nbsp;256&nbsp;|]<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>g32 integer</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;g32&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(x:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;xx&nbsp;=&nbsp;x&nbsp;<span class="keyword">mod</span>&nbsp;256&nbsp;<span class="keyword">in</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;/&nbsp;256&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;yy&nbsp;=&nbsp;y&nbsp;<span class="keyword">mod</span>&nbsp;256<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;z&nbsp;=&nbsp;y&nbsp;/&nbsp;256&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;zz&nbsp;=&nbsp;z&nbsp;<span class="keyword">mod</span>&nbsp;256&nbsp;<span class="keyword">in</span><br>
&nbsp;[|&nbsp;xx&nbsp;;&nbsp;yy&nbsp;;&nbsp;zz&nbsp;;&nbsp;x&nbsp;/&nbsp;16777216&nbsp;|]<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_bmp_header filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_bmp_header&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;a&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;53&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;:=&nbsp;(&nbsp;input_byte&nbsp;ic&nbsp;)&nbsp;::&nbsp;!a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close_in_noerr&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;<span class="constructor">List</span>.rev&nbsp;!a&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;char_of_int&nbsp;b.(0)&nbsp;&lt;&gt;&nbsp;<span class="string">'B'</span>&nbsp;)&nbsp;<span class="keywordsign">||</span>&nbsp;(&nbsp;char_of_int&nbsp;b.(1)&nbsp;&lt;&gt;&nbsp;<span class="string">'M'</span>&nbsp;)&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;magic&nbsp;number&nbsp;in&nbsp;Readwrite.read_bmp_header."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;16&nbsp;<span class="string">"BM"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(1)&nbsp;&lt;-&nbsp;f32&nbsp;2&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(2)&nbsp;&lt;-&nbsp;f16&nbsp;6&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(3)&nbsp;&lt;-&nbsp;f16&nbsp;8&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(4)&nbsp;&lt;-&nbsp;f32&nbsp;10&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(5)&nbsp;&lt;-&nbsp;f32&nbsp;14&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(6)&nbsp;&lt;-&nbsp;f32&nbsp;18&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(7)&nbsp;&lt;-&nbsp;f32&nbsp;22&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(8)&nbsp;&lt;-&nbsp;f16&nbsp;26&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(9)&nbsp;&lt;-&nbsp;f16&nbsp;28&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(10)&nbsp;&lt;-&nbsp;f32&nbsp;30&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(11)&nbsp;&lt;-&nbsp;f32&nbsp;34&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(12)&nbsp;&lt;-&nbsp;f32&nbsp;38&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(13)&nbsp;&lt;-&nbsp;f32&nbsp;42&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(14)&nbsp;&lt;-&nbsp;f32&nbsp;46&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.(15)&nbsp;&lt;-&nbsp;f32&nbsp;50&nbsp;b&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_raw_bmp_int_rgb filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_raw_bmp_int_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;read_bmp_header&nbsp;fname<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;offset&nbsp;=&nbsp;54&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;int_of_string&nbsp;h.(10)&nbsp;&lt;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failwith&nbsp;<span class="string">"Compressed&nbsp;format&nbsp;in&nbsp;Readwrite.read_raw_bmp_int_rgb."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;int_of_string&nbsp;h.(9)&nbsp;&lt;&gt;&nbsp;24&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failwith&nbsp;<span class="string">"Number&nbsp;of&nbsp;bits&nbsp;per&nbsp;pixel&nbsp;not&nbsp;programmed&nbsp;in&nbsp;Readwrite.read_raw_bmp_int_rgb."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;width&nbsp;=&nbsp;int_of_string&nbsp;h.(6)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;height&nbsp;=&nbsp;int_of_string&nbsp;h.(7)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;pred&nbsp;width<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;hh&nbsp;=&nbsp;pred&nbsp;height<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;tw&nbsp;=&nbsp;3&nbsp;*&nbsp;width<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;height&nbsp;width&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;height&nbsp;width&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;height&nbsp;width&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;a&nbsp;=&nbsp;ref&nbsp;(&nbsp;array_read_binary_file&nbsp;(&nbsp;width&nbsp;*&nbsp;height&nbsp;+&nbsp;offset&nbsp;)&nbsp;fname&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;:=&nbsp;<span class="constructor">Util</span>.array_end&nbsp;offset&nbsp;!a&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;hh&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ii&nbsp;=&nbsp;(&nbsp;hh&nbsp;-&nbsp;i&nbsp;)&nbsp;*&nbsp;tw<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;red_output&nbsp;=&nbsp;r.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;green_output&nbsp;=&nbsp;g.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;blue_output&nbsp;=&nbsp;b.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;ww&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;jj&nbsp;=&nbsp;3&nbsp;*&nbsp;j&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blue_output.(j)&nbsp;&lt;-&nbsp;!a.(&nbsp;ii&nbsp;+&nbsp;jj&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;green_output.(j)&nbsp;&lt;-&nbsp;!a.(&nbsp;ii&nbsp;+&nbsp;jj&nbsp;+&nbsp;1&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;red_output.(j)&nbsp;&lt;-&nbsp;!a.(&nbsp;ii&nbsp;+&nbsp;jj&nbsp;+&nbsp;2&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;r&nbsp;;&nbsp;g&nbsp;;&nbsp;b&nbsp;|]<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Error&nbsp;in&nbsp;Readwrite.read_raw_bmp_int_rgb."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_raw_bmp_red filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_raw_bmp_red&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;(&nbsp;read_raw_bmp_int_rgb&nbsp;fname&nbsp;).(0)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Error&nbsp;in&nbsp;Readwrite.read_raw_bmp_red."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_raw_bmp_green filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_raw_bmp_green&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;(&nbsp;read_raw_bmp_int_rgb&nbsp;fname&nbsp;).(1)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Error&nbsp;in&nbsp;Readwrite.read_raw_bmp_red."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_raw_bmp_blue filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_raw_bmp_blue&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;(&nbsp;read_raw_bmp_int_rgb&nbsp;fname&nbsp;).(2)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Error&nbsp;in&nbsp;Readwrite.read_raw_bmp_blue."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_raw_bmp_color filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_raw_bmp_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;matrix_int_rgb_to_color&nbsp;(&nbsp;read_raw_bmp_int_rgb&nbsp;fname&nbsp;)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Error&nbsp;in&nbsp;Readwrite.read_raw_bmp_color."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_palette_bmp_int_rgb filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_palette_bmp_int_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;read_bmp_header&nbsp;fname<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;decalage&nbsp;=&nbsp;54&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;int_of_string&nbsp;h.(10)&nbsp;&lt;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failwith&nbsp;<span class="string">"Compressed&nbsp;format&nbsp;in&nbsp;Readwrite.read_palette_bmp_int_rgb."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;int_of_string&nbsp;h.(9)&nbsp;&lt;&gt;&nbsp;8&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failwith&nbsp;<span class="string">"Number&nbsp;of&nbsp;bits&nbsp;per&nbsp;pixel&nbsp;not&nbsp;programmed&nbsp;in&nbsp;Readwrite.read_palette_bmp_int_rgb."</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;size&nbsp;=&nbsp;int_of_string&nbsp;h.(11)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;file_size&nbsp;=&nbsp;int_of_string&nbsp;h.(1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;height&nbsp;=&nbsp;int_of_string&nbsp;h.(7)&nbsp;<span class="keyword">in</span><br>
</code><table><tr><td></td><td><span class="comment">(** Errors in the declaration of the number of columns are possible.
<p>

Des erreurs sur la déclaration du nombre de colonnes sont possibles. *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;width&nbsp;=&nbsp;max&nbsp;(&nbsp;int_of_string&nbsp;h.(6)&nbsp;)&nbsp;(&nbsp;size&nbsp;/&nbsp;height&nbsp;)<br>
</code><table><tr><td></td><td><span class="comment">(** The offset after the header is not always equal to 1024=256*4.
<p>

Le décalage après l'entête ne vaut pas toujours 1024=256*4. *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;offset&nbsp;=&nbsp;(&nbsp;min&nbsp;(&nbsp;int_of_string&nbsp;h.(4)&nbsp;)&nbsp;(&nbsp;file_size&nbsp;-&nbsp;size&nbsp;)&nbsp;)&nbsp;-&nbsp;54<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;a&nbsp;=&nbsp;ref&nbsp;(&nbsp;array_read_binary_file&nbsp;(&nbsp;file_size&nbsp;)&nbsp;fname&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;:=&nbsp;<span class="constructor">Util</span>.array_end&nbsp;decalage&nbsp;!a&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ww&nbsp;=&nbsp;pred&nbsp;width<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;hh&nbsp;=&nbsp;pred&nbsp;height<br>
</code><table><tr><td></td><td><span class="comment">(** The format of the palette is bb gg rr 00 with four bytes per color.
<p>

Le format de la palette est bb gg rr 00 avec quatre octets par couleur. *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;palette&nbsp;=&nbsp;&nbsp;<span class="constructor">Array</span>.sub&nbsp;!a&nbsp;0&nbsp;offset<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;r&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;height&nbsp;width&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;height&nbsp;width&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;height&nbsp;width&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;:=&nbsp;<span class="constructor">Util</span>.array_end&nbsp;offset&nbsp;!a&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;hh&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;red_output&nbsp;=&nbsp;r.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;green_output&nbsp;=&nbsp;g.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;blue_output&nbsp;=&nbsp;b.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ii&nbsp;=&nbsp;(&nbsp;hh&nbsp;-&nbsp;i&nbsp;)&nbsp;*&nbsp;width&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;ww&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;color&nbsp;=&nbsp;4&nbsp;*&nbsp;!a.(&nbsp;ii&nbsp;+&nbsp;j&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;code&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;palette&nbsp;color&nbsp;4&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blue_output.(j)&nbsp;&lt;-&nbsp;code.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;green_output.(j)&nbsp;&lt;-&nbsp;code.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;red_output.(j)&nbsp;&lt;-&nbsp;code.(2)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;r&nbsp;;&nbsp;g&nbsp;;&nbsp;b&nbsp;|]<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Error&nbsp;in&nbsp;Readwrite.read_palette_bmp_int_rgb."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_palette_bmp_red filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_palette_bmp_red&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;(&nbsp;read_palette_bmp_int_rgb&nbsp;fname&nbsp;).(0)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Error&nbsp;in&nbsp;Readwrite.read_palette_bmp_red."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_palette_bmp_green filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_palette_bmp_green&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;(&nbsp;read_palette_bmp_int_rgb&nbsp;fname&nbsp;).(1)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Error&nbsp;in&nbsp;Readwrite.read_palette_bmp_red."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_palette_bmp_blue filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_palette_bmp_blue&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;(&nbsp;read_palette_bmp_int_rgb&nbsp;fname&nbsp;).(2)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Error&nbsp;in&nbsp;Readwrite.read_palette_bmp_blue."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_palette_bmp_color filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_palette_bmp_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;matrix_int_rgb_to_color&nbsp;(&nbsp;read_palette_bmp_int_rgb&nbsp;fname&nbsp;)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Error&nbsp;in&nbsp;Readwrite.read_palette_bmp_color."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_bmp_int_rgb filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_bmp_int_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;read_raw_bmp_int_rgb&nbsp;fname<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;read_palette_bmp_int_rgb&nbsp;fname<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Fomat&nbsp;not&nbsp;programmed&nbsp;in&nbsp;Readwrite.read_bmp_int_rgb."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_bmp_red filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_bmp_red&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;(&nbsp;read_bmp_int_rgb&nbsp;fname&nbsp;).(0)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Fomat&nbsp;not&nbsp;programmed&nbsp;in&nbsp;Readwrite.read_bmp_red."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_bmp_green filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_bmp_green&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;(&nbsp;read_bmp_int_rgb&nbsp;fname&nbsp;).(1)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Fomat&nbsp;not&nbsp;programmed&nbsp;in&nbsp;Readwrite.read_bmp_green."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_bmp_blue filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_bmp_blue&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;(&nbsp;read_bmp_int_rgb&nbsp;fname&nbsp;).(2)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Fomat&nbsp;not&nbsp;programmed&nbsp;in&nbsp;Readwrite.read_bmp_blue."</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_bmp_color filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_bmp_color&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;matrix_int_rgb_to_color&nbsp;(&nbsp;read_bmp_int_rgb&nbsp;fname&nbsp;)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;failwith&nbsp;<span class="string">"Fomat&nbsp;not&nbsp;programmed&nbsp;in&nbsp;Readwrite.read_bmp_color."</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>bmp_header_of_rgb rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;bmp_header_of_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(m:int&nbsp;array&nbsp;array&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;w&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0).(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;size&nbsp;=&nbsp;3&nbsp;*&nbsp;h&nbsp;*&nbsp;w&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;file_size&nbsp;=&nbsp;54&nbsp;+&nbsp;size&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.concat&nbsp;[&nbsp;[|&nbsp;int_of_char&nbsp;<span class="string">'B'</span>&nbsp;;&nbsp;int_of_char&nbsp;<span class="string">'M'</span>&nbsp;;&nbsp;|]&nbsp;;&nbsp;g32&nbsp;file_size&nbsp;;&nbsp;g16&nbsp;0&nbsp;;&nbsp;g16&nbsp;0&nbsp;;&nbsp;g32&nbsp;54&nbsp;;&nbsp;g32&nbsp;40&nbsp;;&nbsp;g32&nbsp;w&nbsp;;&nbsp;g32&nbsp;h&nbsp;;&nbsp;g16&nbsp;1&nbsp;;&nbsp;g16&nbsp;24&nbsp;;&nbsp;g32&nbsp;0&nbsp;;&nbsp;g32&nbsp;size&nbsp;;&nbsp;g32&nbsp;3780&nbsp;;&nbsp;g32&nbsp;3780&nbsp;;&nbsp;g32&nbsp;0&nbsp;;&nbsp;g32&nbsp;0&nbsp;]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_bmp_int_rgb rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_bmp_int_rgb&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;a&nbsp;=&nbsp;bmp_header_of_rgb&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;red&nbsp;=&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;green&nbsp;=&nbsp;m.(1)<br>
&nbsp;<span class="keyword">and</span>&nbsp;blue&nbsp;=&nbsp;m.(2)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;set_binary_mode_out&nbsp;oc&nbsp;<span class="keyword">true</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;a&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;a.(i)<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;hh&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;red&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ww&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;red.(0)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;hh&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;row_red&nbsp;=&nbsp;red.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_green&nbsp;=&nbsp;green.(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;row_blue&nbsp;=&nbsp;blue.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;ww&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;row_blue.(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;row_green.(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;row_red.(j)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_bmp_color rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_bmp_color&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:int&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_color_to_int_rgb&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;write_bmp_int_rgb&nbsp;mm&nbsp;fname&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_bmp_float_rgb rgb_matrix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_bmp_float_rgb&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;mm&nbsp;=&nbsp;matrix_float_rgb_to_int_rgb&nbsp;m&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;write_bmp_int_rgb&nbsp;mm&nbsp;fname&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Fichierssonsau"><h1>Fichiers sons au</h1></span>
<span id="1_Ausoundfiles"><h1>Au sound files</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_header_au</pre> This function is only for 64 bits platforms. The output has the following form:
<p>

<code class="code">[| magic_type ; offset ; size ; encoding ; sample_rate ; channels |]</code>
<p>

La sortie a la forme précédente.
Cette fonction est réservée aux plateformes 64 bits. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_header_au&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in_bin&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;6&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;type_snd&nbsp;=&nbsp;<span class="constructor">Int32</span>.to_int&nbsp;(&nbsp;<span class="constructor">Int32</span>.of_string&nbsp;<span class="string">"0x2e736e64"</span>&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
</code><table><tr><td></td><td><span class="comment">(** magic_type *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(0)&nbsp;&lt;-&nbsp;input_binary_int&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;compare&nbsp;type_snd&nbsp;v.(0)&nbsp;!=&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;valid&nbsp;file&nbsp;in&nbsp;Readwrite.read_header_au."</span>&nbsp;;<br>
</code><table><tr><td></td><td><span class="comment">(** offset *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(1)&nbsp;&lt;-&nbsp;input_binary_int&nbsp;ic&nbsp;;<br>
</code><table><tr><td></td><td><span class="comment">(** size *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(2)&nbsp;&lt;-&nbsp;input_binary_int&nbsp;ic&nbsp;;<br>
</code><table><tr><td></td><td><span class="comment">(** encoding *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(3)&nbsp;&lt;-&nbsp;input_binary_int&nbsp;ic&nbsp;;<br>
</code><table><tr><td></td><td><span class="comment">(** sample_rate *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(4)&nbsp;&lt;-&nbsp;input_binary_int&nbsp;ic&nbsp;;<br>
</code><table><tr><td></td><td><span class="comment">(** channels *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;v.(5)&nbsp;&lt;-&nbsp;input_binary_int&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;close_in_noerr&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;close_in_noerr&nbsp;ic&nbsp;;&nbsp;failwith&nbsp;<span class="string">"Not&nbsp;a&nbsp;valid&nbsp;header&nbsp;in&nbsp;Readwrite.read_header_au."</span>&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;v&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_float32_au</pre> This function is only for 64 bits platforms.
<p>

Cette fonction est réservée aux plateformes 64 bits. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_float32_au&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;read_header_au&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;ic&nbsp;=&nbsp;open_in_bin&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;compare&nbsp;h.(3)&nbsp;6&nbsp;!=&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;encoding&nbsp;in&nbsp;Readwrite.read_float32_au."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span>&nbsp;seek_in&nbsp;ic&nbsp;h.(1)&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;offset&nbsp;in&nbsp;Readwrite.read_float32_au."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;ref&nbsp;[]<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;channels&nbsp;=&nbsp;h.(5)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;count&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;:=&nbsp;(&nbsp;input_binary_int&nbsp;ic&nbsp;)&nbsp;::&nbsp;!l&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;:=&nbsp;succ&nbsp;!count&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;samples&nbsp;=&nbsp;!count&nbsp;/&nbsp;channels&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;channels&nbsp;samples&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;pred&nbsp;channels&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;pred&nbsp;samples&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;c&nbsp;<span class="keyword">downto</span>&nbsp;0&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.(j).(i)&nbsp;&lt;-&nbsp;<span class="constructor">Int32</span>.float_of_bits&nbsp;(&nbsp;<span class="constructor">Int32</span>.of_int&nbsp;(&nbsp;<span class="constructor">List</span>.hd&nbsp;!l&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;:=&nbsp;<span class="constructor">List</span>.tl&nbsp;!l<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_vector_float_to_float32_au</pre> This function is only for 64 bits platforms.
<p>

Cette fonction est réservée aux plateformes 64 bits. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_vector_float_to_float32_au&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(sample_rate:int)&nbsp;(v:float&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;offset&nbsp;=&nbsp;24<br>
&nbsp;<span class="keyword">and</span>&nbsp;size&nbsp;=&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;encoding&nbsp;=&nbsp;6<br>
&nbsp;<span class="keyword">and</span>&nbsp;channels&nbsp;=&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;l&nbsp;=&nbsp;pred&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;v&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;output_string&nbsp;oc&nbsp;<span class="string">".snd"</span>&nbsp;;<br>
&nbsp;&nbsp;set_binary_mode_out&nbsp;oc&nbsp;<span class="keyword">true</span>&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;offset&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;size&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;encoding&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;sample_rate&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;channels&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;l&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;<span class="constructor">Int32</span>.to_int&nbsp;(&nbsp;<span class="constructor">Int32</span>.bits_of_float&nbsp;v.(i)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_matrix_float_to_float32_au</pre> This function is only for 64 bits platforms.
<p>

Cette fonction est réservée aux plateformes 64 bits. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_matrix_float_to_float32_au&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(sample_rate:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;offset&nbsp;=&nbsp;24<br>
&nbsp;<span class="keyword">and</span>&nbsp;size&nbsp;=&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;encoding&nbsp;=&nbsp;6<br>
&nbsp;<span class="keyword">and</span>&nbsp;channels&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;samples&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;output_string&nbsp;oc&nbsp;<span class="string">".snd"</span>&nbsp;;<br>
&nbsp;&nbsp;set_binary_mode_out&nbsp;oc&nbsp;<span class="keyword">true</span>&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;offset&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;size&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;encoding&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;sample_rate&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;channels&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;c&nbsp;=&nbsp;pred&nbsp;channels&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;samples&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;c&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;<span class="constructor">Int32</span>.to_int&nbsp;(&nbsp;<span class="constructor">Int32</span>.bits_of_float&nbsp;m.(j).(i)&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_vector_float64_au</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_vector_float64_au&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;read_header_au&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;tmp1&nbsp;=&nbsp;<span class="string">"tmp1"</span>&nbsp;^&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;tmp2&nbsp;=&nbsp;<span class="string">"tmp2"</span>&nbsp;^&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;ic&nbsp;=&nbsp;open_in_bin&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;compare&nbsp;h.(3)&nbsp;7&nbsp;!=&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;encoding&nbsp;in&nbsp;Readwrite.read_vector_float64_au."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span>&nbsp;seek_in&nbsp;ic&nbsp;h.(1)&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;offset&nbsp;in&nbsp;Readwrite.read_vector_float64_au."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;h.(5)&nbsp;!=&nbsp;1&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Several&nbsp;channels&nbsp;in&nbsp;Readwrite.read_vector_float64_au."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;fake&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;count&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fake&nbsp;:=&nbsp;input_binary_int&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;:=&nbsp;succ&nbsp;!count&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;samples&nbsp;=&nbsp;!count&nbsp;/&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;samples&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;write_float_array_value&nbsp;v&nbsp;tmp1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;(&nbsp;<span class="string">"head&nbsp;-c&nbsp;22&nbsp;"</span>&nbsp;^&nbsp;tmp1&nbsp;^&nbsp;<span class="string">"&nbsp;&gt;&nbsp;"</span>&nbsp;^&nbsp;tmp2&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;(&nbsp;<span class="string">"tail&nbsp;-c+"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;(&nbsp;succ&nbsp;h.(1)&nbsp;)&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;"</span>&nbsp;^&nbsp;fname&nbsp;^&nbsp;<span class="string">"&nbsp;&gt;&gt;&nbsp;"</span>&nbsp;^&nbsp;tmp2&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;read_float_array_value&nbsp;tmp2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Sys</span>.remove&nbsp;tmp1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Sys</span>.remove&nbsp;tmp2&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_vector_float_to_float64_au</pre>  *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_vector_float_to_float64_au&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(sample_rate:int)&nbsp;(v:float&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;offset&nbsp;=&nbsp;24<br>
&nbsp;<span class="keyword">and</span>&nbsp;size&nbsp;=&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;encoding&nbsp;=&nbsp;7<br>
&nbsp;<span class="keyword">and</span>&nbsp;channels&nbsp;=&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;tmp&nbsp;=&nbsp;<span class="string">"tmp"</span>&nbsp;^&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;write_float_array_value&nbsp;v&nbsp;tmp&nbsp;;<br>
&nbsp;&nbsp;output_string&nbsp;oc&nbsp;<span class="string">".snd"</span>&nbsp;;<br>
&nbsp;&nbsp;set_binary_mode_out&nbsp;oc&nbsp;<span class="keyword">true</span>&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;offset&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;size&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;encoding&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;sample_rate&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;channels&nbsp;;<br>
&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;<br>
&nbsp;&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;(&nbsp;<span class="string">"tail&nbsp;-c+23&nbsp;"</span>&nbsp;^&nbsp;tmp&nbsp;^&nbsp;<span class="string">"&nbsp;&gt;&gt;&nbsp;"</span>&nbsp;^&nbsp;fname&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Sys</span>.remove&nbsp;tmp&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_matrix_float64_au</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_matrix_float64_au&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;read_header_au&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;tmp1&nbsp;=&nbsp;<span class="string">"tmp1"</span>&nbsp;^&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;tmp2&nbsp;=&nbsp;<span class="string">"tmp2"</span>&nbsp;^&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;ic&nbsp;=&nbsp;open_in_bin&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;compare&nbsp;h.(3)&nbsp;7&nbsp;!=&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;encoding&nbsp;in&nbsp;Readwrite.read_matrix_float64_au."</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span>&nbsp;seek_in&nbsp;ic&nbsp;h.(1)&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Bad&nbsp;offset&nbsp;in&nbsp;Readwrite.read_matrix_float64_au."</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;fake&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;channels&nbsp;=&nbsp;h.(5)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;count&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fake&nbsp;:=&nbsp;input_binary_int&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;:=&nbsp;succ&nbsp;!count&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">End_of_file</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;samples&nbsp;=&nbsp;!count&nbsp;/&nbsp;2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;samples&nbsp;0.&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;write_float_array_value&nbsp;v&nbsp;tmp1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;(&nbsp;<span class="string">"head&nbsp;-c&nbsp;22&nbsp;"</span>&nbsp;^&nbsp;tmp1&nbsp;^&nbsp;<span class="string">"&nbsp;&gt;&nbsp;"</span>&nbsp;^&nbsp;tmp2&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;(&nbsp;<span class="string">"tail&nbsp;-c+"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;(&nbsp;succ&nbsp;h.(1)&nbsp;)&nbsp;)&nbsp;^&nbsp;<span class="string">"&nbsp;"</span>&nbsp;^&nbsp;fname&nbsp;^&nbsp;<span class="string">"&nbsp;&gt;&gt;&nbsp;"</span>&nbsp;^&nbsp;tmp2&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;w&nbsp;=&nbsp;read_float_array_value&nbsp;tmp2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Sys</span>.remove&nbsp;tmp1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Sys</span>.remove&nbsp;tmp2&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Util</span>.vector_spray&nbsp;channels&nbsp;w&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_matrix_float_to_float64_au</pre>  *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_matrix_float_to_float64_au&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(sample_rate:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;offset&nbsp;=&nbsp;24<br>
&nbsp;<span class="keyword">and</span>&nbsp;size&nbsp;=&nbsp;-&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;encoding&nbsp;=&nbsp;7<br>
&nbsp;<span class="keyword">and</span>&nbsp;channels&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;v&nbsp;=&nbsp;<span class="constructor">Util</span>.vector_interlace&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;tmp&nbsp;=&nbsp;<span class="string">"tmp"</span>&nbsp;^&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;write_float_array_value&nbsp;v&nbsp;tmp&nbsp;;<br>
&nbsp;&nbsp;output_string&nbsp;oc&nbsp;<span class="string">".snd"</span>&nbsp;;<br>
&nbsp;&nbsp;set_binary_mode_out&nbsp;oc&nbsp;<span class="keyword">true</span>&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;offset&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;size&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;encoding&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;sample_rate&nbsp;;<br>
&nbsp;&nbsp;output_binary_int&nbsp;oc&nbsp;channels&nbsp;;<br>
&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;<br>
&nbsp;&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;(&nbsp;<span class="string">"tail&nbsp;-c+23&nbsp;"</span>&nbsp;^&nbsp;tmp&nbsp;^&nbsp;<span class="string">"&nbsp;&gt;&gt;&nbsp;"</span>&nbsp;^&nbsp;fname&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Sys</span>.remove&nbsp;tmp&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Fichierssonswav"><h1>Fichiers sons wav</h1></span>
<span id="1_Wavsoundfiles"><h1>Wav sound files</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** The wav format is described in the following site.
<p>

http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/WAVE/
<p>

Le format wav est décrit dans le site ci-dessus. *)</span></td></tr></table><code class="code"><br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pcm_wav_header filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pcm_wav_header&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;ic&nbsp;=&nbsp;open_in&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;c&nbsp;=&nbsp;ref&nbsp;<span class="string">'a'</span><br>
&nbsp;<span class="keyword">and</span>&nbsp;n&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;<span class="keyword">and</span>&nbsp;m&nbsp;=&nbsp;ref&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;s&nbsp;=&nbsp;ref&nbsp;<span class="string">""</span><br>
&nbsp;<span class="keyword">and</span>&nbsp;a&nbsp;=&nbsp;ref&nbsp;[]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;:=&nbsp;input_char&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;<span class="constructor">String</span>.make&nbsp;1&nbsp;!c&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;3&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;:=&nbsp;input_char&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;!s&nbsp;^&nbsp;(&nbsp;<span class="constructor">String</span>.make&nbsp;1&nbsp;!c&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;:=&nbsp;!s&nbsp;::&nbsp;!a&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(length:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;:=&nbsp;input_byte&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;:=&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;2&nbsp;<span class="keyword">to</span>&nbsp;length&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;:=&nbsp;256&nbsp;*&nbsp;!m&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;:=&nbsp;!n&nbsp;+&nbsp;!m&nbsp;*&nbsp;(&nbsp;input_byte&nbsp;ic&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;:=&nbsp;(&nbsp;string_of_int&nbsp;!n&nbsp;)&nbsp;::&nbsp;!a&nbsp;;<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;4&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;4&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;2&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;2&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;4&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;4&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;2&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;2&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;4&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.of_list&nbsp;(&nbsp;<span class="constructor">List</span>.rev&nbsp;!a&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_pcm_wav filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_pcm_wav&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;h&nbsp;=&nbsp;read_pcm_wav_header&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;factor&nbsp;=&nbsp;256<br>
&nbsp;<span class="keyword">and</span>&nbsp;ic&nbsp;=&nbsp;open_in&nbsp;fname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;number_of_samples&nbsp;=&nbsp;(&nbsp;int_of_string&nbsp;h.(12)&nbsp;)&nbsp;/&nbsp;(&nbsp;int_of_string&nbsp;h.(9)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;number_of_bits_per_sample&nbsp;=&nbsp;int_of_string&nbsp;h.(10)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;number_of_channels&nbsp;=&nbsp;int_of_string&nbsp;h.(6)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;signal&nbsp;=&nbsp;<span class="constructor">Array</span>.make_matrix&nbsp;number_of_samples&nbsp;number_of_channels&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;number_of_bytes_per_sample&nbsp;=&nbsp;(&nbsp;<span class="keyword">if</span>&nbsp;number_of_bits_per_sample&nbsp;<span class="keyword">mod</span>&nbsp;8&nbsp;&lt;&gt;&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;failwith&nbsp;<span class="string">"Number&nbsp;of&nbsp;bits&nbsp;per&nbsp;sample&nbsp;not&nbsp;programmed&nbsp;in&nbsp;Readwrite.read_pcm_wav."</span>&nbsp;;&nbsp;number_of_bits_per_sample&nbsp;/&nbsp;8&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;shift&nbsp;=&nbsp;int_of_float&nbsp;(&nbsp;<span class="constructor">Util</span>.int_float_power&nbsp;(&nbsp;pred&nbsp;number_of_bits_per_sample&nbsp;)&nbsp;2.&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;extract_value&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int)&nbsp;(radix:int)&nbsp;(bytes_per_sample:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;output&nbsp;=&nbsp;ref&nbsp;0&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;bytes_per_sample&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;input_byte&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;!output&nbsp;-&nbsp;s&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;2&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;input_byte&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;!output&nbsp;+&nbsp;factor&nbsp;*&nbsp;(&nbsp;input_byte&nbsp;ic&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;(&nbsp;(&nbsp;!output&nbsp;+&nbsp;s&nbsp;)&nbsp;<span class="keyword">mod</span>&nbsp;radix&nbsp;)&nbsp;-&nbsp;s&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">assert</span>&nbsp;(&nbsp;bytes_per_sample&nbsp;&gt;&nbsp;0&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;input_byte&nbsp;ic&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;m&nbsp;=&nbsp;ref&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;bytes_per_sample&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;:=&nbsp;factor&nbsp;*&nbsp;!m&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;!output&nbsp;+&nbsp;!m&nbsp;*&nbsp;(&nbsp;input_byte&nbsp;ic&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;:=&nbsp;(&nbsp;(&nbsp;!output&nbsp;+&nbsp;s&nbsp;)&nbsp;<span class="keyword">mod</span>&nbsp;radix&nbsp;)&nbsp;-&nbsp;s&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!output<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;number_of_channels&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;radix&nbsp;=&nbsp;2&nbsp;*&nbsp;shift&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;1&nbsp;<span class="keyword">to</span>&nbsp;44&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ignore&nbsp;(&nbsp;input_byte&nbsp;ic&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set_binary_mode_in&nbsp;ic&nbsp;<span class="keyword">true</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;number_of_samples&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;multi_sample&nbsp;=&nbsp;signal.(i)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multi_sample.(j)&nbsp;&lt;-&nbsp;extract_value&nbsp;shift&nbsp;radix&nbsp;number_of_bytes_per_sample&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close_in_noerr&nbsp;ic<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;coeff&nbsp;=&nbsp;1.&nbsp;/.&nbsp;(&nbsp;float&nbsp;shift&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Matrix</span>.float_transpose&nbsp;(&nbsp;<span class="constructor">Matrix</span>.matrix_float_scal_mult&nbsp;coeff&nbsp;(&nbsp;<span class="constructor">Matrix</span>.float_of_matrix&nbsp;signal&nbsp;)&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_pcm_wav sample_rate bytes_per_sample matrix filename</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_pcm_wav&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(sample_rate:int)&nbsp;(bytes_per_sample:int)&nbsp;(m:float&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;oc&nbsp;=&nbsp;open_out&nbsp;fname<br>
&nbsp;<span class="keyword">and</span>&nbsp;factor&nbsp;=&nbsp;256<br>
&nbsp;<span class="keyword">and</span>&nbsp;shift&nbsp;=&nbsp;ref&nbsp;128<br>
&nbsp;<span class="keyword">and</span>&nbsp;exponent&nbsp;=&nbsp;ref&nbsp;1<br>
&nbsp;<span class="keyword">and</span>&nbsp;number_of_channels&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m<br>
&nbsp;<span class="keyword">and</span>&nbsp;number_of_samples&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)<br>
&nbsp;<span class="keyword">and</span>&nbsp;bits_per_sample&nbsp;=&nbsp;8&nbsp;*&nbsp;bytes_per_sample&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;!exponent&nbsp;&lt;&nbsp;bytes_per_sample&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;shift&nbsp;:=&nbsp;!shift&nbsp;*&nbsp;factor&nbsp;;<br>
&nbsp;&nbsp;&nbsp;incr&nbsp;exponent&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;data_rate&nbsp;=&nbsp;sample_rate&nbsp;*&nbsp;bytes_per_sample&nbsp;*&nbsp;number_of_channels<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;float_factor&nbsp;=&nbsp;float&nbsp;!shift<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cc&nbsp;=&nbsp;pred&nbsp;number_of_channels<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;block_align&nbsp;=&nbsp;number_of_channels&nbsp;*&nbsp;bytes_per_sample&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;data_size&nbsp;=&nbsp;number_of_samples&nbsp;*&nbsp;block_align<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;inject_value&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(s:int)&nbsp;(bps:int)&nbsp;(value:int)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;factor&nbsp;=&nbsp;256&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;bps&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;s&nbsp;+&nbsp;value&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;x&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;2&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;value&nbsp;+&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;x&nbsp;<span class="keyword">mod</span>&nbsp;factor&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;(&nbsp;x&nbsp;/&nbsp;factor&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;x&nbsp;=&nbsp;ref&nbsp;(&nbsp;value&nbsp;+&nbsp;s&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;y&nbsp;=&nbsp;ref&nbsp;(&nbsp;!x&nbsp;<span class="keyword">mod</span>&nbsp;factor&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;!y&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;2&nbsp;<span class="keyword">to</span>&nbsp;bps&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;:=&nbsp;!x&nbsp;/&nbsp;factor&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;:=&nbsp;!x&nbsp;<span class="keyword">mod</span>&nbsp;factor&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_byte&nbsp;oc&nbsp;!y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dsm1&nbsp;=&nbsp;data_size&nbsp;<span class="keyword">mod</span>&nbsp;1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'R'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'I'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'F'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'F'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inject_value&nbsp;0&nbsp;4&nbsp;(&nbsp;36&nbsp;+&nbsp;data_size&nbsp;+&nbsp;dsm1&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'W'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'A'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'V'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'E'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'f'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'m'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'t'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'&nbsp;'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inject_value&nbsp;0&nbsp;4&nbsp;16&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inject_value&nbsp;0&nbsp;2&nbsp;1&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inject_value&nbsp;0&nbsp;2&nbsp;number_of_channels&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inject_value&nbsp;0&nbsp;4&nbsp;sample_rate&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inject_value&nbsp;0&nbsp;4&nbsp;data_rate&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inject_value&nbsp;0&nbsp;2&nbsp;block_align&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inject_value&nbsp;0&nbsp;2&nbsp;bits_per_sample&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'d'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'a'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'t'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_char&nbsp;oc&nbsp;<span class="string">'a'</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inject_value&nbsp;0&nbsp;4&nbsp;data_size&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;pred&nbsp;number_of_samples&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;j&nbsp;=&nbsp;0&nbsp;<span class="keyword">to</span>&nbsp;cc&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inject_value&nbsp;!shift&nbsp;bytes_per_sample&nbsp;(&nbsp;int_of_float&nbsp;(&nbsp;(&nbsp;m.(j).(i)&nbsp;+.&nbsp;1.&nbsp;)&nbsp;*.&nbsp;float_factor&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;dsm1&nbsp;&lt;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inject_value&nbsp;0&nbsp;1&nbsp;0&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close_out_noerr&nbsp;oc&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Fichiersetrpertoires"><h1>Fichiers et répertoires</h1></span>
<span id="1_Filesanddirectories"><h1>Files and directories</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sub_directories directory_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sub_directories&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(dname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Sys</span>.readdir&nbsp;dname<br>
&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Sys</span>.is_directory&nbsp;(&nbsp;<span class="constructor">Filename</span>.concat&nbsp;dname&nbsp;x&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Sys_error</span>&nbsp;unknown&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;x&nbsp;,&nbsp;(&nbsp;x.[0]&nbsp;!=&nbsp;<span class="string">'.'</span>&nbsp;)&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;g&nbsp;x&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cmp&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;y&nbsp;z&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;compare&nbsp;(&nbsp;snd&nbsp;y&nbsp;)&nbsp;(&nbsp;snd&nbsp;z&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ll&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;l&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.sort&nbsp;cmp&nbsp;ll&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l_l&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;snd&nbsp;ll&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;first_true&nbsp;=&nbsp;<span class="constructor">Util</span>.vector_find_first&nbsp;(&nbsp;=&nbsp;)&nbsp;<span class="keyword">true</span>&nbsp;l_l&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;first_true&nbsp;&gt;=&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;lll&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;ll&nbsp;first_true&nbsp;(&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;l&nbsp;)&nbsp;-&nbsp;first_true&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;fst&nbsp;lll&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.sort&nbsp;compare&nbsp;result&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|&nbsp;|]&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sub_directories_with_parent directory_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sub_directories_with_parent&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(dname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.append&nbsp;[|&nbsp;<span class="string">".."</span>&nbsp;|]&nbsp;(&nbsp;sub_directories&nbsp;dname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sub_directories_with_current directory_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sub_directories_with_current&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(dname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.append&nbsp;[|&nbsp;<span class="string">"."</span>&nbsp;|]&nbsp;(&nbsp;sub_directories&nbsp;dname&nbsp;)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>sub_directories_with_parent_and_current directory_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;sub_directories_with_parent_and_current&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(dname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="constructor">Array</span>.append&nbsp;[|&nbsp;<span class="string">".."</span>&nbsp;;&nbsp;<span class="string">"."</span>&nbsp;|]&nbsp;(&nbsp;sub_directories&nbsp;dname&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>regular_files directory_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;regular_files&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(dname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Sys</span>.readdir&nbsp;dname<br>
&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Sys</span>.is_directory&nbsp;(&nbsp;<span class="constructor">Filename</span>.concat&nbsp;dname&nbsp;x&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Sys_error</span>&nbsp;unknown&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;x&nbsp;,&nbsp;(&nbsp;x.[0]&nbsp;!=&nbsp;<span class="string">'.'</span>&nbsp;)&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;g&nbsp;x&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cmp&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;y&nbsp;z&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;compare&nbsp;(&nbsp;snd&nbsp;y&nbsp;)&nbsp;(&nbsp;snd&nbsp;z&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ll&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;f&nbsp;l&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.sort&nbsp;cmp&nbsp;ll&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l_l&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;snd&nbsp;ll&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;first_true&nbsp;=&nbsp;<span class="constructor">Util</span>.vector_find_first&nbsp;(&nbsp;=&nbsp;)&nbsp;<span class="keyword">true</span>&nbsp;l_l&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;first_true&nbsp;&gt;&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;lll&nbsp;=&nbsp;<span class="constructor">Array</span>.sub&nbsp;ll&nbsp;0&nbsp;first_true&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;result&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;fst&nbsp;lll&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.sort&nbsp;compare&nbsp;result&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;first_true&nbsp;=&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;[|&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;lll&nbsp;=&nbsp;<span class="constructor">Array</span>.map&nbsp;fst&nbsp;ll&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.sort&nbsp;compare&nbsp;lll&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lll<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Imagesrelles"><h1>Images réelles</h1></span>
<span id="1_Floatingpointpictures"><h1>Floating point pictures</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_float_rgb red_name green_name blue_name</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_float_rgb&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(rname:string)&nbsp;(gname:string)&nbsp;(bname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;r&nbsp;=&nbsp;read_matrix_float64_au&nbsp;rname<br>
&nbsp;<span class="keyword">and</span>&nbsp;g&nbsp;=&nbsp;read_matrix_float64_au&nbsp;gname<br>
&nbsp;<span class="keyword">and</span>&nbsp;b&nbsp;=&nbsp;read_matrix_float64_au&nbsp;bname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;[|&nbsp;r&nbsp;;&nbsp;g&nbsp;;&nbsp;b&nbsp;|]&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>write_float_rgb rgb_matrix file_prefix</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;write_float_rgb&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(m:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;(fname:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">assert</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;m&nbsp;&gt;=&nbsp;3&nbsp;)&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;rname&nbsp;=&nbsp;fname&nbsp;^&nbsp;<span class="string">".red.au"</span><br>
&nbsp;<span class="keyword">and</span>&nbsp;gname&nbsp;=&nbsp;fname&nbsp;^&nbsp;<span class="string">".green.au"</span><br>
&nbsp;<span class="keyword">and</span>&nbsp;bname&nbsp;=&nbsp;fname&nbsp;^&nbsp;<span class="string">".blue.au"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;write_matrix_float_to_float64_au&nbsp;0&nbsp;m.(0)&nbsp;rname&nbsp;;<br>
&nbsp;&nbsp;write_matrix_float_to_float64_au&nbsp;1&nbsp;m.(1)&nbsp;gname&nbsp;;<br>
&nbsp;&nbsp;write_matrix_float_to_float64_au&nbsp;2&nbsp;m.(2)&nbsp;bname&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>read_picture_float_rgb filename</pre> The accepted formats are: xpm, pgm binary, ppm binary.
<p>

Les formats acceptés sont : xpm, pgm binaire, ppm binaire.*)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;read_picture_float_rgb&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">let</span>&nbsp;e&nbsp;=&nbsp;read_pnm_header&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;e.(0).[1]&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'6'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;read_ppm_binary_float_rgb&nbsp;s<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'5'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;read_pgm_binary_float_rgb&nbsp;s<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">'4'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;read_pbm_binary_float_rgb&nbsp;s<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;xpm_float_rgb&nbsp;(&nbsp;array_read_text_file&nbsp;s&nbsp;)&nbsp;;;<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ </center> *)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** 
<span id="1_Environnement"><h1>Environnement</h1></span>
*)</span></td></tr></table><code class="code"><br>
</code><table><tr><td></td><td><span class="comment">(** <center> </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>clear string</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;clear&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(s:string)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;(&nbsp;<span class="string">"rm&nbsp;-f&nbsp;"</span>&nbsp;^&nbsp;s&nbsp;)&nbsp;)<br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;()&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>crew_bsd unit</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;crew_bsd&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;array_write_text_file&nbsp;[|&nbsp;<span class="string">"#!/bin/sh"</span>&nbsp;;&nbsp;<span class="string">"sysctl&nbsp;-n&nbsp;kern.smp.cpus&nbsp;&gt;&nbsp;tmp_cpu"</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="string">"sysctl&nbsp;-n&nbsp;kern.smp.active&nbsp;&gt;&gt;&nbsp;tmp_cpu"</span>&nbsp;;&nbsp;<span class="string">"exit&nbsp;0"</span>&nbsp;|]&nbsp;<span class="string">"tmp_script.sh"</span>&nbsp;;<br>
&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;<span class="string">"sh&nbsp;tmp_script.sh"</span>&nbsp;)&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;numbers&nbsp;=&nbsp;array_read_reverse_text_file&nbsp;<span class="string">"tmp_cpu"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;clear&nbsp;<span class="string">"tmp_script.sh&nbsp;tmp_cpu"</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;int_of_string&nbsp;numbers.(0)&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;1<br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;int_of_string&nbsp;numbers.(1)&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>crew_linux_lscpu unit</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;crew_linux_lscpu&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;array_write_text_file&nbsp;[|&nbsp;<span class="string">"#!/bin/sh"</span>&nbsp;;&nbsp;<span class="string">"lscpu&nbsp;-p&nbsp;|&nbsp;grep&nbsp;-v&nbsp;'#'&nbsp;|&nbsp;wc&nbsp;-l&nbsp;|&nbsp;tr&nbsp;-d&nbsp;'&nbsp;'&nbsp;&gt;&nbsp;tmp_cpu"</span>&nbsp;;&nbsp;<span class="string">"exit&nbsp;0"</span>&nbsp;|]&nbsp;<span class="string">"tmp_script.sh"</span>&nbsp;;<br>
&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;<span class="string">"sh&nbsp;tmp_script.sh"</span>&nbsp;)&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;number&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;(&nbsp;list_read_reverse_text_file&nbsp;<span class="string">"tmp_cpu"</span>&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;clear&nbsp;<span class="string">"tmp_script.sh&nbsp;tmp_cpu"</span>&nbsp;;<br>
&nbsp;&nbsp;int_of_string&nbsp;number&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>crew_linux_sysctl unit</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;crew_linux_sysctl&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;array_write_text_file&nbsp;[|&nbsp;<span class="string">"#!/bin/sh"</span>&nbsp;;&nbsp;<span class="string">"sysctl&nbsp;-a&nbsp;2&gt;1&nbsp;|&nbsp;grep&nbsp;-v&nbsp;error&nbsp;|&nbsp;grep&nbsp;-o&nbsp;'[.]cpu[.0-9][.0-9]*'&nbsp;|&nbsp;grep&nbsp;-o&nbsp;'[0-9][0-9]*'&nbsp;|&nbsp;sort&nbsp;-u&nbsp;|&nbsp;wc&nbsp;-l&nbsp;|&nbsp;tr&nbsp;-d&nbsp;'&nbsp;'&nbsp;&gt;&nbsp;tmp_cpu"</span>&nbsp;;&nbsp;<span class="string">"exit&nbsp;0"</span>&nbsp;|]&nbsp;<span class="string">"tmp_script.sh"</span>&nbsp;;<br>
&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;<span class="string">"sh&nbsp;tmp_script.sh"</span>&nbsp;)&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;number&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;(&nbsp;list_read_reverse_text_file&nbsp;<span class="string">"tmp_cpu"</span>&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;clear&nbsp;<span class="string">"tmp_script.sh&nbsp;tmp_cpu"</span>&nbsp;;<br>
&nbsp;&nbsp;int_of_string&nbsp;number&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>crew_unix unit</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;crew_unix&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;array_write_text_file&nbsp;[|&nbsp;<span class="string">"#!/bin/sh"</span>&nbsp;;&nbsp;<span class="string">"dmesg&nbsp;|&nbsp;grep&nbsp;-oi&nbsp;'CPU[0-9][0-9]*'&nbsp;|&nbsp;sort&nbsp;-u&nbsp;|&nbsp;wc&nbsp;-l&nbsp;|&nbsp;tr&nbsp;-d&nbsp;'&nbsp;'&nbsp;&gt;&nbsp;tmp_cpu"</span>&nbsp;;<br>
&nbsp;<span class="string">"exit&nbsp;0"</span>&nbsp;|]&nbsp;<span class="string">"tmp_script.sh"</span>&nbsp;;<br>
&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;<span class="string">"sh&nbsp;tmp_script.sh"</span>&nbsp;)&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;number&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;(&nbsp;list_read_reverse_text_file&nbsp;<span class="string">"tmp_cpu"</span>&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;clear&nbsp;<span class="string">"tmp_script.sh&nbsp;tmp_cpu"</span>&nbsp;;<br>
&nbsp;&nbsp;int_of_string&nbsp;number&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>crew unit</pre> Number of active processors.
<p>

Nombre de processeurs en fonctionnement. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;crew&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;output&nbsp;=&nbsp;crew_bsd&nbsp;()&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">assert</span>&nbsp;(&nbsp;output&nbsp;&gt;&nbsp;0&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;output<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;output&nbsp;=&nbsp;crew_linux_lscpu&nbsp;()&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">assert</span>&nbsp;(&nbsp;output&nbsp;&gt;&nbsp;0&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;output&nbsp;=&nbsp;crew_linux_sysctl&nbsp;()&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">assert</span>&nbsp;(&nbsp;output&nbsp;&gt;&nbsp;0&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crew_unix&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>cpu_freq unit</pre> Frequency in megahertz of the first processor.
<p>

Fréquence du premier processeur en mégahertz. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;cpu_freq&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;array_write_text_file&nbsp;[|&nbsp;<span class="string">"#!/bin/sh"</span>&nbsp;;&nbsp;<span class="string">"sysctl&nbsp;-n&nbsp;dev.cpu.0.freq&nbsp;|&nbsp;tr&nbsp;-d&nbsp;'&nbsp;'&nbsp;&gt;&nbsp;tmp_freq"</span>&nbsp;;&nbsp;<span class="string">"exit&nbsp;0"</span>&nbsp;|]&nbsp;<span class="string">"tmp_script.sh"</span>&nbsp;;<br>
&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;<span class="string">"sh&nbsp;tmp_script.sh"</span>&nbsp;)&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;freq&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;(&nbsp;list_read_reverse_text_file&nbsp;<span class="string">"tmp_freq"</span>&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;clear&nbsp;<span class="string">"tmp_script.sh&nbsp;tmp_freq"</span>&nbsp;;<br>
&nbsp;&nbsp;int_of_string&nbsp;freq&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>free_ram unit</pre> Number of free bytes in Random access memory.
<p>

Nombre d'octets libres en mémoire vive. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;free_ram&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;array_write_text_file&nbsp;[|&nbsp;<span class="string">"#!/bin/sh"</span>&nbsp;;&nbsp;<span class="string">"vmstat&nbsp;-s&nbsp;|&nbsp;grep&nbsp;'pages&nbsp;free'&nbsp;|&nbsp;grep&nbsp;-o&nbsp;'[0-9][0-9]*'&nbsp;&gt;&nbsp;tmp_free_ram"</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="string">"vmstat&nbsp;-s&nbsp;|&nbsp;grep&nbsp;'bytes&nbsp;per&nbsp;page'&nbsp;|&nbsp;grep&nbsp;-o&nbsp;'[0-9][0-9]*'&nbsp;&gt;&gt;&nbsp;tmp_free_ram"</span>&nbsp;;&nbsp;<span class="string">"exit&nbsp;0"</span>&nbsp;|]&nbsp;<span class="string">"tmp_script.sh"</span>&nbsp;;<br>
&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;<span class="string">"sh&nbsp;tmp_script.sh"</span>&nbsp;)&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;free&nbsp;=&nbsp;array_read_reverse_text_file&nbsp;<span class="string">"tmp_free_ram"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;clear&nbsp;<span class="string">"tmp_script.sh&nbsp;tmp_free_ram"</span>&nbsp;;<br>
&nbsp;&nbsp;(&nbsp;int_of_string&nbsp;free.(0)&nbsp;)&nbsp;*&nbsp;(&nbsp;int_of_string&nbsp;free.(1)&nbsp;)&nbsp;;;<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>free_disk unit</pre> Number of free kilobytes on the file system containing the current directory.
<p>

Nombre de kilooctets libres sur le système de fichiers contenant le répertoire courant. *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;free_disk&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;array_write_text_file&nbsp;[|&nbsp;<span class="string">"#!/bin/sh"</span>&nbsp;;&nbsp;<span class="string">"df&nbsp;-k&nbsp;.&nbsp;|&nbsp;grep&nbsp;'/'&nbsp;|&nbsp;tr&nbsp;-s&nbsp;'&nbsp;'&nbsp;|&nbsp;cut&nbsp;-d&nbsp;'&nbsp;'&nbsp;-f&nbsp;4&nbsp;&gt;&nbsp;tmp_free_disk"</span>&nbsp;;&nbsp;<span class="string">"exit&nbsp;0"</span>&nbsp;|]&nbsp;<span class="string">"tmp_script.sh"</span>&nbsp;;<br>
&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;<span class="string">"sh&nbsp;tmp_script.sh"</span>&nbsp;)&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;free&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;(&nbsp;list_read_reverse_text_file&nbsp;<span class="string">"tmp_free_disk"</span>&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;clear&nbsp;<span class="string">"tmp_script.sh&nbsp;tmp_free_disk"</span>&nbsp;;<br>
&nbsp;&nbsp;int_of_string&nbsp;free&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>line unit</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;line&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;array_write_text_file&nbsp;[|&nbsp;<span class="string">"#!/bin/sh"</span>&nbsp;;&nbsp;<span class="string">"echo&nbsp;`apm&nbsp;-a`&nbsp;&gt;&nbsp;tmp_line"</span>&nbsp;;&nbsp;<span class="string">"exit&nbsp;0"</span>&nbsp;|]&nbsp;<span class="string">"tmp_script.sh"</span>&nbsp;;<br>
&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;<span class="string">"sh&nbsp;tmp_script.sh"</span>&nbsp;)&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;line&nbsp;=&nbsp;<span class="constructor">List</span>.hd&nbsp;(&nbsp;list_read_reverse_text_file&nbsp;<span class="string">"tmp_line"</span>&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;clear&nbsp;<span class="string">"tmp_script.sh&nbsp;tmp_line"</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;int_of_string&nbsp;line&nbsp;==&nbsp;0&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">false</span><br>
&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">true</span>&nbsp;;;<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <pre>battery unit</pre> *)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;battery&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;array_write_text_file&nbsp;[|&nbsp;<span class="string">"#!/bin/sh"</span>&nbsp;;&nbsp;<span class="string">"apm&nbsp;|&nbsp;grep&nbsp;-v&nbsp;'APM'&nbsp;&gt;&nbsp;tmp_batt"</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="string">"acpiconf&nbsp;-i&nbsp;batt&nbsp;&gt;&gt;&nbsp;tmp_batt"</span>&nbsp;;&nbsp;<span class="string">"exit&nbsp;0"</span>&nbsp;|]&nbsp;<span class="string">"tmp_script.sh"</span>&nbsp;;<br>
&nbsp;ignore&nbsp;(&nbsp;<span class="constructor">Sys</span>.command&nbsp;<span class="string">"sh&nbsp;tmp_script.sh"</span>&nbsp;)&nbsp;;<br>
&nbsp;<span class="keyword">let</span>&nbsp;batt&nbsp;=&nbsp;array_read_text_file&nbsp;<span class="string">"tmp_batt"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;clear&nbsp;<span class="string">"tmp_script.sh&nbsp;tmp_batt"</span>&nbsp;;<br>
&nbsp;&nbsp;<span class="constructor">Array</span>.map&nbsp;(&nbsp;<span class="constructor">Str</span>.global_replace&nbsp;(&nbsp;<span class="constructor">Str</span>.regexp&nbsp;(&nbsp;<span class="string">"\t"</span>&nbsp;)&nbsp;)&nbsp;<span class="string">"&nbsp;"</span>&nbsp;)&nbsp;batt&nbsp;;;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** <center>§ § § </center> *)</span></td></tr></table><code class="code"><br>
<br>
<br>
<br>
<br>
<span class="keyword">end</span></code></body></html>