<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Graphicmath" rel="Chapter" href="Graphicmath.html"><title>Graphicmath.Analogic.float_rgb_mark_image</title>
</head>
<body>
<code class="code"><span class="keyword">let</span>&nbsp;float_rgb_mark_image&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;(approx_hori_size:int)&nbsp;(approx_verti_size:int)&nbsp;(m:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;(reduc:float&nbsp;array&nbsp;array&nbsp;array)&nbsp;(mark:float&nbsp;array)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;<span class="keyword">assert</span>&nbsp;(&nbsp;<span class="constructor">Array</span>.length&nbsp;mark&nbsp;&gt;=&nbsp;4&nbsp;)&nbsp;;<br>
&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;height&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;width&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;m.(0).(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;h_pic&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;reduc.(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w_pic&nbsp;=&nbsp;<span class="constructor">Array</span>.length&nbsp;reduc.(0).(0)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;obsolete&nbsp;=&nbsp;<span class="constructor">Array</span>.make&nbsp;2&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;trace_hori&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;trace_verti&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;first_time&nbsp;=&nbsp;ref&nbsp;<span class="keyword">true</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;date&nbsp;=&nbsp;ref&nbsp;<span class="string">""</span><br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;f_string&nbsp;=&nbsp;(&nbsp;<span class="keyword">function</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">String</span>.sub&nbsp;s&nbsp;0&nbsp;(&nbsp;min&nbsp;6&nbsp;(&nbsp;<span class="constructor">String</span>.length&nbsp;s&nbsp;)&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;steps&nbsp;=&nbsp;10&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;mark.(0)&nbsp;&lt;-&nbsp;float&nbsp;(&nbsp;width&nbsp;/&nbsp;2&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mark.(1)&nbsp;&lt;-&nbsp;float&nbsp;(&nbsp;height&nbsp;/&nbsp;2&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mark.(2)&nbsp;&lt;-&nbsp;0.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mark.(3)&nbsp;&lt;-&nbsp;0.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;factor&nbsp;=&nbsp;height&nbsp;/&nbsp;h_pic<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;hh&nbsp;=&nbsp;(&nbsp;float&nbsp;height&nbsp;)&nbsp;-.&nbsp;2.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ww&nbsp;=&nbsp;(&nbsp;float&nbsp;width&nbsp;)&nbsp;-.&nbsp;2.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;hori_range&nbsp;=&nbsp;[|&nbsp;0&nbsp;;&nbsp;pred&nbsp;width&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;verti_range&nbsp;=&nbsp;[|&nbsp;0&nbsp;;&nbsp;pred&nbsp;height&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;hori_grid&nbsp;=&nbsp;[|&nbsp;-10.&nbsp;;&nbsp;10.&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;verti_grid&nbsp;=&nbsp;[|&nbsp;-10.&nbsp;;&nbsp;10.&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;small_radius&nbsp;=&nbsp;max&nbsp;10&nbsp;(&nbsp;approx_verti_size&nbsp;/&nbsp;50&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;threshold&nbsp;=&nbsp;(&nbsp;sqrt&nbsp;epsilon_float&nbsp;)&nbsp;*.&nbsp;20.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;h_border&nbsp;=&nbsp;(&nbsp;23&nbsp;*&nbsp;h_pic&nbsp;)&nbsp;/&nbsp;100<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;w_border&nbsp;=&nbsp;(&nbsp;23&nbsp;*&nbsp;w_pic&nbsp;)&nbsp;/&nbsp;100&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;hori_shift&nbsp;=&nbsp;w_border&nbsp;/&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;verti_shift&nbsp;=&nbsp;h_border&nbsp;/&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;hori_mid&nbsp;=&nbsp;(&nbsp;5&nbsp;*&nbsp;w_border&nbsp;)&nbsp;/&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;verti_mid&nbsp;=&nbsp;(&nbsp;5&nbsp;*&nbsp;h_border&nbsp;)&nbsp;/&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;hori_size&nbsp;=&nbsp;2&nbsp;*&nbsp;w_border&nbsp;+&nbsp;w_pic<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;verti_size&nbsp;=&nbsp;2&nbsp;*&nbsp;h_border&nbsp;+&nbsp;h_pic&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ls0&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;rs0&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;vl&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;sel&nbsp;=&nbsp;ref&nbsp;[|&nbsp;<span class="string">"0"</span>&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cs0&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;hs0&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;vt&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;set&nbsp;=&nbsp;ref&nbsp;[|&nbsp;<span class="string">"0"</span>&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;left_initial&nbsp;=&nbsp;ref&nbsp;(&nbsp;string_of_int&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)&nbsp;)&nbsp;<span class="keyword">and</span>&nbsp;left_final&nbsp;=&nbsp;ref&nbsp;<span class="string">""</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;top_initial&nbsp;=&nbsp;ref&nbsp;(&nbsp;string_of_int&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)&nbsp;)&nbsp;<span class="keyword">and</span>&nbsp;top_final&nbsp;=&nbsp;ref&nbsp;<span class="string">""</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cancel_message&nbsp;=&nbsp;[|&nbsp;<span class="string">"Annuler"</span>&nbsp;;&nbsp;<span class="string">"Cancel"</span>&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;ok_message&nbsp;=&nbsp;[|&nbsp;<span class="string">"&nbsp;OK&nbsp;"</span>&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;refresh_message&nbsp;=&nbsp;[|&nbsp;<span class="string">"Rafraîchir"</span>&nbsp;;&nbsp;<span class="string">"Refresh"</span>&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;grab_message&nbsp;=&nbsp;ref&nbsp;<span class="string">""</span>&nbsp;<span class="keyword">and</span>&nbsp;save_name&nbsp;=&nbsp;ref&nbsp;<span class="string">""</span>&nbsp;<span class="keyword">and</span>&nbsp;current_character&nbsp;=&nbsp;ref&nbsp;<span class="string">"0"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;right_initial&nbsp;=&nbsp;ref&nbsp;(&nbsp;string_of_float&nbsp;mark.(2)&nbsp;)&nbsp;<span class="keyword">and</span>&nbsp;right_final&nbsp;=&nbsp;ref&nbsp;<span class="string">""</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ls3&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;rs3&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;vr&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0.&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;ser&nbsp;=&nbsp;ref&nbsp;[|&nbsp;<span class="string">"0."</span>&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;bottom_initial&nbsp;=&nbsp;ref&nbsp;(&nbsp;string_of_float&nbsp;mark.(3)&nbsp;)&nbsp;<span class="keyword">and</span>&nbsp;bottom_final&nbsp;=&nbsp;ref&nbsp;<span class="string">""</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;hs1&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;cs1&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;vb&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0.&nbsp;|]&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;seb&nbsp;=&nbsp;ref&nbsp;[|&nbsp;<span class="string">"0."</span>&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;refresh_left&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;refresh_top&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;refresh_right&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;refresh_bottom&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;ok&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;cancel&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]&nbsp;<span class="keyword">and</span>&nbsp;grab&nbsp;=&nbsp;ref&nbsp;[|&nbsp;0&nbsp;|]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;picture&nbsp;=&nbsp;[|&nbsp;hori_size&nbsp;/&nbsp;2&nbsp;;&nbsp;verti_size&nbsp;/&nbsp;2&nbsp;;&nbsp;w_border&nbsp;;&nbsp;h_border&nbsp;;&nbsp;w_border&nbsp;+&nbsp;w_pic&nbsp;;&nbsp;h_border&nbsp;+&nbsp;h_pic&nbsp;|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Graphics</span>.close_graph&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f_init&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** f_init *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Gc</span>.compact&nbsp;()&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!first_time&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Graphics</span>.open_graph&nbsp;(&nbsp;<span class="string">"&nbsp;"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;hori_size&nbsp;)&nbsp;^&nbsp;<span class="string">"x"</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;verti_size&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Graphics</span>.set_window_title&nbsp;<span class="string">"Analogic.float_rgb_mark_image"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left_initial&nbsp;:=&nbsp;string_of_int&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left_final&nbsp;:=&nbsp;<span class="string">""</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;top_initial&nbsp;:=&nbsp;string_of_int&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;top_final&nbsp;:=&nbsp;<span class="string">""</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right_initial&nbsp;:=&nbsp;f_string&nbsp;(&nbsp;string_of_float&nbsp;mark.(2)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right_final&nbsp;:=&nbsp;<span class="string">""</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bottom_initial&nbsp;:=&nbsp;f_string&nbsp;(&nbsp;string_of_float&nbsp;mark.(3)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bottom_final&nbsp;:=&nbsp;<span class="string">""</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Graphics</span>.set_color&nbsp;&nbsp;<span class="constructor">Graphics</span>.background&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Graphics</span>.fill_rect&nbsp;(&nbsp;hori_size&nbsp;/&nbsp;2&nbsp;)&nbsp;0&nbsp;(&nbsp;hori_size&nbsp;/&nbsp;2&nbsp;)&nbsp;verti_shift&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Graphics</span>.moveto&nbsp;(&nbsp;hori_size&nbsp;/&nbsp;2&nbsp;)&nbsp;0&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Graphics</span>.set_color&nbsp;&nbsp;<span class="constructor">Graphics</span>.foreground&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Graphics</span>.draw_string&nbsp;!grab_message&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;:=&nbsp;<span class="constructor">Widget</span>.rect_switch&nbsp;(&nbsp;hori_size&nbsp;-&nbsp;hori_shift&nbsp;)&nbsp;verti_shift&nbsp;<span class="constructor">Graphics</span>.green&nbsp;<span class="constructor">Graphics</span>.black&nbsp;ok_message&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel&nbsp;:=&nbsp;<span class="constructor">Widget</span>.rect_switch&nbsp;hori_shift&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;verti_shift&nbsp;)&nbsp;<span class="constructor">Graphics</span>.red&nbsp;<span class="constructor">Graphics</span>.black&nbsp;cancel_message&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grab&nbsp;:=<span class="constructor">Widget</span>.rect_switch&nbsp;hori_shift&nbsp;verti_shift&nbsp;<span class="constructor">Graphics</span>.cyan&nbsp;<span class="constructor">Graphics</span>.black&nbsp;[|&nbsp;<span class="string">"Saisir"</span>&nbsp;;&nbsp;<span class="string">"Grab"</span>&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls0&nbsp;:=&nbsp;<span class="constructor">Widget</span>.left_switch&nbsp;(&nbsp;w_border&nbsp;+&nbsp;hori_shift&nbsp;/&nbsp;2&nbsp;)&nbsp;verti_shift&nbsp;<span class="constructor">Graphics</span>.cyan&nbsp;<span class="constructor">Graphics</span>.black&nbsp;[|&nbsp;<span class="string">"&nbsp;"</span>&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rs0&nbsp;:=&nbsp;<span class="constructor">Widget</span>.right_switch&nbsp;hori_mid&nbsp;verti_shift&nbsp;<span class="constructor">Graphics</span>.blue&nbsp;<span class="constructor">Graphics</span>.black&nbsp;[|&nbsp;<span class="string">"&nbsp;"</span>&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl&nbsp;:=&nbsp;<span class="constructor">Widget</span>.int_vernier&nbsp;(&nbsp;w_border&nbsp;+&nbsp;(&nbsp;3&nbsp;*&nbsp;hori_shift&nbsp;/&nbsp;2&nbsp;)&nbsp;)&nbsp;verti_shift&nbsp;small_radius&nbsp;<span class="constructor">Graphics</span>.red&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.magenta&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.black&nbsp;steps&nbsp;hori_range&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sel&nbsp;:=&nbsp;<span class="constructor">Widget</span>.string_edit&nbsp;(&nbsp;hori_size&nbsp;/&nbsp;2&nbsp;+&nbsp;hori_shift&nbsp;)&nbsp;verti_shift&nbsp;w_border&nbsp;<span class="constructor">Graphics</span>.black&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;!left_initial&nbsp;!left_final&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;refresh_left&nbsp;:=&nbsp;<span class="constructor">Widget</span>.rect_switch&nbsp;(&nbsp;hori_size&nbsp;-&nbsp;w_border&nbsp;-&nbsp;hori_shift&nbsp;)&nbsp;verti_shift&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.black&nbsp;refresh_message&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls3&nbsp;:=&nbsp;<span class="constructor">Widget</span>.left_switch&nbsp;(&nbsp;w_border&nbsp;+&nbsp;hori_shift&nbsp;/&nbsp;2&nbsp;)&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;verti_shift&nbsp;)&nbsp;<span class="constructor">Graphics</span>.cyan&nbsp;<span class="constructor">Graphics</span>.black&nbsp;[|&nbsp;<span class="string">"&nbsp;"</span>&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rs3&nbsp;:=&nbsp;<span class="constructor">Widget</span>.right_switch&nbsp;hori_mid&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;verti_shift&nbsp;)&nbsp;<span class="constructor">Graphics</span>.blue&nbsp;<span class="constructor">Graphics</span>.black&nbsp;[|&nbsp;<span class="string">"&nbsp;"</span>&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vr&nbsp;:=&nbsp;<span class="constructor">Widget</span>.float_vernier&nbsp;(&nbsp;w_border&nbsp;+&nbsp;(&nbsp;3&nbsp;*&nbsp;hori_shift&nbsp;/&nbsp;2&nbsp;)&nbsp;)&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;verti_shift&nbsp;)&nbsp;small_radius&nbsp;<span class="constructor">Graphics</span>.red&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.magenta&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.black&nbsp;steps&nbsp;hori_grid&nbsp;mark.(2)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ser&nbsp;:=&nbsp;<span class="constructor">Widget</span>.string_edit&nbsp;(&nbsp;hori_size&nbsp;/&nbsp;2&nbsp;+&nbsp;hori_shift&nbsp;)&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;verti_shift&nbsp;)&nbsp;w_border&nbsp;<span class="constructor">Graphics</span>.black&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;!right_initial&nbsp;!right_final&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;refresh_right&nbsp;:=&nbsp;<span class="constructor">Widget</span>.rect_switch&nbsp;(&nbsp;hori_size&nbsp;-&nbsp;w_border&nbsp;)&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;verti_shift&nbsp;)&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.black&nbsp;refresh_message&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cs0&nbsp;:=&nbsp;<span class="constructor">Widget</span>.cup_switch&nbsp;hori_shift&nbsp;(&nbsp;h_border&nbsp;+&nbsp;verti_shift&nbsp;/&nbsp;2&nbsp;)&nbsp;<span class="constructor">Graphics</span>.blue&nbsp;<span class="constructor">Graphics</span>.black&nbsp;[|&nbsp;<span class="string">""</span>&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hs0&nbsp;:=&nbsp;<span class="constructor">Widget</span>.hat_switch&nbsp;hori_shift&nbsp;verti_mid&nbsp;<span class="constructor">Graphics</span>.cyan&nbsp;<span class="constructor">Graphics</span>.black&nbsp;[|&nbsp;<span class="string">""</span>&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vt&nbsp;:=&nbsp;<span class="constructor">Widget</span>.int_vernier&nbsp;hori_shift&nbsp;(&nbsp;2&nbsp;*&nbsp;h_border&nbsp;)&nbsp;small_radius&nbsp;<span class="constructor">Graphics</span>.red&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.magenta&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.black&nbsp;steps&nbsp;verti_range&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;:=&nbsp;<span class="constructor">Widget</span>.string_edit&nbsp;hori_shift&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;2&nbsp;*&nbsp;h_border&nbsp;)&nbsp;(&nbsp;3&nbsp;*&nbsp;hori_shift&nbsp;/&nbsp;2&nbsp;)&nbsp;<span class="constructor">Graphics</span>.black&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;!top_initial&nbsp;!top_final&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;refresh_top&nbsp;:=&nbsp;<span class="constructor">Widget</span>.rect_switch&nbsp;hori_shift&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;h_border&nbsp;-&nbsp;verti_shift&nbsp;)&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.black&nbsp;refresh_message&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hs1&nbsp;:=&nbsp;<span class="constructor">Widget</span>.hat_switch&nbsp;(&nbsp;hori_size&nbsp;-&nbsp;hori_shift&nbsp;)&nbsp;verti_mid&nbsp;<span class="constructor">Graphics</span>.cyan&nbsp;<span class="constructor">Graphics</span>.black&nbsp;[|&nbsp;<span class="string">""</span>&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cs1&nbsp;:=&nbsp;<span class="constructor">Widget</span>.cup_switch&nbsp;(&nbsp;hori_size&nbsp;-&nbsp;hori_shift&nbsp;)&nbsp;(&nbsp;h_border&nbsp;+&nbsp;verti_shift&nbsp;/&nbsp;2&nbsp;)&nbsp;<span class="constructor">Graphics</span>.blue&nbsp;<span class="constructor">Graphics</span>.black&nbsp;[|&nbsp;<span class="string">""</span>&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vb&nbsp;:=&nbsp;<span class="constructor">Widget</span>.float_vernier&nbsp;(&nbsp;hori_size&nbsp;-&nbsp;hori_shift&nbsp;)&nbsp;(&nbsp;2&nbsp;*&nbsp;h_border&nbsp;)&nbsp;small_radius&nbsp;<span class="constructor">Graphics</span>.red&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.magenta&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.black&nbsp;steps&nbsp;verti_grid&nbsp;mark.(3)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seb&nbsp;:=&nbsp;<span class="constructor">Widget</span>.string_edit&nbsp;(&nbsp;1&nbsp;+&nbsp;hori_size&nbsp;-&nbsp;hori_shift&nbsp;)&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;2&nbsp;*&nbsp;h_border&nbsp;)&nbsp;(&nbsp;3&nbsp;*&nbsp;hori_shift&nbsp;/&nbsp;2&nbsp;)&nbsp;<span class="constructor">Graphics</span>.black&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;!bottom_initial&nbsp;!bottom_final&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;refresh_bottom&nbsp;:=&nbsp;<span class="constructor">Widget</span>.rect_switch&nbsp;(&nbsp;hori_size&nbsp;-&nbsp;hori_shift&nbsp;)&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;h_border&nbsp;-&nbsp;verti_shift&nbsp;)&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.black&nbsp;refresh_message&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trace_verti&nbsp;:=&nbsp;w_border&nbsp;+&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trace_hori&nbsp;:=&nbsp;h_border&nbsp;+&nbsp;h_pic&nbsp;-&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;!first_time&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;display_float_rgb&nbsp;w_border&nbsp;h_border&nbsp;reduc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relative_draw_column_float_rgb&nbsp;w_border&nbsp;h_border&nbsp;reduc&nbsp;obsolete.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relative_draw_line_float_rgb&nbsp;w_border&nbsp;h_border&nbsp;reduc&nbsp;obsolete.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Graphics</span>.set_color&nbsp;<span class="constructor">Graphics</span>.red&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Graphics</span>.draw_segments&nbsp;[|&nbsp;(&nbsp;!trace_verti&nbsp;,&nbsp;h_border&nbsp;+&nbsp;1&nbsp;,&nbsp;!trace_verti&nbsp;,&nbsp;h_border&nbsp;+&nbsp;h_pic&nbsp;-&nbsp;2&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;w_border&nbsp;+&nbsp;1&nbsp;,&nbsp;!trace_hori&nbsp;,&nbsp;w_border&nbsp;+&nbsp;w_pic&nbsp;-&nbsp;2&nbsp;,&nbsp;!trace_hori&nbsp;)&nbsp;|]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** f_init *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;f_end&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;<span class="constructor">Graphics</span>.close_graph&nbsp;()&nbsp;;&nbsp;raise&nbsp;<span class="constructor">Widget</span>.<span class="constructor">End</span>&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;f_key&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;c&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;current_character&nbsp;:=&nbsp;<span class="constructor">Char</span>.escaped&nbsp;c&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f_mouse&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;y&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** f_mouse *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first_time&nbsp;:=&nbsp;<span class="keyword">false</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;left_choice&nbsp;=&nbsp;<span class="constructor">Widget</span>.over_int_vernier&nbsp;!vl&nbsp;x&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;top_choice&nbsp;=&nbsp;<span class="constructor">Widget</span>.over_int_vernier&nbsp;!vt&nbsp;x&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;right_choice&nbsp;=&nbsp;<span class="constructor">Widget</span>.over_float_vernier&nbsp;!vr&nbsp;x&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;bottom_choice&nbsp;=&nbsp;<span class="constructor">Widget</span>.over_float_vernier&nbsp;!vb&nbsp;x&nbsp;y&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_rect_button&nbsp;!cancel&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(0)&nbsp;&lt;-&nbsp;-1.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(1)&nbsp;&lt;-&nbsp;-1.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(2)&nbsp;&lt;-&nbsp;0.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(3)&nbsp;&lt;-&nbsp;0.&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_end&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_rect_button&nbsp;!ok&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_end&nbsp;()&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_rect_button&nbsp;!grab&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;<span class="constructor">Unix</span>.localtime&nbsp;(&nbsp;<span class="constructor">Unix</span>.time&nbsp;()&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date&nbsp;:=&nbsp;(&nbsp;string_of_int&nbsp;(&nbsp;1900&nbsp;+&nbsp;d.<span class="constructor">Unix</span>.tm_year&nbsp;)&nbsp;)&nbsp;^&nbsp;<span class="string">"."</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;(&nbsp;succ&nbsp;d.<span class="constructor">Unix</span>.tm_mon&nbsp;)&nbsp;)&nbsp;^&nbsp;<span class="string">"."</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;d.<span class="constructor">Unix</span>.tm_mday&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;<span class="string">"."</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;d.<span class="constructor">Unix</span>.tm_hour&nbsp;)&nbsp;^&nbsp;<span class="string">"."</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;&nbsp;d.<span class="constructor">Unix</span>.tm_min)&nbsp;^&nbsp;<span class="string">"."</span>&nbsp;^&nbsp;(&nbsp;string_of_int&nbsp;d.<span class="constructor">Unix</span>.tm_sec&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;save_name&nbsp;:=&nbsp;<span class="string">"Analogic.float_rgb_mark_image-"</span>&nbsp;^&nbsp;!date&nbsp;^&nbsp;<span class="string">".ppm"</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Readwrite</span>.write_ppm_binary_color&nbsp;(&nbsp;<span class="constructor">Graphics</span>.dump_image&nbsp;(&nbsp;<span class="constructor">Graphics</span>.get_image&nbsp;0&nbsp;0&nbsp;hori_size&nbsp;verti_size&nbsp;)&nbsp;)&nbsp;!save_name&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grab_message&nbsp;:=&nbsp;<span class="string">"&nbsp;Last&nbsp;grab&nbsp;:&nbsp;"</span>&nbsp;^&nbsp;!save_name&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_rect_button&nbsp;picture&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obsolete.(0)&nbsp;&lt;-&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obsolete.(1)&nbsp;&lt;-&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(0)&nbsp;&lt;-&nbsp;float&nbsp;(&nbsp;(&nbsp;x&nbsp;-&nbsp;w_border&nbsp;)&nbsp;*&nbsp;factor&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(1)&nbsp;&lt;-&nbsp;float&nbsp;(&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;h_border&nbsp;-&nbsp;y&nbsp;)&nbsp;*&nbsp;factor&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_left_button&nbsp;!ls0&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obsolete.(0)&nbsp;&lt;-&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(0)&nbsp;&lt;-&nbsp;max&nbsp;0.&nbsp;(&nbsp;mark.(0)&nbsp;-.&nbsp;1.&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_right_button&nbsp;!rs0&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obsolete.(0)&nbsp;&lt;-&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(0)&nbsp;&lt;-&nbsp;1.&nbsp;+.&nbsp;(&nbsp;min&nbsp;ww&nbsp;mark.(0)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_hat_button&nbsp;!hs0&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obsolete.(1)&nbsp;&lt;-&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(1)&nbsp;&lt;-&nbsp;max&nbsp;0.&nbsp;(&nbsp;mark.(1)&nbsp;-.&nbsp;1.&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_cup_button&nbsp;!cs0&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obsolete.(1)&nbsp;&lt;-&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(1)&nbsp;&lt;-&nbsp;1.&nbsp;+.&nbsp;(&nbsp;min&nbsp;hh&nbsp;mark.(1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_left_button&nbsp;!ls3&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(2)&nbsp;&lt;-&nbsp;0.1&nbsp;*.&nbsp;(&nbsp;float&nbsp;(&nbsp;int_of_float&nbsp;&nbsp;(&nbsp;10.&nbsp;*.&nbsp;mark.(2)&nbsp;-.&nbsp;1.&nbsp;)&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_right_button&nbsp;!rs3&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(2)&nbsp;&lt;-&nbsp;0.1&nbsp;*.&nbsp;(&nbsp;float&nbsp;(&nbsp;int_of_float&nbsp;(&nbsp;10.&nbsp;*.&nbsp;mark.(2)&nbsp;+.&nbsp;1.&nbsp;)&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_hat_button&nbsp;!hs1&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(3)&nbsp;&lt;-&nbsp;0.1&nbsp;*.&nbsp;(&nbsp;float&nbsp;(&nbsp;int_of_float&nbsp;(&nbsp;10.&nbsp;*.&nbsp;mark.(3)&nbsp;+.&nbsp;1.&nbsp;)&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_cup_button&nbsp;!cs1&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(3)&nbsp;&lt;-&nbsp;0.1&nbsp;*.&nbsp;(&nbsp;float&nbsp;(&nbsp;int_of_float&nbsp;&nbsp;(&nbsp;10.&nbsp;*.&nbsp;mark.(3)&nbsp;-.&nbsp;1.&nbsp;)&nbsp;)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;<span class="constructor">Widget</span>.is_over_rect_button&nbsp;!refresh_left&nbsp;x&nbsp;y&nbsp;)&nbsp;<span class="keywordsign">||</span>&nbsp;(&nbsp;<span class="constructor">Widget</span>.is_over_rect_button&nbsp;!refresh_right&nbsp;x&nbsp;y&nbsp;)&nbsp;<span class="keywordsign">||</span>&nbsp;(&nbsp;<span class="constructor">Widget</span>.is_over_rect_button&nbsp;!refresh_top&nbsp;x&nbsp;y&nbsp;)&nbsp;<span class="keywordsign">||</span>&nbsp;(&nbsp;<span class="constructor">Widget</span>.is_over_rect_button&nbsp;!refresh_bottom&nbsp;x&nbsp;y&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">then</span>&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;left_choice&nbsp;!=&nbsp;int_of_float&nbsp;mark.(0)&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obsolete.(0)&nbsp;&lt;-&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(0)&nbsp;&lt;-&nbsp;float&nbsp;left_choice&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl&nbsp;:=&nbsp;<span class="constructor">Widget</span>.int_vernier&nbsp;(&nbsp;w_border&nbsp;+&nbsp;(&nbsp;3&nbsp;*&nbsp;hori_shift&nbsp;/&nbsp;2&nbsp;)&nbsp;)&nbsp;verti_shift&nbsp;small_radius&nbsp;<span class="constructor">Graphics</span>.red&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.magenta&nbsp;<span class="constructor">Graphics</span>.black&nbsp;<span class="constructor">Graphics</span>.white&nbsp;steps&nbsp;hori_range&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;top_choice&nbsp;!=&nbsp;int_of_float&nbsp;mark.(1)&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obsolete.(1)&nbsp;&lt;-&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(1)&nbsp;&lt;-&nbsp;float&nbsp;top_choice&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vt&nbsp;:=&nbsp;<span class="constructor">Widget</span>.int_vernier&nbsp;hori_shift&nbsp;(&nbsp;2&nbsp;*&nbsp;h_border&nbsp;)&nbsp;small_radius&nbsp;<span class="constructor">Graphics</span>.red&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.magenta&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.black&nbsp;steps&nbsp;verti_range&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;(&nbsp;right_choice&nbsp;-.&nbsp;mark.(2)&nbsp;)&nbsp;&gt;&nbsp;threshold&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(2)&nbsp;&lt;-&nbsp;right_choice&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vr&nbsp;:=&nbsp;<span class="constructor">Widget</span>.float_vernier&nbsp;(&nbsp;w_border&nbsp;+&nbsp;(&nbsp;3&nbsp;*&nbsp;hori_shift&nbsp;/&nbsp;2&nbsp;)&nbsp;)&nbsp;(&nbsp;verti_size&nbsp;-&nbsp;verti_shift&nbsp;)&nbsp;small_radius&nbsp;<span class="constructor">Graphics</span>.red&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.magenta&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.black&nbsp;steps&nbsp;hori_grid&nbsp;mark.(2)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;abs_float&nbsp;(&nbsp;bottom_choice&nbsp;-.&nbsp;mark.(3)&nbsp;)&nbsp;&gt;&nbsp;threshold&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(3)&nbsp;&lt;-&nbsp;bottom_choice&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vb&nbsp;:=&nbsp;<span class="constructor">Widget</span>.float_vernier&nbsp;(&nbsp;hori_size&nbsp;-&nbsp;hori_shift&nbsp;)&nbsp;(&nbsp;2&nbsp;*&nbsp;h_border&nbsp;)&nbsp;small_radius&nbsp;<span class="constructor">Graphics</span>.red&nbsp;<span class="constructor">Graphics</span>.yellow&nbsp;<span class="constructor">Graphics</span>.magenta&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.black&nbsp;steps&nbsp;verti_grid&nbsp;mark.(3)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_init&nbsp;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_string_edit&nbsp;!sel&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ev&nbsp;=&nbsp;ref&nbsp;(&nbsp;<span class="constructor">Graphics</span>.wait_next_event&nbsp;[&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Key_pressed</span>&nbsp;;&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Button_down</span>&nbsp;]&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_left&nbsp;=&nbsp;string_of_int&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_obs&nbsp;=&nbsp;obsolete.(0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_initial&nbsp;=&nbsp;!left_initial<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_final&nbsp;=&nbsp;!left_final&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;(&nbsp;!ev.<span class="constructor">Graphics</span>.keypressed&nbsp;)&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;not&nbsp;(&nbsp;<span class="constructor">Graphics</span>.button_down&nbsp;()&nbsp;)&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_key&nbsp;(&nbsp;!ev.<span class="constructor">Graphics</span>.key&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;res&nbsp;=&nbsp;<span class="constructor">Widget</span>.string_treatment&nbsp;!left_initial&nbsp;!left_final&nbsp;!current_character&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left_initial&nbsp;:=&nbsp;res.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left_final&nbsp;:=&nbsp;res.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obsolete.(0)&nbsp;&lt;-&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(0)&nbsp;&lt;-&nbsp;float&nbsp;(&nbsp;int_of_string&nbsp;(&nbsp;!left_initial&nbsp;^&nbsp;!left_final&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">Failure</span>&nbsp;unknown&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;obsolete.(0)&nbsp;&lt;-&nbsp;old_obs&nbsp;;&nbsp;mark.(0)&nbsp;&lt;-&nbsp;float&nbsp;(&nbsp;int_of_string&nbsp;old_left&nbsp;)&nbsp;;&nbsp;left_initial&nbsp;:=&nbsp;old_initial&nbsp;;&nbsp;left_final&nbsp;:=&nbsp;old_final&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relative_draw_column_float_rgb&nbsp;w_border&nbsp;h_border&nbsp;reduc&nbsp;obsolete.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relative_draw_column_float_rgb&nbsp;w_border&nbsp;h_border&nbsp;reduc&nbsp;(&nbsp;int_of_float&nbsp;mark.(0)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sel&nbsp;:=&nbsp;<span class="constructor">Widget</span>.string_edit&nbsp;(&nbsp;int_of_string&nbsp;!sel.(0)&nbsp;)&nbsp;(&nbsp;int_of_string&nbsp;!sel.(1)&nbsp;)&nbsp;(&nbsp;int_of_string&nbsp;!sel.(2)&nbsp;)&nbsp;<span class="constructor">Graphics</span>.black&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.green&nbsp;!left_initial&nbsp;!left_final&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev&nbsp;:=&nbsp;<span class="constructor">Graphics</span>.wait_next_event&nbsp;[&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Key_pressed</span>&nbsp;;&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Button_down</span>&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_string_edit&nbsp;!set&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ev&nbsp;=&nbsp;ref&nbsp;(&nbsp;<span class="constructor">Graphics</span>.wait_next_event&nbsp;[&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Key_pressed</span>&nbsp;;&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Button_down</span>&nbsp;]&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_top&nbsp;=&nbsp;string_of_int&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_obs&nbsp;=&nbsp;obsolete.(1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_initial&nbsp;=&nbsp;!top_initial<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_final&nbsp;=&nbsp;!top_final&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;(&nbsp;!ev.<span class="constructor">Graphics</span>.keypressed&nbsp;)&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;not&nbsp;(&nbsp;<span class="constructor">Graphics</span>.button_down&nbsp;()&nbsp;)&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_key&nbsp;(&nbsp;!ev.<span class="constructor">Graphics</span>.key&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;res&nbsp;=&nbsp;<span class="constructor">Widget</span>.string_treatment&nbsp;!top_initial&nbsp;!top_final&nbsp;!current_character&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;top_initial&nbsp;:=&nbsp;res.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;top_final&nbsp;:=&nbsp;res.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obsolete.(1)&nbsp;&lt;-&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)&nbsp;/&nbsp;factor&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(1)&nbsp;&lt;-&nbsp;float&nbsp;(&nbsp;int_of_string&nbsp;(&nbsp;!top_initial&nbsp;^&nbsp;!top_final&nbsp;)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">Failure</span>&nbsp;unknown&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;obsolete.(1)&nbsp;&lt;-&nbsp;old_obs&nbsp;;&nbsp;mark.(1)&nbsp;&lt;-&nbsp;float&nbsp;(&nbsp;int_of_string&nbsp;old_top&nbsp;)&nbsp;;&nbsp;top_initial&nbsp;:=&nbsp;old_initial&nbsp;;&nbsp;top_final&nbsp;:=&nbsp;old_final&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relative_draw_line_float_rgb&nbsp;w_border&nbsp;h_border&nbsp;reduc&nbsp;obsolete.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relative_draw_line_float_rgb&nbsp;w_border&nbsp;h_border&nbsp;reduc&nbsp;(&nbsp;int_of_float&nbsp;mark.(1)&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;:=&nbsp;<span class="constructor">Widget</span>.string_edit&nbsp;(&nbsp;int_of_string&nbsp;!set.(0)&nbsp;)&nbsp;(&nbsp;int_of_string&nbsp;!set.(1)&nbsp;)&nbsp;(&nbsp;int_of_string&nbsp;!set.(2)&nbsp;)&nbsp;<span class="constructor">Graphics</span>.black&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.green&nbsp;!top_initial&nbsp;!top_final&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev&nbsp;:=&nbsp;<span class="constructor">Graphics</span>.wait_next_event&nbsp;[&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Key_pressed</span>&nbsp;;&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Button_down</span>&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_string_edit&nbsp;!ser&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ev&nbsp;=&nbsp;ref&nbsp;(&nbsp;<span class="constructor">Graphics</span>.wait_next_event&nbsp;[&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Key_pressed</span>&nbsp;;&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Button_down</span>&nbsp;]&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_right&nbsp;=&nbsp;f_string&nbsp;(&nbsp;string_of_float&nbsp;mark.(2)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_initial&nbsp;=&nbsp;!right_initial<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_final&nbsp;=&nbsp;!right_final&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;(&nbsp;!ev.<span class="constructor">Graphics</span>.keypressed&nbsp;)&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;not&nbsp;(&nbsp;<span class="constructor">Graphics</span>.button_down&nbsp;()&nbsp;)&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_key&nbsp;(&nbsp;!ev.<span class="constructor">Graphics</span>.key&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;res&nbsp;=&nbsp;<span class="constructor">Widget</span>.string_treatment&nbsp;!right_initial&nbsp;!right_final&nbsp;!current_character&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right_initial&nbsp;:=&nbsp;res.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right_final&nbsp;:=&nbsp;res.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(2)&nbsp;&lt;-&nbsp;float_of_string&nbsp;(&nbsp;!right_initial&nbsp;^&nbsp;!right_final&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">Failure</span>&nbsp;unknown&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;mark.(2)&nbsp;&lt;-&nbsp;float_of_string&nbsp;old_right&nbsp;;&nbsp;right_initial&nbsp;:=&nbsp;old_initial&nbsp;;&nbsp;right_final&nbsp;:=&nbsp;old_final&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ser&nbsp;:=&nbsp;<span class="constructor">Widget</span>.string_edit&nbsp;(&nbsp;int_of_string&nbsp;!ser.(0)&nbsp;)&nbsp;(&nbsp;int_of_string&nbsp;!ser.(1)&nbsp;)&nbsp;(&nbsp;int_of_string&nbsp;!ser.(2)&nbsp;)&nbsp;<span class="constructor">Graphics</span>.black&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.green&nbsp;!right_initial&nbsp;!right_final&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev&nbsp;:=&nbsp;<span class="constructor">Graphics</span>.wait_next_event&nbsp;[&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Key_pressed</span>&nbsp;;&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Button_down</span>&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Widget</span>.is_over_string_edit&nbsp;!seb&nbsp;x&nbsp;y&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ev&nbsp;=&nbsp;ref&nbsp;(&nbsp;<span class="constructor">Graphics</span>.wait_next_event&nbsp;[&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Key_pressed</span>&nbsp;;&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Button_down</span>&nbsp;]&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_bottom&nbsp;=&nbsp;f_string&nbsp;(&nbsp;string_of_float&nbsp;mark.(3)&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_initial&nbsp;=&nbsp;!bottom_initial<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;old_final&nbsp;=&nbsp;!bottom_final&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span>&nbsp;(&nbsp;!ev.<span class="constructor">Graphics</span>.keypressed&nbsp;)&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;(&nbsp;not&nbsp;(&nbsp;<span class="constructor">Graphics</span>.button_down&nbsp;()&nbsp;)&nbsp;)&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f_key&nbsp;(&nbsp;!ev.<span class="constructor">Graphics</span>.key&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;res&nbsp;=&nbsp;<span class="constructor">Widget</span>.string_treatment&nbsp;!bottom_initial&nbsp;!bottom_final&nbsp;!current_character&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bottom_initial&nbsp;:=&nbsp;res.(0)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bottom_final&nbsp;:=&nbsp;res.(1)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark.(3)&nbsp;&lt;-&nbsp;float_of_string&nbsp;(&nbsp;!bottom_initial&nbsp;^&nbsp;!bottom_final&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">Failure</span>&nbsp;unknown&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;mark.(3)&nbsp;&lt;-&nbsp;float_of_string&nbsp;old_bottom&nbsp;;&nbsp;bottom_initial&nbsp;:=&nbsp;old_initial&nbsp;;&nbsp;bottom_final&nbsp;:=&nbsp;old_final&nbsp;)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seb&nbsp;:=&nbsp;<span class="constructor">Widget</span>.string_edit&nbsp;(&nbsp;int_of_string&nbsp;!seb.(0)&nbsp;)&nbsp;(&nbsp;int_of_string&nbsp;!seb.(1)&nbsp;)&nbsp;(&nbsp;int_of_string&nbsp;!seb.(2)&nbsp;)&nbsp;<span class="constructor">Graphics</span>.black&nbsp;<span class="constructor">Graphics</span>.white&nbsp;<span class="constructor">Graphics</span>.green&nbsp;!bottom_initial&nbsp;!bottom_final&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev&nbsp;:=&nbsp;<span class="constructor">Graphics</span>.wait_next_event&nbsp;[&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Key_pressed</span>&nbsp;;&nbsp;<span class="constructor">Graphics</span>.<span class="constructor">Button_down</span>&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** f_mouse *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">and</span>&nbsp;f_except&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;unknown&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;<span class="constructor">Graphics</span>.close_graph&nbsp;()&nbsp;;&nbsp;raise&nbsp;<span class="constructor">Widget</span>.<span class="constructor">End</span>&nbsp;)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Widget</span>.skeleton&nbsp;f_init&nbsp;f_end&nbsp;f_key&nbsp;f_mouse&nbsp;f_except&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">Widget</span>.<span class="constructor">End</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Gc</span>.compact&nbsp;()&nbsp;;<br>
&nbsp;mark</code></body></html>